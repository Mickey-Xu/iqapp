{"ast":null,"code":"import _objectSpread from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import*as api from\"api\";import{createDb,db}from\"js/db\";import*as schema from\"js/schema\";import store from\"js/store\";import{fittersAssignmentTransferProc,groupInfoProc,orderActivitiesSort,templatesConverter,localInstallationStepsConfirmDateProc,getNonConformityConfig}from\"js/util\";import{normalize}from\"normalizr\";import _ from\"lodash\";import{taskDataConversion}from\"./util\";export var type={CACHE:0,API:1};export var initDB=function initDB(){var state=store.getState();var personalNumber=state.auth.personalNumber;createDb(personalNumber);};export var fetchProfile=function fetchProfile(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.getProfile().then(function(response){createDb(response.data.personalNumber);return db.cache.put({id:\"auth\",data:response.data}).then(function(){return Promise.resolve(response.data);});});}if(param===type.CACHE){return db.cache.get(\"auth\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchProfile();}});}};export var fetchMasterData=function fetchMasterData(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.fetchMasterData().then(function(response){var _normalize=normalize(response.data,schema.masterData),entities=_normalize.entities;entities[\"nonConformityConfig\"]=getNonConformityConfig();return db.cache.put({id:\"masterData\",data:entities}).then(function(){return Promise.resolve(entities);});});}if(param===type.CACHE){return db.cache.get(\"masterData\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchMasterData();}});}};export var fetchOrdersData=function fetchOrdersData(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.fetchOrdersData().then(function(response){var data=response.data;data.orderActivities=orderActivitiesSort(data.orderActivities);var _normalize2=normalize(response.data,schema.ordersData),entities=_normalize2.entities;return db.cache.put({id:\"ordersData\",data:entities}).then(function(){return Promise.resolve(entities);});});}if(param===type.CACHE){return db.cache.get(\"ordersData\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchOrdersData();}});}};function customizer(objValue,srcValue){if(_.isArray(objValue)){return objValue.concat(srcValue);}}export var fetchOrdersDataByProjects=function fetchOrdersDataByProjects(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;var projects=arguments.length>1?arguments[1]:undefined;var step=arguments.length>2?arguments[2]:undefined;var auth=store.getState().auth;if(param===type.API){var promises=[];var splitCount=Math.ceil(projects.length/step);for(var i=0;i<splitCount;i++){var ps={projectNos:projects.slice(i*step,(i+1)*step)};promises.push(api.fetchOrdersDataByProjects(ps));}if(promises.length===0){// Just get the error message through call api\nvar message=(auth===null||auth===void 0?void 0:auth.roles[0])===\"SL\"?\"请到我的->同步界面上，点最右上角的同步按钮同步数据\":\"未发现该用户的订单信息\";return Promise.reject({message:message});}var result={};var fulfilledValues=[];return Promise.allSettled(promises).then(function(results){results.forEach(function(result){if(result.status===\"fulfilled\"){fulfilledValues.push(result.value);}});if(fulfilledValues.length===0){var _message=(auth===null||auth===void 0?void 0:auth.roles[0])===\"SL\"?\"请到我的->同步界面上，点最右上角的同步按钮同步数据\":\"未发现该用户的订单信息\";return Promise.reject({message:_message});}else{for(var _i=0;_i<fulfilledValues.length;_i++){_.mergeWith(result,fulfilledValues[_i].data,customizer);}result.orderActivities=orderActivitiesSort(result.orderActivities);var _normalize3=normalize(result,schema.ordersData),entities=_normalize3.entities;return db.cache.put({id:\"ordersData\",data:entities}).then(function(){return Promise.resolve(entities);});}});}if(param===type.CACHE){return db.cache.get(\"ordersData\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchOrdersDataByProjects(type.API,projects,step);}});}};export var fetchTemplatesData=function fetchTemplatesData(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.fetchTemplatesData().then(function(response){var data=templatesConverter(response.data);return db.cache.put({id:\"templatesData\",data:data}).then(function(){return Promise.resolve(data);});});}if(param===type.CACHE){return db.cache.get(\"templatesData\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchTemplatesData();}});}};export var fetchGroupInfo=function fetchGroupInfo(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.fetchGroupInfo().then(function(response){var data=groupInfoProc(response.data);return db.cache.put({id:\"groupInfo\",data:data}).then(function(){return Promise.resolve(data);});});}if(param===type.CACHE){return db.cache.get(\"groupInfo\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchGroupInfo();}});}};export var updateOrderActivities=function updateOrderActivities(data){return db.cache.get(\"ordersData\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var orderActivities=cache.data.orderActivities;orderActivities=_objectSpread(_objectSpread({},orderActivities),data.orderActivities);var newOrdersData=_objectSpread({},cache.data);newOrdersData.orderActivities=orderActivities;return db.cache.put({id:\"ordersData\",data:newOrdersData});}else{return Promise.resolve(data);}});};export var fetchLocalInstallationStepsConfirmDate=function fetchLocalInstallationStepsConfirmDate(data){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:type.API;if(param===type.API){var promises=[];var projects=data.projectNos;var step=70;var splitCount=Math.ceil(projects.length/step);for(var i=0;i<splitCount;i++){var ps={projectNos:projects.slice(i*step,(i+1)*step)};promises.push(api.getLocalInstallationStepConfirmDate(ps));}if(promises.length===0){var _data=localInstallationStepsConfirmDateProc([]);return db.cache.put({id:\"localInstallationStepsConfirmDate\",data:_data}).then(function(){return Promise.resolve(_data);});}return Promise.all(promises).then(function(response){var res=[];for(var _i2=0;_i2<splitCount;_i2++){res=res.concat(response[_i2].data);}var data=localInstallationStepsConfirmDateProc(res);return db.cache.put({id:\"localInstallationStepsConfirmDate\",data:data}).then(function(){return Promise.resolve(data);});});}if(param===type.CACHE){return db.cache.get(\"localInstallationStepsConfirmDate\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchLocalInstallationStepsConfirmDate(data);}});}};export var updateLocalInstallationStepConfirmDate=function updateLocalInstallationStepConfirmDate(data){return db.cache.get(\"localInstallationStepsConfirmDate\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var localInstallationStepsConfirmDates=_objectSpread({},cache.data);localInstallationStepsConfirmDates[data.orderNo+\"-\"+data.stepNo]=data;return db.cache.put({id:\"localInstallationStepsConfirmDate\",data:localInstallationStepsConfirmDates});}else{return Promise.resolve(data);}});};export var fetchFittersDemand=function fetchFittersDemand(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.fetchFittersDemand().then(function(response){var _normalize4=normalize(response.data,schema.fittersDemands),entities=_normalize4.entities;return db.cache.put({id:\"fittersDemand\",data:entities.fittersDemand}).then(function(){return Promise.resolve(entities.fittersDemand);});});}if(param===type.CACHE){return db.cache.get(\"fittersDemand\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchFittersDemand();}});}};export var fetchFittersCertification=function fetchFittersCertification(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.fetchFittersCertification().then(function(response){var _normalize5=normalize(response.data,schema.fittersCertifications),entities=_normalize5.entities;return db.cache.put({id:\"fittersCertification\",data:entities.fittersCertification}).then(function(){return Promise.resolve(entities.fittersCertification);});});}if(param===type.CACHE){return db.cache.get(\"fittersCertification\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchFittersCertification();}});}};export var fetchFittersAssignmentTransfer=function fetchFittersAssignmentTransfer(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.fetchFittersAssignmentTransfer().then(function(response){var fittersAssignmentTransfer=fittersAssignmentTransferProc(response.data);return db.cache.put({id:\"fittersAssignmentTransfer\",data:fittersAssignmentTransfer}).then(function(){return Promise.resolve(fittersAssignmentTransfer);});});}if(param===type.CACHE){return db.cache.get(\"fittersAssignmentTransfer\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchFittersAssignmentTransfer();}});}};export var updateFittersAssignmentTransfer=function updateFittersAssignmentTransfer(data){return db.cache.get(\"fittersAssignmentTransfer\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var newData=_objectSpread({},cache.data);var extfittersAssignmentTransfer=fittersAssignmentTransferProc(data);newData=_objectSpread(_objectSpread({},newData),extfittersAssignmentTransfer);return db.cache.put({id:\"fittersAssignmentTransfer\",data:newData});}else{return Promise.resolve(data);}});};export var fetchDocumentList=function fetchDocumentList(request){var param=arguments.length>1&&arguments[1]!==undefined?arguments[1]:type.API;if(param===type.API){return api.getDocumentList(request).then(function(response){return db.cache.put({id:\"documentList\",data:response.data}).then(function(){return Promise.resolve(response.data);});});}if(param===type.CACHE){return db.cache.get(\"documentList\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchDocumentList(request);}});}};export var fetchInstalltionMethodDict=function fetchInstalltionMethodDict(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.getInstallationMethodDict().then(function(response){return db.cache.put({id:\"InstalltionMethodDict\",data:response.data}).then(function(){return Promise.resolve(response.data);});});}if(param===type.CACHE){return db.cache.get(\"InstalltionMethodDict\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchInstalltionMethodDict();}});}};export var updateDocumentList=function updateDocumentList(data){return db.cache.get(\"documentList\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var projectNo=data.projectNo,orderNo=data.orderNo,activityNo=data.activityNo,documentName=data.documentName,modified=data.modified;var newData=_objectSpread({},cache.data);if(!newData[projectNo]){newData[projectNo]={};}if(!newData[projectNo][orderNo]){newData[projectNo][orderNo]={};}if(!newData[projectNo][orderNo][activityNo]){newData[projectNo][orderNo][activityNo]=[];}if(newData[projectNo][orderNo][activityNo].some(function(e){return e.name===documentName;})){newData[projectNo][orderNo][activityNo].forEach(function(item){if(item.name===documentName){item.modified=modified;}});}else{newData[projectNo][orderNo][activityNo].push({name:documentName,modified:modified});}return db.cache.put({id:\"documentList\",data:newData});}else{return Promise.resolve(data);}});};export var removeCachedData=function removeCachedData(){db.cache.clear();};export var fetchTasks=function fetchTasks(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){var auth=JSON.parse(window.localStorage.getItem(\"auth\"));return api.fetchIDPTTasks(auth.userName).then(function(response){var _response$data;var resp=(_response$data=response.data)===null||_response$data===void 0?void 0:_response$data.data.map(function(item){return taskDataConversion(item);});return db.cache.put({id:\"tasks\",data:resp}).then(function(){return Promise.resolve(resp);});});}if(param===type.CACHE){return db.cache.get(\"tasks\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchTasks();}});}};export var fetchInstMethods=function fetchInstMethods(){var param=arguments.length>0&&arguments[0]!==undefined?arguments[0]:type.API;if(param===type.API){return api.getInstMethods().then(function(response){return db.cache.put({id:\"instMethods\",data:response.data}).then(function(){return Promise.resolve(response.data);});});}if(param===type.CACHE){return db.cache.get(\"instMethods\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data);}else{return fetchTasks();}});}};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/js/fetch.js"],"names":["api","createDb","db","schema","store","fittersAssignmentTransferProc","groupInfoProc","orderActivitiesSort","templatesConverter","localInstallationStepsConfirmDateProc","getNonConformityConfig","normalize","_","taskDataConversion","type","CACHE","API","initDB","state","getState","personalNumber","auth","fetchProfile","param","getProfile","then","response","data","cache","put","id","Promise","resolve","get","fetchMasterData","masterData","entities","fetchOrdersData","orderActivities","ordersData","customizer","objValue","srcValue","isArray","concat","fetchOrdersDataByProjects","projects","step","promises","splitCount","Math","ceil","length","i","ps","projectNos","slice","push","message","roles","reject","result","fulfilledValues","allSettled","results","forEach","status","value","mergeWith","fetchTemplatesData","fetchGroupInfo","updateOrderActivities","newOrdersData","fetchLocalInstallationStepsConfirmDate","getLocalInstallationStepConfirmDate","all","res","updateLocalInstallationStepConfirmDate","localInstallationStepsConfirmDates","orderNo","stepNo","fetchFittersDemand","fittersDemands","fittersDemand","fetchFittersCertification","fittersCertifications","fittersCertification","fetchFittersAssignmentTransfer","fittersAssignmentTransfer","updateFittersAssignmentTransfer","newData","extfittersAssignmentTransfer","fetchDocumentList","request","getDocumentList","fetchInstalltionMethodDict","getInstallationMethodDict","updateDocumentList","projectNo","activityNo","documentName","modified","some","e","name","item","removeCachedData","clear","fetchTasks","JSON","parse","window","localStorage","getItem","fetchIDPTTasks","userName","resp","map","fetchInstMethods","getInstMethods"],"mappings":"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","sourcesContent":["import * as api from \"api\";\r\nimport { createDb, db } from \"js/db\";\r\nimport * as schema from \"js/schema\";\r\nimport store from \"js/store\";\r\nimport {\r\n  fittersAssignmentTransferProc,\r\n  groupInfoProc,\r\n  orderActivitiesSort,\r\n  templatesConverter,\r\n  localInstallationStepsConfirmDateProc,\r\n  getNonConformityConfig\r\n} from \"js/util\";\r\nimport { normalize } from \"normalizr\";\r\nimport _ from \"lodash\";\r\nimport { taskDataConversion } from \"./util\";\r\n\r\nexport const type = {\r\n  CACHE: 0,\r\n  API: 1,\r\n};\r\n\r\nexport const initDB = () => {\r\n  const state = store.getState();\r\n  const personalNumber = state.auth.personalNumber;\r\n  createDb(personalNumber);\r\n};\r\n\r\nexport const fetchProfile = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.getProfile().then((response) => {\r\n      createDb(response.data.personalNumber);\r\n      return db.cache.put({ id: \"auth\", data: response.data }).then(() => {\r\n        return Promise.resolve(response.data);\r\n      });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"auth\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchProfile();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchMasterData = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.fetchMasterData().then((response) => {\r\n      const { entities } = normalize(response.data, schema.masterData);\r\n      entities[\"nonConformityConfig\"] = getNonConformityConfig();\r\n      return db.cache.put({ id: \"masterData\", data: entities }).then(() => {\r\n        return Promise.resolve(entities);\r\n      });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"masterData\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchMasterData();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchOrdersData = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.fetchOrdersData().then((response) => {\r\n      const data = response.data;\r\n      data.orderActivities = orderActivitiesSort(data.orderActivities);\r\n      const { entities } = normalize(response.data, schema.ordersData);\r\n      return db.cache.put({ id: \"ordersData\", data: entities }).then(() => {\r\n        return Promise.resolve(entities);\r\n      });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"ordersData\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchOrdersData();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nfunction customizer(objValue, srcValue) {\r\n  if (_.isArray(objValue)) {\r\n    return objValue.concat(srcValue);\r\n  }\r\n}\r\n\r\nexport const fetchOrdersDataByProjects = (param = type.API, projects, step) => {\r\n  const auth = store.getState().auth;\r\n\r\n  if (param === type.API) {\r\n    let promises = [];\r\n\r\n    let splitCount = Math.ceil(projects.length / step);\r\n\r\n    for (let i = 0; i < splitCount; i++) {\r\n      let ps = { projectNos: projects.slice(i * step, (i + 1) * step) };\r\n      promises.push(api.fetchOrdersDataByProjects(ps));\r\n    }\r\n\r\n    if (promises.length === 0) {\r\n      // Just get the error message through call api\r\n      const message = auth?.roles[0] === \"SL\" ? \"请到我的->同步界面上，点最右上角的同步按钮同步数据\" : \"未发现该用户的订单信息\";\r\n      return Promise.reject({ message: message });\r\n    }\r\n\r\n    let result = {};\r\n    let fulfilledValues = [];\r\n\r\n    return Promise.allSettled(promises).then((results) => {\r\n      results.forEach((result) => {\r\n        if (result.status === \"fulfilled\") {\r\n          fulfilledValues.push(result.value);\r\n        }\r\n      });\r\n\r\n      if (fulfilledValues.length === 0) {\r\n        const message = auth?.roles[0] === \"SL\" ? \"请到我的->同步界面上，点最右上角的同步按钮同步数据\" : \"未发现该用户的订单信息\";\r\n\r\n        return Promise.reject({ message: message });\r\n      } else {\r\n        for (let i = 0; i < fulfilledValues.length; i++) {\r\n          _.mergeWith(result, fulfilledValues[i].data, customizer);\r\n        }\r\n\r\n        result.orderActivities = orderActivitiesSort(result.orderActivities);\r\n        const { entities } = normalize(result, schema.ordersData);\r\n        return db.cache.put({ id: \"ordersData\", data: entities }).then(() => {\r\n          return Promise.resolve(entities);\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"ordersData\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchOrdersDataByProjects(type.API, projects, step);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchTemplatesData = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.fetchTemplatesData().then((response) => {\r\n      const data = templatesConverter(response.data);\r\n      return db.cache.put({ id: \"templatesData\", data: data }).then(() => {\r\n        return Promise.resolve(data);\r\n      });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"templatesData\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchTemplatesData();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchGroupInfo = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.fetchGroupInfo().then((response) => {\r\n      const data = groupInfoProc(response.data);\r\n      return db.cache.put({ id: \"groupInfo\", data: data }).then(() => {\r\n        return Promise.resolve(data);\r\n      });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"groupInfo\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchGroupInfo();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const updateOrderActivities = (data) => {\r\n  return db.cache.get(\"ordersData\").then((cache) => {\r\n    if (cache?.data) {\r\n      let { orderActivities } = cache.data;\r\n      orderActivities = { ...orderActivities, ...data.orderActivities };\r\n      const newOrdersData = { ...cache.data };\r\n      newOrdersData.orderActivities = orderActivities;\r\n      return db.cache.put({ id: \"ordersData\", data: newOrdersData });\r\n    } else {\r\n      return Promise.resolve(data);\r\n    }\r\n  });\r\n};\r\n\r\nexport const fetchLocalInstallationStepsConfirmDate = (\r\n  data,\r\n  param = type.API\r\n) => {\r\n  if (param === type.API) {\r\n    let promises = [];\r\n    let projects = data.projectNos;\r\n    let step = 70;\r\n    let splitCount = Math.ceil(projects.length / step);\r\n\r\n    for (let i = 0; i < splitCount; i++) {\r\n      let ps = { projectNos: projects.slice(i * step, (i + 1) * step) };\r\n      promises.push(api.getLocalInstallationStepConfirmDate(ps));\r\n    }\r\n\r\n    if (promises.length === 0) {\r\n      const data = localInstallationStepsConfirmDateProc([]);\r\n      return db.cache\r\n        .put({ id: \"localInstallationStepsConfirmDate\", data: data })\r\n        .then(() => {\r\n          return Promise.resolve(data);\r\n        });\r\n    }\r\n\r\n    return Promise.all(promises).then((response) => {\r\n      let res = [];\r\n      for (let i = 0; i < splitCount; i++) {\r\n        res = res.concat(response[i].data);\r\n      }\r\n      const data = localInstallationStepsConfirmDateProc(res);\r\n      return db.cache\r\n        .put({ id: \"localInstallationStepsConfirmDate\", data: data })\r\n        .then(() => {\r\n          return Promise.resolve(data);\r\n        });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"localInstallationStepsConfirmDate\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchLocalInstallationStepsConfirmDate(data);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const updateLocalInstallationStepConfirmDate = (data) => {\r\n  return db.cache.get(\"localInstallationStepsConfirmDate\").then((cache) => {\r\n    if (cache?.data) {\r\n      let localInstallationStepsConfirmDates = { ...cache.data };\r\n\r\n      localInstallationStepsConfirmDates[data.orderNo + \"-\" + data.stepNo] =\r\n        data;\r\n\r\n      return db.cache.put({\r\n        id: \"localInstallationStepsConfirmDate\",\r\n        data: localInstallationStepsConfirmDates,\r\n      });\r\n    } else {\r\n      return Promise.resolve(data);\r\n    }\r\n  });\r\n};\r\n\r\nexport const fetchFittersDemand = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.fetchFittersDemand().then((response) => {\r\n      const { entities } = normalize(response.data, schema.fittersDemands);\r\n\r\n      return db.cache\r\n        .put({ id: \"fittersDemand\", data: entities.fittersDemand })\r\n        .then(() => {\r\n          return Promise.resolve(entities.fittersDemand);\r\n        });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"fittersDemand\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchFittersDemand();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchFittersCertification = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.fetchFittersCertification().then((response) => {\r\n      const { entities } = normalize(\r\n        response.data,\r\n        schema.fittersCertifications\r\n      );\r\n\r\n      return db.cache\r\n        .put({\r\n          id: \"fittersCertification\",\r\n          data: entities.fittersCertification,\r\n        })\r\n        .then(() => {\r\n          return Promise.resolve(entities.fittersCertification);\r\n        });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"fittersCertification\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchFittersCertification();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchFittersAssignmentTransfer = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.fetchFittersAssignmentTransfer().then((response) => {\r\n      const fittersAssignmentTransfer = fittersAssignmentTransferProc(\r\n        response.data\r\n      );\r\n\r\n      return db.cache\r\n        .put({\r\n          id: \"fittersAssignmentTransfer\",\r\n          data: fittersAssignmentTransfer,\r\n        })\r\n        .then(() => {\r\n          return Promise.resolve(fittersAssignmentTransfer);\r\n        });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"fittersAssignmentTransfer\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchFittersAssignmentTransfer();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const updateFittersAssignmentTransfer = (data) => {\r\n  return db.cache.get(\"fittersAssignmentTransfer\").then((cache) => {\r\n    if (cache?.data) {\r\n      let newData = { ...cache.data };\r\n      const extfittersAssignmentTransfer = fittersAssignmentTransferProc(data);\r\n      newData = { ...newData, ...extfittersAssignmentTransfer };\r\n      return db.cache.put({ id: \"fittersAssignmentTransfer\", data: newData });\r\n    } else {\r\n      return Promise.resolve(data);\r\n    }\r\n  });\r\n};\r\n\r\nexport const fetchDocumentList = (request, param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.getDocumentList(request).then((response) => {\r\n      return db.cache\r\n        .put({ id: \"documentList\", data: response.data })\r\n        .then(() => {\r\n          return Promise.resolve(response.data);\r\n        });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"documentList\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchDocumentList(request);\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchInstalltionMethodDict = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.getInstallationMethodDict().then((response) => {\r\n      return db.cache\r\n        .put({ id: \"InstalltionMethodDict\", data: response.data })\r\n        .then(() => {\r\n          return Promise.resolve(response.data);\r\n        });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"InstalltionMethodDict\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchInstalltionMethodDict();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const updateDocumentList = (data) => {\r\n  return db.cache.get(\"documentList\").then((cache) => {\r\n    if (cache?.data) {\r\n      const { projectNo, orderNo, activityNo, documentName, modified } = data;\r\n      let newData = { ...cache.data };\r\n\r\n      if (!newData[projectNo]) {\r\n        newData[projectNo] = {};\r\n      }\r\n\r\n      if (!newData[projectNo][orderNo]) {\r\n        newData[projectNo][orderNo] = {};\r\n      }\r\n\r\n      if (!newData[projectNo][orderNo][activityNo]) {\r\n        newData[projectNo][orderNo][activityNo] = [];\r\n      }\r\n\r\n      if (\r\n        newData[projectNo][orderNo][activityNo].some(\r\n          (e) => e.name === documentName\r\n        )\r\n      ) {\r\n        newData[projectNo][orderNo][activityNo].forEach((item) => {\r\n          if (item.name === documentName) {\r\n            item.modified = modified;\r\n          }\r\n        });\r\n      } else {\r\n        newData[projectNo][orderNo][activityNo].push({\r\n          name: documentName,\r\n          modified: modified,\r\n        });\r\n      }\r\n      return db.cache.put({ id: \"documentList\", data: newData });\r\n    } else {\r\n      return Promise.resolve(data);\r\n    }\r\n  });\r\n};\r\n\r\nexport const removeCachedData = () => {\r\n  db.cache.clear();\r\n};\r\n\r\nexport const fetchTasks = (param = type.API) => {\r\n  if (param === type.API) {\r\n    const auth = JSON.parse(window.localStorage.getItem(\"auth\"));\r\n  \r\n    return api\r\n      .fetchIDPTTasks(auth.userName)\r\n      .then((response) => {\r\n        let resp = response.data?.data.map((item) => {\r\n          return taskDataConversion(item)\r\n        });\r\n\r\n        return db.cache\r\n          .put({\r\n            id: \"tasks\",\r\n            data: resp,\r\n          })\r\n          .then(() => {\r\n            return Promise.resolve(resp);\r\n          });\r\n      })\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"tasks\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchTasks();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const fetchInstMethods = (param = type.API) => {\r\n  if (param === type.API) {\r\n    return api.getInstMethods().then((response) => {\r\n      return db.cache\r\n        .put({\r\n          id: \"instMethods\",\r\n          data: response.data,\r\n        })\r\n        .then(() => {\r\n          return Promise.resolve(response.data);\r\n        });\r\n    });\r\n  }\r\n\r\n  if (param === type.CACHE) {\r\n    return db.cache.get(\"instMethods\").then((cache) => {\r\n      if (cache?.data) {\r\n        return Promise.resolve(cache.data);\r\n      } else {\r\n        return fetchTasks();\r\n      }\r\n    });\r\n  }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}