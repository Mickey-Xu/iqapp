{"ast":null,"code":"import _regeneratorRuntime from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";import _asyncToGenerator from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";import _objectSpread from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import*as action from\"actions\";import*as api from\"api\";import{db}from\"js/db\";import*as publicFn from\"js/publicFn/index\";import store from\"js/store\";import _ from\"lodash\";import{isVisible}from\"./templateFormUtil/index\";import*as schema from\"js/schema\";import*as repo from\"js/fetch\";import{normalize}from\"normalizr\";import{documentAuthorizationC}from\"js/publicFn\";export var sleep=function sleep(ms){return new Promise(function(resolve){setTimeout(resolve,ms);});};export var timeHorizonFilter=function timeHorizonFilter(date,today,timeHorizon){var leadingDate=new Date(date);switch(timeHorizon){case\"thisWeek\":{var start=today-new Date(today).getDay()*86400000;var end=start+7*86400000;return leadingDate.getTime()<=end;}case\"twoWeeks\":{var _start=today-new Date(today).getDay()*86400000;var _end=_start+14*86400000;return leadingDate.getTime()<=_end;}case\"fourWeeks\":{var _start2=today-new Date(today).getDay()*86400000;var _end2=_start2+28*86400000;return leadingDate.getTime()<=_end2;}case\"eightWeeks\":{var _start3=today-new Date(today).getDay()*86400000;var _end3=_start3+56*86400000;return leadingDate.getTime()<=_end3;}case\"all\":default:{return true;}}};export var orderActivitiesSort=function orderActivitiesSort(data){return data.sort(function(a,b){if(a.sort<b.sort){return-1;}else{return 1;}});};export var templatesConverter=function templatesConverter(data){var res={};data.forEach(function(elem){if(!res[elem.activityNo]){res[elem.activityNo]=[];}res[elem.activityNo].push(elem);});return res;};export var groupInfoProc=function groupInfoProc(data){var res={};data.forEach(function(value){res[value.projectNo]=JSON.parse(value.projectGroupInfo);});return res;};export var groupInfoDeproc=function groupInfoDeproc(data){var res=[];Object.keys(data).forEach(function(key){var elem={};elem.projectNo=key;elem.projectGroupInfo=JSON.stringify(data[key]);res.push(elem);});return res;};export var fittersAssignmentTransferProc=function fittersAssignmentTransferProc(data){var res={};data.forEach(function(value){if(!res[value.projectNo]){res[value.projectNo]=[];}res[value.projectNo].push(value);});return res;};export var verify=function verify(fields){var verifyType=[\"singleLine\",\"paragraph\",\"number\",\"multipleChoice\",\"dropdown\",\"dropdown\",\"signature\",\"photo\",\"naYesNo\"];var defaultPhotoValue=\"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";for(var i=0;i<fields.length;i++){var result=isVisible(fields[i]);if(result){for(var k=0;k<verifyType.length;k++){if(fields[i].type===verifyType[k]&&fields[i].settings.required){var alertInfo=void 0;if(fields[i].settings.labelI18n.Chinese){alertInfo=fields[i].settings.labelI18n.Chinese;}else if(fields[i].settings.labelI18n.English){alertInfo=fields[i].settings.labelI18n.English;}else if(fields[i].settings.descriptionI18n.Chinese){alertInfo=fields[i].settings.descriptionI18n.Chinese;}else{alertInfo=fields[i].settings.descriptionI18n.English;}if(fields[i].settings.value===defaultPhotoValue||fields[i].settings.value===\"\"||fields[i].settings.value===\"-\"){alert(alertInfo);return false;}else if(fields[i].settings.value===\"#\"){alert(alertInfo);return false;}else if(fields[i].type===\"number\"){if(fields[i].settings.min||fields[i].settings.max){if(fields[i].settings.value<fields[i].settings.min||fields[i].settings.value>fields[i].settings.max){var maxMin=showNumberText(fields[i].settings.min,fields[i].settings.max);alert(\"\".concat(alertInfo,\": \").concat(maxMin));return false;}}}}}}}return true;};export var toDoOrDone=function toDoOrDone(projectNumber,orderNumber,activityNo,templates,documentList){var _orders$orderNumber,_orders$orderNumber2,_orders$orderNumber3;var orders=store.getState().orders;var productLine=(_orders$orderNumber=orders[orderNumber])===null||_orders$orderNumber===void 0?void 0:_orders$orderNumber.productLine;var productFamily=(_orders$orderNumber2=orders[orderNumber])===null||_orders$orderNumber2===void 0?void 0:_orders$orderNumber2.productFamily;var productCategory=(_orders$orderNumber3=orders[orderNumber])===null||_orders$orderNumber3===void 0?void 0:_orders$orderNumber3.productCategory;var templateParms=templates[activityNo]?templates[activityNo]:[];var templateDataList=getTemplateList(templateParms,productLine,productFamily,productCategory);if(templateDataList.length>0){var requiredData=templateDataList.filter(function(item){return item.mandDoc===\"X\";});if(requiredData.length>0){var _documentList$project,_documentList$project2;var documents=documentList===null||documentList===void 0?void 0:(_documentList$project=documentList[projectNumber])===null||_documentList$project===void 0?void 0:(_documentList$project2=_documentList$project[orderNumber])===null||_documentList$project2===void 0?void 0:_documentList$project2[activityNo];var count=0;if(documents){for(var i=0;i<requiredData.length;i++){var discription=\"\".concat(requiredData[i].documentDescription);for(var k=0;k<documents.length;k++){var _documents$k;((_documents$k=documents[k])===null||_documents$k===void 0?void 0:_documents$k.name.includes(discription))&&count++;}}if(requiredData.length<=count){return\"Done\";}else{return\"ToDo\";}}else{return\"ToDo\";}}else{return\"Done\";//如果没有必填\n}}else{return\"WithoutTemplates\";}};export var timeSort=function timeSort(property,bol){return function(a,b){var value1=a[property];var value2=b[property];if(bol){// 升序\nreturn Date.parse(value1)-Date.parse(value2);}else{// 降序\nreturn Date.parse(value2)-Date.parse(value1);}};};export var whetherToShutDown=function whetherToShutDown(orderActivities,orderNumber){if(orderActivities[orderNumber+\"-7720\"]&&!orderActivities[orderNumber+\"-7720\"].confirmedDate){return\"停工中\";}else{return false;}};export var getCurrentElevatorStatus=function getCurrentElevatorStatus(orderActivities,orderNumber){var _orderActivities;if(orderActivities[orderNumber+\"-7720\"]&&!orderActivities[orderNumber+\"-7720\"].confirmedDate){return\"停工中\";}else if((_orderActivities=orderActivities[orderNumber+\"-7350\"])===null||_orderActivities===void 0?void 0:_orderActivities.confirmedDate){return\"安装中\";}else{return\"未到货\";}};export var orderProgress=function orderProgress(orderActivities,orderNumber){var _orderActivities2,_orderActivities3,_orderActivities4,_orderActivities5;//电梯整体安装进度\nif((_orderActivities2=orderActivities[orderNumber+\"-7800\"])===null||_orderActivities2===void 0?void 0:_orderActivities2.confirmedDate){return 100;}if((_orderActivities3=orderActivities[orderNumber+\"-70D0\"])===null||_orderActivities3===void 0?void 0:_orderActivities3.confirmedDate){return 60;}if(((_orderActivities4=orderActivities[orderNumber+\"-7020\"])===null||_orderActivities4===void 0?void 0:_orderActivities4.confirmedDate)&&!orderActivities[orderNumber+\"-70D0\"]){return 60;}if((_orderActivities5=orderActivities[orderNumber+\"-8010\"])===null||_orderActivities5===void 0?void 0:_orderActivities5.confirmedDate){return 30;}else{return 0;}};//电梯安装进度\nexport var elevatorInstallationProgress=function elevatorInstallationProgress(projectNumber,orderActivities,orderNo,documentList){if(!orderActivities[orderNo+\"-7040\"]){// 三步\nvar threeStep=[\"7010\",\"7020\",\"7600\"];var orderActivitie=Object.keys(orderActivities).filter(function(item){return orderActivities[item].orderNumber===orderNo&&threeStep.indexOf(orderActivities[item].activityNumber)>-1;});var progress=orderActivitie.filter(function(item){return orderActivities[item].confirmedDate!==null;});return Math.round(progress.length*100/3)+\"%\";}else{// 十四步\nvar _elevatorInstallationProgress=0;var steps14=[\"7010\",\"7020\",\"7030\",\"7040\",\"7050\",\"7060\",\"7070\",\"7080\",\"7090\",\"70A0\",\"70B0\",\"70C0\",\"70D0\",\"7600\"];steps14.forEach(function(step){if(orderActivities[orderNo+\"-\"+step].editable&&orderActivities[orderNo+\"-\"+step].confirmedDate){_elevatorInstallationProgress+=1;}else if(!orderActivities[orderNo+\"-\"+step].editable){var _documentList$project3,_documentList$project4;var documentActivity=(_documentList$project3=documentList[projectNumber])===null||_documentList$project3===void 0?void 0:(_documentList$project4=_documentList$project3[orderNo])===null||_documentList$project4===void 0?void 0:_documentList$project4[step];var activityModified=documentActivity?documentActivity.sort(timeSort(\"modified\",false)):null;var confirmedTime=activityModified?activityModified===null||activityModified===void 0?void 0:activityModified[0].modified:null;confirmedTime&&(_elevatorInstallationProgress+=1);}});var result=_elevatorInstallationProgress/14*100;return Math.round(result)+\"%\";}};export var projectProgress=function projectProgress(projectNumber,orders,orderActivities){var projectOrders=[];Object.keys(orders).forEach(function(item){orders[item].projectNumber===projectNumber&&projectOrders.push(item);});var progressArray=[];projectOrders.forEach(function(item){var progress=orderProgress(orderActivities,item);progressArray.push(progress);});var sum=0;progressArray.forEach(function(item){sum+=item===\"停工中\"?0:item;});var projectProgress=Math.ceil(sum/projectOrders.length);return projectProgress;};/**\r\n    {\r\n      \"projectNo\": \"string\",\r\n      \"orderNo\": \"string\",\r\n      \"activityNo\": \"string\",\r\n      \"type\": 0,\r\n      \"date\": \"string\",\r\n      \"combinePdf\": true\r\n    }\r\n */export var setActivityStatusParams=function setActivityStatusParams(projectNo,orderNo,activityNo,date,type,orderActivities,orders){var _orders$orderNo,_orders$orderNo2,_orders$orderNo3;var result={};result.projectNo=projectNo;result.orderNo=orderNo;result.activityNo=activityNo;result.date=date;result.type=type;result.combinePdf=false;result.foe=orders===null||orders===void 0?void 0:(_orders$orderNo=orders[orderNo])===null||_orders$orderNo===void 0?void 0:_orders$orderNo.fo;result.region=orders===null||orders===void 0?void 0:(_orders$orderNo2=orders[orderNo])===null||_orders$orderNo2===void 0?void 0:_orders$orderNo2.region;result.branch=orders===null||orders===void 0?void 0:(_orders$orderNo3=orders[orderNo])===null||_orders$orderNo3===void 0?void 0:_orders$orderNo3.prctr;if(orderActivities[orderNo+\"-7030\"]){// 14 steps (or 9 steps)\nif(activityNo===\"70C0\"){result.combinePdf=true;}if(orderActivities[orderNo+\"-\"+activityNo].originalStep){result.activityNo=orderActivities[orderNo+\"-\"+activityNo].originalStep;}}return result;};export var isInstallationStepEditable=function isInstallationStepEditable(orderNo,activityNo,orderActivities){if(orderActivities[orderNo+\"-\"+activityNo].editable===undefined||orderActivities[orderNo+\"-\"+activityNo].editable){return true;}else{return false;}};export var calculationOfInstallationSteps=function calculationOfInstallationSteps(orderActivities,orders){var handedOverToMaintenance=0;//移交维保\nvar debugQuantity=0;// 调试\nvar guideDoorInstallation=0;//导轨门安装\nvar startTheInstallation=0;//开始安装\nvar installationNotStarted=0;//未开始安装\nvar orderNos=Object.keys(orders);for(var i=0;i<orderNos.length;i++){var _orderActivities6,_orderActivities7,_orderActivities8,_orderActivities9,_orderActivities10;if(orderActivities[orderNos[i]+\"-7800\"]&&((_orderActivities6=orderActivities[orderNos[i]+\"-7800\"])===null||_orderActivities6===void 0?void 0:_orderActivities6.confirmedDate)){handedOverToMaintenance++;}else if(orderActivities[orderNos[i]+\"-70C0\"]&&((_orderActivities7=orderActivities[orderNos[i]+\"-70C0\"])===null||_orderActivities7===void 0?void 0:_orderActivities7.confirmedDate)){debugQuantity++;}else if(orderActivities[orderNos[i]+\"-7020\"]&&((_orderActivities8=orderActivities[orderNos[i]+\"-7020\"])===null||_orderActivities8===void 0?void 0:_orderActivities8.confirmedDate)){debugQuantity++;}else if(orderActivities[orderNos[i]+\"-8010\"]&&((_orderActivities9=orderActivities[orderNos[i]+\"-8010\"])===null||_orderActivities9===void 0?void 0:_orderActivities9.confirmedDate)){guideDoorInstallation++;}else if(orderActivities[orderNos[i]+\"-7700\"]&&((_orderActivities10=orderActivities[orderNos[i]+\"-7700\"])===null||_orderActivities10===void 0?void 0:_orderActivities10.confirmedDate)){startTheInstallation++;}else{installationNotStarted++;}}var theOverallProgress=0;var data=[handedOverToMaintenance,debugQuantity,guideDoorInstallation,startTheInstallation,installationNotStarted];data.forEach(function(item){theOverallProgress+=item;});return{handedOverToMaintenance:handedOverToMaintenance,debugQuantity:debugQuantity,guideDoorInstallation:guideDoorInstallation,startTheInstallation:startTheInstallation,installationNotStarted:installationNotStarted,theOverallProgress:theOverallProgress};};export var currentRefreshTime=function currentRefreshTime(){return\"\".concat(new Date().getMonth()+1,\"/\").concat(new Date().getDate(),\" \").concat(new Date().getHours(),\":\").concat(new Date().getMinutes()<10?\"0\"+new Date().getMinutes():new Date().getMinutes());};export var saveTheFirstRefreshTime=function saveTheFirstRefreshTime(dispatch){db.cache.get(\"dataRefreshTime\").then(function(cache){var datatime={allDataRefreshTime:currentRefreshTime(),masterDataRefreshTime:currentRefreshTime(),orderDataRefreshTime:currentRefreshTime(),templateListDataRefreshTime:currentRefreshTime(),documentListDataRefreshTime:currentRefreshTime(),taskListDataRefreshTime:currentRefreshTime()};dispatch(action.setAllDataRefreshTime(datatime));!(cache===null||cache===void 0?void 0:cache.data)&&db.cache.put({id:\"dataRefreshTime\",data:datatime}).then(function(){dispatch(action.setAllDataRefreshTime(datatime));});});db.cache.get(\"settings\").then(function(cache){var language=\"zh-cn\";!(cache===null||cache===void 0?void 0:cache.data)&&db.cache.put({id:\"settings\",data:{language:\"zh-cn\"}}).then(function(){dispatch(action.setAllDataRefreshTime(language));});});};export var recordRefreshTime=function recordRefreshTime(dispatch,name,projects,userInfo){if(name){var parmas={projectNos:Object.keys(projects)};var auth=JSON.parse(window.localStorage.getItem(\"auth\"));var roles=auth===null||auth===void 0?void 0:auth.roles;var isSubconTLOrPE=roles.indexOf('Subcon TL')>-1||roles.indexOf('PE')>-1;var isEISV=roles.indexOf('SL')>-1;var request=getDocumentListParmas(parmas.projectNos);switch(name){case\"all\":if(isSubconTLOrPE||isEISV){dispatch(action.fetchOrders(request,\"all\",userInfo,dispatch));}else{dispatch(action.fetchOrders(request,\"all\",userInfo,dispatch));// dispatch(action.fetchDocuments(request, dispatch));\ndispatch(action.fetchTasksList(userInfo,dispatch));}break;case\"orders\":dispatch(action.fetchOrders(parmas,\"\",userInfo,dispatch));break;case\"documents\":dispatch(action.fetchDocuments(request,userInfo,dispatch));break;case\"task\":dispatch(action.fetchTasksList(request,userInfo,\"\",dispatch));break;default:return dispatch(action.fetchOrders(request,\"all\",userInfo,dispatch)),// dispatch(action.fetchDocuments(dispatch)),\ndispatch(action.fetchTasksList(userInfo,dispatch));}}else{db.cache.get(\"dataRefreshTime\").then(function(cache){(cache===null||cache===void 0?void 0:cache.data)&&dispatch(action.setAllDataRefreshTime(cache.data));});}};export var getDocumentListParmas=function getDocumentListParmas(projectNos,orderNos){var orders=orderNos?orderNos:store.getState().orders;var data=[];var _loop=function _loop(i){Object.keys(orders).find(function(item){return orders[item].projectNumber===projectNos[i]&&data.push({foe:orders[item].fo,region:orders[item].region,branch:orders[item].prctr,projectNo:orders[item].projectNumber,orders:Object.keys(orders).filter(function(order){return orders[order].projectNumber===orders[item].projectNumber;})});});};for(var i=0;i<projectNos.length;i++){_loop(i);}return data;};export var isFormUpdated=function isFormUpdated(currentForm,initForm){if(currentForm.fields.length!==initForm.fields.length){return false;}for(var i=0;i<currentForm.fields.length;i++){if(Array.isArray(currentForm.fields[i].settings.value)){if(!_.isEqual(currentForm.fields[i].settings.value.sort(),initForm.fields[i].settings.value.sort())){return true;}}else{if(currentForm.fields[i].settings.value!==initForm.fields[i].settings.value){return true;}}}return false;};export var localInstallationStepsConfirmDateProc=function localInstallationStepsConfirmDateProc(data){var res={};data.forEach(function(value){res[value.orderNo+\"-\"+value.stepNo]=value;});return res;};export var verifyWhenConfirm7020or70C0=function verifyWhenConfirm7020or70C0(orderActivities,orderNumber,activityNumber){// 14 steps\nif(orderActivities[orderNumber+\"-7030\"]){if(activityNumber===\"70C0\"){var checkSteps=[\"7010\",\"7020\",\"7030\",\"7040\",\"7050\",\"7060\",\"7070\",\"7080\",\"7090\",\"70A0\",\"70B0\"];var result=checkSteps.find(function(step){return!orderActivities[orderNumber+\"-\"+step].confirmedDate;});if(result){return{stepNo:result,message:\"未确认,请先确认\"};}}}};/**\r\n *  code: 1: 本地不存在template\r\n *        2：本地存在template,但是不一样\r\n *        3：本地存在template,但是一样\r\n */export var checkTemplateForm=function checkTemplateForm(documentNo,documentPart,value){var key=documentNo+\"-\"+documentPart;return db.cache.get(\"rawTemplateForm\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var existData=cache.data;if(!existData[key]){existData[key]=value;return db.cache.put({id:\"rawTemplateForm\",data:existData}).then(function(){return Promise.resolve({code:1,value:value});});}if(existData[key]!==value){existData[key]=value;return db.cache.put({id:\"rawTemplateForm\",data:existData}).then(function(){return Promise.resolve({code:2,value:value});});}return Promise.resolve({code:3,value:value});}else{var data={};data[key]=value;return db.cache.put({id:\"rawTemplateForm\",data:data}).then(function(){return Promise.resolve({code:1,value:value});});}});};export var getRawTemplate=function getRawTemplate(documentNo,documentPart){var key=documentNo+\"-\"+documentPart;return db.cache.get(\"rawTemplateForm\").then(function(cache){// TODO: 这边正常流程下来都会有数据，可提高代码健壮性\nif(cache===null||cache===void 0?void 0:cache.data){return Promise.resolve(cache.data[key]);}});};/**\r\n * code: 1: 本地存在draft\r\n *      2： 本地不存在draft\r\n */export var getDraftFromLocal=function getDraftFromLocal(documentNo,documentPart,activityNo,productFamily,productLine,language,draftParam){var orderNo=draftParam.orderNo;var key=orderNo+\"-\"+activityNo+\"-\"+documentNo+\"-\"+documentPart+\"-\"+productFamily+\"-\"+productLine+\"-\"+language;return db.cache.get(\"templateDraft\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var existData=cache.data;if(existData[key]){return Promise.resolve({code:1,value:existData[key]});}return Promise.resolve({code:2});}else{return Promise.resolve({code:2});}});};/**\r\n * code： 1：draft 存在\r\n *        2：draft 不存在\r\n */export var getDraft=function getDraft(param,draftParam,expendParam){var documentNo=param.documentNo,documentPart=param.documentPart;var activityNo=expendParam.activityNo,productFamily=expendParam.productFamily,productLine=expendParam.productLine,language=expendParam.language;return getDraftFromLocal(documentNo,documentPart,activityNo,productFamily,productLine,language,draftParam).then(function(data){if(data.code===1){return Promise.resolve(data);}else return getDraftFromApi(draftParam).then(function(data){return Promise.resolve(data);});});};/**\r\n * code: 1 draft 存在\r\n *       2 draft 不存在\r\n */export var getDraftFromApi=function getDraftFromApi(draftParam){return api.getDraft(draftParam).then(function(res){if(res.data.form){return Promise.resolve({code:1,value:res.data.form});}else{return Promise.resolve({code:2});}});};export var saveDraftToLocal=function saveDraftToLocal(data,currentParam,draftParams){var documentNo=currentParam.documentNo,documentPart=currentParam.documentPart;var orderNo=draftParams.orderNo,activityNo=draftParams.activityNo,productFamily=draftParams.productFamily,productLine=draftParams.productLine,language=draftParams.language;var key=orderNo+\"-\"+activityNo+\"-\"+documentNo+\"-\"+documentPart+\"-\"+productFamily+\"-\"+productLine+\"-\"+language;db.cache.get(\"templateDraft\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var existData=cache.data;existData[key]=data;db.cache.put({id:\"templateDraft\",data:existData});}else{var storeData={};storeData[key]=data;db.cache.put({id:\"templateDraft\",data:storeData});}});};export var deleteDraftFromLocal=function deleteDraftFromLocal(currentParam){var documentNo=currentParam.documentNo,documentPart=currentParam.documentPart;db.cache.get(\"templateDraft\").then(function(cache){if(cache===null||cache===void 0?void 0:cache.data){var existData=cache.data;var deleteKeys=Object.keys(existData).filter(function(key){return key.includes(documentNo+\"-\"+documentPart);});deleteKeys.forEach(function(key){delete existData[key];});db.cache.put({id:\"templateDraft\",data:existData});}});};export var getTemplateList=function getTemplateList(templatesData,productLine,productFamily,productCategory){var condition1=templatesData.filter(function(item){return item.productCategory===productCategory&&item.productLine===productLine&&item.productFamily===productFamily;});var condition2=templatesData.filter(function(item){return item.productCategory===productCategory&&item.productLine===productLine&&item.productFamily===null;});var condition3=templatesData.filter(function(item){return item.productCategory===productCategory&&item.productFamily===productFamily&&item.productLine===null;});var condition4=templatesData.filter(function(item){return item.productCategory===productCategory&&item.productLine===null&&item.productFamily===null;});var condition5=templatesData.filter(function(item){return item.productLine===productLine&&item.productFamily===productFamily&&item.productCategory===null;});var condition6=templatesData.filter(function(item){return item.productLine===productLine&&item.productCategory===null&&item.productFamily===null;});var condition7=templatesData.filter(function(item){return item.productFamily===productFamily&&item.productCategory===null&&item.productLine===null;});var condition8=templatesData.filter(function(item){return item.productCategory===null&&item.productLine===null&&item.productFamily===null;});var result=[condition1,condition2,condition3,condition4,condition5,condition6,condition7,condition8].find(function(array){return array.length>0;});return result?result:[];};export var getDocumentComplateStatus=function getDocumentComplateStatus(auth,projectNumber,orderNo,orderActivities,templates,documentList){var activityList=publicFn.orderDetailSteps(orderActivities,orderNo,auth.activityAuth,auth.roles[0]);var documentCompleteStatus=[];for(var i=0;i<activityList.length;i++){if(orderActivities===null||orderActivities===void 0?void 0:orderActivities[orderNo+'-'+activityList[i]]){var status=toDoOrDone(projectNumber,orderNo,activityList[i],templates,documentList);documentCompleteStatus.push(status);}}var completeSum=[];var completed=[];for(var _i=0;_i<documentCompleteStatus.length;_i++){if(documentCompleteStatus[_i]===\"ToDo\"){completeSum.push(documentCompleteStatus[_i]);}else if(documentCompleteStatus[_i]===\"Done\"){completeSum.push(documentCompleteStatus[_i]);completed.push(documentCompleteStatus[_i]);}}return\"\".concat(completed.length,\"/\").concat(completeSum.length);};// export const getStopsOrHoistHeight = (chars, orderNo, type) => {\n//   const condition = type === \"stops\" ? \"GRP_NUMBER_OF_STOPS\" : \"GRP_HQ\";\n//   const data = [];\n//   Object.keys(chars).filter((item) => {\n//     return (\n//       chars[item].orderNo === orderNo &&\n//       chars[item].charID === condition &&\n//       data.push(chars[item])\n//     );\n//   });\n//   console.log(data, type, orderNo);\n//   return data.length > 0 ? data[0].value : 0;\n// };\nexport var getStopsOrHoistHeight=function getStopsOrHoistHeight(chars,orderNo,type){var data=[];Object.keys(chars).filter(function(item){return chars[item].orderNo===orderNo&&data.push(chars[item]);});if(type===\"stops\"){var stops=data.filter(function(item){return item.name.indexOf(\"停站数\")>-1||item.name.indexOf(\"Number of stops\")>-1;});return stops.length>0?stops[0].value:0;}else{var hoistHeight=data.filter(function(item){return item.name.indexOf(\"提升高度\")>-1||item.name.indexOf(\"Travel height\")>-1||item.name.indexOf(\"Vertical rise\")>-1;});return hoistHeight.length>0?hoistHeight[0].value:0;}};export var scrollToPosition=function scrollToPosition(element,pathname){var position=store.getState().scrollPosition[pathname];element.current.scrollTop=position?position:0;};export var removeNotVisibleFields=function removeNotVisibleFields(templateForm){var result=_.cloneDeep(templateForm);_.remove(result.fields,function(field){return!isVisible(field);});return result;};export var getTaskCount=function getTaskCount(){var tasks=store.getState().tasks;var orders=store.getState().orders;var projects=store.getState().projects;var awaitCloseNum=publicFn.taskCleaner(tasks.assigner,orders,projects)&&publicFn.taskCleaner(tasks.assigner,orders,projects).filter(function(item){return item.Status===\"D\";}).length;var awaitComplateNum=publicFn.taskCleaner(tasks.assignee,orders,projects)&&publicFn.taskCleaner(tasks.assignee,orders,projects).filter(function(item){return item.Status===\"A\";}).length;return{awaitCloseNum:awaitCloseNum,awaitComplateNum:awaitComplateNum};};export var getAwaitComplateAwaitCloseCount=function getAwaitComplateAwaitCloseCount(tasks){var countTaskStatuses=function countTaskStatuses(tasks){var statusCount={};tasks.forEach(function(task){var taskType=task.taskType,status=task.status;if(!statusCount[taskType]){statusCount[taskType]={'awaitStartNum':0,\"awaitCloseNum\":0,\"awaitComplateNum\":0};}if(status===\"awaitClose\"){statusCount[taskType][\"awaitCloseNum\"]+=1;}else if(status===\"awaitComplate\"){statusCount[taskType][\"awaitComplateNum\"]+=1;}else if(status===\"awaitStart\"){statusCount[taskType][\"awaitStartNum\"]+=1;}});return statusCount;};var taskStatusCount=countTaskStatuses(tasks);var updatedTasks=tasks.map(function(task){var taskType=task.taskType;var _ref=taskStatusCount[taskType]||{\"awaitCloseNum\":0,\"awaitComplateNum\":0,'awaitStartNum':0},pendingCloseCount=_ref[\"awaitCloseNum\"],pendingCompleteCount=_ref[\"awaitComplateNum\"],pendingStartCoun=_ref['awaitStartNum'];return _objectSpread(_objectSpread({},task),{},{\"awaitCloseNum\":pendingCloseCount,\"awaitComplateNum\":pendingCompleteCount,'awaitStartNum':pendingStartCoun});});return updatedTasks;};export var showNumberText=function showNumberText(min,max){var a=min===0?min.toString():min;var b=max===0?max.toString():max;if(a||b){if(a&&!b){return\"(\".concat(a,\"...)\");}else if(!a&&b){return\"(...\".concat(b,\")\");}else{return\"(\".concat(a,\"-\").concat(b,\")\");}}else{return\"\";}};export var checkFileIsExisting=function checkFileIsExisting(template,data,orders){var templateDataList=getTemplateList(template[data.activityNumber]||[],orders[data.orderNumber].productLine,orders[data.orderNumber].productFamily,orders[data.orderNumber].productCategory);var param=templateDataList.map(function(item){return{foe:orders[data.orderNumber].fo,region:orders[data.orderNumber].region,branch:orders[data.orderNumber].prctr,projectNo:orders[data.orderNumber].projectNumber,orderNo:data.orderNumber,activityNo:data.activityNumber,documentName:item.documentDescription+\".eform2\"};});return api.checkFileIsExisting(param).then(function(res){var message=[];res.data.forEach(function(item,index){!item&&message.push(templateDataList[index].documentDescription);});return message;});};export var getChecklistActivityNo=function getChecklistActivityNo(data){var _store$getState,_store$getState$docum,_store$getState$docum2,_store$getState$docum3;var activtyNo=\"V001\";var listData=(_store$getState=store.getState())===null||_store$getState===void 0?void 0:(_store$getState$docum=_store$getState.documentList)===null||_store$getState$docum===void 0?void 0:(_store$getState$docum2=_store$getState$docum[data.projectNumber])===null||_store$getState$docum2===void 0?void 0:(_store$getState$docum3=_store$getState$docum2[data.orderNumber])===null||_store$getState$docum3===void 0?void 0:_store$getState$docum3[activtyNo];return listData?activtyNo:false;};export var getNonConformityConfig=function getNonConformityConfig(){return{\"7010\":{activityNo:\"7010\",allowreupload:true,closeEnabledInOILScreen:false},\"7020\":{activityNo:\"7020\",allowreupload:true,closeEnabledInOILScreen:false},\"7030\":{activityNo:\"7030\",allowreupload:true,closeEnabledInOILScreen:false},\"7040\":{activityNo:\"7040\",allowreupload:true,closeEnabledInOILScreen:false},\"7050\":{activityNo:\"7050\",allowreupload:true,closeEnabledInOILScreen:false},\"7060\":{activityNo:\"7060\",allowreupload:true,closeEnabledInOILScreen:false},\"7070\":{activityNo:\"7070\",allowreupload:true,closeEnabledInOILScreen:false},\"7080\":{activityNo:\"7080\",allowreupload:true,closeEnabledInOILScreen:false},\"7090\":{activityNo:\"7090\",allowreupload:true,closeEnabledInOILScreen:false},\"70A0\":{activityNo:\"70A0\",allowreupload:true,closeEnabledInOILScreen:false},\"70B0\":{activityNo:\"70B0\",allowreupload:true,closeEnabledInOILScreen:false},\"70C0\":{activityNo:\"70C0\",allowreupload:true,closeEnabledInOILScreen:false},\"70D0\":{activityNo:\"70D0\",allowreupload:false,closeEnabledInOILScreen:true},\"7350\":{activityNo:\"7350\",allowreupload:false,closeEnabledInOILScreen:true},\"7360\":{activityNo:\"7360\",allowreupload:false,closeEnabledInOILScreen:true},\"7400\":{activityNo:\"7400\",allowreupload:false,closeEnabledInOILScreen:true},\"7500\":{activityNo:\"7500\",allowreupload:false,closeEnabledInOILScreen:true},\"7600\":{activityNo:\"7600\",allowreupload:false,closeEnabledInOILScreen:true},\"7620\":{activityNo:\"7620\",allowreupload:false,closeEnabledInOILScreen:true},\"7700\":{activityNo:\"7700\",allowreupload:false,closeEnabledInOILScreen:true},\"7800\":{activityNo:\"7800\",allowreupload:false,closeEnabledInOILScreen:true},\"7950\":{activityNo:\"7950\",allowreupload:false,closeEnabledInOILScreen:true},\"8010\":{activityNo:\"8010\",allowreupload:false,closeEnabledInOILScreen:true},\"9200\":{activityNo:\"9200\",allowreupload:false,closeEnabledInOILScreen:true}};};var customizer=function customizer(objValue,srcValue){if(Array.isArray(objValue)&&Array.isArray(srcValue)){return objValue.concat(srcValue);}};export var updateOrdersData=function updateOrdersData(soNo,dispatch){dispatch(action.showLoading());api.fetchOrdersDataByProjects(soNo).then(function(response){var _normalize=normalize(response.data,schema.ordersData),entities=_normalize.entities;db.cache.get(\"ordersData\").then(function(cache){var result=_.mergeWith(cache.data,entities,customizer);var projects=result.projects?Object.keys(result.projects):[];db.cache.put({id:\"ordersData\",data:result}).then(function(){var param={projectNos:projects};repo.fetchLocalInstallationStepsConfirmDate(param);var request=getDocumentListParmas(param.projectNos,result===null||result===void 0?void 0:result.orders);dispatch(action.fetchDocuments(request,{},dispatch));});});}).catch(function(error){dispatch(action.setError(error.message));}).finally(function(){dispatch(action.hideLoading());});};export var disableForm=function disableForm(){var _orders$orderNo4,_documentList$project5,_documentList$project6,_nonConformityConfig$;var params=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!showUploadButton()){return false;}var _store$getState2=store.getState(),orderActivities=_store$getState2.orderActivities,documentList=_store$getState2.documentList,templates=_store$getState2.templates,orders=_store$getState2.orders,auth=_store$getState2.auth,nonConformityConfig=_store$getState2.nonConformityConfig;var activityNo=params.activityNo,orderNo=params.orderNo,productFamily=params.productFamily,productLine=params.productLine,projectNumber=params.projectNumber,root=params.root;var productCategory=(_orders$orderNo4=orders[orderNo])===null||_orders$orderNo4===void 0?void 0:_orders$orderNo4.productCategory;var templatesData=templates[activityNo]||[];var documents=[];var documentsItem=(_documentList$project5=documentList[projectNumber])===null||_documentList$project5===void 0?void 0:(_documentList$project6=_documentList$project5[orderNo])===null||_documentList$project6===void 0?void 0:_documentList$project6[activityNo];var allowreupload=(_nonConformityConfig$=nonConformityConfig[activityNo])===null||_nonConformityConfig$===void 0?void 0:_nonConformityConfig$.allowreupload;var disableTheEntranceroot=root===\"listCard\";var data=getTemplateList(templatesData,productLine,productFamily,productCategory);var description=data.map(function(item){return item.documentDescription;});description.forEach(function(item){return documentsItem&&documentsItem.filter(function(ele){return ele.name.indexOf(item)>-1&&documents.push(ele);})||[];});var docAuthActivityNos=documentAuthorizationC(orderActivities,orderNo,auth.activityAuth,auth.roles[0]);var canUploadDoc=docAuthActivityNos.includes(activityNo);if(root===\"installationChecklist\"){var _documentList$project7,_documentList$project8;var template={mandDoc:\"Y\",documentDescription:\"\\u5B89\\u88C5\\u68C0\\u67E5\\u6E05\\u5355\"};data.push(template);documents.push(documentList===null||documentList===void 0?void 0:(_documentList$project7=documentList[projectNumber])===null||_documentList$project7===void 0?void 0:(_documentList$project8=_documentList$project7[orderNo])===null||_documentList$project8===void 0?void 0:_documentList$project8[activityNo][0]);}if(disableTheEntranceroot&&canUploadDoc){return false;}if(documents.length>0){if(!allowreupload){return true;}else{if(getChecklistActivityNo({projectNumber:projectNumber,orderNumber:orderNo})){return true;}else{return false;}}}else{return false;}};export var showUploadButton=function showUploadButton(){var _store$getState3=store.getState(),auth=_store$getState3.auth;return auth===null||auth===void 0?void 0:auth.isEnableCorrectImage;};var getTime=function getTime(){var now=new Date();var year=now.getFullYear();var month=String(now.getMonth()+1).padStart(2,'0');var day=String(now.getDate()).padStart(2,'0');var hours=String(now.getHours()).padStart(2,'0');var minutes=String(now.getMinutes()).padStart(2,'0');var seconds=String(now.getSeconds()).padStart(2,'0');return\"\".concat(year,\"-\").concat(month,\"-\").concat(day,\" \").concat(hours,\":\").concat(minutes,\":\").concat(seconds);};var getCurrentPosition=function getCurrentPosition(){return new Promise(function(resolve){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(position){var latitude=position.coords.latitude;var longitude=position.coords.longitude;resolve({status:'success',data:{latitude:latitude,longitude:longitude}});},function(error){resolve({status:'error',message:error.message});});}else{resolve({status:'error',message:'Geolocation is not supported by this browser.'});}});};// 根据经纬度获取详细地址\nvar getLocationFromCoordinates=function getLocationFromCoordinates(latitude,longitude){return new Promise(function(resolve,reject){if(window.BMap){var geocoder=new window.BMap.Geocoder();// 创建 Geocoder 实例\nvar point=new window.BMap.Point(longitude,latitude);// 创建坐标对象\ngeocoder.getLocation(point,function(result){if(result){resolve(result.address);}else{resolve('无法获取地址信息');}});}else{reject('百度地图 API 未加载');}});};export var fillTextToImg=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(base64,projectParams){var _location$data,_location$data2,_data$projects$projec;var data,location,address,projectName,time,watermarkText,img;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:data=store.getState();// let location = { longitude: \"121.197237\", latitude: \"31.449172\" }\n_context.next=3;return getCurrentPosition();case 3:location=_context.sent;_context.next=6;return getLocationFromCoordinates(location===null||location===void 0?void 0:(_location$data=location.data)===null||_location$data===void 0?void 0:_location$data.latitude,location===null||location===void 0?void 0:(_location$data2=location.data)===null||_location$data2===void 0?void 0:_location$data2.longitude);case 6:address=_context.sent;projectName=(_data$projects$projec=data.projects[projectParams.projectNumber])===null||_data$projects$projec===void 0?void 0:_data$projects$projec.description;time=getTime();watermarkText=[\"\\u62CD\\u6444\\u5730\\u70B9\\uFF1A\".concat(address),\"\\u62CD\\u6444\\u65F6\\u95F4\\uFF1A\".concat(time),\"\\u8BA2\\u5355\\u7F16\\u53F7\\uFF1A\".concat(projectParams.orderNo),\"\\u9879\\u76EE\\u540D\\u79F0\\uFF1A\".concat(projectName)];img=new Image();img.src=base64;img.setAttribute(\"crossOrigin\",\"Anonymous\");return _context.abrupt(\"return\",new Promise(function(resolve){img.onload=function(){var canvas=document.createElement(\"canvas\");var ctx=canvas.getContext(\"2d\");canvas.width=img.width;canvas.height=img.height;ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0,canvas.width,canvas.height);ctx.font='15px Arial';ctx.textAlign=\"left\";ctx.fillStyle=\"#ffffff\";var lineHeight=0;watermarkText.forEach(function(item){lineHeight+=30;ctx.fillText(item,20,canvas.height-lineHeight+20);});resolve(canvas.toDataURL(\"image/jpg\"));};}));case 14:case\"end\":return _context.stop();}}},_callee);}));return function fillTextToImg(_x,_x2){return _ref2.apply(this,arguments);};}();export var formatDateToYMD=function formatDateToYMD(dateString){console.log(dateString);var date=new Date(dateString);// 将字符串转换为 Date 对象\nvar year=date.getFullYear();// 获取年份\nvar month=String(date.getMonth()+1).padStart(2,'0');// 获取月份（注意月份是从0开始的，需加1）\nvar day=String(date.getDate()).padStart(2,'0');// 获取日期\nreturn dateString?\"\".concat(year,\"-\").concat(month,\"-\").concat(day):null;// 拼接成“YYYY年MM月DD日”格式\n};export var taskDataConversion=function taskDataConversion(item){var status;switch(item.status){case 1:status=\"awaitStart\";break;case 2:status=\"awaitComplate\";break;case 3:status=\"awaitClose\";break;case 4:status='closed';break;case 5:status='closed';break;default:status='closed';break;};return{taskId:item.id,taskType:item.type,projectNo:item.projectNo,orderNo:item.salesOrderNo,activityNo:item.activityNo,projectName:item.projectName,planStartDate:formatDateToYMD(item.planStartDate),planEndDate:formatDateToYMD(item.planEndDate),actualStartDate:formatDateToYMD(item.actualStartDate),actualEndDate:formatDateToYMD(item.actualEndDate),actualCloseDate:formatDateToYMD(item.actualClosedDate),statusDesc:item.statusDesc,status:status};};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/js/util.js"],"names":["action","api","db","publicFn","store","_","isVisible","schema","repo","normalize","documentAuthorizationC","sleep","ms","Promise","resolve","setTimeout","timeHorizonFilter","date","today","timeHorizon","leadingDate","Date","start","getDay","end","getTime","orderActivitiesSort","data","sort","a","b","templatesConverter","res","forEach","elem","activityNo","push","groupInfoProc","value","projectNo","JSON","parse","projectGroupInfo","groupInfoDeproc","Object","keys","key","stringify","fittersAssignmentTransferProc","verify","fields","verifyType","defaultPhotoValue","i","length","result","k","type","settings","required","alertInfo","labelI18n","Chinese","English","descriptionI18n","alert","min","max","maxMin","showNumberText","toDoOrDone","projectNumber","orderNumber","templates","documentList","orders","getState","productLine","productFamily","productCategory","templateParms","templateDataList","getTemplateList","requiredData","filter","item","mandDoc","documents","count","discription","documentDescription","name","includes","timeSort","property","bol","value1","value2","whetherToShutDown","orderActivities","confirmedDate","getCurrentElevatorStatus","orderProgress","elevatorInstallationProgress","orderNo","threeStep","orderActivitie","indexOf","activityNumber","progress","Math","round","steps14","step","editable","documentActivity","activityModified","confirmedTime","modified","projectProgress","projectOrders","progressArray","sum","ceil","setActivityStatusParams","combinePdf","foe","fo","region","branch","prctr","originalStep","isInstallationStepEditable","undefined","calculationOfInstallationSteps","handedOverToMaintenance","debugQuantity","guideDoorInstallation","startTheInstallation","installationNotStarted","orderNos","theOverallProgress","currentRefreshTime","getMonth","getDate","getHours","getMinutes","saveTheFirstRefreshTime","dispatch","cache","get","then","datatime","allDataRefreshTime","masterDataRefreshTime","orderDataRefreshTime","templateListDataRefreshTime","documentListDataRefreshTime","taskListDataRefreshTime","setAllDataRefreshTime","put","id","language","recordRefreshTime","projects","userInfo","parmas","projectNos","auth","window","localStorage","getItem","roles","isSubconTLOrPE","isEISV","request","getDocumentListParmas","fetchOrders","fetchTasksList","fetchDocuments","find","order","isFormUpdated","currentForm","initForm","Array","isArray","isEqual","localInstallationStepsConfirmDateProc","stepNo","verifyWhenConfirm7020or70C0","checkSteps","message","checkTemplateForm","documentNo","documentPart","existData","code","getRawTemplate","getDraftFromLocal","draftParam","getDraft","param","expendParam","getDraftFromApi","form","saveDraftToLocal","currentParam","draftParams","storeData","deleteDraftFromLocal","deleteKeys","templatesData","condition1","condition2","condition3","condition4","condition5","condition6","condition7","condition8","array","getDocumentComplateStatus","activityList","orderDetailSteps","activityAuth","documentCompleteStatus","status","completeSum","completed","getStopsOrHoistHeight","chars","stops","hoistHeight","scrollToPosition","element","pathname","position","scrollPosition","current","scrollTop","removeNotVisibleFields","templateForm","cloneDeep","remove","field","getTaskCount","tasks","awaitCloseNum","taskCleaner","assigner","Status","awaitComplateNum","assignee","getAwaitComplateAwaitCloseCount","countTaskStatuses","statusCount","task","taskType","taskStatusCount","updatedTasks","map","pendingCloseCount","pendingCompleteCount","pendingStartCoun","toString","checkFileIsExisting","template","documentName","index","getChecklistActivityNo","activtyNo","listData","getNonConformityConfig","allowreupload","closeEnabledInOILScreen","customizer","objValue","srcValue","concat","updateOrdersData","soNo","showLoading","fetchOrdersDataByProjects","response","ordersData","entities","mergeWith","fetchLocalInstallationStepsConfirmDate","catch","error","setError","finally","hideLoading","disableForm","params","showUploadButton","nonConformityConfig","root","documentsItem","disableTheEntranceroot","description","ele","docAuthActivityNos","canUploadDoc","isEnableCorrectImage","now","year","getFullYear","month","String","padStart","day","hours","minutes","seconds","getSeconds","getCurrentPosition","navigator","geolocation","latitude","coords","longitude","getLocationFromCoordinates","reject","BMap","geocoder","Geocoder","point","Point","getLocation","address","fillTextToImg","base64","projectParams","location","projectName","time","watermarkText","img","Image","src","setAttribute","onload","canvas","document","createElement","ctx","getContext","width","height","fillRect","drawImage","font","textAlign","fillStyle","lineHeight","fillText","toDataURL","formatDateToYMD","dateString","console","log","taskDataConversion","taskId","salesOrderNo","planStartDate","planEndDate","actualStartDate","actualEndDate","actualCloseDate","actualClosedDate","statusDesc"],"mappings":"mjBAAA,MAAO,GAAKA,CAAAA,MAAZ,KAAwB,SAAxB,CACA,MAAO,GAAKC,CAAAA,GAAZ,KAAqB,KAArB,CACA,OAASC,EAAT,KAAmB,OAAnB,CACA,MAAO,GAAKC,CAAAA,QAAZ,KAA0B,mBAA1B,CACA,MAAOC,CAAAA,KAAP,KAAkB,UAAlB,CACA,MAAOC,CAAAA,CAAP,KAAc,QAAd,CACA,OAASC,SAAT,KAA0B,0BAA1B,CACA,MAAO,GAAKC,CAAAA,MAAZ,KAAwB,WAAxB,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,UAAtB,CACA,OAASC,SAAT,KAA0B,WAA1B,CACA,OAASC,sBAAT,KAAuC,aAAvC,CAEA,MAAO,IAAMC,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACC,EAAD,CAAQ,CAC3B,MAAO,IAAIC,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAa,CAC9BC,UAAU,CAACD,OAAD,CAAUF,EAAV,CAAV,CACD,CAFM,CAAP,CAGD,CAJM,CAMP,MAAO,IAAMI,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,IAAD,CAAOC,KAAP,CAAcC,WAAd,CAA8B,CAC7D,GAAMC,CAAAA,WAAW,CAAG,GAAIC,CAAAA,IAAJ,CAASJ,IAAT,CAApB,CACA,OAAQE,WAAR,EACE,IAAK,UAAL,CAAiB,CACf,GAAMG,CAAAA,KAAK,CAAGJ,KAAK,CAAG,GAAIG,CAAAA,IAAJ,CAASH,KAAT,EAAgBK,MAAhB,GAA2B,QAAjD,CACA,GAAMC,CAAAA,GAAG,CAAGF,KAAK,CAAG,EAAI,QAAxB,CACA,MAAOF,CAAAA,WAAW,CAACK,OAAZ,IAAyBD,GAAhC,CACD,CACD,IAAK,UAAL,CAAiB,CACf,GAAMF,CAAAA,MAAK,CAAGJ,KAAK,CAAG,GAAIG,CAAAA,IAAJ,CAASH,KAAT,EAAgBK,MAAhB,GAA2B,QAAjD,CACA,GAAMC,CAAAA,IAAG,CAAGF,MAAK,CAAG,GAAK,QAAzB,CAEA,MAAOF,CAAAA,WAAW,CAACK,OAAZ,IAAyBD,IAAhC,CACD,CACD,IAAK,WAAL,CAAkB,CAChB,GAAMF,CAAAA,OAAK,CAAGJ,KAAK,CAAG,GAAIG,CAAAA,IAAJ,CAASH,KAAT,EAAgBK,MAAhB,GAA2B,QAAjD,CACA,GAAMC,CAAAA,KAAG,CAAGF,OAAK,CAAG,GAAK,QAAzB,CAEA,MAAOF,CAAAA,WAAW,CAACK,OAAZ,IAAyBD,KAAhC,CACD,CACD,IAAK,YAAL,CAAmB,CACjB,GAAMF,CAAAA,OAAK,CAAGJ,KAAK,CAAG,GAAIG,CAAAA,IAAJ,CAASH,KAAT,EAAgBK,MAAhB,GAA2B,QAAjD,CACA,GAAMC,CAAAA,KAAG,CAAGF,OAAK,CAAG,GAAK,QAAzB,CAEA,MAAOF,CAAAA,WAAW,CAACK,OAAZ,IAAyBD,KAAhC,CACD,CACD,IAAK,KAAL,CACA,QAAS,CACP,MAAO,KAAP,CACD,CA3BH,CA6BD,CA/BM,CAiCP,MAAO,IAAME,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACC,IAAD,CAAU,CAC3C,MAAOA,CAAAA,IAAI,CAACC,IAAL,CAAU,SAAUC,CAAV,CAAaC,CAAb,CAAgB,CAC/B,GAAID,CAAC,CAACD,IAAF,CAASE,CAAC,CAACF,IAAf,CAAqB,CACnB,MAAO,CAAC,CAAR,CACD,CAFD,IAEO,CACL,MAAO,EAAP,CACD,CACF,CANM,CAAP,CAOD,CARM,CAUP,MAAO,IAAMG,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACJ,IAAD,CAAU,CAC1C,GAAIK,CAAAA,GAAG,CAAG,EAAV,CAEAL,IAAI,CAACM,OAAL,CAAa,SAACC,IAAD,CAAU,CACrB,GAAI,CAACF,GAAG,CAACE,IAAI,CAACC,UAAN,CAAR,CAA2B,CACzBH,GAAG,CAACE,IAAI,CAACC,UAAN,CAAH,CAAuB,EAAvB,CACD,CAEDH,GAAG,CAACE,IAAI,CAACC,UAAN,CAAH,CAAqBC,IAArB,CAA0BF,IAA1B,EACD,CAND,EAQA,MAAOF,CAAAA,GAAP,CACD,CAZM,CAcP,MAAO,IAAMK,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACV,IAAD,CAAU,CACrC,GAAMK,CAAAA,GAAG,CAAG,EAAZ,CAEAL,IAAI,CAACM,OAAL,CAAa,SAACK,KAAD,CAAW,CACtBN,GAAG,CAACM,KAAK,CAACC,SAAP,CAAH,CAAuBC,IAAI,CAACC,KAAL,CAAWH,KAAK,CAACI,gBAAjB,CAAvB,CACD,CAFD,EAIA,MAAOV,CAAAA,GAAP,CACD,CARM,CAUP,MAAO,IAAMW,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAAChB,IAAD,CAAU,CACvC,GAAMK,CAAAA,GAAG,CAAG,EAAZ,CAEAY,MAAM,CAACC,IAAP,CAAYlB,IAAZ,EAAkBM,OAAlB,CAA0B,SAACa,GAAD,CAAS,CACjC,GAAMZ,CAAAA,IAAI,CAAG,EAAb,CAEAA,IAAI,CAACK,SAAL,CAAiBO,GAAjB,CACAZ,IAAI,CAACQ,gBAAL,CAAwBF,IAAI,CAACO,SAAL,CAAepB,IAAI,CAACmB,GAAD,CAAnB,CAAxB,CAEAd,GAAG,CAACI,IAAJ,CAASF,IAAT,EACD,CAPD,EAQA,MAAOF,CAAAA,GAAP,CACD,CAZM,CAcP,MAAO,IAAMgB,CAAAA,6BAA6B,CAAG,QAAhCA,CAAAA,6BAAgC,CAACrB,IAAD,CAAU,CACrD,GAAMK,CAAAA,GAAG,CAAG,EAAZ,CAEAL,IAAI,CAACM,OAAL,CAAa,SAACK,KAAD,CAAW,CACtB,GAAI,CAACN,GAAG,CAACM,KAAK,CAACC,SAAP,CAAR,CAA2B,CACzBP,GAAG,CAACM,KAAK,CAACC,SAAP,CAAH,CAAuB,EAAvB,CACD,CACDP,GAAG,CAACM,KAAK,CAACC,SAAP,CAAH,CAAqBH,IAArB,CAA0BE,KAA1B,EACD,CALD,EAOA,MAAON,CAAAA,GAAP,CACD,CAXM,CAaP,MAAO,IAAMiB,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,CAACC,MAAD,CAAY,CAChC,GAAMC,CAAAA,UAAU,CAAG,CACjB,YADiB,CAEjB,WAFiB,CAGjB,QAHiB,CAIjB,gBAJiB,CAKjB,UALiB,CAMjB,UANiB,CAOjB,WAPiB,CAQjB,OARiB,CASjB,SATiB,CAAnB,CAYA,GAAMC,CAAAA,iBAAiB,CACrB,gFADF,CAGA,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGH,MAAM,CAACI,MAA3B,CAAmCD,CAAC,EAApC,CAAwC,CACtC,GAAME,CAAAA,MAAM,CAAGjD,SAAS,CAAC4C,MAAM,CAACG,CAAD,CAAP,CAAxB,CACA,GAAIE,MAAJ,CAAY,CACV,IAAK,GAAIC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGL,UAAU,CAACG,MAA/B,CAAuCE,CAAC,EAAxC,CAA4C,CAC1C,GAAIN,MAAM,CAACG,CAAD,CAAN,CAAUI,IAAV,GAAmBN,UAAU,CAACK,CAAD,CAA7B,EAAoCN,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBC,QAA3D,CAAqE,CACnE,GAAIC,CAAAA,SAAS,OAAb,CACA,GAAIV,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBG,SAAnB,CAA6BC,OAAjC,CAA0C,CACxCF,SAAS,CAAGV,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBG,SAAnB,CAA6BC,OAAzC,CACD,CAFD,IAEO,IAAIZ,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBG,SAAnB,CAA6BE,OAAjC,CAA0C,CAC/CH,SAAS,CAAGV,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBG,SAAnB,CAA6BE,OAAzC,CACD,CAFM,IAEA,IAAIb,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBM,eAAnB,CAAmCF,OAAvC,CAAgD,CACrDF,SAAS,CAAGV,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBM,eAAnB,CAAmCF,OAA/C,CACD,CAFM,IAEA,CACLF,SAAS,CAAGV,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBM,eAAnB,CAAmCD,OAA/C,CACD,CAED,GACEb,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBpB,KAAnB,GAA6Bc,iBAA7B,EACAF,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBpB,KAAnB,GAA6B,EAD7B,EAEAY,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBpB,KAAnB,GAA6B,GAH/B,CAIE,CACA2B,KAAK,CAACL,SAAD,CAAL,CAEA,MAAO,MAAP,CACD,CARD,IAQO,IAAIV,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBpB,KAAnB,GAA6B,GAAjC,CAAsC,CAC3C2B,KAAK,CAACL,SAAD,CAAL,CACA,MAAO,MAAP,CACD,CAHM,IAGA,IAAIV,MAAM,CAACG,CAAD,CAAN,CAAUI,IAAV,GAAmB,QAAvB,CAAiC,CACtC,GAAIP,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBQ,GAAnB,EAA0BhB,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBS,GAAjD,CAAsD,CACpD,GAAIjB,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBpB,KAAnB,CAA2BY,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBQ,GAA9C,EAAqDhB,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBpB,KAAnB,CAA2BY,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBS,GAAvG,CAA4G,CAC1G,GAAMC,CAAAA,MAAM,CAAGC,cAAc,CAACnB,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBQ,GAApB,CAAyBhB,MAAM,CAACG,CAAD,CAAN,CAAUK,QAAV,CAAmBS,GAA5C,CAA7B,CACAF,KAAK,WAAIL,SAAJ,cAAkBQ,MAAlB,EAAL,CACA,MAAO,MAAP,CACD,CACF,CACF,CACF,CACF,CACF,CACF,CACD,MAAO,KAAP,CACD,CAzDM,CA2DP,MAAO,IAAME,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CACxBC,aADwB,CAExBC,WAFwB,CAGxBrC,UAHwB,CAIxBsC,SAJwB,CAKxBC,YALwB,CAMrB,mEACH,GAAMC,CAAAA,MAAM,CAAGvE,KAAK,CAACwE,QAAN,GAAiBD,MAAhC,CACA,GAAME,CAAAA,WAAW,sBAAGF,MAAM,CAACH,WAAD,CAAT,8CAAG,oBAAqBK,WAAzC,CACA,GAAMC,CAAAA,aAAa,uBAAGH,MAAM,CAACH,WAAD,CAAT,+CAAG,qBAAqBM,aAA3C,CACA,GAAMC,CAAAA,eAAe,uBAAGJ,MAAM,CAACH,WAAD,CAAT,+CAAG,qBAAqBO,eAA7C,CACA,GAAMC,CAAAA,aAAa,CAAGP,SAAS,CAACtC,UAAD,CAAT,CAAwBsC,SAAS,CAACtC,UAAD,CAAjC,CAAgD,EAAtE,CACA,GAAM8C,CAAAA,gBAAgB,CAAGC,eAAe,CACtCF,aADsC,CAEtCH,WAFsC,CAGtCC,aAHsC,CAItCC,eAJsC,CAAxC,CAOA,GAAIE,gBAAgB,CAAC3B,MAAjB,CAA0B,CAA9B,CAAiC,CAC/B,GAAM6B,CAAAA,YAAY,CAAGF,gBAAgB,CAACG,MAAjB,CACnB,SAACC,IAAD,QAAUA,CAAAA,IAAI,CAACC,OAAL,GAAiB,GAA3B,EADmB,CAArB,CAGA,GAAIH,YAAY,CAAC7B,MAAb,CAAsB,CAA1B,CAA6B,kDAC3B,GAAMiC,CAAAA,SAAS,CACbb,YADa,SACbA,YADa,wCACbA,YAAY,CAAGH,aAAH,CADC,wEACb,sBAAgCC,WAAhC,CADa,iDACb,uBAA+CrC,UAA/C,CADF,CAGA,GAAIqD,CAAAA,KAAK,CAAG,CAAZ,CACA,GAAID,SAAJ,CAAe,CACb,IAAK,GAAIlC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG8B,YAAY,CAAC7B,MAAjC,CAAyCD,CAAC,EAA1C,CAA8C,CAC5C,GAAMoC,CAAAA,WAAW,WAAMN,YAAY,CAAC9B,CAAD,CAAZ,CAAgBqC,mBAAtB,CAAjB,CACA,IAAK,GAAIlC,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG+B,SAAS,CAACjC,MAA9B,CAAsCE,CAAC,EAAvC,CAA2C,kBACzC,eAAA+B,SAAS,CAAC/B,CAAD,CAAT,oDAAcmC,IAAd,CAAmBC,QAAnB,CAA4BH,WAA5B,IAA4CD,KAAK,EAAjD,CACD,CACF,CAED,GAAIL,YAAY,CAAC7B,MAAb,EAAuBkC,KAA3B,CAAkC,CAChC,MAAO,MAAP,CACD,CAFD,IAEO,CACL,MAAO,MAAP,CACD,CACF,CAbD,IAaO,CACL,MAAO,MAAP,CACD,CACF,CArBD,IAqBO,CACL,MAAO,MAAP,CAAe;AAChB,CACF,CA5BD,IA4BO,CACL,MAAO,kBAAP,CACD,CACF,CAlDM,CAoDP,MAAO,IAAMK,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,QAAD,CAAWC,GAAX,CAAmB,CACzC,MAAO,UAAUlE,CAAV,CAAaC,CAAb,CAAgB,CACrB,GAAIkE,CAAAA,MAAM,CAAGnE,CAAC,CAACiE,QAAD,CAAd,CACA,GAAIG,CAAAA,MAAM,CAAGnE,CAAC,CAACgE,QAAD,CAAd,CAEA,GAAIC,GAAJ,CAAS,CACP;AACA,MAAO1E,CAAAA,IAAI,CAACoB,KAAL,CAAWuD,MAAX,EAAqB3E,IAAI,CAACoB,KAAL,CAAWwD,MAAX,CAA5B,CACD,CAHD,IAGO,CACL;AACA,MAAO5E,CAAAA,IAAI,CAACoB,KAAL,CAAWwD,MAAX,EAAqB5E,IAAI,CAACoB,KAAL,CAAWuD,MAAX,CAA5B,CACD,CACF,CAXD,CAYD,CAbM,CAeP,MAAO,IAAME,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,eAAD,CAAkB3B,WAAlB,CAAkC,CACjE,GACE2B,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAf,EACA,CAAC2B,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAf,CAAuC4B,aAF1C,CAGE,CACA,MAAO,KAAP,CACD,CALD,IAKO,CACL,MAAO,MAAP,CACD,CACF,CATM,CAWP,MAAO,IAAMC,CAAAA,wBAAwB,CAAG,QAA3BA,CAAAA,wBAA2B,CAACF,eAAD,CAAkB3B,WAAlB,CAAkC,sBACxE,GACE2B,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAf,EACA,CAAC2B,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAf,CAAuC4B,aAF1C,CAGE,CACA,MAAO,KAAP,CACD,CALD,IAKO,sBAAID,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAnB,2CAAI,iBAAwC4B,aAA5C,CAA2D,CAChE,MAAO,KAAP,CACD,CAFM,IAEA,CACL,MAAO,KAAP,CACD,CACF,CAXM,CAaP,MAAO,IAAME,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACH,eAAD,CAAkB3B,WAAlB,CAAkC,6EAC7D;AAEA,sBAAI2B,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAnB,4CAAI,kBAAwC4B,aAA5C,CAA2D,CACzD,MAAO,IAAP,CACD,CACD,sBAAID,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAnB,4CAAI,kBAAwC4B,aAA5C,CAA2D,CACzD,MAAO,GAAP,CACD,CACD,GACE,oBAAAD,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAf,8DAAwC4B,aAAxC,GACA,CAACD,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAFlB,CAGE,CACA,MAAO,GAAP,CACD,CACD,sBAAI2B,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAnB,4CAAI,kBAAwC4B,aAA5C,CAA2D,CACzD,MAAO,GAAP,CACD,CAFD,IAEO,CACL,MAAO,EAAP,CACD,CACF,CApBM,CAsBP;AACA,MAAO,IAAMG,CAAAA,4BAA4B,CAAG,QAA/BA,CAAAA,4BAA+B,CAC1ChC,aAD0C,CAE1C4B,eAF0C,CAG1CK,OAH0C,CAI1C9B,YAJ0C,CAKvC,CACH,GAAI,CAACyB,eAAe,CAACK,OAAO,CAAG,OAAX,CAApB,CAAyC,CACvC;AACA,GAAMC,CAAAA,SAAS,CAAG,CAAC,MAAD,CAAS,MAAT,CAAiB,MAAjB,CAAlB,CACA,GAAMC,CAAAA,cAAc,CAAG9D,MAAM,CAACC,IAAP,CAAYsD,eAAZ,EAA6Bf,MAA7B,CAAoC,SAACC,IAAD,CAAU,CACnE,MACEc,CAAAA,eAAe,CAACd,IAAD,CAAf,CAAsBb,WAAtB,GAAsCgC,OAAtC,EACAC,SAAS,CAACE,OAAV,CAAkBR,eAAe,CAACd,IAAD,CAAf,CAAsBuB,cAAxC,EAA0D,CAAC,CAF7D,CAID,CALsB,CAAvB,CAOA,GAAMC,CAAAA,QAAQ,CAAGH,cAAc,CAACtB,MAAf,CAAsB,SAACC,IAAD,CAAU,CAC/C,MAAOc,CAAAA,eAAe,CAACd,IAAD,CAAf,CAAsBe,aAAtB,GAAwC,IAA/C,CACD,CAFgB,CAAjB,CAIA,MAAOU,CAAAA,IAAI,CAACC,KAAL,CAAYF,QAAQ,CAACvD,MAAT,CAAkB,GAAnB,CAA0B,CAArC,EAA0C,GAAjD,CACD,CAfD,IAeO,CACL;AACA,GAAIiD,CAAAA,6BAA4B,CAAG,CAAnC,CACA,GAAMS,CAAAA,OAAO,CAAG,CACd,MADc,CAEd,MAFc,CAGd,MAHc,CAId,MAJc,CAKd,MALc,CAMd,MANc,CAOd,MAPc,CAQd,MARc,CASd,MATc,CAUd,MAVc,CAWd,MAXc,CAYd,MAZc,CAad,MAbc,CAcd,MAdc,CAAhB,CAiBAA,OAAO,CAAC/E,OAAR,CAAgB,SAACgF,IAAD,CAAU,CACxB,GACEd,eAAe,CAACK,OAAO,CAAG,GAAV,CAAgBS,IAAjB,CAAf,CAAsCC,QAAtC,EACAf,eAAe,CAACK,OAAO,CAAG,GAAV,CAAgBS,IAAjB,CAAf,CAAsCb,aAFxC,CAGE,CACAG,6BAA4B,EAAI,CAAhC,CACD,CALD,IAKO,IAAI,CAACJ,eAAe,CAACK,OAAO,CAAG,GAAV,CAAgBS,IAAjB,CAAf,CAAsCC,QAA3C,CAAqD,mDAC1D,GAAMC,CAAAA,gBAAgB,yBAAGzC,YAAY,CAACH,aAAD,CAAf,yEAAG,uBAA8BiC,OAA9B,CAAH,iDAAG,uBAAyCS,IAAzC,CAAzB,CACA,GAAMG,CAAAA,gBAAgB,CAAGD,gBAAgB,CACrCA,gBAAgB,CAACvF,IAAjB,CAAsBiE,QAAQ,CAAC,UAAD,CAAa,KAAb,CAA9B,CADqC,CAErC,IAFJ,CAGA,GAAMwB,CAAAA,aAAa,CAAGD,gBAAgB,CAClCA,gBADkC,SAClCA,gBADkC,iBAClCA,gBAAgB,CAAG,CAAH,CAAhB,CAAsBE,QADY,CAElC,IAFJ,CAGAD,aAAa,GAAKd,6BAA4B,EAAI,CAArC,CAAb,CACD,CACF,CAhBD,EAkBA,GAAMhD,CAAAA,MAAM,CAAIgD,6BAA4B,CAAG,EAAhC,CAAsC,GAArD,CACA,MAAOO,CAAAA,IAAI,CAACC,KAAL,CAAWxD,MAAX,EAAqB,GAA5B,CACD,CACF,CA9DM,CAgEP,MAAO,IAAMgE,CAAAA,eAAe,CAAG,yBAAChD,aAAD,CAAgBI,MAAhB,CAAwBwB,eAAxB,CAA4C,CACzE,GAAMqB,CAAAA,aAAa,CAAG,EAAtB,CACA5E,MAAM,CAACC,IAAP,CAAY8B,MAAZ,EAAoB1C,OAApB,CAA4B,SAACoD,IAAD,CAAU,CACpCV,MAAM,CAACU,IAAD,CAAN,CAAad,aAAb,GAA+BA,aAA/B,EAAgDiD,aAAa,CAACpF,IAAd,CAAmBiD,IAAnB,CAAhD,CACD,CAFD,EAGA,GAAMoC,CAAAA,aAAa,CAAG,EAAtB,CACAD,aAAa,CAACvF,OAAd,CAAsB,SAACoD,IAAD,CAAU,CAC9B,GAAIwB,CAAAA,QAAQ,CAAGP,aAAa,CAACH,eAAD,CAAkBd,IAAlB,CAA5B,CAEAoC,aAAa,CAACrF,IAAd,CAAmByE,QAAnB,EACD,CAJD,EAMA,GAAIa,CAAAA,GAAG,CAAG,CAAV,CAEAD,aAAa,CAACxF,OAAd,CAAsB,SAACoD,IAAD,CAAU,CAC9BqC,GAAG,EAAIrC,IAAI,GAAK,KAAT,CAAiB,CAAjB,CAAqBA,IAA5B,CACD,CAFD,EAGA,GAAMkC,CAAAA,eAAe,CAAGT,IAAI,CAACa,IAAL,CAAUD,GAAG,CAAGF,aAAa,CAAClE,MAA9B,CAAxB,CACA,MAAOiE,CAAAA,eAAP,CACD,CAnBM,CAqBP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GACA,MAAO,IAAMK,CAAAA,uBAAuB,CAAG,QAA1BA,CAAAA,uBAA0B,CACrCrF,SADqC,CAErCiE,OAFqC,CAGrCrE,UAHqC,CAIrClB,IAJqC,CAKrCwC,IALqC,CAMrC0C,eANqC,CAOrCxB,MAPqC,CAQlC,uDACH,GAAMpB,CAAAA,MAAM,CAAG,EAAf,CACAA,MAAM,CAAChB,SAAP,CAAmBA,SAAnB,CACAgB,MAAM,CAACiD,OAAP,CAAiBA,OAAjB,CACAjD,MAAM,CAACpB,UAAP,CAAoBA,UAApB,CACAoB,MAAM,CAACtC,IAAP,CAAcA,IAAd,CACAsC,MAAM,CAACE,IAAP,CAAcA,IAAd,CACAF,MAAM,CAACsE,UAAP,CAAoB,KAApB,CACAtE,MAAM,CAACuE,GAAP,CAAanD,MAAb,SAAaA,MAAb,kCAAaA,MAAM,CAAG6B,OAAH,CAAnB,0CAAa,gBAAmBuB,EAAhC,CACAxE,MAAM,CAACyE,MAAP,CAAgBrD,MAAhB,SAAgBA,MAAhB,mCAAgBA,MAAM,CAAG6B,OAAH,CAAtB,2CAAgB,iBAAmBwB,MAAnC,CACAzE,MAAM,CAAC0E,MAAP,CAAgBtD,MAAhB,SAAgBA,MAAhB,mCAAgBA,MAAM,CAAG6B,OAAH,CAAtB,2CAAgB,iBAAmB0B,KAAnC,CAEA,GAAI/B,eAAe,CAACK,OAAO,CAAG,OAAX,CAAnB,CAAwC,CACtC;AACA,GAAIrE,UAAU,GAAK,MAAnB,CAA2B,CACzBoB,MAAM,CAACsE,UAAP,CAAoB,IAApB,CACD,CAED,GAAI1B,eAAe,CAACK,OAAO,CAAG,GAAV,CAAgBrE,UAAjB,CAAf,CAA4CgG,YAAhD,CAA8D,CAC5D5E,MAAM,CAACpB,UAAP,CACEgE,eAAe,CAACK,OAAO,CAAG,GAAV,CAAgBrE,UAAjB,CAAf,CAA4CgG,YAD9C,CAED,CACF,CACD,MAAO5E,CAAAA,MAAP,CACD,CAhCM,CAkCP,MAAO,IAAM6E,CAAAA,0BAA0B,CAAG,QAA7BA,CAAAA,0BAA6B,CACxC5B,OADwC,CAExCrE,UAFwC,CAGxCgE,eAHwC,CAIrC,CACH,GACEA,eAAe,CAACK,OAAO,CAAG,GAAV,CAAgBrE,UAAjB,CAAf,CAA4C+E,QAA5C,GAAyDmB,SAAzD,EACAlC,eAAe,CAACK,OAAO,CAAG,GAAV,CAAgBrE,UAAjB,CAAf,CAA4C+E,QAF9C,CAGE,CACA,MAAO,KAAP,CACD,CALD,IAKO,CACL,MAAO,MAAP,CACD,CACF,CAbM,CAeP,MAAO,IAAMoB,CAAAA,8BAA8B,CAAG,QAAjCA,CAAAA,8BAAiC,CAACnC,eAAD,CAAkBxB,MAAlB,CAA6B,CACzE,GAAI4D,CAAAA,uBAAuB,CAAG,CAA9B,CAAiC;AACjC,GAAIC,CAAAA,aAAa,CAAG,CAApB,CAAuB;AACvB,GAAIC,CAAAA,qBAAqB,CAAG,CAA5B,CAA+B;AAC/B,GAAIC,CAAAA,oBAAoB,CAAG,CAA3B,CAA8B;AAC9B,GAAIC,CAAAA,sBAAsB,CAAG,CAA7B,CAAgC;AAChC,GAAMC,CAAAA,QAAQ,CAAGhG,MAAM,CAACC,IAAP,CAAY8B,MAAZ,CAAjB,CACA,IAAK,GAAItB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGuF,QAAQ,CAACtF,MAA7B,CAAqCD,CAAC,EAAtC,CAA0C,gGACxC,GACE8C,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CAAf,sBACA8C,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CADf,4CACA,kBAAwC+C,aADxC,CADF,CAGE,CACAmC,uBAAuB,GACxB,CALD,IAKO,IACLpC,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CAAf,sBACA8C,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CADf,4CACA,kBAAwC+C,aADxC,CADK,CAGL,CACAoC,aAAa,GACd,CALM,IAKA,IACLrC,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CAAf,sBACA8C,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CADf,4CACA,kBAAwC+C,aADxC,CADK,CAGL,CACAoC,aAAa,GACd,CALM,IAKA,IACLrC,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CAAf,sBACA8C,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CADf,4CACA,kBAAwC+C,aADxC,CADK,CAGL,CACAqC,qBAAqB,GACtB,CALM,IAKA,IACLtC,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CAAf,uBACA8C,eAAe,CAACyC,QAAQ,CAACvF,CAAD,CAAR,CAAc,OAAf,CADf,6CACA,mBAAwC+C,aADxC,CADK,CAGL,CACAsC,oBAAoB,GACrB,CALM,IAKA,CACLC,sBAAsB,GACvB,CACF,CAED,GAAIE,CAAAA,kBAAkB,CAAG,CAAzB,CACA,GAAMlH,CAAAA,IAAI,CAAG,CACX4G,uBADW,CAEXC,aAFW,CAGXC,qBAHW,CAIXC,oBAJW,CAKXC,sBALW,CAAb,CAOAhH,IAAI,CAACM,OAAL,CAAa,SAACoD,IAAD,CAAU,CACrBwD,kBAAkB,EAAIxD,IAAtB,CACD,CAFD,EAIA,MAAO,CACLkD,uBAAuB,CAAvBA,uBADK,CAELC,aAAa,CAAbA,aAFK,CAGLC,qBAAqB,CAArBA,qBAHK,CAILC,oBAAoB,CAApBA,oBAJK,CAKLC,sBAAsB,CAAtBA,sBALK,CAMLE,kBAAkB,CAAlBA,kBANK,CAAP,CAQD,CA1DM,CA4DP,MAAO,IAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,EAAM,CACtC,gBAAU,GAAIzH,CAAAA,IAAJ,GAAW0H,QAAX,GAAwB,CAAlC,aACM,GAAI1H,CAAAA,IAAJ,GAAW2H,OAAX,EADN,aAC8B,GAAI3H,CAAAA,IAAJ,GAAW4H,QAAX,EAD9B,aACuD,GAAI5H,CAAAA,IAAJ,GAAW6H,UAAX,GAA0B,EAA1B,CACjD,IAAM,GAAI7H,CAAAA,IAAJ,GAAW6H,UAAX,EAD2C,CAEjD,GAAI7H,CAAAA,IAAJ,GAAW6H,UAAX,EAHN,EAKD,CANM,CAQP,MAAO,IAAMC,CAAAA,uBAAuB,CAAG,QAA1BA,CAAAA,uBAA0B,CAACC,QAAD,CAAc,CACnDlJ,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,iBAAb,EAAgCC,IAAhC,CAAqC,SAACF,KAAD,CAAW,CAC9C,GAAMG,CAAAA,QAAQ,CAAG,CACfC,kBAAkB,CAAEX,kBAAkB,EADvB,CAEfY,qBAAqB,CAAEZ,kBAAkB,EAF1B,CAGfa,oBAAoB,CAAEb,kBAAkB,EAHzB,CAIfc,2BAA2B,CAAEd,kBAAkB,EAJhC,CAKfe,2BAA2B,CAAEf,kBAAkB,EALhC,CAMfgB,uBAAuB,CAAEhB,kBAAkB,EAN5B,CAAjB,CAQAM,QAAQ,CAACpJ,MAAM,CAAC+J,qBAAP,CAA6BP,QAA7B,CAAD,CAAR,CAEA,EAACH,KAAD,SAACA,KAAD,iBAACA,KAAK,CAAE1H,IAAR,GACEzB,EAAE,CAACmJ,KAAH,CACGW,GADH,CACO,CACHC,EAAE,CAAE,iBADD,CAEHtI,IAAI,CAAE6H,QAFH,CADP,EAKGD,IALH,CAKQ,UAAM,CACVH,QAAQ,CAACpJ,MAAM,CAAC+J,qBAAP,CAA6BP,QAA7B,CAAD,CAAR,CACD,CAPH,CADF,CASD,CApBD,EAsBAtJ,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,UAAb,EAAyBC,IAAzB,CAA8B,SAACF,KAAD,CAAW,CACvC,GAAMa,CAAAA,QAAQ,CAAG,OAAjB,CACA,EAACb,KAAD,SAACA,KAAD,iBAACA,KAAK,CAAE1H,IAAR,GACEzB,EAAE,CAACmJ,KAAH,CACGW,GADH,CACO,CACHC,EAAE,CAAE,UADD,CAEHtI,IAAI,CAAE,CAAEuI,QAAQ,CAAE,OAAZ,CAFH,CADP,EAKGX,IALH,CAKQ,UAAM,CACVH,QAAQ,CAACpJ,MAAM,CAAC+J,qBAAP,CAA6BG,QAA7B,CAAD,CAAR,CACD,CAPH,CADF,CASD,CAXD,EAYD,CAnCM,CAqCP,MAAO,IAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACf,QAAD,CAAWzD,IAAX,CAAiByE,QAAjB,CAA2BC,QAA3B,CAAwC,CACvE,GAAI1E,IAAJ,CAAU,CACR,GAAM2E,CAAAA,MAAM,CAAG,CACbC,UAAU,CAAE3H,MAAM,CAACC,IAAP,CAAYuH,QAAZ,CADC,CAAf,CAIA,GAAMI,CAAAA,IAAI,CAAGhI,IAAI,CAACC,KAAL,CAAWgI,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,MAA5B,CAAX,CAAb,CACA,GAAIC,CAAAA,KAAK,CAAGJ,IAAH,SAAGA,IAAH,iBAAGA,IAAI,CAAEI,KAAlB,CACA,GAAMC,CAAAA,cAAc,CAAGD,KAAK,CAACjE,OAAN,CAAc,WAAd,EAA6B,CAAC,CAA9B,EAAmCiE,KAAK,CAACjE,OAAN,CAAc,IAAd,EAAsB,CAAC,CAAjF,CACA,GAAMmE,CAAAA,MAAM,CAAGF,KAAK,CAACjE,OAAN,CAAc,IAAd,EAAsB,CAAC,CAAtC,CAEA,GAAMoE,CAAAA,OAAO,CAAGC,qBAAqB,CAACV,MAAM,CAACC,UAAR,CAArC,CACA,OAAQ5E,IAAR,EACE,IAAK,KAAL,CACE,GAAIkF,cAAc,EAAIC,MAAtB,CAA8B,CAC5B1B,QAAQ,CAACpJ,MAAM,CAACiL,WAAP,CAAmBF,OAAnB,CAA4B,KAA5B,CAAmCV,QAAnC,CAA6CjB,QAA7C,CAAD,CAAR,CACD,CAFD,IAEO,CACLA,QAAQ,CAACpJ,MAAM,CAACiL,WAAP,CAAmBF,OAAnB,CAA4B,KAA5B,CAAmCV,QAAnC,CAA6CjB,QAA7C,CAAD,CAAR,CACA;AACAA,QAAQ,CAACpJ,MAAM,CAACkL,cAAP,CAAsBb,QAAtB,CAAgCjB,QAAhC,CAAD,CAAR,CACD,CACD,MACF,IAAK,QAAL,CACEA,QAAQ,CAACpJ,MAAM,CAACiL,WAAP,CAAmBX,MAAnB,CAA2B,EAA3B,CAA+BD,QAA/B,CAAyCjB,QAAzC,CAAD,CAAR,CACA,MACF,IAAK,WAAL,CACEA,QAAQ,CAACpJ,MAAM,CAACmL,cAAP,CAAsBJ,OAAtB,CAA+BV,QAA/B,CAAyCjB,QAAzC,CAAD,CAAR,CACA,MACF,IAAK,MAAL,CACEA,QAAQ,CAACpJ,MAAM,CAACkL,cAAP,CAAsBH,OAAtB,CAA8BV,QAA9B,CAAuC,EAAvC,CAA2CjB,QAA3C,CAAD,CAAR,CACA,MACF,QACE,MACEA,CAAAA,QAAQ,CAACpJ,MAAM,CAACiL,WAAP,CAAmBF,OAAnB,CAA4B,KAA5B,CAAmCV,QAAnC,CAA6CjB,QAA7C,CAAD,CAAR,CACA;AACAA,QAAQ,CAACpJ,MAAM,CAACkL,cAAP,CAAsBb,QAAtB,CAAgCjB,QAAhC,CAAD,CAHV,CApBJ,CA0BD,CArCD,IAqCO,CACLlJ,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,iBAAb,EAAgCC,IAAhC,CAAqC,SAACF,KAAD,CAAW,CAC9C,CAAAA,KAAK,OAAL,EAAAA,KAAK,SAAL,QAAAA,KAAK,CAAE1H,IAAP,GAAeyH,QAAQ,CAACpJ,MAAM,CAAC+J,qBAAP,CAA6BV,KAAK,CAAC1H,IAAnC,CAAD,CAAvB,CACD,CAFD,EAGD,CACF,CA3CM,CA6CP,MAAO,IAAMqJ,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,CAACT,UAAD,CAAa3B,QAAb,CAA0B,CAC7D,GAAMjE,CAAAA,MAAM,CAAGiE,QAAQ,CAAGA,QAAH,CAAcxI,KAAK,CAACwE,QAAN,GAAiBD,MAAtD,CACA,GAAIhD,CAAAA,IAAI,CAAG,EAAX,CAF6D,yBAGpD0B,CAHoD,EAI3DT,MAAM,CAACC,IAAP,CAAY8B,MAAZ,EAAoByG,IAApB,CAAyB,SAAC/F,IAAD,CAAU,CACjC,MACEV,CAAAA,MAAM,CAACU,IAAD,CAAN,CAAad,aAAb,GAA+BgG,UAAU,CAAClH,CAAD,CAAzC,EACA1B,IAAI,CAACS,IAAL,CAAU,CACR0F,GAAG,CAAEnD,MAAM,CAACU,IAAD,CAAN,CAAa0C,EADV,CAERC,MAAM,CAAErD,MAAM,CAACU,IAAD,CAAN,CAAa2C,MAFb,CAGRC,MAAM,CAAEtD,MAAM,CAACU,IAAD,CAAN,CAAa6C,KAHb,CAIR3F,SAAS,CAAEoC,MAAM,CAACU,IAAD,CAAN,CAAad,aAJhB,CAKRI,MAAM,CAAE/B,MAAM,CAACC,IAAP,CAAY8B,MAAZ,EAAoBS,MAApB,CAA2B,SAACiG,KAAD,CAAW,CAC5C,MAAO1G,CAAAA,MAAM,CAAC0G,KAAD,CAAN,CAAc9G,aAAd,GAAgCI,MAAM,CAACU,IAAD,CAAN,CAAad,aAApD,CACD,CAFO,CALA,CAAV,CAFF,CAYD,CAbD,EAJ2D,EAG7D,IAAK,GAAIlB,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGkH,UAAU,CAACjH,MAA/B,CAAuCD,CAAC,EAAxC,CAA4C,OAAnCA,CAAmC,EAe3C,CAED,MAAO1B,CAAAA,IAAP,CACD,CArBM,CAuBP,MAAO,IAAM2J,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAACC,WAAD,CAAcC,QAAd,CAA2B,CACtD,GAAID,WAAW,CAACrI,MAAZ,CAAmBI,MAAnB,GAA8BkI,QAAQ,CAACtI,MAAT,CAAgBI,MAAlD,CAA0D,CACxD,MAAO,MAAP,CACD,CAED,IAAK,GAAID,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGkI,WAAW,CAACrI,MAAZ,CAAmBI,MAAvC,CAA+CD,CAAC,EAAhD,CAAoD,CAClD,GAAIoI,KAAK,CAACC,OAAN,CAAcH,WAAW,CAACrI,MAAZ,CAAmBG,CAAnB,EAAsBK,QAAtB,CAA+BpB,KAA7C,CAAJ,CAAyD,CACvD,GACE,CAACjC,CAAC,CAACsL,OAAF,CACCJ,WAAW,CAACrI,MAAZ,CAAmBG,CAAnB,EAAsBK,QAAtB,CAA+BpB,KAA/B,CAAqCV,IAArC,EADD,CAEC4J,QAAQ,CAACtI,MAAT,CAAgBG,CAAhB,EAAmBK,QAAnB,CAA4BpB,KAA5B,CAAkCV,IAAlC,EAFD,CADH,CAKE,CACA,MAAO,KAAP,CACD,CACF,CATD,IASO,CACL,GACE2J,WAAW,CAACrI,MAAZ,CAAmBG,CAAnB,EAAsBK,QAAtB,CAA+BpB,KAA/B,GACAkJ,QAAQ,CAACtI,MAAT,CAAgBG,CAAhB,EAAmBK,QAAnB,CAA4BpB,KAF9B,CAGE,CACA,MAAO,KAAP,CACD,CACF,CACF,CAED,MAAO,MAAP,CACD,CA1BM,CA4BP,MAAO,IAAMsJ,CAAAA,qCAAqC,CAAG,QAAxCA,CAAAA,qCAAwC,CAACjK,IAAD,CAAU,CAC7D,GAAMK,CAAAA,GAAG,CAAG,EAAZ,CAEAL,IAAI,CAACM,OAAL,CAAa,SAACK,KAAD,CAAW,CACtBN,GAAG,CAACM,KAAK,CAACkE,OAAN,CAAgB,GAAhB,CAAsBlE,KAAK,CAACuJ,MAA7B,CAAH,CAA0CvJ,KAA1C,CACD,CAFD,EAIA,MAAON,CAAAA,GAAP,CACD,CARM,CAUP,MAAO,IAAM8J,CAAAA,2BAA2B,CAAG,QAA9BA,CAAAA,2BAA8B,CACzC3F,eADyC,CAEzC3B,WAFyC,CAGzCoC,cAHyC,CAItC,CACH;AACA,GAAIT,eAAe,CAAC3B,WAAW,CAAG,OAAf,CAAnB,CAA4C,CAC1C,GAAIoC,cAAc,GAAK,MAAvB,CAA+B,CAC7B,GAAMmF,CAAAA,UAAU,CAAG,CACjB,MADiB,CAEjB,MAFiB,CAGjB,MAHiB,CAIjB,MAJiB,CAKjB,MALiB,CAMjB,MANiB,CAOjB,MAPiB,CAQjB,MARiB,CASjB,MATiB,CAUjB,MAViB,CAWjB,MAXiB,CAAnB,CAcA,GAAMxI,CAAAA,MAAM,CAAGwI,UAAU,CAACX,IAAX,CACb,SAACnE,IAAD,QAAU,CAACd,eAAe,CAAC3B,WAAW,CAAG,GAAd,CAAoByC,IAArB,CAAf,CAA0Cb,aAArD,EADa,CAAf,CAIA,GAAI7C,MAAJ,CAAY,CACV,MAAO,CACLsI,MAAM,CAAEtI,MADH,CAELyI,OAAO,CAAE,UAFJ,CAAP,CAID,CACF,CACF,CACF,CAlCM,CAoCP;AACA;AACA;AACA;AACA,GACA,MAAO,IAAMC,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACC,UAAD,CAAaC,YAAb,CAA2B7J,KAA3B,CAAqC,CACpE,GAAMQ,CAAAA,GAAG,CAAGoJ,UAAU,CAAG,GAAb,CAAmBC,YAA/B,CACA,MAAOjM,CAAAA,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,iBAAb,EAAgCC,IAAhC,CAAqC,SAACF,KAAD,CAAW,CACrD,GAAIA,KAAJ,SAAIA,KAAJ,iBAAIA,KAAK,CAAE1H,IAAX,CAAiB,CACf,GAAMyK,CAAAA,SAAS,CAAG/C,KAAK,CAAC1H,IAAxB,CACA,GAAI,CAACyK,SAAS,CAACtJ,GAAD,CAAd,CAAqB,CACnBsJ,SAAS,CAACtJ,GAAD,CAAT,CAAiBR,KAAjB,CAEA,MAAOpC,CAAAA,EAAE,CAACmJ,KAAH,CACJW,GADI,CACA,CAAEC,EAAE,CAAE,iBAAN,CAAyBtI,IAAI,CAAEyK,SAA/B,CADA,EAEJ7C,IAFI,CAEC,UAAM,CACV,MAAO1I,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAW/J,KAAK,CAALA,KAAX,CAAhB,CAAP,CACD,CAJI,CAAP,CAKD,CAED,GAAI8J,SAAS,CAACtJ,GAAD,CAAT,GAAmBR,KAAvB,CAA8B,CAC5B8J,SAAS,CAACtJ,GAAD,CAAT,CAAiBR,KAAjB,CAEA,MAAOpC,CAAAA,EAAE,CAACmJ,KAAH,CACJW,GADI,CACA,CAAEC,EAAE,CAAE,iBAAN,CAAyBtI,IAAI,CAAEyK,SAA/B,CADA,EAEJ7C,IAFI,CAEC,UAAM,CACV,MAAO1I,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAW/J,KAAK,CAALA,KAAX,CAAhB,CAAP,CACD,CAJI,CAAP,CAKD,CAED,MAAOzB,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAW/J,KAAK,CAALA,KAAX,CAAhB,CAAP,CACD,CAvBD,IAuBO,CACL,GAAMX,CAAAA,IAAI,CAAG,EAAb,CACAA,IAAI,CAACmB,GAAD,CAAJ,CAAYR,KAAZ,CAEA,MAAOpC,CAAAA,EAAE,CAACmJ,KAAH,CAASW,GAAT,CAAa,CAAEC,EAAE,CAAE,iBAAN,CAAyBtI,IAAI,CAAJA,IAAzB,CAAb,EAA8C4H,IAA9C,CAAmD,UAAM,CAC9D,MAAO1I,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAW/J,KAAK,CAALA,KAAX,CAAhB,CAAP,CACD,CAFM,CAAP,CAGD,CACF,CAhCM,CAAP,CAiCD,CAnCM,CAqCP,MAAO,IAAMgK,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACJ,UAAD,CAAaC,YAAb,CAA8B,CAC1D,GAAMrJ,CAAAA,GAAG,CAAGoJ,UAAU,CAAG,GAAb,CAAmBC,YAA/B,CACA,MAAOjM,CAAAA,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,iBAAb,EAAgCC,IAAhC,CAAqC,SAACF,KAAD,CAAW,CACrD;AACA,GAAIA,KAAJ,SAAIA,KAAJ,iBAAIA,KAAK,CAAE1H,IAAX,CAAiB,CACf,MAAOd,CAAAA,OAAO,CAACC,OAAR,CAAgBuI,KAAK,CAAC1H,IAAN,CAAWmB,GAAX,CAAhB,CAAP,CACD,CACF,CALM,CAAP,CAMD,CARM,CAUP;AACA;AACA;AACA,GACA,MAAO,IAAMyJ,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAC/BL,UAD+B,CAE/BC,YAF+B,CAG/BhK,UAH+B,CAI/B2C,aAJ+B,CAK/BD,WAL+B,CAM/BqF,QAN+B,CAO/BsC,UAP+B,CAQ5B,IACKhG,CAAAA,OADL,CACiBgG,UADjB,CACKhG,OADL,CAEH,GAAM1D,CAAAA,GAAG,CACP0D,OAAO,CACP,GADA,CAEArE,UAFA,CAGA,GAHA,CAIA+J,UAJA,CAKA,GALA,CAMAC,YANA,CAOA,GAPA,CAQArH,aARA,CASA,GATA,CAUAD,WAVA,CAWA,GAXA,CAYAqF,QAbF,CAcA,MAAOhK,CAAAA,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,eAAb,EAA8BC,IAA9B,CAAmC,SAACF,KAAD,CAAW,CACnD,GAAIA,KAAJ,SAAIA,KAAJ,iBAAIA,KAAK,CAAE1H,IAAX,CAAiB,CACf,GAAMyK,CAAAA,SAAS,CAAG/C,KAAK,CAAC1H,IAAxB,CACA,GAAIyK,SAAS,CAACtJ,GAAD,CAAb,CAAoB,CAClB,MAAOjC,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAW/J,KAAK,CAAE8J,SAAS,CAACtJ,GAAD,CAA3B,CAAhB,CAAP,CACD,CAED,MAAOjC,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAhB,CAAP,CACD,CAPD,IAOO,CACL,MAAOxL,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAhB,CAAP,CACD,CACF,CAXM,CAAP,CAYD,CApCM,CAsCP;AACA;AACA;AACA,GACA,MAAO,IAAMI,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACC,KAAD,CAAQF,UAAR,CAAoBG,WAApB,CAAoC,IAClDT,CAAAA,UADkD,CACrBQ,KADqB,CAClDR,UADkD,CACtCC,YADsC,CACrBO,KADqB,CACtCP,YADsC,IAElDhK,CAAAA,UAFkD,CAEGwK,WAFH,CAElDxK,UAFkD,CAEtC2C,aAFsC,CAEG6H,WAFH,CAEtC7H,aAFsC,CAEvBD,WAFuB,CAEG8H,WAFH,CAEvB9H,WAFuB,CAEVqF,QAFU,CAEGyC,WAFH,CAEVzC,QAFU,CAG1D,MAAOqC,CAAAA,iBAAiB,CACtBL,UADsB,CAEtBC,YAFsB,CAGtBhK,UAHsB,CAItB2C,aAJsB,CAKtBD,WALsB,CAMtBqF,QANsB,CAOtBsC,UAPsB,CAAjB,CAQLjD,IARK,CAQA,SAAC5H,IAAD,CAAU,CACf,GAAIA,IAAI,CAAC0K,IAAL,GAAc,CAAlB,CAAqB,CACnB,MAAOxL,CAAAA,OAAO,CAACC,OAAR,CAAgBa,IAAhB,CAAP,CACD,CAFD,IAGE,OAAOiL,CAAAA,eAAe,CAACJ,UAAD,CAAf,CAA4BjD,IAA5B,CAAiC,SAAC5H,IAAD,CAAU,CAChD,MAAOd,CAAAA,OAAO,CAACC,OAAR,CAAgBa,IAAhB,CAAP,CACD,CAFM,CAAP,CAGH,CAfM,CAAP,CAgBD,CAnBM,CAqBP;AACA;AACA;AACA,GACA,MAAO,IAAMiL,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACJ,UAAD,CAAgB,CAC7C,MAAOvM,CAAAA,GAAG,CAACwM,QAAJ,CAAaD,UAAb,EAAyBjD,IAAzB,CAA8B,SAACvH,GAAD,CAAS,CAC5C,GAAIA,GAAG,CAACL,IAAJ,CAASkL,IAAb,CAAmB,CACjB,MAAOhM,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAW/J,KAAK,CAAEN,GAAG,CAACL,IAAJ,CAASkL,IAA3B,CAAhB,CAAP,CACD,CAFD,IAEO,CACL,MAAOhM,CAAAA,OAAO,CAACC,OAAR,CAAgB,CAAEuL,IAAI,CAAE,CAAR,CAAhB,CAAP,CACD,CACF,CANM,CAAP,CAOD,CARM,CAUP,MAAO,IAAMS,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACnL,IAAD,CAAOoL,YAAP,CAAqBC,WAArB,CAAqC,IAC3Dd,CAAAA,UAD2D,CAC9Ba,YAD8B,CAC3Db,UAD2D,CAC/CC,YAD+C,CAC9BY,YAD8B,CAC/CZ,YAD+C,IAE3D3F,CAAAA,OAF2D,CAGjEwG,WAHiE,CAE3DxG,OAF2D,CAElDrE,UAFkD,CAGjE6K,WAHiE,CAElD7K,UAFkD,CAEtC2C,aAFsC,CAGjEkI,WAHiE,CAEtClI,aAFsC,CAEvBD,WAFuB,CAGjEmI,WAHiE,CAEvBnI,WAFuB,CAEVqF,QAFU,CAGjE8C,WAHiE,CAEV9C,QAFU,CAInE,GAAMpH,CAAAA,GAAG,CACP0D,OAAO,CACP,GADA,CAEArE,UAFA,CAGA,GAHA,CAIA+J,UAJA,CAKA,GALA,CAMAC,YANA,CAOA,GAPA,CAQArH,aARA,CASA,GATA,CAUAD,WAVA,CAWA,GAXA,CAYAqF,QAbF,CAcAhK,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,eAAb,EAA8BC,IAA9B,CAAmC,SAACF,KAAD,CAAW,CAC5C,GAAIA,KAAJ,SAAIA,KAAJ,iBAAIA,KAAK,CAAE1H,IAAX,CAAiB,CACf,GAAMyK,CAAAA,SAAS,CAAG/C,KAAK,CAAC1H,IAAxB,CACAyK,SAAS,CAACtJ,GAAD,CAAT,CAAiBnB,IAAjB,CACAzB,EAAE,CAACmJ,KAAH,CAASW,GAAT,CAAa,CAAEC,EAAE,CAAE,eAAN,CAAuBtI,IAAI,CAAEyK,SAA7B,CAAb,EACD,CAJD,IAIO,CACL,GAAMa,CAAAA,SAAS,CAAG,EAAlB,CACAA,SAAS,CAACnK,GAAD,CAAT,CAAiBnB,IAAjB,CACAzB,EAAE,CAACmJ,KAAH,CAASW,GAAT,CAAa,CAAEC,EAAE,CAAE,eAAN,CAAuBtI,IAAI,CAAEsL,SAA7B,CAAb,EACD,CACF,CAVD,EAWD,CA7BM,CA+BP,MAAO,IAAMC,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACH,YAAD,CAAkB,IAC5Cb,CAAAA,UAD4C,CACfa,YADe,CAC5Cb,UAD4C,CAChCC,YADgC,CACfY,YADe,CAChCZ,YADgC,CAEpDjM,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,eAAb,EAA8BC,IAA9B,CAAmC,SAACF,KAAD,CAAW,CAC5C,GAAIA,KAAJ,SAAIA,KAAJ,iBAAIA,KAAK,CAAE1H,IAAX,CAAiB,CACf,GAAMyK,CAAAA,SAAS,CAAG/C,KAAK,CAAC1H,IAAxB,CACA,GAAMwL,CAAAA,UAAU,CAAGvK,MAAM,CAACC,IAAP,CAAYuJ,SAAZ,EAAuBhH,MAAvB,CAA8B,SAACtC,GAAD,CAAS,CACxD,MAAOA,CAAAA,GAAG,CAAC8C,QAAJ,CAAasG,UAAU,CAAG,GAAb,CAAmBC,YAAhC,CAAP,CACD,CAFkB,CAAnB,CAIAgB,UAAU,CAAClL,OAAX,CAAmB,SAACa,GAAD,CAAS,CAC1B,MAAOsJ,CAAAA,SAAS,CAACtJ,GAAD,CAAhB,CACD,CAFD,EAIA5C,EAAE,CAACmJ,KAAH,CAASW,GAAT,CAAa,CAAEC,EAAE,CAAE,eAAN,CAAuBtI,IAAI,CAAEyK,SAA7B,CAAb,EACD,CACF,CAbD,EAcD,CAhBM,CAkBP,MAAO,IAAMlH,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACkI,aAAD,CAAgBvI,WAAhB,CAA6BC,aAA7B,CAA4CC,eAA5C,CAAgE,CAC7F,GAAMsI,CAAAA,UAAU,CAAGD,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACN,eAAL,GAAyBA,eAAzB,EAA4CM,IAAI,CAACR,WAAL,GAAqBA,WAAjE,EAAgFQ,IAAI,CAACP,aAAL,GAAuBA,aADzG,EADiB,CAAnB,CAKA,GAAMwI,CAAAA,UAAU,CAAGF,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACN,eAAL,GAAyBA,eAAzB,EAA4CM,IAAI,CAACR,WAAL,GAAqBA,WAAjE,EAAgFQ,IAAI,CAACP,aAAL,GAAuB,IADzG,EADiB,CAAnB,CAKA,GAAMyI,CAAAA,UAAU,CAAGH,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACN,eAAL,GAAyBA,eAAzB,EAA4CM,IAAI,CAACP,aAAL,GAAuBA,aAAnE,EAAoFO,IAAI,CAACR,WAAL,GAAqB,IAD3G,EADiB,CAAnB,CAKA,GAAM2I,CAAAA,UAAU,CAAGJ,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACN,eAAL,GAAyBA,eAAzB,EAA4CM,IAAI,CAACR,WAAL,GAAqB,IAAjE,EAAyEQ,IAAI,CAACP,aAAL,GAAuB,IADlG,EADiB,CAAnB,CAKA,GAAM2I,CAAAA,UAAU,CAAGL,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACR,WAAL,GAAqBA,WAArB,EAAoCQ,IAAI,CAACP,aAAL,GAAuBA,aAA3D,EAA4EO,IAAI,CAACN,eAAL,GAAyB,IADvG,EADiB,CAAnB,CAKA,GAAM2I,CAAAA,UAAU,CAAGN,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACR,WAAL,GAAqBA,WAArB,EAAoCQ,IAAI,CAACN,eAAL,GAAyB,IAA7D,EAAqEM,IAAI,CAACP,aAAL,GAAuB,IAD9F,EADiB,CAAnB,CAKA,GAAM6I,CAAAA,UAAU,CAAGP,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACP,aAAL,GAAuBA,aAAvB,EAAwCO,IAAI,CAACN,eAAL,GAAyB,IAAjE,EAAyEM,IAAI,CAACR,WAAL,GAAqB,IADhG,EADiB,CAAnB,CAKA,GAAM+I,CAAAA,UAAU,CAAGR,aAAa,CAAChI,MAAd,CACjB,SAACC,IAAD,QACEA,CAAAA,IAAI,CAACN,eAAL,GAAyB,IAAzB,EAAiCM,IAAI,CAACR,WAAL,GAAqB,IAAtD,EAA8DQ,IAAI,CAACP,aAAL,GAAuB,IADvF,EADiB,CAAnB,CAKA,GAAMvB,CAAAA,MAAM,CAAG,CACb8J,UADa,CAEbC,UAFa,CAGbC,UAHa,CAIbC,UAJa,CAKbC,UALa,CAMbC,UANa,CAObC,UAPa,CAQbC,UARa,EASbxC,IATa,CASR,SAAAyC,KAAK,QAAIA,CAAAA,KAAK,CAACvK,MAAN,CAAe,CAAnB,EATG,CAAf,CAWA,MAAOC,CAAAA,MAAM,CAAGA,MAAH,CAAY,EAAzB,CACD,CArDM,CAuDP,MAAO,IAAMuK,CAAAA,yBAAyB,CAAG,QAA5BA,CAAAA,yBAA4B,CACvCtD,IADuC,CAEvCjG,aAFuC,CAGvCiC,OAHuC,CAIvCL,eAJuC,CAKvC1B,SALuC,CAMvCC,YANuC,CAOpC,CACH,GAAMqJ,CAAAA,YAAY,CAAG5N,QAAQ,CAAC6N,gBAAT,CACnB7H,eADmB,CAEnBK,OAFmB,CAGnBgE,IAAI,CAACyD,YAHc,CAInBzD,IAAI,CAACI,KAAL,CAAW,CAAX,CAJmB,CAArB,CAOA,GAAMsD,CAAAA,sBAAsB,CAAG,EAA/B,CACA,IAAK,GAAI7K,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAG0K,YAAY,CAACzK,MAAjC,CAAyCD,CAAC,EAA1C,CAA8C,CAC5C,GAAI8C,eAAJ,SAAIA,eAAJ,iBAAIA,eAAe,CAAGK,OAAO,CAAG,GAAV,CAAgBuH,YAAY,CAAC1K,CAAD,CAA/B,CAAnB,CAAwD,CACtD,GAAM8K,CAAAA,MAAM,CAAG7J,UAAU,CACvBC,aADuB,CAEvBiC,OAFuB,CAGvBuH,YAAY,CAAC1K,CAAD,CAHW,CAIvBoB,SAJuB,CAKvBC,YALuB,CAAzB,CAOAwJ,sBAAsB,CAAC9L,IAAvB,CAA4B+L,MAA5B,EACD,CAEF,CAED,GAAMC,CAAAA,WAAW,CAAG,EAApB,CACA,GAAMC,CAAAA,SAAS,CAAG,EAAlB,CACA,IAAK,GAAIhL,CAAAA,EAAC,CAAG,CAAb,CAAgBA,EAAC,CAAG6K,sBAAsB,CAAC5K,MAA3C,CAAmDD,EAAC,EAApD,CAAwD,CACtD,GAAI6K,sBAAsB,CAAC7K,EAAD,CAAtB,GAA8B,MAAlC,CAA0C,CACxC+K,WAAW,CAAChM,IAAZ,CAAiB8L,sBAAsB,CAAC7K,EAAD,CAAvC,EACD,CAFD,IAEO,IAAI6K,sBAAsB,CAAC7K,EAAD,CAAtB,GAA8B,MAAlC,CAA0C,CAC/C+K,WAAW,CAAChM,IAAZ,CAAiB8L,sBAAsB,CAAC7K,EAAD,CAAvC,EACAgL,SAAS,CAACjM,IAAV,CAAe8L,sBAAsB,CAAC7K,EAAD,CAArC,EACD,CACF,CAED,gBAAUgL,SAAS,CAAC/K,MAApB,aAA8B8K,WAAW,CAAC9K,MAA1C,EACD,CA1CM,CA4CP;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAEA,MAAO,IAAMgL,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,CAACC,KAAD,CAAQ/H,OAAR,CAAiB/C,IAAjB,CAA0B,CAC7D,GAAM9B,CAAAA,IAAI,CAAG,EAAb,CACAiB,MAAM,CAACC,IAAP,CAAY0L,KAAZ,EAAmBnJ,MAAnB,CAA0B,SAACC,IAAD,CAAU,CAClC,MAAOkJ,CAAAA,KAAK,CAAClJ,IAAD,CAAL,CAAYmB,OAAZ,GAAwBA,OAAxB,EAAmC7E,IAAI,CAACS,IAAL,CAAUmM,KAAK,CAAClJ,IAAD,CAAf,CAA1C,CACD,CAFD,EAIA,GAAI5B,IAAI,GAAK,OAAb,CAAsB,CACpB,GAAM+K,CAAAA,KAAK,CAAG7M,IAAI,CAACyD,MAAL,CAAY,SAACC,IAAD,CAAU,CAClC,MACEA,CAAAA,IAAI,CAACM,IAAL,CAAUgB,OAAV,CAAkB,KAAlB,EAA2B,CAAC,CAA5B,EACAtB,IAAI,CAACM,IAAL,CAAUgB,OAAV,CAAkB,iBAAlB,EAAuC,CAAC,CAF1C,CAID,CALa,CAAd,CAMA,MAAO6H,CAAAA,KAAK,CAAClL,MAAN,CAAe,CAAf,CAAmBkL,KAAK,CAAC,CAAD,CAAL,CAASlM,KAA5B,CAAoC,CAA3C,CACD,CARD,IAQO,CACL,GAAMmM,CAAAA,WAAW,CAAG9M,IAAI,CAACyD,MAAL,CAAY,SAACC,IAAD,CAAU,CACxC,MACEA,CAAAA,IAAI,CAACM,IAAL,CAAUgB,OAAV,CAAkB,MAAlB,EAA4B,CAAC,CAA7B,EACAtB,IAAI,CAACM,IAAL,CAAUgB,OAAV,CAAkB,eAAlB,EAAqC,CAAC,CADtC,EAEAtB,IAAI,CAACM,IAAL,CAAUgB,OAAV,CAAkB,eAAlB,EAAqC,CAAC,CAHxC,CAKD,CANmB,CAApB,CAQA,MAAO8H,CAAAA,WAAW,CAACnL,MAAZ,CAAqB,CAArB,CAAyBmL,WAAW,CAAC,CAAD,CAAX,CAAenM,KAAxC,CAAgD,CAAvD,CACD,CACF,CAzBM,CA2BP,MAAO,IAAMoM,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACC,OAAD,CAAUC,QAAV,CAAuB,CACrD,GAAMC,CAAAA,QAAQ,CAAGzO,KAAK,CAACwE,QAAN,GAAiBkK,cAAjB,CAAgCF,QAAhC,CAAjB,CACAD,OAAO,CAACI,OAAR,CAAgBC,SAAhB,CAA4BH,QAAQ,CAAGA,QAAH,CAAc,CAAlD,CACD,CAHM,CAKP,MAAO,IAAMI,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACC,YAAD,CAAkB,CACtD,GAAM3L,CAAAA,MAAM,CAAGlD,CAAC,CAAC8O,SAAF,CAAYD,YAAZ,CAAf,CACA7O,CAAC,CAAC+O,MAAF,CAAS7L,MAAM,CAACL,MAAhB,CAAwB,SAACmM,KAAD,CAAW,CACjC,MAAO,CAAC/O,SAAS,CAAC+O,KAAD,CAAjB,CACD,CAFD,EAGA,MAAO9L,CAAAA,MAAP,CACD,CANM,CAQP,MAAO,IAAM+L,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,EAAM,CAChC,GAAMC,CAAAA,KAAK,CAAGnP,KAAK,CAACwE,QAAN,GAAiB2K,KAA/B,CACA,GAAM5K,CAAAA,MAAM,CAAGvE,KAAK,CAACwE,QAAN,GAAiBD,MAAhC,CACA,GAAMyF,CAAAA,QAAQ,CAAGhK,KAAK,CAACwE,QAAN,GAAiBwF,QAAlC,CAEA,GAAMoF,CAAAA,aAAa,CACjBrP,QAAQ,CAACsP,WAAT,CAAqBF,KAAK,CAACG,QAA3B,CAAqC/K,MAArC,CAA6CyF,QAA7C,GACAjK,QAAQ,CAACsP,WAAT,CAAqBF,KAAK,CAACG,QAA3B,CAAqC/K,MAArC,CAA6CyF,QAA7C,EAAuDhF,MAAvD,CAA8D,SAACC,IAAD,CAAU,CACtE,MAAOA,CAAAA,IAAI,CAACsK,MAAL,GAAgB,GAAvB,CACD,CAFD,EAEGrM,MAJL,CAMA,GAAMsM,CAAAA,gBAAgB,CACpBzP,QAAQ,CAACsP,WAAT,CAAqBF,KAAK,CAACM,QAA3B,CAAqClL,MAArC,CAA6CyF,QAA7C,GACAjK,QAAQ,CAACsP,WAAT,CAAqBF,KAAK,CAACM,QAA3B,CAAqClL,MAArC,CAA6CyF,QAA7C,EAAuDhF,MAAvD,CAA8D,SAACC,IAAD,CAAU,CACtE,MAAOA,CAAAA,IAAI,CAACsK,MAAL,GAAgB,GAAvB,CACD,CAFD,EAEGrM,MAJL,CAMA,MAAO,CACLkM,aAAa,CAAbA,aADK,CAELI,gBAAgB,CAAhBA,gBAFK,CAAP,CAID,CArBM,CAuBP,MAAO,IAAME,CAAAA,+BAA+B,CAAG,QAAlCA,CAAAA,+BAAkC,CAACP,KAAD,CAAW,CACxD,GAAMQ,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACR,KAAD,CAAW,CACnC,GAAMS,CAAAA,WAAW,CAAG,EAApB,CACAT,KAAK,CAACtN,OAAN,CAAc,SAAAgO,IAAI,CAAI,IACZC,CAAAA,QADY,CACSD,IADT,CACZC,QADY,CACF/B,MADE,CACS8B,IADT,CACF9B,MADE,CAEpB,GAAI,CAAC6B,WAAW,CAACE,QAAD,CAAhB,CAA4B,CAC1BF,WAAW,CAACE,QAAD,CAAX,CAAwB,CAAE,gBAAiB,CAAnB,CAAsB,gBAAiB,CAAvC,CAA0C,mBAAoB,CAA9D,CAAxB,CACD,CACD,GAAI/B,MAAM,GAAK,YAAf,CAA6B,CAC3B6B,WAAW,CAACE,QAAD,CAAX,CAAsB,eAAtB,GAA0C,CAA1C,CACD,CAFD,IAEO,IAAI/B,MAAM,GAAK,eAAf,CAAgC,CACrC6B,WAAW,CAACE,QAAD,CAAX,CAAsB,kBAAtB,GAA6C,CAA7C,CACD,CAFM,IAEA,IAAI/B,MAAM,GAAK,YAAf,CAA6B,CAClC6B,WAAW,CAACE,QAAD,CAAX,CAAsB,eAAtB,GAA0C,CAA1C,CACD,CACF,CAZD,EAcA,MAAOF,CAAAA,WAAP,CACD,CAjBD,CAmBA,GAAMG,CAAAA,eAAe,CAAGJ,iBAAiB,CAACR,KAAD,CAAzC,CAEA,GAAMa,CAAAA,YAAY,CAAGb,KAAK,CAACc,GAAN,CAAU,SAAAJ,IAAI,CAAI,IAC7BC,CAAAA,QAD6B,CAChBD,IADgB,CAC7BC,QAD6B,UAEuFC,eAAe,CAACD,QAAD,CAAf,EAA6B,CAAE,gBAAiB,CAAnB,CAAsB,mBAAoB,CAA1C,CAA6C,gBAAiB,CAA9D,CAFpH,CAEZI,iBAFY,MAE7B,eAF6B,EAE2BC,oBAF3B,MAEO,kBAFP,EAEkEC,gBAFlE,MAEiD,eAFjD,EAIrC,sCACKP,IADL,MAEE,gBAAiBK,iBAFnB,CAGE,mBAAoBC,oBAHtB,CAIE,gBAAiBC,gBAJnB,GAMD,CAVoB,CAArB,CAWA,MAAOJ,CAAAA,YAAP,CACD,CAlCM,CAoCP,MAAO,IAAM/L,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACH,GAAD,CAAMC,GAAN,CAAc,CAC1C,GAAMtC,CAAAA,CAAC,CAAGqC,GAAG,GAAK,CAAR,CAAYA,GAAG,CAACuM,QAAJ,EAAZ,CAA6BvM,GAAvC,CACA,GAAMpC,CAAAA,CAAC,CAAGqC,GAAG,GAAK,CAAR,CAAYA,GAAG,CAACsM,QAAJ,EAAZ,CAA6BtM,GAAvC,CAEA,GAAItC,CAAC,EAAIC,CAAT,CAAY,CACV,GAAID,CAAC,EAAI,CAACC,CAAV,CAAa,CACX,iBAAWD,CAAX,SACD,CAFD,IAEO,IAAI,CAACA,CAAD,EAAMC,CAAV,CAAa,CAClB,oBAAcA,CAAd,MACD,CAFM,IAEA,CACL,iBAAWD,CAAX,aAAgBC,CAAhB,MACD,CACF,CARD,IAQO,CACL,MAAO,EAAP,CACD,CACF,CAfM,CAiBP,MAAO,IAAM4O,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACC,QAAD,CAAWhP,IAAX,CAAiBgD,MAAjB,CAA4B,CAC7D,GAAMM,CAAAA,gBAAgB,CAAGC,eAAe,CACtCyL,QAAQ,CAAChP,IAAI,CAACiF,cAAN,CAAR,EAAiC,EADK,CAEtCjC,MAAM,CAAChD,IAAI,CAAC6C,WAAN,CAAN,CAAyBK,WAFa,CAGtCF,MAAM,CAAChD,IAAI,CAAC6C,WAAN,CAAN,CAAyBM,aAHa,CAItCH,MAAM,CAAChD,IAAI,CAAC6C,WAAN,CAAN,CAAyBO,eAJa,CAAxC,CAOA,GAAM2H,CAAAA,KAAK,CAAGzH,gBAAgB,CAACoL,GAAjB,CAAqB,SAAChL,IAAD,CAAU,CAC3C,MAAO,CACLyC,GAAG,CAAEnD,MAAM,CAAChD,IAAI,CAAC6C,WAAN,CAAN,CAAyBuD,EADzB,CAELC,MAAM,CAAErD,MAAM,CAAChD,IAAI,CAAC6C,WAAN,CAAN,CAAyBwD,MAF5B,CAGLC,MAAM,CAAEtD,MAAM,CAAChD,IAAI,CAAC6C,WAAN,CAAN,CAAyB0D,KAH5B,CAIL3F,SAAS,CAAEoC,MAAM,CAAChD,IAAI,CAAC6C,WAAN,CAAN,CAAyBD,aAJ/B,CAKLiC,OAAO,CAAE7E,IAAI,CAAC6C,WALT,CAMLrC,UAAU,CAAER,IAAI,CAACiF,cANZ,CAOLgK,YAAY,CAAEvL,IAAI,CAACK,mBAAL,CAA2B,SAPpC,CAAP,CASD,CAVa,CAAd,CAYA,MAAOzF,CAAAA,GAAG,CAACyQ,mBAAJ,CAAwBhE,KAAxB,EAA+BnD,IAA/B,CAAoC,SAACvH,GAAD,CAAS,CAClD,GAAIgK,CAAAA,OAAO,CAAG,EAAd,CACAhK,GAAG,CAACL,IAAJ,CAASM,OAAT,CAAiB,SAACoD,IAAD,CAAOwL,KAAP,CAAiB,CAChC,CAACxL,IAAD,EAAS2G,OAAO,CAAC5J,IAAR,CAAa6C,gBAAgB,CAAC4L,KAAD,CAAhB,CAAwBnL,mBAArC,CAAT,CACD,CAFD,EAIA,MAAOsG,CAAAA,OAAP,CACD,CAPM,CAAP,CAQD,CA5BM,CA8BP,MAAO,IAAM8E,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,CAACnP,IAAD,CAAU,yFAC9C,GAAMoP,CAAAA,SAAS,CAAG,MAAlB,CAEA,GAAMC,CAAAA,QAAQ,kBACZ5Q,KAAK,CAACwE,QAAN,EADY,iEACZ,gBAAkBF,YADN,wEACZ,sBAAiC/C,IAAI,CAAC4C,aAAtC,CADY,yEACZ,uBAAuD5C,IAAI,CAAC6C,WAA5D,CADY,iDACZ,uBACAuM,SADA,CADF,CAKA,MAAOC,CAAAA,QAAQ,CAAGD,SAAH,CAAe,KAA9B,CACD,CATM,CAYP,MAAO,IAAME,CAAAA,sBAAsB,CAAG,QAAzBA,CAAAA,sBAAyB,EAAM,CAC1C,MAAO,CACL,OAAQ,CACN9O,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CADH,CAML,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CANH,CAWL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CAXH,CAgBL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CAhBH,CAqBL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CArBH,CA0BL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CA1BH,CA+BL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CA/BH,CAoCL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CApCH,CAyCL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CAzCH,CA8CL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CA9CH,CAmDL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CAnDH,CAwDL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,IAFT,CAGNC,uBAAuB,CAAE,KAHnB,CAxDH,CA6DL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CA7DH,CAkEL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CAlEH,CAuEL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CAvEH,CA4EL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CA5EH,CAiFL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CAjFH,CAsFL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CAtFH,CA2FL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CA3FH,CAgGL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CAhGH,CAqGL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CArGH,CA0GL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CA1GH,CA+GL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CA/GH,CAoHL,OAAQ,CACNhP,UAAU,CAAE,MADN,CAEN+O,aAAa,CAAE,KAFT,CAGNC,uBAAuB,CAAE,IAHnB,CApHH,CAAP,CA0HD,CA3HM,CA6HP,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,QAAD,CAAWC,QAAX,CAAwB,CACzC,GAAI7F,KAAK,CAACC,OAAN,CAAc2F,QAAd,GAA2B5F,KAAK,CAACC,OAAN,CAAc4F,QAAd,CAA/B,CAAwD,CACtD,MAAOD,CAAAA,QAAQ,CAACE,MAAT,CAAgBD,QAAhB,CAAP,CACD,CACF,CAJD,CAMA,MAAO,IAAME,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACC,IAAD,CAAOrI,QAAP,CAAoB,CAClDA,QAAQ,CAACpJ,MAAM,CAAC0R,WAAP,EAAD,CAAR,CACAzR,GAAG,CAAC0R,yBAAJ,CAA8BF,IAA9B,EAAoClI,IAApC,CAAyC,SAACqI,QAAD,CAAc,gBAChCnR,SAAS,CAACmR,QAAQ,CAACjQ,IAAV,CAAgBpB,MAAM,CAACsR,UAAvB,CADuB,CAC7CC,QAD6C,YAC7CA,QAD6C,CAErD5R,EAAE,CAACmJ,KAAH,CAASC,GAAT,CAAa,YAAb,EAA2BC,IAA3B,CAAgC,SAACF,KAAD,CAAW,CACzC,GAAM9F,CAAAA,MAAM,CAAGlD,CAAC,CAAC0R,SAAF,CAAY1I,KAAK,CAAC1H,IAAlB,CAAwBmQ,QAAxB,CAAkCV,UAAlC,CAAf,CACA,GAAIhH,CAAAA,QAAQ,CAAG7G,MAAM,CAAC6G,QAAP,CACXxH,MAAM,CAACC,IAAP,CAAYU,MAAM,CAAC6G,QAAnB,CADW,CAEX,EAFJ,CAGAlK,EAAE,CAACmJ,KAAH,CAASW,GAAT,CAAa,CAAEC,EAAE,CAAE,YAAN,CAAoBtI,IAAI,CAAE4B,MAA1B,CAAb,EAAiDgG,IAAjD,CAAsD,UAAM,CAC1D,GAAMmD,CAAAA,KAAK,CAAG,CAAEnC,UAAU,CAAEH,QAAd,CAAd,CACA5J,IAAI,CACDwR,sCADH,CAC0CtF,KAD1C,EAGA,GAAM3B,CAAAA,OAAO,CAAEC,qBAAqB,CAAC0B,KAAK,CAACnC,UAAP,CAAmBhH,MAAnB,SAAmBA,MAAnB,iBAAmBA,MAAM,CAAEoB,MAA3B,CAApC,CACAyE,QAAQ,CAACpJ,MAAM,CAACmL,cAAP,CAAsBJ,OAAtB,CAA+B,EAA/B,CAAmC3B,QAAnC,CAAD,CAAR,CACD,CAPD,EAQD,CAbD,EAgBD,CAlBD,EAkBG6I,KAlBH,CAkBS,SAACC,KAAD,CAAW,CAClB9I,QAAQ,CAACpJ,MAAM,CAACmS,QAAP,CAAgBD,KAAK,CAAClG,OAAtB,CAAD,CAAR,CACD,CApBD,EAoBGoG,OApBH,CAoBW,UAAM,CACfhJ,QAAQ,CAACpJ,MAAM,CAACqS,WAAP,EAAD,CAAR,CACD,CAtBD,EAuBD,CAzBM,CA2BP,MAAO,IAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,EAAiB,6FAAhBC,CAAAA,MAAgB,2DAAP,EAAO,CAC1C,GAAI,CAACC,gBAAgB,EAArB,CAAyB,CACvB,MAAO,MAAP,CACD,CAHyC,qBAK8CpS,KAAK,CAACwE,QAAN,EAL9C,CAKlCuB,eALkC,kBAKlCA,eALkC,CAKjBzB,YALiB,kBAKjBA,YALiB,CAKHD,SALG,kBAKHA,SALG,CAKQE,MALR,kBAKQA,MALR,CAKgB6F,IALhB,kBAKgBA,IALhB,CAKsBiI,mBALtB,kBAKsBA,mBALtB,IAMlCtQ,CAAAA,UANkC,CAMuCoQ,MANvC,CAMlCpQ,UANkC,CAMtBqE,OANsB,CAMuC+L,MANvC,CAMtB/L,OANsB,CAMb1B,aANa,CAMuCyN,MANvC,CAMbzN,aANa,CAMED,WANF,CAMuC0N,MANvC,CAME1N,WANF,CAMeN,aANf,CAMuCgO,MANvC,CAMehO,aANf,CAM8BmO,IAN9B,CAMuCH,MANvC,CAM8BG,IAN9B,CAO1C,GAAM3N,CAAAA,eAAe,mBAAGJ,MAAM,CAAC6B,OAAD,CAAT,2CAAG,iBAAiBzB,eAAzC,CACA,GAAMqI,CAAAA,aAAa,CAAG3I,SAAS,CAACtC,UAAD,CAAT,EAAyB,EAA/C,CACA,GAAMoD,CAAAA,SAAS,CAAG,EAAlB,CACA,GAAMoN,CAAAA,aAAa,yBAAGjO,YAAY,CAACH,aAAD,CAAf,yEAAG,uBAA8BiC,OAA9B,CAAH,iDAAG,uBAAyCrE,UAAzC,CAAtB,CACA,GAAM+O,CAAAA,aAAa,wBAAGuB,mBAAmB,CAACtQ,UAAD,CAAtB,gDAAG,sBAAiC+O,aAAvD,CACA,GAAM0B,CAAAA,sBAAsB,CAAGF,IAAI,GAAK,UAAxC,CAGA,GAAM/Q,CAAAA,IAAI,CAAGuD,eAAe,CAACkI,aAAD,CAAgBvI,WAAhB,CAA6BC,aAA7B,CAA4CC,eAA5C,CAA5B,CACA,GAAM8N,CAAAA,WAAW,CAAGlR,IAAI,CAAC0O,GAAL,CAAS,SAAChL,IAAD,CAAU,CACrC,MAAOA,CAAAA,IAAI,CAACK,mBAAZ,CACD,CAFmB,CAApB,CAKAmN,WAAW,CAAC5Q,OAAZ,CAAoB,SAACoD,IAAD,CAAU,CAC5B,MACGsN,CAAAA,aAAa,EACZA,aAAa,CAACvN,MAAd,CACE,SAAC0N,GAAD,QAASA,CAAAA,GAAG,CAACnN,IAAJ,CAASgB,OAAT,CAAiBtB,IAAjB,EAAyB,CAAC,CAA1B,EAA+BE,SAAS,CAACnD,IAAV,CAAe0Q,GAAf,CAAxC,EADF,CADF,EAIA,EALF,CAOD,CARD,EAUA,GAAMC,CAAAA,kBAAkB,CAAGrS,sBAAsB,CAC/CyF,eAD+C,CAE/CK,OAF+C,CAG/CgE,IAAI,CAACyD,YAH0C,CAI/CzD,IAAI,CAACI,KAAL,CAAW,CAAX,CAJ+C,CAAjD,CAOA,GAAMoI,CAAAA,YAAY,CAAGD,kBAAkB,CAACnN,QAAnB,CAA4BzD,UAA5B,CAArB,CAEA,GAAIuQ,IAAI,GAAK,uBAAb,CAAsC,mDACpC,GAAM/B,CAAAA,QAAQ,CAAG,CACfrL,OAAO,CAAE,GADM,CAEfI,mBAAmB,uCAFJ,CAAjB,CAKA/D,IAAI,CAACS,IAAL,CAAUuO,QAAV,EAEApL,SAAS,CAACnD,IAAV,CAAesC,YAAf,SAAeA,YAAf,yCAAeA,YAAY,CAAGH,aAAH,CAA3B,yEAAe,uBAAgCiC,OAAhC,CAAf,iDAAe,uBAA2CrE,UAA3C,EAAuD,CAAvD,CAAf,EACD,CAED,GAAIyQ,sBAAsB,EAAII,YAA9B,CAA4C,CAC1C,MAAO,MAAP,CACD,CAED,GAAIzN,SAAS,CAACjC,MAAV,CAAmB,CAAvB,CAA0B,CACxB,GAAI,CAAC4N,aAAL,CAAoB,CAClB,MAAO,KAAP,CACD,CAFD,IAEO,CACL,GAAIJ,sBAAsB,CAAC,CAAEvM,aAAa,CAAEA,aAAjB,CAAgCC,WAAW,CAAEgC,OAA7C,CAAD,CAA1B,CAAoF,CAClF,MAAO,KAAP,CACD,CAFD,IAEO,CACL,MAAO,MAAP,CACD,CACF,CACF,CAVD,IAUO,CACL,MAAO,MAAP,CACD,CACF,CApEM,CAsEP,MAAO,IAAMgM,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,EAAM,sBAClBpS,KAAK,CAACwE,QAAN,EADkB,CAC3B4F,IAD2B,kBAC3BA,IAD2B,CAGpC,MAAOA,CAAAA,IAAP,SAAOA,IAAP,iBAAOA,IAAI,CAAEyI,oBAAb,CACD,CAJM,CAMP,GAAMxR,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,EAAM,CACpB,GAAMyR,CAAAA,GAAG,CAAG,GAAI7R,CAAAA,IAAJ,EAAZ,CACA,GAAM8R,CAAAA,IAAI,CAAGD,GAAG,CAACE,WAAJ,EAAb,CACA,GAAMC,CAAAA,KAAK,CAAGC,MAAM,CAACJ,GAAG,CAACnK,QAAJ,GAAiB,CAAlB,CAAN,CAA2BwK,QAA3B,CAAoC,CAApC,CAAuC,GAAvC,CAAd,CACA,GAAMC,CAAAA,GAAG,CAAGF,MAAM,CAACJ,GAAG,CAAClK,OAAJ,EAAD,CAAN,CAAsBuK,QAAtB,CAA+B,CAA/B,CAAkC,GAAlC,CAAZ,CACA,GAAME,CAAAA,KAAK,CAAGH,MAAM,CAACJ,GAAG,CAACjK,QAAJ,EAAD,CAAN,CAAuBsK,QAAvB,CAAgC,CAAhC,CAAmC,GAAnC,CAAd,CACA,GAAMG,CAAAA,OAAO,CAAGJ,MAAM,CAACJ,GAAG,CAAChK,UAAJ,EAAD,CAAN,CAAyBqK,QAAzB,CAAkC,CAAlC,CAAqC,GAArC,CAAhB,CACA,GAAMI,CAAAA,OAAO,CAAGL,MAAM,CAACJ,GAAG,CAACU,UAAJ,EAAD,CAAN,CAAyBL,QAAzB,CAAkC,CAAlC,CAAqC,GAArC,CAAhB,CAEA,gBAAUJ,IAAV,aAAkBE,KAAlB,aAA2BG,GAA3B,aAAkCC,KAAlC,aAA2CC,OAA3C,aAAsDC,OAAtD,EACD,CAVD,CAYA,GAAME,CAAAA,kBAAkB,CAAI,QAAtBA,CAAAA,kBAAsB,EAAM,CAChC,MAAO,IAAIhT,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAa,CAC9B,GAAIgT,SAAS,CAACC,WAAd,CAA2B,CACzBD,SAAS,CAACC,WAAV,CAAsBF,kBAAtB,CACE,SAAChF,QAAD,CAAc,CACZ,GAAMmF,CAAAA,QAAQ,CAAGnF,QAAQ,CAACoF,MAAT,CAAgBD,QAAjC,CACA,GAAME,CAAAA,SAAS,CAAGrF,QAAQ,CAACoF,MAAT,CAAgBC,SAAlC,CACApT,OAAO,CAAC,CAAEqN,MAAM,CAAE,SAAV,CAAqBxM,IAAI,CAAE,CAAEqS,QAAQ,CAARA,QAAF,CAAYE,SAAS,CAATA,SAAZ,CAA3B,CAAD,CAAP,CACD,CALH,CAME,SAAChC,KAAD,CAAW,CACTpR,OAAO,CAAC,CAAEqN,MAAM,CAAE,OAAV,CAAmBnC,OAAO,CAAEkG,KAAK,CAAClG,OAAlC,CAAD,CAAP,CACD,CARH,EAUD,CAXD,IAWO,CACLlL,OAAO,CAAC,CAAEqN,MAAM,CAAE,OAAV,CAAmBnC,OAAO,CAAE,+CAA5B,CAAD,CAAP,CACD,CACF,CAfM,CAAP,CAiBD,CAlBD,CAoBA;AACA,GAAMmI,CAAAA,0BAA0B,CAAG,QAA7BA,CAAAA,0BAA6B,CAACH,QAAD,CAAWE,SAAX,CAAyB,CAC1D,MAAO,IAAIrT,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAUsT,MAAV,CAAqB,CACtC,GAAI3J,MAAM,CAAC4J,IAAX,CAAiB,CACf,GAAMC,CAAAA,QAAQ,CAAG,GAAI7J,CAAAA,MAAM,CAAC4J,IAAP,CAAYE,QAAhB,EAAjB,CAA6C;AAC7C,GAAMC,CAAAA,KAAK,CAAG,GAAI/J,CAAAA,MAAM,CAAC4J,IAAP,CAAYI,KAAhB,CAAsBP,SAAtB,CAAiCF,QAAjC,CAAd,CAA0D;AAE1DM,QAAQ,CAACI,WAAT,CAAqBF,KAArB,CAA4B,SAACjR,MAAD,CAAY,CACtC,GAAIA,MAAJ,CAAY,CACVzC,OAAO,CAACyC,MAAM,CAACoR,OAAR,CAAP,CACD,CAFD,IAEO,CACL7T,OAAO,CAAC,UAAD,CAAP,CACD,CACF,CAND,EAOD,CAXD,IAWO,CACLsT,MAAM,CAAC,cAAD,CAAN,CACD,CACF,CAfM,CAAP,CAgBD,CAjBD,CAmBA,MAAO,IAAMQ,CAAAA,aAAa,2FAAG,iBAAOC,MAAP,CAAcC,aAAd,wOACvBnT,IADuB,CAChBvB,KAAK,CAACwE,QAAN,EADgB,CAE3B;AAF2B,sBAGJiP,CAAAA,kBAAkB,EAHd,QAGrBkB,QAHqB,qCAIPZ,CAAAA,0BAA0B,CAACY,QAAD,SAACA,QAAD,iCAACA,QAAQ,CAAEpT,IAAX,yCAAC,eAAgBqS,QAAjB,CAA2Be,QAA3B,SAA2BA,QAA3B,kCAA2BA,QAAQ,CAAEpT,IAArC,0CAA2B,gBAAgBuS,SAA3C,CAJnB,QAIvBS,OAJuB,eAKvBK,WALuB,wBAKTrT,IAAI,CAACyI,QAAL,CAAc0K,aAAa,CAACvQ,aAA5B,CALS,gDAKT,sBAA4CsO,WALnC,CAMvBoC,IANuB,CAMhBxT,OAAO,EANS,CAQvByT,aARuB,CAQP,yCAASP,OAAT,0CAA4BM,IAA5B,0CAA4CH,aAAa,CAACtO,OAA1D,0CAA6EwO,WAA7E,EARO,CAUrBG,GAVqB,CAUf,GAAIC,CAAAA,KAAJ,EAVe,CAW3BD,GAAG,CAACE,GAAJ,CAAUR,MAAV,CACAM,GAAG,CAACG,YAAJ,CAAiB,aAAjB,CAAgC,WAAhC,EAZ2B,gCAcpB,GAAIzU,CAAAA,OAAJ,CAAY,SAACC,OAAD,CAAa,CAE9BqU,GAAG,CAACI,MAAJ,CAAa,UAAM,CAEjB,GAAMC,CAAAA,MAAM,CAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAf,CACA,GAAMC,CAAAA,GAAG,CAAGH,MAAM,CAACI,UAAP,CAAkB,IAAlB,CAAZ,CAEAJ,MAAM,CAACK,KAAP,CAAeV,GAAG,CAACU,KAAnB,CACAL,MAAM,CAACM,MAAP,CAAgBX,GAAG,CAACW,MAApB,CAEAH,GAAG,CAACI,QAAJ,CAAa,CAAb,CAAgB,CAAhB,CAAmBP,MAAM,CAACK,KAA1B,CAAiCL,MAAM,CAACM,MAAxC,EACAH,GAAG,CAACK,SAAJ,CAAcb,GAAd,CAAmB,CAAnB,CAAsB,CAAtB,CAAyBK,MAAM,CAACK,KAAhC,CAAuCL,MAAM,CAACM,MAA9C,EAEAH,GAAG,CAACM,IAAJ,CAAW,YAAX,CACAN,GAAG,CAACO,SAAJ,CAAgB,MAAhB,CACAP,GAAG,CAACQ,SAAJ,CAAgB,SAAhB,CAEA,GAAIC,CAAAA,UAAU,CAAG,CAAjB,CAEAlB,aAAa,CAACjT,OAAd,CAAsB,SAAAoD,IAAI,CAAI,CAC5B+Q,UAAU,EAAI,EAAd,CACAT,GAAG,CAACU,QAAJ,CAAahR,IAAb,CAAmB,EAAnB,CAAuBmQ,MAAM,CAACM,MAAP,CAAgBM,UAAhB,CAA6B,EAApD,EACD,CAHD,EAKAtV,OAAO,CAAC0U,MAAM,CAACc,SAAP,CAAiB,WAAjB,CAAD,CAAP,CACD,CAvBD,CAwBD,CA1BM,CAdoB,yDAAH,kBAAb1B,CAAAA,aAAa,iDAAnB,CA2CP,MAAO,IAAM2B,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,UAAD,CAAgB,CAC7CC,OAAO,CAACC,GAAR,CAAYF,UAAZ,EACA,GAAMvV,CAAAA,IAAI,CAAG,GAAII,CAAAA,IAAJ,CAASmV,UAAT,CAAb,CAAoC;AAEpC,GAAMrD,CAAAA,IAAI,CAAGlS,IAAI,CAACmS,WAAL,EAAb,CAAkC;AAClC,GAAMC,CAAAA,KAAK,CAAGC,MAAM,CAACrS,IAAI,CAAC8H,QAAL,GAAkB,CAAnB,CAAN,CAA4BwK,QAA5B,CAAqC,CAArC,CAAwC,GAAxC,CAAd,CAA6D;AAC7D,GAAMC,CAAAA,GAAG,CAAGF,MAAM,CAACrS,IAAI,CAAC+H,OAAL,EAAD,CAAN,CAAuBuK,QAAvB,CAAgC,CAAhC,CAAmC,GAAnC,CAAZ,CAAsD;AAEtD,MAAOiD,CAAAA,UAAU,WAAKrD,IAAL,aAAaE,KAAb,aAAsBG,GAAtB,EAA6B,IAA9C,CAAqD;AACtD,CATM,CAWP,MAAO,IAAMmD,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACtR,IAAD,CAAU,CAC1C,GAAI8I,CAAAA,MAAJ,CACA,OAAQ9I,IAAI,CAAC8I,MAAb,EACE,IAAK,EAAL,CACEA,MAAM,CAAG,YAAT,CACA,MACF,IAAK,EAAL,CACEA,MAAM,CAAG,eAAT,CACA,MACF,IAAK,EAAL,CACEA,MAAM,CAAG,YAAT,CACA,MACF,IAAK,EAAL,CACEA,MAAM,CAAG,QAAT,CACA,MACF,IAAK,EAAL,CACEA,MAAM,CAAG,QAAT,CACA,MACF,QACEA,MAAM,CAAG,QAAT,CACA,MAlBJ,CAmBC,CAED,MAAO,CACLyI,MAAM,CAAEvR,IAAI,CAAC4E,EADR,CAELiG,QAAQ,CAAE7K,IAAI,CAAC5B,IAFV,CAGLlB,SAAS,CAAE8C,IAAI,CAAC9C,SAHX,CAILiE,OAAO,CAAEnB,IAAI,CAACwR,YAJT,CAKL1U,UAAU,CAAEkD,IAAI,CAAClD,UALZ,CAML6S,WAAW,CAAE3P,IAAI,CAAC2P,WANb,CAOL8B,aAAa,CAAEP,eAAe,CAAClR,IAAI,CAACyR,aAAN,CAPzB,CAQLC,WAAW,CAAER,eAAe,CAAClR,IAAI,CAAC0R,WAAN,CARvB,CASLC,eAAe,CAAET,eAAe,CAAClR,IAAI,CAAC2R,eAAN,CAT3B,CAULC,aAAa,CAAEV,eAAe,CAAClR,IAAI,CAAC4R,aAAN,CAVzB,CAWLC,eAAe,CAAEX,eAAe,CAAClR,IAAI,CAAC8R,gBAAN,CAX3B,CAYLC,UAAU,CAAE/R,IAAI,CAAC+R,UAZZ,CAaLjJ,MAAM,CAAEA,MAbH,CAAP,CAgBD,CAvCM","sourcesContent":["import * as action from \"actions\";\r\nimport * as api from \"api\";\r\nimport { db } from \"js/db\";\r\nimport * as publicFn from \"js/publicFn/index\";\r\nimport store from \"js/store\";\r\nimport _ from \"lodash\";\r\nimport { isVisible } from \"./templateFormUtil/index\";\r\nimport * as schema from \"js/schema\";\r\nimport * as repo from \"js/fetch\";\r\nimport { normalize } from \"normalizr\";\r\nimport { documentAuthorizationC } from \"js/publicFn\";\r\n\r\nexport const sleep = (ms) => {\r\n  return new Promise((resolve) => {\r\n    setTimeout(resolve, ms);\r\n  });\r\n};\r\n\r\nexport const timeHorizonFilter = (date, today, timeHorizon) => {\r\n  const leadingDate = new Date(date);\r\n  switch (timeHorizon) {\r\n    case \"thisWeek\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 7 * 86400000;\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"twoWeeks\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 14 * 86400000;\r\n\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"fourWeeks\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 28 * 86400000;\r\n\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"eightWeeks\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 56 * 86400000;\r\n\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"all\":\r\n    default: {\r\n      return true;\r\n    }\r\n  }\r\n};\r\n\r\nexport const orderActivitiesSort = (data) => {\r\n  return data.sort(function (a, b) {\r\n    if (a.sort < b.sort) {\r\n      return -1;\r\n    } else {\r\n      return 1;\r\n    }\r\n  });\r\n};\r\n\r\nexport const templatesConverter = (data) => {\r\n  let res = {};\r\n\r\n  data.forEach((elem) => {\r\n    if (!res[elem.activityNo]) {\r\n      res[elem.activityNo] = [];\r\n    }\r\n\r\n    res[elem.activityNo].push(elem);\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const groupInfoProc = (data) => {\r\n  const res = {};\r\n\r\n  data.forEach((value) => {\r\n    res[value.projectNo] = JSON.parse(value.projectGroupInfo);\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const groupInfoDeproc = (data) => {\r\n  const res = [];\r\n\r\n  Object.keys(data).forEach((key) => {\r\n    const elem = {};\r\n\r\n    elem.projectNo = key;\r\n    elem.projectGroupInfo = JSON.stringify(data[key]);\r\n\r\n    res.push(elem);\r\n  });\r\n  return res;\r\n};\r\n\r\nexport const fittersAssignmentTransferProc = (data) => {\r\n  const res = {};\r\n\r\n  data.forEach((value) => {\r\n    if (!res[value.projectNo]) {\r\n      res[value.projectNo] = [];\r\n    }\r\n    res[value.projectNo].push(value);\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const verify = (fields) => {\r\n  const verifyType = [\r\n    \"singleLine\",\r\n    \"paragraph\",\r\n    \"number\",\r\n    \"multipleChoice\",\r\n    \"dropdown\",\r\n    \"dropdown\",\r\n    \"signature\",\r\n    \"photo\",\r\n    \"naYesNo\",\r\n  ];\r\n\r\n  const defaultPhotoValue =\r\n    \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\r\n\r\n  for (let i = 0; i < fields.length; i++) {\r\n    const result = isVisible(fields[i]);\r\n    if (result) {\r\n      for (let k = 0; k < verifyType.length; k++) {\r\n        if (fields[i].type === verifyType[k] && fields[i].settings.required) {\r\n          let alertInfo;\r\n          if (fields[i].settings.labelI18n.Chinese) {\r\n            alertInfo = fields[i].settings.labelI18n.Chinese;\r\n          } else if (fields[i].settings.labelI18n.English) {\r\n            alertInfo = fields[i].settings.labelI18n.English;\r\n          } else if (fields[i].settings.descriptionI18n.Chinese) {\r\n            alertInfo = fields[i].settings.descriptionI18n.Chinese;\r\n          } else {\r\n            alertInfo = fields[i].settings.descriptionI18n.English;\r\n          }\r\n\r\n          if (\r\n            fields[i].settings.value === defaultPhotoValue ||\r\n            fields[i].settings.value === \"\" ||\r\n            fields[i].settings.value === \"-\"\r\n          ) {\r\n            alert(alertInfo);\r\n\r\n            return false;\r\n          } else if (fields[i].settings.value === \"#\") {\r\n            alert(alertInfo);\r\n            return false;\r\n          } else if (fields[i].type === \"number\") {\r\n            if (fields[i].settings.min || fields[i].settings.max) {\r\n              if (fields[i].settings.value < fields[i].settings.min || fields[i].settings.value > fields[i].settings.max) {\r\n                const maxMin = showNumberText(fields[i].settings.min, fields[i].settings.max);\r\n                alert(`${alertInfo}: ${maxMin}`)\r\n                return false;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\nexport const toDoOrDone = (\r\n  projectNumber,\r\n  orderNumber,\r\n  activityNo,\r\n  templates,\r\n  documentList\r\n) => {\r\n  const orders = store.getState().orders;\r\n  const productLine = orders[orderNumber]?.productLine;\r\n  const productFamily = orders[orderNumber]?.productFamily;\r\n  const productCategory = orders[orderNumber]?.productCategory;\r\n  const templateParms = templates[activityNo] ? templates[activityNo] : [];\r\n  const templateDataList = getTemplateList(\r\n    templateParms,\r\n    productLine,\r\n    productFamily,\r\n    productCategory\r\n  );\r\n\r\n  if (templateDataList.length > 0) {\r\n    const requiredData = templateDataList.filter(\r\n      (item) => item.mandDoc === \"X\"\r\n    );\r\n    if (requiredData.length > 0) {\r\n      const documents =\r\n        documentList?.[projectNumber]?.[orderNumber]?.[activityNo];\r\n\r\n      let count = 0;\r\n      if (documents) {\r\n        for (let i = 0; i < requiredData.length; i++) {\r\n          const discription = `${requiredData[i].documentDescription}`;\r\n          for (let k = 0; k < documents.length; k++) {\r\n            documents[k]?.name.includes(discription) && count++;\r\n          }\r\n        }\r\n\r\n        if (requiredData.length <= count) {\r\n          return \"Done\";\r\n        } else {\r\n          return \"ToDo\";\r\n        }\r\n      } else {\r\n        return \"ToDo\";\r\n      }\r\n    } else {\r\n      return \"Done\"; //如果没有必填\r\n    }\r\n  } else {\r\n    return \"WithoutTemplates\";\r\n  }\r\n};\r\n\r\nexport const timeSort = (property, bol) => {\r\n  return function (a, b) {\r\n    var value1 = a[property];\r\n    var value2 = b[property];\r\n\r\n    if (bol) {\r\n      // 升序\r\n      return Date.parse(value1) - Date.parse(value2);\r\n    } else {\r\n      // 降序\r\n      return Date.parse(value2) - Date.parse(value1);\r\n    }\r\n  };\r\n};\r\n\r\nexport const whetherToShutDown = (orderActivities, orderNumber) => {\r\n  if (\r\n    orderActivities[orderNumber + \"-7720\"] &&\r\n    !orderActivities[orderNumber + \"-7720\"].confirmedDate\r\n  ) {\r\n    return \"停工中\";\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport const getCurrentElevatorStatus = (orderActivities, orderNumber) => {\r\n  if (\r\n    orderActivities[orderNumber + \"-7720\"] &&\r\n    !orderActivities[orderNumber + \"-7720\"].confirmedDate\r\n  ) {\r\n    return \"停工中\";\r\n  } else if (orderActivities[orderNumber + \"-7350\"]?.confirmedDate) {\r\n    return \"安装中\";\r\n  } else {\r\n    return \"未到货\";\r\n  }\r\n};\r\n\r\nexport const orderProgress = (orderActivities, orderNumber) => {\r\n  //电梯整体安装进度\r\n\r\n  if (orderActivities[orderNumber + \"-7800\"]?.confirmedDate) {\r\n    return 100;\r\n  }\r\n  if (orderActivities[orderNumber + \"-70D0\"]?.confirmedDate) {\r\n    return 60;\r\n  }\r\n  if (\r\n    orderActivities[orderNumber + \"-7020\"]?.confirmedDate &&\r\n    !orderActivities[orderNumber + \"-70D0\"]\r\n  ) {\r\n    return 60;\r\n  }\r\n  if (orderActivities[orderNumber + \"-8010\"]?.confirmedDate) {\r\n    return 30;\r\n  } else {\r\n    return 0;\r\n  }\r\n};\r\n\r\n//电梯安装进度\r\nexport const elevatorInstallationProgress = (\r\n  projectNumber,\r\n  orderActivities,\r\n  orderNo,\r\n  documentList\r\n) => {\r\n  if (!orderActivities[orderNo + \"-7040\"]) {\r\n    // 三步\r\n    const threeStep = [\"7010\", \"7020\", \"7600\"];\r\n    const orderActivitie = Object.keys(orderActivities).filter((item) => {\r\n      return (\r\n        orderActivities[item].orderNumber === orderNo &&\r\n        threeStep.indexOf(orderActivities[item].activityNumber) > -1\r\n      );\r\n    });\r\n\r\n    const progress = orderActivitie.filter((item) => {\r\n      return orderActivities[item].confirmedDate !== null;\r\n    });\r\n\r\n    return Math.round((progress.length * 100) / 3) + \"%\";\r\n  } else {\r\n    // 十四步\r\n    let elevatorInstallationProgress = 0;\r\n    const steps14 = [\r\n      \"7010\",\r\n      \"7020\",\r\n      \"7030\",\r\n      \"7040\",\r\n      \"7050\",\r\n      \"7060\",\r\n      \"7070\",\r\n      \"7080\",\r\n      \"7090\",\r\n      \"70A0\",\r\n      \"70B0\",\r\n      \"70C0\",\r\n      \"70D0\",\r\n      \"7600\",\r\n    ];\r\n\r\n    steps14.forEach((step) => {\r\n      if (\r\n        orderActivities[orderNo + \"-\" + step].editable &&\r\n        orderActivities[orderNo + \"-\" + step].confirmedDate\r\n      ) {\r\n        elevatorInstallationProgress += 1;\r\n      } else if (!orderActivities[orderNo + \"-\" + step].editable) {\r\n        const documentActivity = documentList[projectNumber]?.[orderNo]?.[step];\r\n        const activityModified = documentActivity\r\n          ? documentActivity.sort(timeSort(\"modified\", false))\r\n          : null;\r\n        const confirmedTime = activityModified\r\n          ? activityModified?.[0].modified\r\n          : null;\r\n        confirmedTime && (elevatorInstallationProgress += 1);\r\n      }\r\n    });\r\n\r\n    const result = (elevatorInstallationProgress / 14) * 100;\r\n    return Math.round(result) + \"%\";\r\n  }\r\n};\r\n\r\nexport const projectProgress = (projectNumber, orders, orderActivities) => {\r\n  const projectOrders = [];\r\n  Object.keys(orders).forEach((item) => {\r\n    orders[item].projectNumber === projectNumber && projectOrders.push(item);\r\n  });\r\n  const progressArray = [];\r\n  projectOrders.forEach((item) => {\r\n    let progress = orderProgress(orderActivities, item);\r\n\r\n    progressArray.push(progress);\r\n  });\r\n\r\n  let sum = 0;\r\n\r\n  progressArray.forEach((item) => {\r\n    sum += item === \"停工中\" ? 0 : item;\r\n  });\r\n  const projectProgress = Math.ceil(sum / projectOrders.length);\r\n  return projectProgress;\r\n};\r\n\r\n/**\r\n    {\r\n      \"projectNo\": \"string\",\r\n      \"orderNo\": \"string\",\r\n      \"activityNo\": \"string\",\r\n      \"type\": 0,\r\n      \"date\": \"string\",\r\n      \"combinePdf\": true\r\n    }\r\n */\r\nexport const setActivityStatusParams = (\r\n  projectNo,\r\n  orderNo,\r\n  activityNo,\r\n  date,\r\n  type,\r\n  orderActivities,\r\n  orders\r\n) => {\r\n  const result = {};\r\n  result.projectNo = projectNo;\r\n  result.orderNo = orderNo;\r\n  result.activityNo = activityNo;\r\n  result.date = date;\r\n  result.type = type;\r\n  result.combinePdf = false;\r\n  result.foe = orders?.[orderNo]?.fo;\r\n  result.region = orders?.[orderNo]?.region;\r\n  result.branch = orders?.[orderNo]?.prctr;\r\n\r\n  if (orderActivities[orderNo + \"-7030\"]) {\r\n    // 14 steps (or 9 steps)\r\n    if (activityNo === \"70C0\") {\r\n      result.combinePdf = true;\r\n    }\r\n\r\n    if (orderActivities[orderNo + \"-\" + activityNo].originalStep) {\r\n      result.activityNo =\r\n        orderActivities[orderNo + \"-\" + activityNo].originalStep;\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nexport const isInstallationStepEditable = (\r\n  orderNo,\r\n  activityNo,\r\n  orderActivities\r\n) => {\r\n  if (\r\n    orderActivities[orderNo + \"-\" + activityNo].editable === undefined ||\r\n    orderActivities[orderNo + \"-\" + activityNo].editable\r\n  ) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport const calculationOfInstallationSteps = (orderActivities, orders) => {\r\n  let handedOverToMaintenance = 0; //移交维保\r\n  let debugQuantity = 0; // 调试\r\n  let guideDoorInstallation = 0; //导轨门安装\r\n  let startTheInstallation = 0; //开始安装\r\n  let installationNotStarted = 0; //未开始安装\r\n  const orderNos = Object.keys(orders);\r\n  for (let i = 0; i < orderNos.length; i++) {\r\n    if (\r\n      orderActivities[orderNos[i] + \"-7800\"] &&\r\n      orderActivities[orderNos[i] + \"-7800\"]?.confirmedDate\r\n    ) {\r\n      handedOverToMaintenance++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-70C0\"] &&\r\n      orderActivities[orderNos[i] + \"-70C0\"]?.confirmedDate\r\n    ) {\r\n      debugQuantity++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-7020\"] &&\r\n      orderActivities[orderNos[i] + \"-7020\"]?.confirmedDate\r\n    ) {\r\n      debugQuantity++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-8010\"] &&\r\n      orderActivities[orderNos[i] + \"-8010\"]?.confirmedDate\r\n    ) {\r\n      guideDoorInstallation++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-7700\"] &&\r\n      orderActivities[orderNos[i] + \"-7700\"]?.confirmedDate\r\n    ) {\r\n      startTheInstallation++;\r\n    } else {\r\n      installationNotStarted++;\r\n    }\r\n  }\r\n\r\n  let theOverallProgress = 0;\r\n  const data = [\r\n    handedOverToMaintenance,\r\n    debugQuantity,\r\n    guideDoorInstallation,\r\n    startTheInstallation,\r\n    installationNotStarted,\r\n  ];\r\n  data.forEach((item) => {\r\n    theOverallProgress += item;\r\n  });\r\n\r\n  return {\r\n    handedOverToMaintenance,\r\n    debugQuantity,\r\n    guideDoorInstallation,\r\n    startTheInstallation,\r\n    installationNotStarted,\r\n    theOverallProgress,\r\n  };\r\n};\r\n\r\nexport const currentRefreshTime = () => {\r\n  return `${new Date().getMonth() + 1\r\n    }/${new Date().getDate()} ${new Date().getHours()}:${new Date().getMinutes() < 10\r\n      ? \"0\" + new Date().getMinutes()\r\n      : new Date().getMinutes()\r\n    }`;\r\n};\r\n\r\nexport const saveTheFirstRefreshTime = (dispatch) => {\r\n  db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n    const datatime = {\r\n      allDataRefreshTime: currentRefreshTime(),\r\n      masterDataRefreshTime: currentRefreshTime(),\r\n      orderDataRefreshTime: currentRefreshTime(),\r\n      templateListDataRefreshTime: currentRefreshTime(),\r\n      documentListDataRefreshTime: currentRefreshTime(),\r\n      taskListDataRefreshTime: currentRefreshTime(),\r\n    };\r\n    dispatch(action.setAllDataRefreshTime(datatime));\r\n\r\n    !cache?.data &&\r\n      db.cache\r\n        .put({\r\n          id: \"dataRefreshTime\",\r\n          data: datatime,\r\n        })\r\n        .then(() => {\r\n          dispatch(action.setAllDataRefreshTime(datatime));\r\n        });\r\n  });\r\n\r\n  db.cache.get(\"settings\").then((cache) => {\r\n    const language = \"zh-cn\";\r\n    !cache?.data &&\r\n      db.cache\r\n        .put({\r\n          id: \"settings\",\r\n          data: { language: \"zh-cn\" },\r\n        })\r\n        .then(() => {\r\n          dispatch(action.setAllDataRefreshTime(language));\r\n        });\r\n  });\r\n};\r\n\r\nexport const recordRefreshTime = (dispatch, name, projects, userInfo) => {\r\n  if (name) {\r\n    const parmas = {\r\n      projectNos: Object.keys(projects),\r\n    };\r\n\r\n    const auth = JSON.parse(window.localStorage.getItem(\"auth\"));\r\n    let roles = auth?.roles;\r\n    const isSubconTLOrPE = roles.indexOf('Subcon TL') > -1 || roles.indexOf('PE') > -1;\r\n    const isEISV = roles.indexOf('SL') > -1;\r\n\r\n    const request = getDocumentListParmas(parmas.projectNos);\r\n    switch (name) {\r\n      case \"all\":\r\n        if (isSubconTLOrPE || isEISV) {\r\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch));\r\n        } else {\r\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch));\r\n          // dispatch(action.fetchDocuments(request, dispatch));\r\n          dispatch(action.fetchTasksList(userInfo, dispatch));\r\n        }\r\n        break;\r\n      case \"orders\":\r\n        dispatch(action.fetchOrders(parmas, \"\", userInfo, dispatch));\r\n        break;\r\n      case \"documents\":\r\n        dispatch(action.fetchDocuments(request, userInfo, dispatch));\r\n        break;\r\n      case \"task\":\r\n        dispatch(action.fetchTasksList(request,userInfo,\"\", dispatch));\r\n        break;\r\n      default:\r\n        return (\r\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch)),\r\n          // dispatch(action.fetchDocuments(dispatch)),\r\n          dispatch(action.fetchTasksList(userInfo, dispatch))\r\n        );\r\n    }\r\n  } else {\r\n    db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n      cache?.data && dispatch(action.setAllDataRefreshTime(cache.data));\r\n    });\r\n  }\r\n};\r\n\r\nexport const getDocumentListParmas = (projectNos, orderNos) => {\r\n  const orders = orderNos ? orderNos:  store.getState().orders;\r\n  let data = [];\r\n  for (let i = 0; i < projectNos.length; i++) {\r\n    Object.keys(orders).find((item) => {\r\n      return (\r\n        orders[item].projectNumber === projectNos[i] &&\r\n        data.push({\r\n          foe: orders[item].fo,\r\n          region: orders[item].region,\r\n          branch: orders[item].prctr,\r\n          projectNo: orders[item].projectNumber,\r\n          orders: Object.keys(orders).filter((order) => {\r\n            return orders[order].projectNumber === orders[item].projectNumber;\r\n          }),\r\n        })\r\n      );\r\n    });\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\nexport const isFormUpdated = (currentForm, initForm) => {\r\n  if (currentForm.fields.length !== initForm.fields.length) {\r\n    return false;\r\n  }\r\n\r\n  for (let i = 0; i < currentForm.fields.length; i++) {\r\n    if (Array.isArray(currentForm.fields[i].settings.value)) {\r\n      if (\r\n        !_.isEqual(\r\n          currentForm.fields[i].settings.value.sort(),\r\n          initForm.fields[i].settings.value.sort()\r\n        )\r\n      ) {\r\n        return true;\r\n      }\r\n    } else {\r\n      if (\r\n        currentForm.fields[i].settings.value !==\r\n        initForm.fields[i].settings.value\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport const localInstallationStepsConfirmDateProc = (data) => {\r\n  const res = {};\r\n\r\n  data.forEach((value) => {\r\n    res[value.orderNo + \"-\" + value.stepNo] = value;\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const verifyWhenConfirm7020or70C0 = (\r\n  orderActivities,\r\n  orderNumber,\r\n  activityNumber\r\n) => {\r\n  // 14 steps\r\n  if (orderActivities[orderNumber + \"-7030\"]) {\r\n    if (activityNumber === \"70C0\") {\r\n      const checkSteps = [\r\n        \"7010\",\r\n        \"7020\",\r\n        \"7030\",\r\n        \"7040\",\r\n        \"7050\",\r\n        \"7060\",\r\n        \"7070\",\r\n        \"7080\",\r\n        \"7090\",\r\n        \"70A0\",\r\n        \"70B0\",\r\n      ];\r\n\r\n      const result = checkSteps.find(\r\n        (step) => !orderActivities[orderNumber + \"-\" + step].confirmedDate\r\n      );\r\n\r\n      if (result) {\r\n        return {\r\n          stepNo: result,\r\n          message: \"未确认,请先确认\",\r\n        };\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *  code: 1: 本地不存在template\r\n *        2：本地存在template,但是不一样\r\n *        3：本地存在template,但是一样\r\n */\r\nexport const checkTemplateForm = (documentNo, documentPart, value) => {\r\n  const key = documentNo + \"-\" + documentPart;\r\n  return db.cache.get(\"rawTemplateForm\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      if (!existData[key]) {\r\n        existData[key] = value;\r\n\r\n        return db.cache\r\n          .put({ id: \"rawTemplateForm\", data: existData })\r\n          .then(() => {\r\n            return Promise.resolve({ code: 1, value });\r\n          });\r\n      }\r\n\r\n      if (existData[key] !== value) {\r\n        existData[key] = value;\r\n\r\n        return db.cache\r\n          .put({ id: \"rawTemplateForm\", data: existData })\r\n          .then(() => {\r\n            return Promise.resolve({ code: 2, value });\r\n          });\r\n      }\r\n\r\n      return Promise.resolve({ code: 3, value });\r\n    } else {\r\n      const data = {};\r\n      data[key] = value;\r\n\r\n      return db.cache.put({ id: \"rawTemplateForm\", data }).then(() => {\r\n        return Promise.resolve({ code: 1, value });\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nexport const getRawTemplate = (documentNo, documentPart) => {\r\n  const key = documentNo + \"-\" + documentPart;\r\n  return db.cache.get(\"rawTemplateForm\").then((cache) => {\r\n    // TODO: 这边正常流程下来都会有数据，可提高代码健壮性\r\n    if (cache?.data) {\r\n      return Promise.resolve(cache.data[key]);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * code: 1: 本地存在draft\r\n *      2： 本地不存在draft\r\n */\r\nexport const getDraftFromLocal = (\r\n  documentNo,\r\n  documentPart,\r\n  activityNo,\r\n  productFamily,\r\n  productLine,\r\n  language,\r\n  draftParam\r\n) => {\r\n  const { orderNo } = draftParam;\r\n  const key =\r\n    orderNo +\r\n    \"-\" +\r\n    activityNo +\r\n    \"-\" +\r\n    documentNo +\r\n    \"-\" +\r\n    documentPart +\r\n    \"-\" +\r\n    productFamily +\r\n    \"-\" +\r\n    productLine +\r\n    \"-\" +\r\n    language;\r\n  return db.cache.get(\"templateDraft\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      if (existData[key]) {\r\n        return Promise.resolve({ code: 1, value: existData[key] });\r\n      }\r\n\r\n      return Promise.resolve({ code: 2 });\r\n    } else {\r\n      return Promise.resolve({ code: 2 });\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * code： 1：draft 存在\r\n *        2：draft 不存在\r\n */\r\nexport const getDraft = (param, draftParam, expendParam) => {\r\n  const { documentNo, documentPart } = param;\r\n  const { activityNo, productFamily, productLine, language } = expendParam;\r\n  return getDraftFromLocal(\r\n    documentNo,\r\n    documentPart,\r\n    activityNo,\r\n    productFamily,\r\n    productLine,\r\n    language,\r\n    draftParam\r\n  ).then((data) => {\r\n    if (data.code === 1) {\r\n      return Promise.resolve(data);\r\n    } else\r\n      return getDraftFromApi(draftParam).then((data) => {\r\n        return Promise.resolve(data);\r\n      });\r\n  });\r\n};\r\n\r\n/**\r\n * code: 1 draft 存在\r\n *       2 draft 不存在\r\n */\r\nexport const getDraftFromApi = (draftParam) => {\r\n  return api.getDraft(draftParam).then((res) => {\r\n    if (res.data.form) {\r\n      return Promise.resolve({ code: 1, value: res.data.form });\r\n    } else {\r\n      return Promise.resolve({ code: 2 });\r\n    }\r\n  });\r\n};\r\n\r\nexport const saveDraftToLocal = (data, currentParam, draftParams) => {\r\n  const { documentNo, documentPart } = currentParam;\r\n  const { orderNo, activityNo, productFamily, productLine, language } =\r\n    draftParams;\r\n  const key =\r\n    orderNo +\r\n    \"-\" +\r\n    activityNo +\r\n    \"-\" +\r\n    documentNo +\r\n    \"-\" +\r\n    documentPart +\r\n    \"-\" +\r\n    productFamily +\r\n    \"-\" +\r\n    productLine +\r\n    \"-\" +\r\n    language;\r\n  db.cache.get(\"templateDraft\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      existData[key] = data;\r\n      db.cache.put({ id: \"templateDraft\", data: existData });\r\n    } else {\r\n      const storeData = {};\r\n      storeData[key] = data;\r\n      db.cache.put({ id: \"templateDraft\", data: storeData });\r\n    }\r\n  });\r\n};\r\n\r\nexport const deleteDraftFromLocal = (currentParam) => {\r\n  const { documentNo, documentPart } = currentParam;\r\n  db.cache.get(\"templateDraft\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      const deleteKeys = Object.keys(existData).filter((key) => {\r\n        return key.includes(documentNo + \"-\" + documentPart);\r\n      });\r\n\r\n      deleteKeys.forEach((key) => {\r\n        delete existData[key];\r\n      });\r\n\r\n      db.cache.put({ id: \"templateDraft\", data: existData });\r\n    }\r\n  });\r\n};\r\n\r\nexport const getTemplateList = (templatesData, productLine, productFamily, productCategory) => {\r\n  const condition1 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productLine === productLine && item.productFamily === productFamily\r\n  );\r\n\r\n  const condition2 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productLine === productLine && item.productFamily === null\r\n  );\r\n\r\n  const condition3 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productFamily === productFamily && item.productLine === null\r\n  );\r\n\r\n  const condition4 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productLine === null && item.productFamily === null\r\n  );\r\n\r\n  const condition5 = templatesData.filter(\r\n    (item) =>\r\n      item.productLine === productLine && item.productFamily === productFamily && item.productCategory === null\r\n  );\r\n\r\n  const condition6 = templatesData.filter(\r\n    (item) =>\r\n      item.productLine === productLine && item.productCategory === null && item.productFamily === null\r\n  );\r\n\r\n  const condition7 = templatesData.filter(\r\n    (item) =>\r\n      item.productFamily === productFamily && item.productCategory === null && item.productLine === null\r\n  );\r\n\r\n  const condition8 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === null && item.productLine === null && item.productFamily === null\r\n  );\r\n\r\n  const result = [\r\n    condition1,\r\n    condition2,\r\n    condition3,\r\n    condition4,\r\n    condition5,\r\n    condition6,\r\n    condition7,\r\n    condition8\r\n  ].find(array => array.length > 0)\r\n\r\n  return result ? result : [];\r\n};\r\n\r\nexport const getDocumentComplateStatus = (\r\n  auth,\r\n  projectNumber,\r\n  orderNo,\r\n  orderActivities,\r\n  templates,\r\n  documentList\r\n) => {\r\n  const activityList = publicFn.orderDetailSteps(\r\n    orderActivities,\r\n    orderNo,\r\n    auth.activityAuth,\r\n    auth.roles[0]\r\n  );\r\n\r\n  const documentCompleteStatus = [];\r\n  for (let i = 0; i < activityList.length; i++) {\r\n    if (orderActivities?.[orderNo + '-' + activityList[i]]) {\r\n      const status = toDoOrDone(\r\n        projectNumber,\r\n        orderNo,\r\n        activityList[i],\r\n        templates,\r\n        documentList\r\n      );\r\n      documentCompleteStatus.push(status);\r\n    }\r\n\r\n  }\r\n\r\n  const completeSum = [];\r\n  const completed = [];\r\n  for (let i = 0; i < documentCompleteStatus.length; i++) {\r\n    if (documentCompleteStatus[i] === \"ToDo\") {\r\n      completeSum.push(documentCompleteStatus[i]);\r\n    } else if (documentCompleteStatus[i] === \"Done\") {\r\n      completeSum.push(documentCompleteStatus[i]);\r\n      completed.push(documentCompleteStatus[i]);\r\n    }\r\n  }\r\n\r\n  return `${completed.length}/${completeSum.length}`;\r\n};\r\n\r\n// export const getStopsOrHoistHeight = (chars, orderNo, type) => {\r\n//   const condition = type === \"stops\" ? \"GRP_NUMBER_OF_STOPS\" : \"GRP_HQ\";\r\n\r\n//   const data = [];\r\n//   Object.keys(chars).filter((item) => {\r\n//     return (\r\n//       chars[item].orderNo === orderNo &&\r\n//       chars[item].charID === condition &&\r\n//       data.push(chars[item])\r\n//     );\r\n//   });\r\n//   console.log(data, type, orderNo);\r\n\r\n//   return data.length > 0 ? data[0].value : 0;\r\n// };\r\n\r\nexport const getStopsOrHoistHeight = (chars, orderNo, type) => {\r\n  const data = [];\r\n  Object.keys(chars).filter((item) => {\r\n    return chars[item].orderNo === orderNo && data.push(chars[item]);\r\n  });\r\n\r\n  if (type === \"stops\") {\r\n    const stops = data.filter((item) => {\r\n      return (\r\n        item.name.indexOf(\"停站数\") > -1 ||\r\n        item.name.indexOf(\"Number of stops\") > -1\r\n      );\r\n    });\r\n    return stops.length > 0 ? stops[0].value : 0;\r\n  } else {\r\n    const hoistHeight = data.filter((item) => {\r\n      return (\r\n        item.name.indexOf(\"提升高度\") > -1 ||\r\n        item.name.indexOf(\"Travel height\") > -1 ||\r\n        item.name.indexOf(\"Vertical rise\") > -1\r\n      );\r\n    });\r\n\r\n    return hoistHeight.length > 0 ? hoistHeight[0].value : 0;\r\n  }\r\n};\r\n\r\nexport const scrollToPosition = (element, pathname) => {\r\n  const position = store.getState().scrollPosition[pathname];\r\n  element.current.scrollTop = position ? position : 0;\r\n};\r\n\r\nexport const removeNotVisibleFields = (templateForm) => {\r\n  const result = _.cloneDeep(templateForm);\r\n  _.remove(result.fields, (field) => {\r\n    return !isVisible(field);\r\n  });\r\n  return result;\r\n};\r\n\r\nexport const getTaskCount = () => {\r\n  const tasks = store.getState().tasks;\r\n  const orders = store.getState().orders;\r\n  const projects = store.getState().projects;\r\n\r\n  const awaitCloseNum =\r\n    publicFn.taskCleaner(tasks.assigner, orders, projects) &&\r\n    publicFn.taskCleaner(tasks.assigner, orders, projects).filter((item) => {\r\n      return item.Status === \"D\";\r\n    }).length;\r\n\r\n  const awaitComplateNum =\r\n    publicFn.taskCleaner(tasks.assignee, orders, projects) &&\r\n    publicFn.taskCleaner(tasks.assignee, orders, projects).filter((item) => {\r\n      return item.Status === \"A\";\r\n    }).length;\r\n\r\n  return {\r\n    awaitCloseNum,\r\n    awaitComplateNum,\r\n  };\r\n};\r\n\r\nexport const getAwaitComplateAwaitCloseCount = (tasks) => {\r\n  const countTaskStatuses = (tasks) => {\r\n    const statusCount = {};\r\n    tasks.forEach(task => {\r\n      const { taskType, status } = task;\r\n      if (!statusCount[taskType]) {\r\n        statusCount[taskType] = { 'awaitStartNum': 0, \"awaitCloseNum\": 0, \"awaitComplateNum\": 0 };\r\n      }\r\n      if (status === \"awaitClose\") {\r\n        statusCount[taskType][\"awaitCloseNum\"] += 1;\r\n      } else if (status === \"awaitComplate\") {\r\n        statusCount[taskType][\"awaitComplateNum\"] += 1;\r\n      } else if (status === \"awaitStart\") {\r\n        statusCount[taskType][\"awaitStartNum\"] += 1;\r\n      }\r\n    });\r\n\r\n    return statusCount;\r\n  };\r\n\r\n  const taskStatusCount = countTaskStatuses(tasks);\r\n\r\n  const updatedTasks = tasks.map(task => {\r\n    const { taskType } = task;\r\n    const { \"awaitCloseNum\": pendingCloseCount, \"awaitComplateNum\": pendingCompleteCount, 'awaitStartNum': pendingStartCoun } = taskStatusCount[taskType] || { \"awaitCloseNum\": 0, \"awaitComplateNum\": 0, 'awaitStartNum': 0 };\r\n\r\n    return {\r\n      ...task,\r\n      \"awaitCloseNum\": pendingCloseCount,\r\n      \"awaitComplateNum\": pendingCompleteCount,\r\n      'awaitStartNum': pendingStartCoun\r\n    };\r\n  });\r\n  return updatedTasks;\r\n}\r\n\r\nexport const showNumberText = (min, max) => {\r\n  const a = min === 0 ? min.toString() : min;\r\n  const b = max === 0 ? max.toString() : max;\r\n\r\n  if (a || b) {\r\n    if (a && !b) {\r\n      return `(${a}...)`;\r\n    } else if (!a && b) {\r\n      return `(...${b})`;\r\n    } else {\r\n      return `(${a}-${b})`;\r\n    }\r\n  } else {\r\n    return \"\";\r\n  }\r\n};\r\n\r\nexport const checkFileIsExisting = (template, data, orders) => {\r\n  const templateDataList = getTemplateList(\r\n    template[data.activityNumber] || [],\r\n    orders[data.orderNumber].productLine,\r\n    orders[data.orderNumber].productFamily,\r\n    orders[data.orderNumber].productCategory\r\n  );\r\n\r\n  const param = templateDataList.map((item) => {\r\n    return {\r\n      foe: orders[data.orderNumber].fo,\r\n      region: orders[data.orderNumber].region,\r\n      branch: orders[data.orderNumber].prctr,\r\n      projectNo: orders[data.orderNumber].projectNumber,\r\n      orderNo: data.orderNumber,\r\n      activityNo: data.activityNumber,\r\n      documentName: item.documentDescription + \".eform2\",\r\n    };\r\n  });\r\n\r\n  return api.checkFileIsExisting(param).then((res) => {\r\n    let message = [];\r\n    res.data.forEach((item, index) => {\r\n      !item && message.push(templateDataList[index].documentDescription);\r\n    });\r\n\r\n    return message;\r\n  });\r\n};\r\n\r\nexport const getChecklistActivityNo = (data) => {\r\n  const activtyNo = \"V001\";\r\n\r\n  const listData =\r\n    store.getState()?.documentList?.[data.projectNumber]?.[data.orderNumber]?.[\r\n    activtyNo\r\n    ];\r\n\r\n  return listData ? activtyNo : false;\r\n};\r\n\r\n\r\nexport const getNonConformityConfig = () => {\r\n  return {\r\n    \"7010\": {\r\n      activityNo: \"7010\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7020\": {\r\n      activityNo: \"7020\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7030\": {\r\n      activityNo: \"7030\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7040\": {\r\n      activityNo: \"7040\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7050\": {\r\n      activityNo: \"7050\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7060\": {\r\n      activityNo: \"7060\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7070\": {\r\n      activityNo: \"7070\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7080\": {\r\n      activityNo: \"7080\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7090\": {\r\n      activityNo: \"7090\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70A0\": {\r\n      activityNo: \"70A0\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70B0\": {\r\n      activityNo: \"70B0\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70C0\": {\r\n      activityNo: \"70C0\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70D0\": {\r\n      activityNo: \"70D0\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7350\": {\r\n      activityNo: \"7350\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7360\": {\r\n      activityNo: \"7360\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7400\": {\r\n      activityNo: \"7400\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7500\": {\r\n      activityNo: \"7500\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7600\": {\r\n      activityNo: \"7600\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7620\": {\r\n      activityNo: \"7620\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7700\": {\r\n      activityNo: \"7700\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7800\": {\r\n      activityNo: \"7800\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7950\": {\r\n      activityNo: \"7950\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"8010\": {\r\n      activityNo: \"8010\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"9200\": {\r\n      activityNo: \"9200\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    }\r\n  }\r\n}\r\n\r\nconst customizer = (objValue, srcValue) => {\r\n  if (Array.isArray(objValue) && Array.isArray(srcValue)) {\r\n    return objValue.concat(srcValue);\r\n  }\r\n};\r\n\r\nexport const updateOrdersData = (soNo, dispatch) => {\r\n  dispatch(action.showLoading());\r\n  api.fetchOrdersDataByProjects(soNo).then((response) => {\r\n    const { entities } = normalize(response.data, schema.ordersData);\r\n    db.cache.get(\"ordersData\").then((cache) => {\r\n      const result = _.mergeWith(cache.data, entities, customizer);\r\n      let projects = result.projects\r\n        ? Object.keys(result.projects)\r\n        : [];\r\n      db.cache.put({ id: \"ordersData\", data: result }).then(() => {\r\n        const param = { projectNos: projects }\r\n        repo\r\n          .fetchLocalInstallationStepsConfirmDate(param)\r\n\r\n        const request= getDocumentListParmas(param.projectNos, result?.orders)\r\n        dispatch(action.fetchDocuments(request, {}, dispatch));\r\n      });\r\n    });\r\n\r\n\r\n  }).catch((error) => {\r\n    dispatch(action.setError(error.message));\r\n  }).finally(() => {\r\n    dispatch(action.hideLoading());\r\n  });\r\n}\r\n\r\nexport const disableForm = (params = {}) => {\r\n  if (!showUploadButton()) {\r\n    return false\r\n  }\r\n\r\n  const { orderActivities, documentList, templates, orders, auth, nonConformityConfig } = store.getState();\r\n  const { activityNo, orderNo, productFamily, productLine, projectNumber, root } = params;\r\n  const productCategory = orders[orderNo]?.productCategory;\r\n  const templatesData = templates[activityNo] || [];\r\n  const documents = [];\r\n  const documentsItem = documentList[projectNumber]?.[orderNo]?.[activityNo];\r\n  const allowreupload = nonConformityConfig[activityNo]?.allowreupload;\r\n  const disableTheEntranceroot = root === \"listCard\";\r\n\r\n\r\n  const data = getTemplateList(templatesData, productLine, productFamily, productCategory);\r\n  const description = data.map((item) => {\r\n    return item.documentDescription;\r\n  });\r\n\r\n\r\n  description.forEach((item) => {\r\n    return (\r\n      (documentsItem &&\r\n        documentsItem.filter(\r\n          (ele) => ele.name.indexOf(item) > -1 && documents.push(ele)\r\n        )) ||\r\n      []\r\n    );\r\n  });\r\n\r\n  const docAuthActivityNos = documentAuthorizationC(\r\n    orderActivities,\r\n    orderNo,\r\n    auth.activityAuth,\r\n    auth.roles[0]\r\n  );\r\n\r\n  const canUploadDoc = docAuthActivityNos.includes(activityNo);\r\n\r\n  if (root === \"installationChecklist\") {\r\n    const template = {\r\n      mandDoc: \"Y\",\r\n      documentDescription: `安装检查清单`,\r\n    };\r\n\r\n    data.push(template);\r\n\r\n    documents.push(documentList?.[projectNumber]?.[orderNo]?.[activityNo][0]);\r\n  }\r\n\r\n  if (disableTheEntranceroot && canUploadDoc) {\r\n    return false\r\n  }\r\n\r\n  if (documents.length > 0) {\r\n    if (!allowreupload) {\r\n      return true\r\n    } else {\r\n      if (getChecklistActivityNo({ projectNumber: projectNumber, orderNumber: orderNo })) {\r\n        return true\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n\r\nexport const showUploadButton = () => {\r\n  const {  auth } = store.getState();\r\n\r\n  return auth?.isEnableCorrectImage\r\n}\r\n\r\nconst getTime = () => {\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  const month = String(now.getMonth() + 1).padStart(2, '0');\r\n  const day = String(now.getDate()).padStart(2, '0');\r\n  const hours = String(now.getHours()).padStart(2, '0');\r\n  const minutes = String(now.getMinutes()).padStart(2, '0');\r\n  const seconds = String(now.getSeconds()).padStart(2, '0');\r\n\r\n  return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n}\r\n\r\nconst getCurrentPosition =  () => {\r\n  return new Promise((resolve) => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const latitude = position.coords.latitude;\r\n          const longitude = position.coords.longitude;\r\n          resolve({ status: 'success', data: { latitude, longitude } });\r\n        },\r\n        (error) => {\r\n          resolve({ status: 'error', message: error.message });\r\n        }\r\n      );\r\n    } else {\r\n      resolve({ status: 'error', message: 'Geolocation is not supported by this browser.' });\r\n    }\r\n  });\r\n\r\n};\r\n\r\n// 根据经纬度获取详细地址\r\nconst getLocationFromCoordinates = (latitude, longitude) => {\r\n  return new Promise((resolve, reject) => {\r\n    if (window.BMap) {\r\n      const geocoder = new window.BMap.Geocoder(); // 创建 Geocoder 实例\r\n      const point = new window.BMap.Point(longitude, latitude); // 创建坐标对象\r\n\r\n      geocoder.getLocation(point, (result) => {\r\n        if (result) {\r\n          resolve(result.address);\r\n        } else {\r\n          resolve('无法获取地址信息');\r\n        }\r\n      });\r\n    } else {\r\n      reject('百度地图 API 未加载');\r\n    }\r\n  });\r\n};\r\n\r\nexport const fillTextToImg = async (base64,projectParams) => {\r\n  let data = store.getState();\r\n  // let location = { longitude: \"121.197237\", latitude: \"31.449172\" }\r\n  const location = await getCurrentPosition();\r\n  let address = await getLocationFromCoordinates(location?.data?.latitude, location?.data?.longitude);\r\n  let projectName = data.projects[projectParams.projectNumber]?.description;\r\n  let time = getTime();\r\n\r\n  let watermarkText = [`拍摄地点：${address}`, `拍摄时间：${time}`, `订单编号：${projectParams.orderNo}`, `项目名称：${projectName}`];\r\n\r\n  const img = new Image();\r\n  img.src = base64;\r\n  img.setAttribute(\"crossOrigin\", \"Anonymous\");\r\n\r\n  return new Promise((resolve) => {\r\n\r\n    img.onload = () => {\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = img.width;\r\n      canvas.height = img.height;\r\n\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n\r\n      ctx.font = '15px Arial';\r\n      ctx.textAlign = \"left\";\r\n      ctx.fillStyle = \"#ffffff\";\r\n\r\n      let lineHeight = 0;\r\n\r\n      watermarkText.forEach(item => {\r\n        lineHeight += 30\r\n        ctx.fillText(item, 20, canvas.height - lineHeight + 20);\r\n      })\r\n\r\n      resolve(canvas.toDataURL(\"image/jpg\"));\r\n    };\r\n  });\r\n}\r\n\r\nexport const formatDateToYMD = (dateString) => {\r\n  console.log(dateString)\r\n  const date = new Date(dateString);  // 将字符串转换为 Date 对象\r\n\r\n  const year = date.getFullYear();  // 获取年份\r\n  const month = String(date.getMonth() + 1).padStart(2, '0');  // 获取月份（注意月份是从0开始的，需加1）\r\n  const day = String(date.getDate()).padStart(2, '0');  // 获取日期\r\n\r\n  return dateString? `${year}-${month}-${day}`: null;  // 拼接成“YYYY年MM月DD日”格式\r\n}\r\n\r\nexport const taskDataConversion = (item) => {\r\n  let status;\r\n  switch (item.status) {\r\n    case 1:\r\n      status = \"awaitStart\"\r\n      break;\r\n    case 2:\r\n      status = \"awaitComplate\";\r\n      break;\r\n    case 3:\r\n      status = \"awaitClose\";\r\n      break;\r\n    case 4:\r\n      status = 'closed';\r\n      break;\r\n    case 5:\r\n      status = 'closed';\r\n      break;\r\n    default:\r\n      status = 'closed';\r\n      break;\r\n  };\r\n\r\n  return {\r\n    taskId: item.id,\r\n    taskType: item.type,\r\n    projectNo: item.projectNo,\r\n    orderNo: item.salesOrderNo,\r\n    activityNo: item.activityNo,\r\n    projectName: item.projectName,\r\n    planStartDate: formatDateToYMD(item.planStartDate),\r\n    planEndDate: formatDateToYMD(item.planEndDate),\r\n    actualStartDate: formatDateToYMD(item.actualStartDate),\r\n    actualEndDate: formatDateToYMD(item.actualEndDate),\r\n    actualCloseDate: formatDateToYMD(item.actualClosedDate),\r\n    statusDesc: item.statusDesc,\r\n    status: status\r\n  };\r\n\r\n}"]},"metadata":{},"sourceType":"module"}