{"ast":null,"code":"/**\r\n * Copyright (C) 2016 All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are not permitted unless explicitly granted in writing.\r\n *\r\n * Usage and modification rights granted to Schindler AG, Ebikon.\r\n */\nimport { appendChild, appendQuestionBlock, hasChildNode, getChildNode, getChildNodes, getRequiredAttr, getAttrWithDefault, readQuestionBlock } from \"./utils/xml\";\nimport { DEFAULT_LANG } from \"./constants/global\";\nimport uuid from \"node-uuid\";\nexport default {\n  serialize(doc, findField, parentNode, field) {\n    const {\n      trs,\n      changeNotAllowed\n    } = field.settings;\n    const questionBlock = appendQuestionBlock(doc, findField, parentNode, \"string[]\", field);\n    var attr = {\n      \"change-not-allowed\": changeNotAllowed\n    };\n    const table = appendChild(doc, questionBlock, \"table\", \"\", attr);\n    trs.forEach(tr => {\n      const trNode = appendChild(doc, table, \"tr\");\n      tr.tds.forEach(td => {\n        var attr = tr.columnHeader ? {\n          width: td.width\n        } : {};\n        const tdNode = appendChild(doc, trNode, \"td\", \"\", attr);\n\n        if (tr.columnHeader === true || td.rowHeader === true || changeNotAllowed) {\n          Object.keys(td.nameI18n).forEach(lang => {\n            if (typeof td.nameI18n[lang] !== \"undefined\") {\n              appendChild(doc, tdNode, \"text\", td.nameI18n[lang], {\n                lang\n              });\n            }\n          });\n        } else {\n          appendChild(doc, tdNode, \"textfield\", td.name);\n        }\n      });\n    });\n  },\n\n  canDeserialize(node) {\n    return node.nodeName === \"question_block\" && hasChildNode(node, \"table\");\n  },\n\n  deserialize(node) {\n    let field = readQuestionBlock(node, \"table\", \"string[]\"); // eslint-disable-line prefer-const\n\n    const tableNode = getChildNode(node, \"table\");\n    const trNodes = getChildNodes(tableNode, \"tr\");\n    const changeNotAllowed = getAttrWithDefault(tableNode, \"change-not-allowed\", \"false\") === \"true\";\n    let trs = []; // eslint-disable-line prefer-const\n\n    field.settings.trs = trs;\n    field.settings.required = getRequiredAttr(node, \"required\") === \"true\";\n    trNodes.forEach((trNode, trIndex) => {\n      const trId = uuid.v4();\n      let tds = [];\n\n      if (trIndex === 0) {\n        trs.push({\n          id: trId,\n          columnHeader: true,\n          tds: tds\n        });\n      } else {\n        trs.push({\n          id: trId,\n          tds: tds\n        });\n      }\n\n      const tdNodes = getChildNodes(trNode, \"td\");\n      tdNodes.forEach((tdNode, tdIndex) => {\n        const tdId = uuid.v4();\n        trs[trIndex].tds.push({\n          id: tdId\n        });\n\n        if (trIndex === 0) {\n          const nameI18n = getChildNodes(tdNode, \"text\").reduce((acc, textNode) => {\n            return Object.assign({}, acc, {\n              [getAttrWithDefault(textNode, \"lang\", DEFAULT_LANG)]: textNode.textContent\n            });\n          }, {});\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\n          trs[trIndex].tds[tdIndex].width = getAttrWithDefault(tdNode, \"width\", 0);\n        } else if (tdIndex === 0) {\n          trs[trIndex].tds[tdIndex].rowHeader = true;\n          const nameI18n = getChildNodes(tdNode, \"text\").reduce((acc, textNode) => {\n            return Object.assign({}, acc, {\n              [getAttrWithDefault(textNode, \"lang\", DEFAULT_LANG)]: textNode.textContent\n            });\n          }, {});\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\n        } else if (changeNotAllowed) {\n          const contentNode = getChildNode(tdNode, \"textfield\");\n          let nameI18n = {};\n\n          if (contentNode.hasAttribute(\"lang\")) {\n            nameI18n = getChildNodes(tdNode, \"text\").reduce((acc, textNode) => {\n              return Object.assign({}, acc, {\n                [getAttrWithDefault(textNode, \"lang\", DEFAULT_LANG)]: textNode.textContent\n              });\n            }, {});\n          } else {\n            //Compatible with older versions\n            nameI18n[DEFAULT_LANG] = contentNode.textContent !== \"\" && contentNode.textContent !== undefined ? contentNode.textContent : undefined;\n          }\n\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\n        } else {\n          const contentNode = getChildNode(tdNode, \"textfield\");\n          var nameI18n = {};\n          nameI18n[DEFAULT_LANG] = contentNode.textContent !== \"\" && contentNode.textContent !== undefined ? contentNode.textContent : undefined;\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\n        }\n      });\n    });\n    field.settings.changeNotAllowed = changeNotAllowed;\n    return field;\n  }\n\n};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/js/sfdl/TableIO.js"],"names":["appendChild","appendQuestionBlock","hasChildNode","getChildNode","getChildNodes","getRequiredAttr","getAttrWithDefault","readQuestionBlock","DEFAULT_LANG","uuid","serialize","doc","findField","parentNode","field","trs","changeNotAllowed","settings","questionBlock","attr","table","forEach","tr","trNode","tds","td","columnHeader","width","tdNode","rowHeader","Object","keys","nameI18n","lang","name","canDeserialize","node","nodeName","deserialize","tableNode","trNodes","required","trIndex","trId","v4","push","id","tdNodes","tdIndex","tdId","reduce","acc","textNode","assign","textContent","contentNode","hasAttribute","undefined"],"mappings":"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","sourcesContent":["/**\r\n * Copyright (C) 2016 All rights reserved.\r\n *\r\n * Redistribution and use in source and binary forms, with or without modification,\r\n * are not permitted unless explicitly granted in writing.\r\n *\r\n * Usage and modification rights granted to Schindler AG, Ebikon.\r\n */\r\n\r\nimport {\r\n  appendChild,\r\n  appendQuestionBlock,\r\n  hasChildNode,\r\n  getChildNode,\r\n  getChildNodes,\r\n  getRequiredAttr,\r\n  getAttrWithDefault,\r\n  readQuestionBlock,\r\n} from \"./utils/xml\";\r\nimport { DEFAULT_LANG } from \"./constants/global\";\r\nimport uuid from \"node-uuid\";\r\n\r\nexport default {\r\n  serialize(doc, findField, parentNode, field) {\r\n    const { trs, changeNotAllowed } = field.settings;\r\n    const questionBlock = appendQuestionBlock(\r\n      doc,\r\n      findField,\r\n      parentNode,\r\n      \"string[]\",\r\n      field\r\n    );\r\n    var attr = { \"change-not-allowed\": changeNotAllowed };\r\n\r\n    const table = appendChild(doc, questionBlock, \"table\", \"\", attr);\r\n\r\n    trs.forEach((tr) => {\r\n      const trNode = appendChild(doc, table, \"tr\");\r\n\r\n      tr.tds.forEach((td) => {\r\n        var attr = tr.columnHeader ? { width: td.width } : {};\r\n        const tdNode = appendChild(doc, trNode, \"td\", \"\", attr);\r\n        if (\r\n          tr.columnHeader === true ||\r\n          td.rowHeader === true ||\r\n          changeNotAllowed\r\n        ) {\r\n          Object.keys(td.nameI18n).forEach((lang) => {\r\n            if (typeof td.nameI18n[lang] !== \"undefined\") {\r\n              appendChild(doc, tdNode, \"text\", td.nameI18n[lang], { lang });\r\n            }\r\n          });\r\n        } else {\r\n          appendChild(doc, tdNode, \"textfield\", td.name);\r\n        }\r\n      });\r\n    });\r\n  },\r\n\r\n  canDeserialize(node) {\r\n    return node.nodeName === \"question_block\" && hasChildNode(node, \"table\");\r\n  },\r\n\r\n  deserialize(node) {\r\n    let field = readQuestionBlock(node, \"table\", \"string[]\"); // eslint-disable-line prefer-const\r\n\r\n    const tableNode = getChildNode(node, \"table\");\r\n    const trNodes = getChildNodes(tableNode, \"tr\");\r\n    const changeNotAllowed =\r\n      getAttrWithDefault(tableNode, \"change-not-allowed\", \"false\") === \"true\";\r\n    let trs = []; // eslint-disable-line prefer-const\r\n    field.settings.trs = trs;\r\n    field.settings.required = getRequiredAttr(node, \"required\") === \"true\";\r\n\r\n    trNodes.forEach((trNode, trIndex) => {\r\n      const trId = uuid.v4();\r\n      let tds = [];\r\n      if (trIndex === 0) {\r\n        trs.push({\r\n          id: trId,\r\n          columnHeader: true,\r\n          tds: tds,\r\n        });\r\n      } else {\r\n        trs.push({\r\n          id: trId,\r\n          tds: tds,\r\n        });\r\n      }\r\n      const tdNodes = getChildNodes(trNode, \"td\");\r\n\r\n      tdNodes.forEach((tdNode, tdIndex) => {\r\n        const tdId = uuid.v4();\r\n        trs[trIndex].tds.push({\r\n          id: tdId,\r\n        });\r\n\r\n        if (trIndex === 0) {\r\n          const nameI18n = getChildNodes(tdNode, \"text\").reduce(\r\n            (acc, textNode) => {\r\n              return Object.assign({}, acc, {\r\n                [getAttrWithDefault(\r\n                  textNode,\r\n                  \"lang\",\r\n                  DEFAULT_LANG\r\n                )]: textNode.textContent,\r\n              });\r\n            },\r\n            {}\r\n          );\r\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\r\n          trs[trIndex].tds[tdIndex].width = getAttrWithDefault(\r\n            tdNode,\r\n            \"width\",\r\n            0\r\n          );\r\n        } else if (tdIndex === 0) {\r\n          trs[trIndex].tds[tdIndex].rowHeader = true;\r\n          const nameI18n = getChildNodes(tdNode, \"text\").reduce(\r\n            (acc, textNode) => {\r\n              return Object.assign({}, acc, {\r\n                [getAttrWithDefault(\r\n                  textNode,\r\n                  \"lang\",\r\n                  DEFAULT_LANG\r\n                )]: textNode.textContent,\r\n              });\r\n            },\r\n            {}\r\n          );\r\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\r\n        } else if (changeNotAllowed) {\r\n          const contentNode = getChildNode(tdNode, \"textfield\");\r\n          let nameI18n = {};\r\n          if (contentNode.hasAttribute(\"lang\")) {\r\n            nameI18n = getChildNodes(tdNode, \"text\").reduce((acc, textNode) => {\r\n              return Object.assign({}, acc, {\r\n                [getAttrWithDefault(\r\n                  textNode,\r\n                  \"lang\",\r\n                  DEFAULT_LANG\r\n                )]: textNode.textContent,\r\n              });\r\n            }, {});\r\n          } else {\r\n            //Compatible with older versions\r\n            nameI18n[DEFAULT_LANG] =\r\n              contentNode.textContent !== \"\" &&\r\n              contentNode.textContent !== undefined\r\n                ? contentNode.textContent\r\n                : undefined;\r\n          }\r\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\r\n        } else {\r\n          const contentNode = getChildNode(tdNode, \"textfield\");\r\n          var nameI18n = {};\r\n          nameI18n[DEFAULT_LANG] =\r\n            contentNode.textContent !== \"\" &&\r\n            contentNode.textContent !== undefined\r\n              ? contentNode.textContent\r\n              : undefined;\r\n          trs[trIndex].tds[tdIndex].nameI18n = nameI18n;\r\n        }\r\n      });\r\n    });\r\n\r\n    field.settings.changeNotAllowed = changeNotAllowed;\r\n\r\n    return field;\r\n  },\r\n};\r\n"]},"metadata":{},"sourceType":"module"}