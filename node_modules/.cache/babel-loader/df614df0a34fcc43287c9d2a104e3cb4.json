{"ast":null,"code":"import{toDoOrDone}from\"js/util\";import{authorizationC,documentAuthorizationC,documentAuthorizationR}from\"js/publicFn/authUtils\";var DateConfirmFlag=function DateConfirmFlag(flagNumber){var permissionObj={CanConfirm:false,CanCancel:false,CanSetConstraint:false,CanDeleteDonstraint:false,HasConstraint:false,SupervisorActivity:false,HideActivity:false,PaymentOk:false,PaymentNotOk:false,ProgressType:false};var binFlagNumberOrder=parseInt(flagNumber,10).toString(2).padStart(10,\"0\").split(\"\").reverse().join(\"\");Object.keys(permissionObj).forEach(function(item,index){if(binFlagNumberOrder[index]===\"1\"){permissionObj[item]=true;}});return permissionObj;};export var DatePermissionControl=function DatePermissionControl(data,prarms){var _orderActivities$;var auth=data.auth,orderActivities=data.orderActivities,documentList=data.documentList,templates=data.templates;var orderNumber=prarms.orderNumber,activityNumber=prarms.activityNumber,projectNumber=prarms.projectNumber;var role=auth.roles[0];var permissions=auth.activityAuth;var datePermission={Confirm:false,Cancel:false,Lock:false,unLock:false,canUploadDoc:false,canReadDoc:false,docStatus:\"\",planedDateEditablePermission:false,planedDateCancelablePermission:false,finishedDateEditablePermission:false,finishedDateCancelablePermission:false};var flagsNumber=(_orderActivities$=orderActivities[\"\".concat(orderNumber,\"-\").concat(activityNumber)])===null||_orderActivities$===void 0?void 0:_orderActivities$.flags;var docStatus=toDoOrDone(projectNumber,orderNumber,activityNumber,templates,documentList);var docIsFinish=docStatus!==\"ToDo\";var flags=DateConfirmFlag(flagsNumber);if(role===\"admin\"){Object.keys(datePermission).forEach(function(Permission){if(Permission===\"Confirm\"){if(docIsFinish){datePermission[Permission]=true;}}else{datePermission[Permission]=true;}datePermission[\"docStatus\"]=docStatus;});}else{var authNumbers=authorizationC(orderActivities,orderNumber,permissions,role);datePermission[\"docStatus\"]=docStatus;if(authNumbers.includes(activityNumber)){if(docIsFinish&&flags.CanConfirm){datePermission.Confirm=true;}datePermission.Cancel=flags.CanCancel;datePermission.Lock=flags.CanSetConstraint;datePermission.unLock=flags.CanDeleteDonstraint;datePermission.planedDateEditablePermission=flags.CanSetConstraint;datePermission.planedDateCancelablePermission=flags.CanDeleteDonstraint;datePermission.finishedDateEditablePermission=flags.CanConfirm;datePermission.finishedDateCancelablePermission=flags.CanCancel;}if(orderActivities[\"\".concat(orderNumber,\"-\").concat(activityNumber)].editable!==undefined&&orderActivities[\"\".concat(orderNumber,\"-\").concat(activityNumber)].editable===false){if(orderActivities[\"\".concat(orderNumber,\"-\").concat(activityNumber)].confirmedDate===null){datePermission.Confirm=true;datePermission.Cancel=false;}else{datePermission.Confirm=false;datePermission.Cancel=true;}}if(!docIsFinish){datePermission.Confirm=false;}var docCNumbers=documentAuthorizationC(orderActivities,orderNumber,permissions,role);if(docCNumbers.includes(activityNumber)){datePermission.canUploadDoc=true;}var docRNumbers=documentAuthorizationR(orderActivities,orderNumber,permissions,role);if(docRNumbers.includes(activityNumber)){datePermission.canReadDoc=true;}}return datePermission;};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/js/publicFn/DatePermissionControl.js"],"names":["toDoOrDone","authorizationC","documentAuthorizationC","documentAuthorizationR","DateConfirmFlag","flagNumber","permissionObj","CanConfirm","CanCancel","CanSetConstraint","CanDeleteDonstraint","HasConstraint","SupervisorActivity","HideActivity","PaymentOk","PaymentNotOk","ProgressType","binFlagNumberOrder","parseInt","toString","padStart","split","reverse","join","Object","keys","forEach","item","index","DatePermissionControl","data","prarms","auth","orderActivities","documentList","templates","orderNumber","activityNumber","projectNumber","role","roles","permissions","activityAuth","datePermission","Confirm","Cancel","Lock","unLock","canUploadDoc","canReadDoc","docStatus","planedDateEditablePermission","planedDateCancelablePermission","finishedDateEditablePermission","finishedDateCancelablePermission","flagsNumber","flags","docIsFinish","Permission","authNumbers","includes","editable","undefined","confirmedDate","docCNumbers","docRNumbers"],"mappings":"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","sourcesContent":["import { toDoOrDone } from \"js/util\";\r\nimport {\r\n  authorizationC,\r\n  documentAuthorizationC,\r\n  documentAuthorizationR,\r\n} from \"js/publicFn/authUtils\";\r\nconst DateConfirmFlag = (flagNumber) => {\r\n  const permissionObj = {\r\n    CanConfirm: false,\r\n    CanCancel: false,\r\n    CanSetConstraint: false,\r\n    CanDeleteDonstraint: false,\r\n    HasConstraint: false,\r\n    SupervisorActivity: false,\r\n    HideActivity: false,\r\n    PaymentOk: false,\r\n    PaymentNotOk: false,\r\n    ProgressType: false,\r\n  };\r\n  const binFlagNumberOrder = parseInt(flagNumber, 10)\r\n    .toString(2)\r\n    .padStart(10, \"0\")\r\n    .split(\"\")\r\n    .reverse()\r\n    .join(\"\");\r\n  Object.keys(permissionObj).forEach((item, index) => {\r\n    if (binFlagNumberOrder[index] === \"1\") {\r\n      permissionObj[item] = true;\r\n    }\r\n  });\r\n  return permissionObj;\r\n};\r\n\r\nexport const DatePermissionControl = (data, prarms) => {\r\n  const { auth, orderActivities, documentList, templates } = data;\r\n  const { orderNumber, activityNumber, projectNumber } = prarms;\r\n  const role = auth.roles[0];\r\n  const permissions = auth.activityAuth;\r\n  const datePermission = {\r\n    Confirm: false,\r\n    Cancel: false,\r\n    Lock: false,\r\n    unLock: false,\r\n    canUploadDoc: false,\r\n    canReadDoc: false,\r\n    docStatus: \"\",\r\n    planedDateEditablePermission: false,\r\n    planedDateCancelablePermission: false,\r\n    finishedDateEditablePermission: false,\r\n    finishedDateCancelablePermission: false,\r\n  };\r\n\r\n  const flagsNumber =\r\n    orderActivities[`${orderNumber}-${activityNumber}`]?.flags;\r\n\r\n  const docStatus = toDoOrDone(\r\n    projectNumber,\r\n    orderNumber,\r\n    activityNumber,\r\n    templates,\r\n    documentList\r\n  );\r\n\r\n  const docIsFinish = docStatus !== \"ToDo\";\r\n\r\n  const flags = DateConfirmFlag(flagsNumber);\r\n\r\n  if (role === \"admin\") {\r\n    Object.keys(datePermission).forEach((Permission) => {\r\n      if (Permission === \"Confirm\") {\r\n        if (docIsFinish) {\r\n          datePermission[Permission] = true;\r\n        }\r\n      } else {\r\n        datePermission[Permission] = true;\r\n      }\r\n      datePermission[\"docStatus\"] = docStatus;\r\n    });\r\n  } else {\r\n    const authNumbers = authorizationC(\r\n      orderActivities,\r\n      orderNumber,\r\n      permissions,\r\n      role\r\n    );\r\n\r\n    datePermission[\"docStatus\"] = docStatus;\r\n\r\n    if (authNumbers.includes(activityNumber)) {\r\n      if (docIsFinish && flags.CanConfirm) {\r\n        datePermission.Confirm = true;\r\n      }\r\n\r\n      datePermission.Cancel = flags.CanCancel;\r\n      datePermission.Lock = flags.CanSetConstraint;\r\n      datePermission.unLock = flags.CanDeleteDonstraint;\r\n\r\n      datePermission.planedDateEditablePermission = flags.CanSetConstraint;\r\n      datePermission.planedDateCancelablePermission = flags.CanDeleteDonstraint;\r\n      datePermission.finishedDateEditablePermission = flags.CanConfirm;\r\n      datePermission.finishedDateCancelablePermission = flags.CanCancel;\r\n    }\r\n\r\n    if (\r\n      orderActivities[`${orderNumber}-${activityNumber}`].editable !==\r\n        undefined &&\r\n      orderActivities[`${orderNumber}-${activityNumber}`].editable === false\r\n    ) {\r\n      if (\r\n        orderActivities[`${orderNumber}-${activityNumber}`].confirmedDate ===\r\n        null\r\n      ) {\r\n        datePermission.Confirm = true;\r\n        datePermission.Cancel = false;\r\n      } else {\r\n        datePermission.Confirm = false;\r\n        datePermission.Cancel = true;\r\n      }\r\n    }\r\n\r\n    if (!docIsFinish) {\r\n      datePermission.Confirm = false;\r\n    }\r\n\r\n    const docCNumbers = documentAuthorizationC(\r\n      orderActivities,\r\n      orderNumber,\r\n      permissions,\r\n      role\r\n    );\r\n\r\n    if (docCNumbers.includes(activityNumber)) {\r\n      datePermission.canUploadDoc = true;\r\n    }\r\n\r\n    const docRNumbers = documentAuthorizationR(\r\n      orderActivities,\r\n      orderNumber,\r\n      permissions,\r\n      role\r\n    );\r\n\r\n    if (docRNumbers.includes(activityNumber)) {\r\n      datePermission.canReadDoc = true;\r\n    }\r\n\r\n  }\r\n\r\n  return datePermission;\r\n};\r\n"]},"metadata":{},"sourceType":"module"}