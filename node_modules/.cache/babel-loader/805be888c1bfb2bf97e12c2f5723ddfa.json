{"ast":null,"code":"import*as action from\"actions\";import*as api from\"api\";import*as repo from\"js/fetch\";import{saveTheFirstRefreshTime}from\"js/util\";export var setAuth=function setAuth(auth){return{type:\"SET_AUTH\",payload:auth};};export var clearState=function clearState(){return{type:\"USER_LOGOUT\"};};export var login=function login(data){return function(dispatch){dispatch(action.showLoading());return api.login(data).then(function(response){var result=response.data.result;if(result===2){return Promise.reject({message:\"用户名或密码错误\"});}return repo.fetchProfile();}).then(function(data){if(data.isPwdInit){return data;}else{dispatch(action.setAuth(data));window.localStorage.setItem(\"auth\",JSON.stringify(data));saveTheFirstRefreshTime(dispatch);dispatch(action.setHistoryPage(\"loginPage\"));return repo.fetchInstMethods();}}).catch(function(error){window.localStorage.removeItem(\"auth\");dispatch(action.setAuth(null));dispatch(action.setError(error.message));}).finally(function(){dispatch(action.hideLoading());});};};export var logout=function logout(){return function(dispatch){dispatch(action.showLoading());return api.logout().then(function(){window.localStorage.removeItem(\"auth\");dispatch(setAuth(null));dispatch(clearState());}).catch(function(error){dispatch(action.setError(error));}).finally(function(){dispatch(action.hideLoading());});};};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/actions/auth.js"],"names":["action","api","repo","saveTheFirstRefreshTime","setAuth","auth","type","payload","clearState","login","data","dispatch","showLoading","then","response","result","Promise","reject","message","fetchProfile","isPwdInit","window","localStorage","setItem","JSON","stringify","setHistoryPage","fetchInstMethods","catch","error","removeItem","setError","finally","hideLoading","logout"],"mappings":"AAAA,MAAO,GAAKA,CAAAA,MAAZ,KAAwB,SAAxB,CACA,MAAO,GAAKC,CAAAA,GAAZ,KAAqB,KAArB,CACA,MAAO,GAAKC,CAAAA,IAAZ,KAAsB,UAAtB,CACA,OAASC,uBAAT,KAAwC,SAAxC,CAEA,MAAO,IAAMC,CAAAA,OAAO,CAAG,QAAVA,CAAAA,OAAU,CAACC,IAAD,CAAU,CAC/B,MAAO,CAAEC,IAAI,CAAE,UAAR,CAAoBC,OAAO,CAAEF,IAA7B,CAAP,CACD,CAFM,CAIP,MAAO,IAAMG,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,EAAM,CAC9B,MAAO,CAAEF,IAAI,CAAE,aAAR,CAAP,CACD,CAFM,CAIP,MAAO,IAAMG,CAAAA,KAAK,CAAG,QAARA,CAAAA,KAAQ,CAACC,IAAD,QAAU,UAACC,QAAD,CAAc,CAC3CA,QAAQ,CAACX,MAAM,CAACY,WAAP,EAAD,CAAR,CACA,MAAOX,CAAAA,GAAG,CACPQ,KADI,CACEC,IADF,EAEJG,IAFI,CAEC,SAACC,QAAD,CAAc,IACVC,CAAAA,MADU,CACCD,QAAQ,CAACJ,IADV,CACVK,MADU,CAElB,GAAIA,MAAM,GAAK,CAAf,CAAkB,CAChB,MAAOC,CAAAA,OAAO,CAACC,MAAR,CAAe,CAAEC,OAAO,CAAE,UAAX,CAAf,CAAP,CACD,CACD,MAAOhB,CAAAA,IAAI,CAACiB,YAAL,EAAP,CACD,CARI,EASJN,IATI,CASC,SAACH,IAAD,CAAU,CACd,GAAIA,IAAI,CAACU,SAAT,CAAoB,CAClB,MAAOV,CAAAA,IAAP,CACD,CAFD,IAEO,CACLC,QAAQ,CAACX,MAAM,CAACI,OAAP,CAAeM,IAAf,CAAD,CAAR,CACAW,MAAM,CAACC,YAAP,CAAoBC,OAApB,CAA4B,MAA5B,CAAoCC,IAAI,CAACC,SAAL,CAAef,IAAf,CAApC,EACAP,uBAAuB,CAACQ,QAAD,CAAvB,CACAA,QAAQ,CAACX,MAAM,CAAC0B,cAAP,CAAsB,WAAtB,CAAD,CAAR,CACA,MAAOxB,CAAAA,IAAI,CAACyB,gBAAL,EAAP,CACD,CACF,CAnBI,EAoBJC,KApBI,CAoBE,SAACC,KAAD,CAAW,CAChBR,MAAM,CAACC,YAAP,CAAoBQ,UAApB,CAA+B,MAA/B,EACAnB,QAAQ,CAACX,MAAM,CAACI,OAAP,CAAe,IAAf,CAAD,CAAR,CACAO,QAAQ,CAACX,MAAM,CAAC+B,QAAP,CAAgBF,KAAK,CAACX,OAAtB,CAAD,CAAR,CACD,CAxBI,EAyBJc,OAzBI,CAyBI,UAAM,CACbrB,QAAQ,CAACX,MAAM,CAACiC,WAAP,EAAD,CAAR,CACD,CA3BI,CAAP,CA4BD,CA9BoB,EAAd,CAgCP,MAAO,IAAMC,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,SAAM,UAACvB,QAAD,CAAc,CACxCA,QAAQ,CAACX,MAAM,CAACY,WAAP,EAAD,CAAR,CACA,MAAOX,CAAAA,GAAG,CACPiC,MADI,GAEJrB,IAFI,CAEC,UAAM,CACVQ,MAAM,CAACC,YAAP,CAAoBQ,UAApB,CAA+B,MAA/B,EACAnB,QAAQ,CAACP,OAAO,CAAC,IAAD,CAAR,CAAR,CACAO,QAAQ,CAACH,UAAU,EAAX,CAAR,CACD,CANI,EAOJoB,KAPI,CAOE,SAACC,KAAD,CAAW,CAChBlB,QAAQ,CAACX,MAAM,CAAC+B,QAAP,CAAgBF,KAAhB,CAAD,CAAR,CACD,CATI,EAUJG,OAVI,CAUI,UAAM,CACbrB,QAAQ,CAACX,MAAM,CAACiC,WAAP,EAAD,CAAR,CACD,CAZI,CAAP,CAaD,CAfqB,EAAf","sourcesContent":["import * as action from \"actions\";\r\nimport * as api from \"api\";\r\nimport * as repo from \"js/fetch\";\r\nimport { saveTheFirstRefreshTime } from \"js/util\";\r\n\r\nexport const setAuth = (auth) => {\r\n  return { type: \"SET_AUTH\", payload: auth };\r\n};\r\n\r\nexport const clearState = () => {\r\n  return { type: \"USER_LOGOUT\" };\r\n};\r\n\r\nexport const login = (data) => (dispatch) => {\r\n  dispatch(action.showLoading());\r\n  return api\r\n    .login(data)\r\n    .then((response) => {\r\n      const { result } = response.data;\r\n      if (result === 2) {\r\n        return Promise.reject({ message: \"用户名或密码错误\" });\r\n      }\r\n      return repo.fetchProfile();\r\n    })\r\n    .then((data) => {\r\n      if (data.isPwdInit) {\r\n        return data;\r\n      } else {\r\n        dispatch(action.setAuth(data));\r\n        window.localStorage.setItem(\"auth\", JSON.stringify(data));\r\n        saveTheFirstRefreshTime(dispatch);\r\n        dispatch(action.setHistoryPage(\"loginPage\"));\r\n        return repo.fetchInstMethods();\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      window.localStorage.removeItem(\"auth\");\r\n      dispatch(action.setAuth(null));\r\n      dispatch(action.setError(error.message));\r\n    })\r\n    .finally(() => {\r\n      dispatch(action.hideLoading());\r\n    });\r\n};\r\n\r\nexport const logout = () => (dispatch) => {\r\n  dispatch(action.showLoading());\r\n  return api\r\n    .logout()\r\n    .then(() => {\r\n      window.localStorage.removeItem(\"auth\");\r\n      dispatch(setAuth(null));\r\n      dispatch(clearState());\r\n    })\r\n    .catch((error) => {\r\n      dispatch(action.setError(error));\r\n    })\r\n    .finally(() => {\r\n      dispatch(action.hideLoading());\r\n    });\r\n};\r\n"]},"metadata":{},"sourceType":"module"}