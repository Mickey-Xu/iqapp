{"ast":null,"code":"import _slicedToArray from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{Box,FormLabel,makeStyles,Typography}from\"@material-ui/core\";import Compressor from\"compressorjs\";import{LocalizeContext}from\"i18n\";import{fillTextToImg}from\"js/util\";import React,{useRef,useState}from\"react\";import{useParams}from'react-router-dom';var useStyles=makeStyles(function(_ref){var spacing=_ref.spacing;return{btm:{display:\"flex\",justifyContent:\"space-between\",margin:spacing(1,1,0,1)},root:{display:\"grid\",padding:spacing(1,0),borderBottom:\" 1px solid #e0e0e0\",backgroundColor:\"#FFF\"},lable:{margin:spacing(0,0,1,0),color:\"rgba(0, 0, 0, 0.87)\"},inputFile:{width:\"0.1px\",height:\"0.1px\",opacity:0,overflow:\"hidden\",position:\"absolute\",top:\"0\",zIndex:-1},file:{height:\"160px\",position:\"relative\",overflow:\"hidden\",textAlign:\"center\"}};});export var Photo=function Photo(props){var i18n=React.useContext(LocalizeContext);var classes=useStyles();var _useState=useState({width:\"auto\",height:\"100%\"}),_useState2=_slicedToArray(_useState,2),photoStyle=_useState2[0],setPhotoStyle=_useState2[1];var photoEl=useRef(null);var iptRef=useRef(null);var projectData=useParams();var onPhotoChange=function onPhotoChange(e){var fileReader=new FileReader();var file=e.target.files[0];var isCamera=e.target.value.includes('camera');console.log(isCamera?'用户选择了拍照':'用户选择了本地图片');fileReader.onloadend=function(e){var photo=e.target.result;fillTextToImg(photo,projectData).then(function(res){props.onChange(res);});var i=new Image();i.onload=function(){setPhotoStyle({// width: photoEl.current.clientWidth,\n// height: (photoEl.current.clientWidth / i.width) * i.height,\nwidth:\"auto\",height:\"100%\"});};i.src=photo;};if(file){new Compressor(file,{quality:0.2,convertSize:400000,success:function success(result){fileReader.readAsDataURL(result);},error:function error(err){console.log(err.message);}});}else{props.onChange(\"#\");}};return/*#__PURE__*/React.createElement(\"div\",{className:classes.root},/*#__PURE__*/React.createElement(Typography,{variant:\"subtitle2\",className:classes.lable},props.label),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"input\",{className:classes.inputFile,type:\"file\",accept:\"image/x-png,image/jpeg,image/gif\",id:props.id,ref:iptRef,onChange:onPhotoChange})),/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(FormLabel,{required:props.required},/*#__PURE__*/React.createElement(Typography,{component:\"span\",variant:\"subtitle2\",className:classes.lable},props.description))),/*#__PURE__*/React.createElement(Box,{border:1,className:classes.file},/*#__PURE__*/React.createElement(\"img\",{src:props.value,style:photoStyle,ref:photoEl,alt:\"\"})),/*#__PURE__*/React.createElement(Box,{className:classes.btm},/*#__PURE__*/React.createElement(Typography,{color:\"secondary\",variant:\"body2\",onClick:function onClick(){props.onChange(\"#\");iptRef.current.value=\"\";}},i18n.ISNTAPP_DELETE),/*#__PURE__*/React.createElement(\"label\",{htmlFor:props.id},/*#__PURE__*/React.createElement(Typography,{color:\"secondary\",variant:\"body2\"},i18n.ISNTAPP_IMPORT_PICTURES))));};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/components/TemplateForm/Photo/index.js"],"names":["Box","FormLabel","makeStyles","Typography","Compressor","LocalizeContext","fillTextToImg","React","useRef","useState","useParams","useStyles","spacing","btm","display","justifyContent","margin","root","padding","borderBottom","backgroundColor","lable","color","inputFile","width","height","opacity","overflow","position","top","zIndex","file","textAlign","Photo","props","i18n","useContext","classes","photoStyle","setPhotoStyle","photoEl","iptRef","projectData","onPhotoChange","e","fileReader","FileReader","target","files","isCamera","value","includes","console","log","onloadend","photo","result","then","res","onChange","i","Image","onload","src","quality","convertSize","success","readAsDataURL","error","err","message","label","id","required","description","current","ISNTAPP_DELETE","ISNTAPP_IMPORT_PICTURES"],"mappings":"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","sourcesContent":["import { Box, FormLabel, makeStyles, Typography } from \"@material-ui/core\";\r\nimport Compressor from \"compressorjs\";\r\nimport { LocalizeContext } from \"i18n\";\r\nimport { fillTextToImg } from \"js/util\";\r\nimport React, { useRef, useState } from \"react\";\r\nimport { useParams } from 'react-router-dom';\r\n\r\nconst useStyles = makeStyles(({ spacing }) => ({\r\n  btm: {\r\n    display: \"flex\",\r\n    justifyContent: \"space-between\",\r\n    margin: spacing(1, 1, 0, 1),\r\n  },\r\n  root: {\r\n    display: \"grid\",\r\n    padding: spacing(1, 0),\r\n    borderBottom: \" 1px solid #e0e0e0\",\r\n    backgroundColor: \"#FFF\",\r\n  },\r\n  lable: {\r\n    margin: spacing(0, 0, 1, 0),\r\n    color: \"rgba(0, 0, 0, 0.87)\",\r\n  },\r\n  inputFile: {\r\n    width: \"0.1px\",\r\n    height: \"0.1px\",\r\n    opacity: 0,\r\n    overflow: \"hidden\",\r\n    position: \"absolute\",\r\n    top: \"0\",\r\n    zIndex: -1,\r\n  },\r\n  file: {\r\n    height: \"160px\",\r\n    position: \"relative\",\r\n    overflow: \"hidden\",\r\n    textAlign: \"center\",\r\n  },\r\n}));\r\n\r\nexport const Photo = (props) => {\r\n  const i18n = React.useContext(LocalizeContext);\r\n  const classes = useStyles();\r\n  const [photoStyle, setPhotoStyle] = useState({\r\n    width: \"auto\",\r\n    height: \"100%\",\r\n  });\r\n  const photoEl = useRef(null);\r\n  const iptRef = useRef(null);\r\n  const projectData = useParams();\r\n  const onPhotoChange = (e) => {\r\n    const fileReader = new FileReader();\r\n    const file = e.target.files[0];\r\n    const isCamera = e.target.value.includes('camera');\r\n    console.log(isCamera ? '用户选择了拍照' : '用户选择了本地图片');\r\n\r\n    fileReader.onloadend = (e) => {\r\n      const photo = e.target.result;\r\n      fillTextToImg(photo, projectData).then((res) => {\r\n        props.onChange(res);\r\n       })\r\n      const i = new Image();\r\n      i.onload = () => {\r\n        setPhotoStyle({\r\n          // width: photoEl.current.clientWidth,\r\n          // height: (photoEl.current.clientWidth / i.width) * i.height,\r\n          width: \"auto\",\r\n          height: \"100%\",\r\n        });\r\n      };\r\n      i.src = photo;\r\n    };\r\n    if (file) {\r\n      new Compressor(file, {\r\n        quality: 0.2,\r\n        convertSize: 400000,\r\n        success(result) {\r\n          fileReader.readAsDataURL(result);\r\n        },\r\n        error(err) {\r\n          console.log(err.message);\r\n        },\r\n      });\r\n    } else {\r\n      props.onChange(\"#\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Typography variant=\"subtitle2\" className={classes.lable}>\r\n        {props.label}\r\n      </Typography>\r\n      <div>\r\n        <input\r\n          className={classes.inputFile}\r\n          type=\"file\"\r\n          accept=\"image/x-png,image/jpeg,image/gif\"\r\n          id={props.id}\r\n          ref={iptRef}\r\n          onChange={onPhotoChange}\r\n        />\r\n      </div>\r\n      <div>\r\n        {/* <Typography variant=\"body2\">{props.description}</Typography> */}\r\n        <FormLabel required={props.required}>\r\n          <Typography\r\n            component=\"span\"\r\n            variant=\"subtitle2\"\r\n            className={classes.lable}\r\n          >\r\n            {props.description}\r\n          </Typography>\r\n        </FormLabel>\r\n      </div>\r\n      <Box border={1} className={classes.file}>\r\n        <img src={props.value} style={photoStyle} ref={photoEl} alt=\"\" />\r\n      </Box>\r\n      <Box className={classes.btm}>\r\n        <Typography\r\n          color=\"secondary\"\r\n          variant=\"body2\"\r\n          onClick={() => {\r\n            props.onChange(\"#\");\r\n            iptRef.current.value = \"\";\r\n          }}\r\n        >\r\n          {i18n.ISNTAPP_DELETE}\r\n        </Typography>\r\n        <label htmlFor={props.id}>\r\n          <Typography color=\"secondary\" variant=\"body2\">\r\n            {i18n.ISNTAPP_IMPORT_PICTURES}\r\n          </Typography>\r\n        </label>\r\n      </Box>\r\n    </div>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}