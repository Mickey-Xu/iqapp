{"ast":null,"code":"import _objectSpread from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{Box,Button}from\"@material-ui/core\";import{withStyles}from\"@material-ui/core/styles\";import*as action from\"actions\";import ConfirmModal from\"components/ConfirmModal\";import{TitlePage}from\"components/TemplateForm/TitlePage\";import{LocalizeContext}from\"i18n\";import{Base64}from\"js-base64\";import{deserialize,serialize}from\"js/sfdl\";import{componentGenerator,initProps,isVisible,tmplLangMapper}from\"js/templateFormUtil\";import{deleteDraftFromLocal,isFormUpdated,verify,removeNotVisibleFields}from\"js/util\";import PrimaryLayout from\"layouts/PrimaryLayout\";import React,{useEffect,useState}from\"react\";import{connect}from\"react-redux\";import{useHistory,useParams}from\"react-router-dom\";import*as repo from\"js/fetch\";import FilterIcon from\"../../assets/img/filter.png\";import TemplateFilter from\"../../components/TemplateFilter\";var TemplatePage=withStyles(function(_ref){var spacing=_ref.spacing;return{root:{width:\"100%\",fontWeight:500,position:\"fixed\",top:\"54px\",display:\"flex\",justifyContent:\"space-between\",backgroundColor:\" #efe9e9\",borderBottom:\"1px solid #eae9e9\",zIndex:\"1\"},btn:{color:\"#123db5\",textTransform:\"capitalize\",marginRight:spacing(2)},container:{margin:spacing(7,2,0,2)}};})(function(_ref2){var description=_ref2.description,savePDF=_ref2.savePDF,classes=_ref2.classes,formState=_ref2.formState,fieldsState=_ref2.fieldsState,getTemplateForm=_ref2.getTemplateForm,templateFormData=_ref2.templateFormData,initTemplateForm=_ref2.initTemplateForm,storeCurrentParams=_ref2.storeCurrentParams,activityNo=_ref2.activityNo,orderNo=_ref2.orderNo,projectNumber=_ref2.projectNumber,foe=_ref2.fo,region=_ref2.region,branch=_ref2.prctr,saveAndReturn=_ref2.saveAndReturn,removeTemplateState=_ref2.removeTemplateState,productFamily=_ref2.productFamily,productLine=_ref2.productLine,language=_ref2.language;var i18n=React.useContext(LocalizeContext);var _useParams=useParams(),documentNo=_useParams.documentNo,documentPart=_useParams.documentPart;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),initData=_useState2[0],setInitData=_useState2[1];var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),dialog=_React$useState2[0],setDialog=_React$useState2[1];var _React$useState3=React.useState([1]),_React$useState4=_slicedToArray(_React$useState3,2),checked=_React$useState4[0],setChecked=_React$useState4[1];var _useState3=useState({fields:[]}),_useState4=_slicedToArray(_useState3,2),templateForm=_useState4[0],setTemplateForm=_useState4[1];var useInitForm=function useInitForm(){useEffect(function(){getTemplateForm({documentNo:documentNo,documentPart:documentPart},{ProjectNo:projectNumber,orderNo:orderNo,activityNo:activityNo,description:description,branch:branch,foe:foe,region:region},{activityNo:activityNo,productFamily:productFamily,productLine:productLine,language:language}).then(function(res){initTemplateForm(documentNo,documentPart,activityNo,productFamily,productLine,language,res.value,{orderNo:orderNo}).then(function(data){setInitData(data);});if(res.code===2){alert(\"模板有更新，之前草稿已被清理\");deleteDraftFromLocal({documentNo:documentNo,documentPart:documentPart});}});storeCurrentParams({documentNo:documentNo,documentPart:documentPart,activityNo:activityNo,productFamily:productFamily,productLine:productLine,language:language});},[]);};useInitForm();var history=useHistory();var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),open=_useState6[0],setOpen=_useState6[1];var closeMenu=function closeMenu(){removeTemplateState(documentNo,documentPart,activityNo,productFamily,productLine,language);history.goBack();setOpen(false);};var submit=function submit(e){var result=verify(templateFormData.fields);if(result){var data={projectNo:projectNumber,orderNo:orderNo,activityNo:activityNo,description:description,branch:branch,foe:foe,region:region,override:true,form:Base64.encode(serialize(removeNotVisibleFields(templateFormData)))};var draftData={projectNo:projectNumber,orderNo:orderNo,activityNo:activityNo,description:description,branch:branch,foe:foe,region:region,form:Base64.encode(serialize(templateFormData))};savePDF(data,draftData,{documentNo:documentNo,documentPart:documentPart,activityNo:activityNo,productFamily:productFamily,productLine:productLine,language:language});}};var goBack=function goBack(){if(isFormUpdated(templateFormData,deserialize(Base64.decode(initData)))){setOpen(true);}else{removeTemplateState(documentNo,documentPart,activityNo,productFamily,productLine,language);history.goBack();}};var saveDraft=function saveDraft(type){setOpen(false);var data={projectNo:projectNumber,orderNo:orderNo,activityNo:activityNo,description:description,branch:branch,foe:foe,region:region,form:Base64.encode(serialize(templateFormData))};var currentParams={documentNo:documentNo,documentPart:documentPart};if(type===\"save\"){saveAndReturn(data,currentParams,{productFamily:productFamily,productLine:productLine,language:language}).then(function(){setInitData(data.form);alert(\"草稿保存成功\");});}else{saveAndReturn(data,currentParams,{productFamily:productFamily,productLine:productLine,language:language}).then(function(){history.goBack();removeTemplateState(documentNo,documentPart,activityNo,productFamily,productLine,language);});}};var handleToggle=function handleToggle(value){return function(){var currentIndex=checked.indexOf(value);var newChecked=_toConsumableArray(checked);if(currentIndex===-1){newChecked.push(value);}else{newChecked.splice(currentIndex,1);}setChecked(newChecked);};};var confirmFilter=function confirmFilter(){if(checked.length>1){var checkedId=[];checked.forEach(function(item){return(item===null||item===void 0?void 0:item.id)&&checkedId.push(item.id);});var fields=[];checkedId.forEach(function(item){templateFormData[\"fields\"].forEach(function(field){field.settings.tagRules.forEach(function(tagRule){item===tagRule.tagId&&fields.push(field);});});});console.log(fields);setTemplateForm(_objectSpread(_objectSpread({},templateFormData),{},{fields:fields}));}else{setTemplateForm(templateFormData);}setDialog(false);};return/*#__PURE__*/React.createElement(PrimaryLayout,{title:i18n.ISNTAPP_TEMPLATE,isDirectReturn:false,isFetchAll:false,goBack:goBack},/*#__PURE__*/React.createElement(Box,{className:classes.root},(templateFormData===null||templateFormData===void 0?void 0:templateFormData.form[\"settings\"][\"tagUniverse\"].length)>0?/*#__PURE__*/React.createElement(Button,{onClick:function onClick(){return setDialog(true);}},/*#__PURE__*/React.createElement(\"img\",{src:FilterIcon,alt:\"\"})):/*#__PURE__*/React.createElement(Box,null),/*#__PURE__*/React.createElement(Box,null,/*#__PURE__*/React.createElement(Button,{className:classes.btn,onClick:function onClick(){return saveDraft(\"save\");}},i18n.ISNTAPP_SAVE_AS_PDF),/*#__PURE__*/React.createElement(Button,{className:classes.btn,onClick:function onClick(){return submit();}},i18n.ISNTAPP_TEMPLATE_UPLOAD))),/*#__PURE__*/React.createElement(Box,{className:classes.container},/*#__PURE__*/React.createElement(TitlePage,formState),(checked.length>1?templateForm[\"fields\"]:fieldsState).map(function(field){return isVisible(field)?componentGenerator(field,initProps(field,language)):null;})),/*#__PURE__*/React.createElement(ConfirmModal,{open:open,onClose:closeMenu,handleClick:function handleClick(){return saveDraft();}},i18n.INSTALLATION_DO_YOU_WANGT_TO_SAVE_THE_DRAFT),/*#__PURE__*/React.createElement(TemplateFilter,{templateForm:templateFormData,open:dialog,setOpen:setDialog,handleToggle:handleToggle,checked:checked,confirmFilter:confirmFilter}));});var mapStateToProps=function mapStateToProps(_ref3,ownProps){var _templates$activityNo;var templateForm=_ref3.templateForm,templates=_ref3.templates,orders=_ref3.orders;var _ownProps$match$param=ownProps.match.params,activityNo=_ownProps$match$param.activityNo,documentPart=_ownProps$match$param.documentPart,orderNo=_ownProps$match$param.orderNo,projectNumber=_ownProps$match$param.projectNumber,documentNo=_ownProps$match$param.documentNo,productFamily=_ownProps$match$param.productFamily,productLine=_ownProps$match$param.productLine,language=_ownProps$match$param.language;var key=documentNo+\"-\"+documentPart+\"-\"+activityNo+\"-\"+productFamily+\"-\"+productLine+\"-\"+language;var formState={};var fieldsState=[];if(templateForm[key]){var _templateForm$key$for,_templateForm$key$for2,_templateForm$key$for3,_templateForm$key$for4,_templateForm$key$for5,_templateForm$key$for6,_templateForm$key$for7,_templateForm$key$for8;formState={title:((_templateForm$key$for=templateForm[key].form)===null||_templateForm$key$for===void 0?void 0:_templateForm$key$for.settings.titleI18n[tmplLangMapper[language]])?(_templateForm$key$for2=templateForm[key].form)===null||_templateForm$key$for2===void 0?void 0:_templateForm$key$for2.settings.titleI18n[tmplLangMapper[language]]:(_templateForm$key$for3=templateForm[key].form)===null||_templateForm$key$for3===void 0?void 0:_templateForm$key$for3.settings.titleI18n.English,description:((_templateForm$key$for4=templateForm[key].form)===null||_templateForm$key$for4===void 0?void 0:_templateForm$key$for4.settings.descriptionI18n[tmplLangMapper[language]])?(_templateForm$key$for5=templateForm[key].form)===null||_templateForm$key$for5===void 0?void 0:_templateForm$key$for5.settings.descriptionI18n[tmplLangMapper[language]]:(_templateForm$key$for6=templateForm[key].form)===null||_templateForm$key$for6===void 0?void 0:_templateForm$key$for6.settings.descriptionI18n.English,logos:(_templateForm$key$for7=templateForm[key].form)===null||_templateForm$key$for7===void 0?void 0:_templateForm$key$for7.settings.logos,identifier:(_templateForm$key$for8=templateForm[key].form)===null||_templateForm$key$for8===void 0?void 0:_templateForm$key$for8.settings.identifier};fieldsState=templateForm[key].fields;}var templateFormData=templateForm[key];var description=(_templates$activityNo=templates[activityNo])===null||_templates$activityNo===void 0?void 0:_templates$activityNo.find(function(item){return item.documentPart===documentPart&&item.documentNo===documentNo&&item.productFamily===(productFamily===\"null\"?null:productFamily)&&item.productLine===(productLine===\"null\"?null:productLine)&&item.language===language;}).documentDescription;var order=orders===null||orders===void 0?void 0:orders[orderNo];return{formState:formState,fieldsState:fieldsState,templateFormData:templateFormData,activityNo:activityNo,orderNo:orderNo,projectNumber:projectNumber,description:description,fo:order===null||order===void 0?void 0:order.fo,region:order===null||order===void 0?void 0:order.region,prctr:order===null||order===void 0?void 0:order.prctr,productFamily:productFamily,productLine:productLine,language:language};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{storeCurrentParams:function storeCurrentParams(param){dispatch(action.storeCurrentParams(param));},getTemplateForm:function getTemplateForm(param,draftParam,expendParam){dispatch(action.fetchAll(repo.type.CACHE));return dispatch(action.fetchTemplateForm(param,draftParam,expendParam));},initTemplateForm:function initTemplateForm(documentNo,documentPart,activityNo,productFamily,productLine,language,data,routeParams){return dispatch(action.initTemplateForm(documentNo,documentPart,activityNo,productFamily,productLine,language,data,routeParams));},savePDF:function savePDF(data,draftData,param){dispatch(action.uploadDocumentForm(data,draftData,param));},saveAndReturn:function saveAndReturn(data,currentParams,extendParam){return dispatch(action.saveDraft(data,currentParams,extendParam));},removeTemplateState:function removeTemplateState(documentNo,documentPart,activityNo,productFamily,productLine,language){dispatch(action.removeTemplateFormState({documentNo:documentNo,documentPart:documentPart,activityNo:activityNo,productFamily:productFamily,productLine:productLine,language:language}));}};};export default connect(mapStateToProps,mapDispatchToProps)(TemplatePage);","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/pages/TemplatePage/index.js"],"names":["Box","Button","withStyles","action","ConfirmModal","TitlePage","LocalizeContext","Base64","deserialize","serialize","componentGenerator","initProps","isVisible","tmplLangMapper","deleteDraftFromLocal","isFormUpdated","verify","removeNotVisibleFields","PrimaryLayout","React","useEffect","useState","connect","useHistory","useParams","repo","FilterIcon","TemplateFilter","TemplatePage","spacing","root","width","fontWeight","position","top","display","justifyContent","backgroundColor","borderBottom","zIndex","btn","color","textTransform","marginRight","container","margin","description","savePDF","classes","formState","fieldsState","getTemplateForm","templateFormData","initTemplateForm","storeCurrentParams","activityNo","orderNo","projectNumber","foe","fo","region","branch","prctr","saveAndReturn","removeTemplateState","productFamily","productLine","language","i18n","useContext","documentNo","documentPart","initData","setInitData","dialog","setDialog","checked","setChecked","fields","templateForm","setTemplateForm","useInitForm","ProjectNo","then","res","value","data","code","alert","history","open","setOpen","closeMenu","goBack","submit","e","result","projectNo","override","form","encode","draftData","decode","saveDraft","type","currentParams","handleToggle","currentIndex","indexOf","newChecked","push","splice","confirmFilter","length","checkedId","forEach","item","id","field","settings","tagRules","tagRule","tagId","console","log","ISNTAPP_TEMPLATE","ISNTAPP_SAVE_AS_PDF","ISNTAPP_TEMPLATE_UPLOAD","map","INSTALLATION_DO_YOU_WANGT_TO_SAVE_THE_DRAFT","mapStateToProps","ownProps","templates","orders","match","params","key","title","titleI18n","English","descriptionI18n","logos","identifier","find","documentDescription","order","mapDispatchToProps","dispatch","param","draftParam","expendParam","fetchAll","CACHE","fetchTemplateForm","routeParams","uploadDocumentForm","extendParam","removeTemplateFormState"],"mappings":"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","sourcesContent":["import { Box, Button } from \"@material-ui/core\";\r\nimport { withStyles } from \"@material-ui/core/styles\";\r\nimport * as action from \"actions\";\r\nimport ConfirmModal from \"components/ConfirmModal\";\r\nimport { TitlePage } from \"components/TemplateForm/TitlePage\";\r\nimport { LocalizeContext } from \"i18n\";\r\nimport { Base64 } from \"js-base64\";\r\nimport { deserialize, serialize } from \"js/sfdl\";\r\nimport {\r\n  componentGenerator,\r\n  initProps,\r\n  isVisible,\r\n  tmplLangMapper,\r\n} from \"js/templateFormUtil\";\r\nimport {\r\n  deleteDraftFromLocal,\r\n  isFormUpdated,\r\n  verify,\r\n  removeNotVisibleFields,\r\n} from \"js/util\";\r\nimport PrimaryLayout from \"layouts/PrimaryLayout\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { useHistory, useParams } from \"react-router-dom\";\r\nimport * as repo from \"js/fetch\";\r\nimport FilterIcon from \"../../assets/img/filter.png\";\r\nimport TemplateFilter from \"../../components/TemplateFilter\"\r\n\r\nconst TemplatePage = withStyles(({ spacing }) => {\r\n  return {\r\n    root: {\r\n      width: \"100%\",\r\n      fontWeight: 500,\r\n      position: \"fixed\",\r\n      top: \"54px\",\r\n      display: \"flex\",\r\n      justifyContent: \"space-between\",\r\n      backgroundColor: \" #efe9e9\",\r\n      borderBottom: \"1px solid #eae9e9\",\r\n      zIndex: \"1\",\r\n    },\r\n    btn: {\r\n      color: \"#123db5\",\r\n      textTransform: \"capitalize\",\r\n      marginRight: spacing(2),\r\n    },\r\n    container: {\r\n      margin: spacing(7, 2, 0, 2),\r\n    },\r\n  };\r\n})(\r\n  ({\r\n    description,\r\n    savePDF,\r\n    classes,\r\n    formState,\r\n    fieldsState,\r\n    getTemplateForm,\r\n    templateFormData,\r\n    initTemplateForm,\r\n    storeCurrentParams,\r\n    activityNo,\r\n    orderNo,\r\n    projectNumber,\r\n    fo: foe,\r\n    region,\r\n    prctr: branch,\r\n    saveAndReturn,\r\n    removeTemplateState,\r\n    productFamily,\r\n    productLine,\r\n    language,\r\n  }) => {\r\n    const i18n = React.useContext(LocalizeContext);\r\n    let { documentNo, documentPart } = useParams();\r\n    const [initData, setInitData] = useState(null);\r\n    const [dialog, setDialog] = React.useState(false);\r\n    const [checked, setChecked] = React.useState([1]);\r\n    const [templateForm, setTemplateForm] = useState({ fields:[]});\r\n\r\n    const useInitForm = () => {\r\n      useEffect(() => {\r\n        getTemplateForm(\r\n          {\r\n            documentNo,\r\n            documentPart,\r\n          },\r\n          {\r\n            ProjectNo: projectNumber,\r\n            orderNo,\r\n            activityNo,\r\n            description,\r\n            branch,\r\n            foe,\r\n            region,\r\n          },\r\n          {\r\n            activityNo,\r\n            productFamily,\r\n            productLine,\r\n            language,\r\n          }\r\n        ).then((res) => {\r\n          initTemplateForm(\r\n            documentNo,\r\n            documentPart,\r\n            activityNo,\r\n            productFamily,\r\n            productLine,\r\n            language,\r\n            res.value,\r\n            { orderNo }\r\n          ).then((data) => {\r\n            setInitData(data);\r\n          });\r\n          if (res.code === 2) {\r\n            alert(\"模板有更新，之前草稿已被清理\");\r\n            deleteDraftFromLocal({\r\n              documentNo,\r\n              documentPart,\r\n            });\r\n          }\r\n        });\r\n\r\n        storeCurrentParams({\r\n          documentNo,\r\n          documentPart,\r\n          activityNo,\r\n          productFamily,\r\n          productLine,\r\n          language,\r\n        });\r\n      }, []);\r\n    };\r\n\r\n    useInitForm();\r\n\r\n    const history = useHistory();\r\n    const [open, setOpen] = useState(false);\r\n\r\n    const closeMenu = () => {\r\n      removeTemplateState(\r\n        documentNo,\r\n        documentPart,\r\n        activityNo,\r\n        productFamily,\r\n        productLine,\r\n        language\r\n      );\r\n      history.goBack();\r\n      setOpen(false);\r\n    };\r\n\r\n    const submit = (e) => {\r\n      const result = verify(templateFormData.fields);\r\n      if (result) {\r\n        let data = {\r\n          projectNo: projectNumber,\r\n          orderNo: orderNo,\r\n          activityNo: activityNo,\r\n          description: description,\r\n          branch,\r\n          foe,\r\n          region,\r\n          override: true,\r\n          form: Base64.encode(\r\n            serialize(removeNotVisibleFields(templateFormData))\r\n          ),\r\n        };\r\n        let draftData = {\r\n          projectNo: projectNumber,\r\n          orderNo: orderNo,\r\n          activityNo: activityNo,\r\n          description: description,\r\n          branch: branch,\r\n          foe: foe,\r\n          region: region,\r\n          form: Base64.encode(serialize(templateFormData)),\r\n        };\r\n        savePDF(data, draftData, {\r\n          documentNo,\r\n          documentPart,\r\n          activityNo,\r\n          productFamily,\r\n          productLine,\r\n          language,\r\n        });\r\n      }\r\n    };\r\n\r\n    const goBack = () => {\r\n      if (\r\n        isFormUpdated(templateFormData, deserialize(Base64.decode(initData)))\r\n      ) {\r\n        setOpen(true);\r\n      } else {\r\n        removeTemplateState(\r\n          documentNo,\r\n          documentPart,\r\n          activityNo,\r\n          productFamily,\r\n          productLine,\r\n          language\r\n        );\r\n        history.goBack();\r\n      }\r\n    };\r\n\r\n    const saveDraft = (type) => {\r\n      setOpen(false);\r\n      let data = {\r\n        projectNo: projectNumber,\r\n        orderNo: orderNo,\r\n        activityNo: activityNo,\r\n        description: description,\r\n        branch: branch,\r\n        foe: foe,\r\n        region: region,\r\n        form: Base64.encode(serialize(templateFormData)),\r\n      };\r\n\r\n      const currentParams = {\r\n        documentNo,\r\n        documentPart,\r\n      };\r\n\r\n      if (type === \"save\") {\r\n        saveAndReturn(data, currentParams, {\r\n          productFamily,\r\n          productLine,\r\n          language,\r\n        }).then(() => {\r\n          setInitData(data.form);\r\n          alert(\"草稿保存成功\");\r\n        });\r\n      } else {\r\n        saveAndReturn(data, currentParams, {\r\n          productFamily,\r\n          productLine,\r\n          language,\r\n        }).then(() => {\r\n          history.goBack();\r\n          removeTemplateState(\r\n            documentNo,\r\n            documentPart,\r\n            activityNo,\r\n            productFamily,\r\n            productLine,\r\n            language\r\n          );\r\n        });\r\n      }\r\n    };\r\n\r\n    const handleToggle = (value) => () => {\r\n      const currentIndex = checked.indexOf(value);\r\n      const newChecked = [...checked];\r\n      if (currentIndex === -1) {\r\n        newChecked.push(value);\r\n      } else {\r\n        newChecked.splice(currentIndex, 1);\r\n      }\r\n      setChecked(newChecked);\r\n    };\r\n\r\n    const confirmFilter = () => {      \r\n      if (checked.length > 1) {\r\n        const checkedId = [];\r\n        checked.forEach((item) => item?.id && checkedId.push(item.id))\r\n        const fields = []\r\n        checkedId.forEach(item => {\r\n          templateFormData[\"fields\"].forEach((field) => {\r\n            field.settings.tagRules.forEach((tagRule) => {\r\n              item === tagRule.tagId && fields.push(field)\r\n            })\r\n          })\r\n        });\r\n        console.log(fields)\r\n        setTemplateForm({ ...templateFormData, fields: fields })\r\n      } else {\r\n        setTemplateForm(templateFormData)\r\n      }\r\n      setDialog(false)\r\n    }\r\n\r\n    return (\r\n      <PrimaryLayout\r\n        title={i18n.ISNTAPP_TEMPLATE}\r\n        isDirectReturn={false}\r\n        isFetchAll={false}\r\n        goBack={goBack}\r\n      >\r\n        <Box className={classes.root}>\r\n          {templateFormData?.form[\"settings\"][\"tagUniverse\"].length > 0 ? <Button\r\n            onClick={() => setDialog(true)}\r\n          >\r\n            <img src={FilterIcon} alt=\"\" />\r\n          </Button>:<Box></Box>}\r\n          <Box>\r\n            <Button className={classes.btn} onClick={() => saveDraft(\"save\")}>\r\n              {i18n.ISNTAPP_SAVE_AS_PDF}\r\n            </Button>\r\n            <Button className={classes.btn} onClick={() => submit()}>\r\n              {i18n.ISNTAPP_TEMPLATE_UPLOAD}\r\n            </Button>\r\n            </Box>\r\n        </Box>\r\n        <Box className={classes.container}>\r\n          <TitlePage {...formState} />\r\n          {(checked.length > 1 ? templateForm[\"fields\"] : fieldsState).map((field) => {\r\n            return isVisible(field)\r\n              ? componentGenerator(field, initProps(field, language))\r\n              : null;\r\n          })}\r\n        </Box>\r\n        <ConfirmModal\r\n          open={open}\r\n          onClose={closeMenu}\r\n          handleClick={() => saveDraft()}\r\n        >\r\n          {i18n.INSTALLATION_DO_YOU_WANGT_TO_SAVE_THE_DRAFT}\r\n        </ConfirmModal>\r\n        <TemplateFilter\r\n          templateForm={templateFormData}\r\n          open={dialog}\r\n          setOpen={setDialog}\r\n          handleToggle={handleToggle}\r\n          checked={checked}\r\n          confirmFilter={confirmFilter}\r\n        />\r\n      </PrimaryLayout>\r\n    );\r\n  }\r\n);\r\n\r\nconst mapStateToProps = ({ templateForm, templates, orders }, ownProps) => {\r\n  let {\r\n    activityNo,\r\n    documentPart,\r\n    orderNo,\r\n    projectNumber,\r\n    documentNo,\r\n    productFamily,\r\n    productLine,\r\n    language,\r\n  } = ownProps.match.params;\r\n\r\n  const key =\r\n    documentNo +\r\n    \"-\" +\r\n    documentPart +\r\n    \"-\" +\r\n    activityNo +\r\n    \"-\" +\r\n    productFamily +\r\n    \"-\" +\r\n    productLine +\r\n    \"-\" +\r\n    language;\r\n\r\n  let formState = {};\r\n  let fieldsState = [];\r\n  if (templateForm[key]) {\r\n    formState = {\r\n      title: templateForm[key].form?.settings.titleI18n[\r\n        tmplLangMapper[language]\r\n      ]\r\n        ? templateForm[key].form?.settings.titleI18n[tmplLangMapper[language]]\r\n        : templateForm[key].form?.settings.titleI18n.English,\r\n      description: templateForm[key].form?.settings.descriptionI18n[\r\n        tmplLangMapper[language]\r\n      ]\r\n        ? templateForm[key].form?.settings.descriptionI18n[\r\n            tmplLangMapper[language]\r\n          ]\r\n        : templateForm[key].form?.settings.descriptionI18n.English,\r\n      logos: templateForm[key].form?.settings.logos,\r\n      identifier: templateForm[key].form?.settings.identifier,\r\n    };\r\n    fieldsState = templateForm[key].fields;\r\n  }\r\n\r\n  let templateFormData = templateForm[key];\r\n\r\n  let description = templates[activityNo]?.find(\r\n    (item) =>\r\n      item.documentPart === documentPart &&\r\n      item.documentNo === documentNo &&\r\n      item.productFamily ===\r\n        (productFamily === \"null\" ? null : productFamily) &&\r\n      item.productLine === (productLine === \"null\" ? null : productLine) &&\r\n      item.language === language\r\n  ).documentDescription;\r\n  let order = orders?.[orderNo];\r\n  return {\r\n    formState,\r\n    fieldsState,\r\n    templateFormData,\r\n    activityNo,\r\n    orderNo,\r\n    projectNumber,\r\n    description,\r\n    fo: order?.fo,\r\n    region: order?.region,\r\n    prctr: order?.prctr,\r\n    productFamily,\r\n    productLine,\r\n    language,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    storeCurrentParams: (param) => {\r\n      dispatch(action.storeCurrentParams(param));\r\n    },\r\n    getTemplateForm: (param, draftParam, expendParam) => {\r\n      dispatch(action.fetchAll(repo.type.CACHE));\r\n      return dispatch(action.fetchTemplateForm(param, draftParam, expendParam));\r\n    },\r\n    initTemplateForm: (\r\n      documentNo,\r\n      documentPart,\r\n      activityNo,\r\n      productFamily,\r\n      productLine,\r\n      language,\r\n      data,\r\n      routeParams\r\n    ) => {\r\n      return dispatch(\r\n        action.initTemplateForm(\r\n          documentNo,\r\n          documentPart,\r\n          activityNo,\r\n          productFamily,\r\n          productLine,\r\n          language,\r\n          data,\r\n          routeParams\r\n        )\r\n      );\r\n    },\r\n    savePDF: (data, draftData, param) => {\r\n      dispatch(action.uploadDocumentForm(data, draftData, param));\r\n    },\r\n    saveAndReturn: (data, currentParams, extendParam) => {\r\n      return dispatch(action.saveDraft(data, currentParams, extendParam));\r\n    },\r\n    removeTemplateState: (\r\n      documentNo,\r\n      documentPart,\r\n      activityNo,\r\n      productFamily,\r\n      productLine,\r\n      language\r\n    ) => {\r\n      dispatch(\r\n        action.removeTemplateFormState({\r\n          documentNo,\r\n          documentPart,\r\n          activityNo,\r\n          productFamily,\r\n          productLine,\r\n          language,\r\n        })\r\n      );\r\n    },\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TemplatePage);\r\n"]},"metadata":{},"sourceType":"module"}