{"ast":null,"code":"import*as action from\"actions\";import*as api from\"api\";import{db}from\"js/db\";import*as schema from\"js/schema\";import{currentRefreshTime,orderActivitiesSort,templatesConverter,getNonConformityConfig}from\"js/util\";import{normalize}from\"normalizr\";import*as repo from\"js/fetch\";export var setAllDataRefreshTime=function setAllDataRefreshTime(data){return{type:\"SET_ALL_DATA_REFRESH_TIME\",payload:data};};var setRequestStatus=function setRequestStatus(name,loading){return{type:\"SET_REQUEST_STATUS\",payload:{name:name,loading:loading}};};export var closeLoading=function closeLoading(name){return setRequestStatus(name,\"loaded\");};export var openLoading=function openLoading(name){return setRequestStatus(name,\"loading\");};export var closeLoadingShowFailInfo=function closeLoadingShowFailInfo(name){return setRequestStatus(name,\"failToLoad\");};export var fetchOrders=function fetchOrders(request,type,userInfo){return function(dispatch){dispatch(action.openLoading(\"masterData\"));//设置loading\napi.fetchMasterData((userInfo===null||userInfo===void 0?void 0:userInfo.pNumber)?userInfo:{}).then(function(response){var _normalize=normalize(response.data,schema.masterData),entities=_normalize.entities;entities[\"nonConformityConfig\"]=getNonConformityConfig();db.cache.put({id:\"masterData\",data:entities}).then(function(){db.cache.get(\"dataRefreshTime\").then(function(cache){var datatime=cache.data;datatime[\"masterDataRefreshTime\"]=currentRefreshTime();db.cache.put({id:\"dataRefreshTime\",data:datatime}).then(function(){dispatch(action.setAllDataRefreshTime(datatime));});});});var projects=entities.workCenters?Object.keys(entities.workCenters):[];dispatch(action.openLoading(\"ordersData\"));api.fetchOrdersDataByProjectsAndMerge(projects,1,userInfo).then(function(response){var data=response;data.orderActivities=orderActivitiesSort(data.orderActivities);var _normalize2=normalize(response,schema.ordersData),entities=_normalize2.entities;db.cache.put({id:\"ordersData\",data:entities}).then(function(){var param={projectNos:projects};if(userInfo===null||userInfo===void 0?void 0:userInfo.pNumber){param[\"pNumber\"]=userInfo.pNumber;}repo.fetchLocalInstallationStepsConfirmDate(param).then(function(){db.cache.get(\"dataRefreshTime\").then(function(cache){var datatime=cache.data;datatime[\"orderDataRefreshTime\"]=currentRefreshTime();db.cache.put({id:\"dataRefreshTime\",data:datatime}).then(function(){dispatch(action.setAllDataRefreshTime(datatime));type===\"all\"&&dispatch(action.fetchDocuments(request,userInfo,dispatch));});});});});}).finally(function(){dispatch(action.closeLoading(\"ordersData\"));}).catch(function(error){dispatch(action.closeLoadingShowFailInfo(\"ordersData\"));dispatch(action.setError(error.message));return false;});}).finally(function(){db.cache.put({id:\"dataVersion\",data:\"lastVersion\"});dispatch(action.closeLoading(\"masterData\"));}).catch(function(error){dispatch(action.closeLoadingShowFailInfo(\"masterData\"));dispatch(action.setError(error.message));return false;});};};export var fetchDocuments=function fetchDocuments(request,userInfo){return function(dispatch){dispatch(action.openLoading(\"document\"));//设置loading\napi.getDocumentList(request).then(function(response){return db.cache.put({id:\"documentList\",data:response.data}).then(function(){db.cache.get(\"dataRefreshTime\").then(function(cache){var datatime=cache.data;datatime[\"documentListDataRefreshTime\"]=currentRefreshTime();db.cache.put({id:\"dataRefreshTime\",data:datatime}).then(function(){dispatch(action.setAllDataRefreshTime(datatime));});});});}).finally(function(){dispatch(action.closeLoading(\"document\"));}).catch(function(error){dispatch(action.closeLoadingShowFailInfo(\"document\"));dispatch(action.setError(error.message));return false;});dispatch(action.openLoading(\"templateList\"));//设置loading\napi.fetchTemplatesData((userInfo===null||userInfo===void 0?void 0:userInfo.pNumber)?userInfo:{}).then(function(response){var data=templatesConverter(response.data);db.cache.put({id:\"templatesData\",data:data}).then(function(){db.cache.get(\"dataRefreshTime\").then(function(cache){var datatime=cache.data;datatime[\"templateListDataRefreshTime\"]=currentRefreshTime();db.cache.put({id:\"dataRefreshTime\",data:datatime}).then(function(){dispatch(action.setAllDataRefreshTime(datatime));});});});}).finally(function(){dispatch(action.closeLoading(\"templateList\"));}).catch(function(error){dispatch(action.closeLoadingShowFailInfo(\"templateList\"));dispatch(action.setError(error.message));return false;});};};export var fetchTasksList=function fetchTasksList(userInfo){return function(dispatch){console.log(userInfo);// return false\ndispatch(action.openLoading(\"taskList\"));//设置loading\napi.fetchTasks((userInfo===null||userInfo===void 0?void 0:userInfo.pNumber)?userInfo:{}).then(function(response){return db.cache.put({id:\"tasks\",data:response.data}).then(function(){db.cache.get(\"dataRefreshTime\").then(function(cache){var datatime=cache.data;datatime[\"taskListDataRefreshTime\"]=currentRefreshTime();db.cache.put({id:\"dataRefreshTime\",data:datatime}).then(function(){dispatch(action.setAllDataRefreshTime(datatime));});});});}).finally(function(){dispatch(action.closeLoading(\"taskList\"));}).catch(function(error){dispatch(action.closeLoadingShowFailInfo(\"taskList\"));dispatch(action.setError(error.message));return false;});};};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/actions/refreshTime.js"],"names":["action","api","db","schema","currentRefreshTime","orderActivitiesSort","templatesConverter","getNonConformityConfig","normalize","repo","setAllDataRefreshTime","data","type","payload","setRequestStatus","name","loading","closeLoading","openLoading","closeLoadingShowFailInfo","fetchOrders","request","userInfo","dispatch","fetchMasterData","pNumber","then","response","masterData","entities","cache","put","id","get","datatime","projects","workCenters","Object","keys","fetchOrdersDataByProjectsAndMerge","orderActivities","ordersData","param","projectNos","fetchLocalInstallationStepsConfirmDate","fetchDocuments","finally","catch","error","setError","message","getDocumentList","fetchTemplatesData","fetchTasksList","console","log","fetchTasks"],"mappings":"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","sourcesContent":["import * as action from \"actions\";\r\nimport * as api from \"api\";\r\nimport { db } from \"js/db\";\r\nimport * as schema from \"js/schema\";\r\nimport {\r\n  currentRefreshTime,\r\n  orderActivitiesSort,\r\n  templatesConverter,\r\n  getNonConformityConfig\r\n} from \"js/util\";\r\nimport { normalize } from \"normalizr\";\r\nimport * as repo from \"js/fetch\";\r\n\r\nexport const setAllDataRefreshTime = (data) => ({\r\n  type: \"SET_ALL_DATA_REFRESH_TIME\",\r\n  payload: data,\r\n});\r\n\r\nconst setRequestStatus = (name, loading) => {\r\n  return { type: \"SET_REQUEST_STATUS\", payload: { name, loading } };\r\n};\r\n\r\nexport const closeLoading = (name) => setRequestStatus(name, \"loaded\");\r\n\r\nexport const openLoading = (name) => setRequestStatus(name, \"loading\");\r\n\r\nexport const closeLoadingShowFailInfo = (name) =>\r\n  setRequestStatus(name, \"failToLoad\");\r\n\r\nexport const fetchOrders = (request, type, userInfo) => (dispatch) => {\r\n  dispatch(action.openLoading(\"masterData\")); //设置loading\r\n  api\r\n    .fetchMasterData(userInfo?.pNumber ? userInfo : {})\r\n    .then((response) => {\r\n      const { entities } = normalize(response.data, schema.masterData);\r\n      entities[\"nonConformityConfig\"] = getNonConformityConfig()\r\n      db.cache.put({ id: \"masterData\", data: entities }).then(() => {\r\n        db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n          const datatime = cache.data;\r\n          datatime[\"masterDataRefreshTime\"] = currentRefreshTime();\r\n          db.cache.put({ id: \"dataRefreshTime\", data: datatime }).then(() => {\r\n            dispatch(action.setAllDataRefreshTime(datatime));\r\n          });\r\n        });\r\n      });\r\n\r\n      let projects = entities.workCenters\r\n        ? Object.keys(entities.workCenters)\r\n        : [];\r\n      dispatch(action.openLoading(\"ordersData\"));\r\n      api\r\n        .fetchOrdersDataByProjectsAndMerge(projects, 1, userInfo)\r\n        .then((response) => {\r\n          const data = response;\r\n          data.orderActivities = orderActivitiesSort(data.orderActivities);\r\n          const { entities } = normalize(response, schema.ordersData);\r\n          db.cache.put({ id: \"ordersData\", data: entities }).then(() => {\r\n            const param = { projectNos: projects }\r\n            if (userInfo?.pNumber) {\r\n              param[\"pNumber\"] = userInfo.pNumber\r\n            }\r\n            repo\r\n              .fetchLocalInstallationStepsConfirmDate(param)\r\n              .then(() => {\r\n                db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n                  const datatime = cache.data;\r\n                  datatime[\"orderDataRefreshTime\"] = currentRefreshTime();\r\n                  db.cache\r\n                    .put({ id: \"dataRefreshTime\", data: datatime })\r\n                    .then(() => {\r\n                      dispatch(action.setAllDataRefreshTime(datatime));\r\n                      type === \"all\" &&\r\n                        dispatch(action.fetchDocuments(request, userInfo, dispatch));\r\n                    });\r\n                });\r\n              });\r\n          });\r\n        })\r\n        .finally(() => {\r\n          dispatch(action.closeLoading(\"ordersData\"));\r\n        })\r\n        .catch((error) => {\r\n          dispatch(action.closeLoadingShowFailInfo(\"ordersData\"));\r\n          dispatch(action.setError(error.message));\r\n          return false;\r\n        });\r\n    })\r\n    .finally(() => {\r\n      db.cache.put({ id: \"dataVersion\", data: \"lastVersion\" })\r\n      dispatch(action.closeLoading(\"masterData\"));\r\n    })\r\n    .catch((error) => {\r\n      dispatch(action.closeLoadingShowFailInfo(\"masterData\"));\r\n      dispatch(action.setError(error.message));\r\n      return false;\r\n    });\r\n};\r\n\r\nexport const fetchDocuments = (request, userInfo) => (dispatch) => {\r\n  dispatch(action.openLoading(\"document\")); //设置loading\r\n  api\r\n    .getDocumentList(request)\r\n    .then((response) => {\r\n      return db.cache\r\n        .put({ id: \"documentList\", data: response.data })\r\n        .then(() => {\r\n          db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n            const datatime = cache.data;\r\n            datatime[\"documentListDataRefreshTime\"] = currentRefreshTime();\r\n            db.cache.put({ id: \"dataRefreshTime\", data: datatime }).then(() => {\r\n              dispatch(action.setAllDataRefreshTime(datatime));\r\n            });\r\n          });\r\n        });\r\n    })\r\n    .finally(() => {\r\n      dispatch(action.closeLoading(\"document\"));\r\n    })\r\n    .catch((error) => {\r\n      dispatch(action.closeLoadingShowFailInfo(\"document\"));\r\n      dispatch(action.setError(error.message));\r\n      return false;\r\n    });\r\n\r\n  dispatch(action.openLoading(\"templateList\")); //设置loading\r\n  api\r\n    .fetchTemplatesData(userInfo?.pNumber ? userInfo : {})\r\n    .then((response) => {\r\n      const data = templatesConverter(response.data);\r\n      db.cache.put({ id: \"templatesData\", data: data }).then(() => {\r\n        db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n          const datatime = cache.data;\r\n          datatime[\"templateListDataRefreshTime\"] = currentRefreshTime();\r\n          db.cache.put({ id: \"dataRefreshTime\", data: datatime }).then(() => {\r\n            dispatch(action.setAllDataRefreshTime(datatime));\r\n          });\r\n        });\r\n      });\r\n    })\r\n\r\n    .finally(() => {\r\n      dispatch(action.closeLoading(\"templateList\"));\r\n    })\r\n    .catch((error) => {\r\n      dispatch(action.closeLoadingShowFailInfo(\"templateList\"));\r\n      dispatch(action.setError(error.message));\r\n      return false;\r\n    });\r\n};\r\n\r\nexport const fetchTasksList = (userInfo) => (dispatch) => {\r\n  console.log(userInfo)\r\n  // return false\r\n  dispatch(action.openLoading(\"taskList\")); //设置loading\r\n  api\r\n    .fetchTasks(userInfo?.pNumber ? userInfo : {})\r\n    .then((response) => {\r\n      return db.cache.put({ id: \"tasks\", data: response.data }).then(() => {\r\n        db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n          const datatime = cache.data;\r\n          datatime[\"taskListDataRefreshTime\"] = currentRefreshTime();\r\n          db.cache.put({ id: \"dataRefreshTime\", data: datatime }).then(() => {\r\n            dispatch(action.setAllDataRefreshTime(datatime));\r\n          });\r\n        });\r\n      });\r\n    })\r\n    .finally(() => {\r\n      dispatch(action.closeLoading(\"taskList\"));\r\n    })\r\n    .catch((error) => {\r\n      dispatch(action.closeLoadingShowFailInfo(\"taskList\"));\r\n      dispatch(action.setError(error.message));\r\n      return false;\r\n    });\r\n};\r\n"]},"metadata":{},"sourceType":"module"}