{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\src\\\\components\\\\TemplateForm\\\\Photo\\\\index.js\";\nimport { Box, FormLabel, makeStyles, Typography } from \"@material-ui/core\";\nimport Compressor from \"compressorjs\";\nimport { LocalizeContext } from \"i18n\";\nimport { fillTextToImg } from \"js/util\";\nimport { useParams } from 'react-router-dom';\nimport React, { useRef, useState, useEffect } from 'react';\nconst useStyles = makeStyles(({\n  spacing\n}) => ({\n  btm: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    margin: spacing(1, 1, 0, 1)\n  },\n  root: {\n    display: \"grid\",\n    padding: spacing(1, 0),\n    borderBottom: \" 1px solid #e0e0e0\",\n    backgroundColor: \"#FFF\"\n  },\n  lable: {\n    margin: spacing(0, 0, 1, 0),\n    color: \"rgba(0, 0, 0, 0.87)\"\n  },\n  inputFile: {\n    width: \"0.1px\",\n    height: \"0.1px\",\n    opacity: 0,\n    overflow: \"hidden\",\n    position: \"absolute\",\n    top: \"0\",\n    zIndex: -1\n  },\n  file: {\n    height: \"160px\",\n    position: \"relative\",\n    overflow: \"hidden\",\n    textAlign: \"center\"\n  }\n}));\nexport const Photo = props => {\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [imageSrc, setImageSrc] = useState(null);\n  const [isCameraActive, setIsCameraActive] = useState(false);\n\n  const startCamera = async () => {\n    if (videoRef.current) {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: true\n      });\n      videoRef.current.srcObject = stream;\n      videoRef.current.play();\n      setIsCameraActive(true);\n    } else {\n      console.error(\"Video element not found\");\n    }\n  };\n\n  const captureImage = () => {\n    const canvas = canvasRef.current;\n    const context = canvas.getContext('2d');\n    const video = videoRef.current;\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\n    const base64 = canvas.toDataURL('image/png');\n    setImageSrc(base64);\n    stopCamera();\n  };\n\n  const stopCamera = () => {\n    const stream = videoRef.current.srcObject;\n\n    if (stream) {\n      stream.getTracks().forEach(track => track.stop());\n    }\n\n    videoRef.current.srcObject = null;\n    setIsCameraActive(false);\n  };\n\n  useEffect(() => {\n    if (isCameraActive) {\n      const canvas = canvasRef.current;\n      canvas.width = videoRef.current.videoWidth;\n      canvas.height = videoRef.current.videoHeight;\n    }\n  }, [isCameraActive]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      textAlign: 'center'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    onClick: startCamera,\n    style: {\n      marginBottom: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 7\n    }\n  }, \"\\u542F\\u52A8\\u6444\\u50CF\\u5934\"), isCameraActive ? /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      position: 'relative',\n      display: 'inline-block'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 91,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    ref: videoRef,\n    style: {\n      width: '300px',\n      height: 'auto',\n      border: '2px solid #fff'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      position: 'absolute',\n      top: '20%',\n      left: '10%',\n      width: '80%',\n      height: '60%',\n      border: '2px dashed #ff0000',\n      pointerEvents: 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"button\", {\n    onClick: captureImage,\n    style: {\n      marginTop: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 11\n    }\n  }, \"\\u62CD\\u7167\"), /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 11\n    }\n  })) : imageSrc ? /*#__PURE__*/React.createElement(\"img\", {\n    src: imageSrc,\n    alt: \"\\u9884\\u89C8\",\n    style: {\n      maxWidth: '100%',\n      marginTop: '10px'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 9\n    }\n  }) : null);\n};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/components/TemplateForm/Photo/index.js"],"names":["Box","FormLabel","makeStyles","Typography","Compressor","LocalizeContext","fillTextToImg","useParams","React","useRef","useState","useEffect","useStyles","spacing","btm","display","justifyContent","margin","root","padding","borderBottom","backgroundColor","lable","color","inputFile","width","height","opacity","overflow","position","top","zIndex","file","textAlign","Photo","props","videoRef","canvasRef","imageSrc","setImageSrc","isCameraActive","setIsCameraActive","startCamera","current","stream","navigator","mediaDevices","getUserMedia","video","srcObject","play","console","error","captureImage","canvas","context","getContext","drawImage","base64","toDataURL","stopCamera","getTracks","forEach","track","stop","videoWidth","videoHeight","marginBottom","border","left","pointerEvents","marginTop","maxWidth"],"mappings":"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","sourcesContent":["import { Box, FormLabel, makeStyles, Typography } from \"@material-ui/core\";\r\nimport Compressor from \"compressorjs\";\r\nimport { LocalizeContext } from \"i18n\";\r\nimport { fillTextToImg } from \"js/util\";\r\nimport { useParams } from 'react-router-dom';\r\nimport React, { useRef, useState, useEffect } from 'react';\r\n\r\nconst useStyles = makeStyles(({ spacing }) => ({\r\n  btm: {\r\n    display: \"flex\",\r\n    justifyContent: \"space-between\",\r\n    margin: spacing(1, 1, 0, 1),\r\n  },\r\n  root: {\r\n    display: \"grid\",\r\n    padding: spacing(1, 0),\r\n    borderBottom: \" 1px solid #e0e0e0\",\r\n    backgroundColor: \"#FFF\",\r\n  },\r\n  lable: {\r\n    margin: spacing(0, 0, 1, 0),\r\n    color: \"rgba(0, 0, 0, 0.87)\",\r\n  },\r\n  inputFile: {\r\n    width: \"0.1px\",\r\n    height: \"0.1px\",\r\n    opacity: 0,\r\n    overflow: \"hidden\",\r\n    position: \"absolute\",\r\n    top: \"0\",\r\n    zIndex: -1,\r\n  },\r\n  file: {\r\n    height: \"160px\",\r\n    position: \"relative\",\r\n    overflow: \"hidden\",\r\n    textAlign: \"center\",\r\n  },\r\n}));\r\n\r\nexport const Photo = (props) => {\r\n  const videoRef = useRef(null);\r\n  const canvasRef = useRef(null);\r\n  const [imageSrc, setImageSrc] = useState(null);\r\n  const [isCameraActive, setIsCameraActive] = useState(false);\r\n\r\n  const startCamera = async () => {\r\n    if (videoRef.current) {\r\n      const stream = await navigator.mediaDevices.getUserMedia({ video: true });\r\n      videoRef.current.srcObject = stream;\r\n      videoRef.current.play();\r\n      setIsCameraActive(true);\r\n    } else {\r\n      console.error(\"Video element not found\");\r\n    }\r\n  };\r\n\r\n  const captureImage = () => {\r\n    const canvas = canvasRef.current;\r\n    const context = canvas.getContext('2d');\r\n    const video = videoRef.current;\r\n    context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n    const base64 = canvas.toDataURL('image/png');\r\n    setImageSrc(base64);\r\n    stopCamera();\r\n  };\r\n\r\n  const stopCamera = () => {\r\n    const stream = videoRef.current.srcObject;\r\n    if (stream) {\r\n      stream.getTracks().forEach(track => track.stop());\r\n    }\r\n    videoRef.current.srcObject = null;\r\n    setIsCameraActive(false);\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (isCameraActive) {\r\n      const canvas = canvasRef.current;\r\n      canvas.width = videoRef.current.videoWidth;\r\n      canvas.height = videoRef.current.videoHeight;\r\n    }\r\n  }, [isCameraActive]);\r\n\r\n  return (\r\n    <div style={{ textAlign: 'center' }}>\r\n      <button onClick={startCamera} style={{ marginBottom: '10px' }}>\r\n        启动摄像头\r\n      </button>\r\n      {isCameraActive ? (\r\n        <div style={{ position: 'relative', display: 'inline-block' }}>\r\n          <video ref={videoRef} style={{ width: '300px', height: 'auto', border: '2px solid #fff' }} />\r\n          <div\r\n            style={{\r\n              position: 'absolute',\r\n              top: '20%',\r\n              left: '10%',\r\n              width: '80%',\r\n              height: '60%',\r\n              border: '2px dashed #ff0000',\r\n              pointerEvents: 'none'\r\n            }}\r\n          />\r\n          <button onClick={captureImage} style={{ marginTop: '10px' }}>\r\n            拍照\r\n          </button>\r\n          <canvas ref={canvasRef} style={{ display: 'none' }} />\r\n        </div>\r\n      ) : imageSrc ? (\r\n        <img src={imageSrc} alt=\"预览\" style={{ maxWidth: '100%', marginTop: '10px' }} />\r\n      ) : null}\r\n    </div>)\r\n  \r\n  \r\n};\r\n"]},"metadata":{},"sourceType":"module"}