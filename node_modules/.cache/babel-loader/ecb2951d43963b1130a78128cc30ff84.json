{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\src\\\\components\\\\OrderActivityListCard\\\\index.js\";\nimport { Box, Button, Card, CardActions, CardContent, Grid, Typography, withStyles } from \"@material-ui/core\";\nimport { CancelOutlined, CheckCircleOutlineOutlined, DescriptionOutlined, EventAvailableOutlined, EventNoteOutlined // LockOpenOutlined,\n// LockOutlined,\n, ScheduleOutlined } from \"@material-ui/icons\";\nimport { LocalizeContext } from \"i18n\";\nimport { isInstallationStep } from \"js/installationStep\";\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport { useHistory } from \"react-router-dom\";\nimport { toDoOrDone, verifyWhenConfirm7020or70C0, checkFileIsExisting, getTemplateList } from \"../../js/util\";\nimport * as action from \"actions\";\nconst OrderActivityListCard = withStyles(({\n  spacing\n}) => {\n  return {\n    button: {\n      borderRadius: spacing(2.5),\n      textTransform: \"capitalize\",\n      lineHeight: \"unset\",\n      fontSize: \"0.5rem\",\n      padding: \"2px 14px\"\n    },\n    card: {\n      marginTop: spacing(2) // borderTopStyle: \"solid\",\n      // borderTopColor: \"#ff0000\",\n\n    },\n    cardActions: {\n      marginLeft: \"0px\"\n    },\n    label: {\n      whiteSpace: \"nowrap\"\n    }\n  };\n})(({\n  classes,\n  data,\n  document,\n  handleClickOpen,\n  tabType,\n  orderActivities,\n  documentList,\n  orders,\n  templates,\n  fetchNoConformityList\n}) => {\n  // console.log(data);\n  const i18n = React.useContext(LocalizeContext);\n  const root = \"listCard\";\n  const history = useHistory();\n  const action = [// {\n  //   label: i18n.ORDERDETAILS_LOCK,\n  //   name: \"Lock\",\n  //   component: (auth) => (\n  //     <LockOutlined\n  //       color={auth.isExecutable.Lock ? \"action\" : \"disabled\"}\n  //       onClick={() =>\n  //         handleClickOpen(\n  //           \"lock\",\n  //           data.activityNumber,\n  //           (tabType ? data.activityNumber : data.stepNumber) +\n  //             \" \" +\n  //             data.descriptionShort\n  //         )\n  //       }\n  //     />\n  //   ),\n  // },\n  // {\n  //   label: i18n.ORDERDETAILS_UNLOCK,\n  //   name: \"unLock\",\n  //   component: (auth) => (\n  //     <LockOpenOutlined\n  //       color={auth.isExecutable.unLock ? \"action\" : \"disabled\"}\n  //       onClick={() =>\n  //         handleClickOpen(\n  //           \"unlock\",\n  //           data.activityNumber,\n  //           (tabType ? data.activityNumber : data.stepNumber) +\n  //             \" \" +\n  //             data.descriptionShort\n  //         )\n  //       }\n  //     />\n  //   ),\n  // },\n  {\n    label: i18n.GENERAL_CONFIRM,\n    name: \"Confirm\",\n    component: auth => /*#__PURE__*/React.createElement(CheckCircleOutlineOutlined, {\n      color: auth.isExecutable.Confirm ? \"action\" : \"disabled\",\n      onClick: () => {\n        const result = verifyWhenConfirm7020or70C0(orderActivities, data.orderNumber, data.activityNumber);\n\n        if (result) {\n          alert(result.stepNo + result.message);\n          return;\n        }\n\n        const templateDataList = getTemplateList(templates[data.activityNumber] || [], orders[data.orderNumber].productLine, orders[data.orderNumber].productFamily, orders[data.orderNumber].productCategory);\n        const param = templateDataList.map(item => {\n          return {\n            foe: orders[data.orderNumber].fo,\n            region: orders[data.orderNumber].region,\n            branch: orders[data.orderNumber].prctr,\n            ProjectNo: orders[data.orderNumber].projectNumber,\n            OrderNo: data.orderNumber,\n            ActivityNo: data.activityNumber,\n            Description: item.documentDescription\n          };\n        });\n        checkFileIsExisting(templates, data, orders).then(message => {\n          if (message.length < 1) {\n            param.map(item => fetchNoConformityList(item).then(res => {\n              var _res$data, _res$data$0$nonConfor;\n\n              const foundItems = (_res$data = res.data) === null || _res$data === void 0 ? void 0 : (_res$data$0$nonConfor = _res$data[0].nonConformities) === null || _res$data$0$nonConfor === void 0 ? void 0 : _res$data$0$nonConfor.flatMap(key => key.nonConformityItems.filter(subItem => subItem.questionType === \"Triangle\" && subItem.itemValue === \"no\"));\n\n              if (foundItems.length > 0) {\n                alert(`您有${foundItems.length}个三角项检查项未关闭，请关闭三角项后再确认节点`);\n                return false;\n              }\n\n              ;\n            }));\n            handleClickOpen(\"confirm\", data.activityNumber, (tabType ? data.activityNumber : data.stepNumber) + \" \" + data.description);\n          } else {\n            alert(`请上传 ${message.toString()}`);\n          }\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 11\n      }\n    })\n  }, {\n    label: i18n.GENERAL_CANCEL,\n    name: \"Cancel\",\n    component: auth => /*#__PURE__*/React.createElement(CancelOutlined, {\n      color: auth.isExecutable.Cancel ? \"action\" : \"disabled\",\n      onClick: () => handleClickOpen(\"cancel\", data.activityNumber, (tabType ? data.activityNumber : data.stepNumber) + \" \" + data.description),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 11\n      }\n    })\n  }, {\n    label: document === \"Done\" ? i18n.ISNTAPP_JOBLIST_DOC_DONE : document === \"ToDo\" ? i18n.ISNTAPP_JOBLIST_DOC_TODO : i18n.ISNTAPP_WITHOUT_TEMPLATES,\n    name: \"Document\",\n    component: () => /*#__PURE__*/React.createElement(DescriptionOutlined, {\n      style: {\n        margin: \"auto\"\n      },\n      color: document === \"Done\" || document === \"ToDo\" ? \"action\" : \"disabled\",\n      onClick: () => {\n        history.push(`/documents/${data.activityNumber}/${data.orderNumber}/${data.productFamily}/${root}`);\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205,\n        columnNumber: 11\n      }\n    })\n  }];\n  return /*#__PURE__*/React.createElement(Card, {\n    className: classes.card,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(CardContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    disabled: true,\n    variant: \"contained\",\n    style: {\n      backgroundColor: data.isExecutable.Confirm ? \"#8bc34a\" : \"\",\n      color: data.isExecutable.Confirm ? \"white\" : \"black\"\n    },\n    classes: {\n      root: classes.button\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 223,\n      columnNumber: 11\n    }\n  }, data.info, \" \", data.hint && i18n.ISNTAPP_NO_PERMISSION), /*#__PURE__*/React.createElement(Box, {\n    mt: 2,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 234,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Box, {\n    style: {\n      display: \"inline-flex\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 235,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(ScheduleOutlined, {\n    color: \"action\",\n    style: {\n      fontSize: \"1.4rem\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 236,\n      columnNumber: 15\n    }\n  }), /*#__PURE__*/React.createElement(Typography, {\n    variant: \"body1\",\n    fontWeight: 500,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 237,\n      columnNumber: 15\n    }\n  }, !isInstallationStep(data.activityNumber) ? i18n.JOBLIST_ACTIVITY : i18n.ISNTAPP_JOBLIST_INST_STEPS, \": \", data.activityNumber + \" \" + data.description))), /*#__PURE__*/React.createElement(Box, {\n    mt: 1.5,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 245,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    container: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    style: {\n      display: \"inline-flex\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(EventNoteOutlined, {\n    style: {\n      fontSize: \"1.05rem\"\n    },\n    color: \"action\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Typography, {\n    variant: \"caption\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 252,\n      columnNumber: 17\n    }\n  }, i18n.PROJECTLIST_PLANNED_FINISH, \": \", data.leadingDate)), /*#__PURE__*/React.createElement(Grid, {\n    item: true,\n    xs: 6,\n    style: {\n      display: \"inline-flex\",\n      justifyContent: \"flex-start\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 256,\n      columnNumber: 15\n    }\n  }, /*#__PURE__*/React.createElement(EventAvailableOutlined, {\n    style: {\n      fontSize: \"1.05rem\"\n    },\n    color: \"action\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Typography, {\n    variant: \"caption\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 17\n    }\n  }, i18n.PROJECTLIST_CONFIRMED_FINISH, \": \", data.confirmedDate))))), /*#__PURE__*/React.createElement(CardActions, {\n    style: {\n      backgroundColor: \"#f5f5f5\",\n      overflow: \"auto\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 275,\n      columnNumber: 9\n    }\n  }, action.map((item, index) => {\n    const Component = item.component;\n    let disabled = false;\n\n    if (item.name === \"Lock\") {\n      disabled = !data.isExecutable.Lock;\n    }\n\n    if (item.name === \"unLock\") {\n      disabled = !data.isExecutable.unLock;\n    }\n\n    if (item.name === \"Confirm\") {\n      disabled = !data.isExecutable.Confirm;\n    }\n\n    if (item.name === \"Cancel\") {\n      disabled = !data.isExecutable.Cancel;\n    }\n\n    if (item.name === \"Document\") {\n      disabled = !((document === \"ToDo\" || document === \"Done\") && data.isExecutable.canReadDoc);\n    }\n\n    return /*#__PURE__*/React.createElement(Button, {\n      size: \"small\",\n      key: index // disabled={disabled}\n      ,\n      style: {\n        display: \"inline-grid\",\n        flex: \"auto\",\n        marginLeft: \"0px\"\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 15\n      }\n    }, /*#__PURE__*/React.createElement(Component, {\n      isExecutable: data.isExecutable,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 314,\n        columnNumber: 17\n      }\n    }), /*#__PURE__*/React.createElement(Typography, {\n      variant: \"caption\",\n      className: classes.label,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 315,\n        columnNumber: 17\n      }\n    }, item.label));\n  })));\n});\nexport default connect(({\n  templates = [],\n  documentList,\n  orders,\n  orderActivities\n}, {\n  data: {\n    activityNumber: activityNo,\n    orderNumber\n  }\n}) => {\n  var _orders$orderNumber;\n\n  const projectNumber = (_orders$orderNumber = orders[orderNumber]) === null || _orders$orderNumber === void 0 ? void 0 : _orders$orderNumber.projectNumber;\n  const document = toDoOrDone(projectNumber, orderNumber, activityNo, templates, documentList);\n  return {\n    document,\n    orderActivities,\n    documentList,\n    orders,\n    templates\n  };\n}, dispatch => {\n  return {\n    fetchNoConformityList: data => {\n      return dispatch(action.getNoConformityList(data));\n    }\n  };\n})(OrderActivityListCard);","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/components/OrderActivityListCard/index.js"],"names":["Box","Button","Card","CardActions","CardContent","Grid","Typography","withStyles","CancelOutlined","CheckCircleOutlineOutlined","DescriptionOutlined","EventAvailableOutlined","EventNoteOutlined","ScheduleOutlined","LocalizeContext","isInstallationStep","React","connect","useHistory","toDoOrDone","verifyWhenConfirm7020or70C0","checkFileIsExisting","getTemplateList","action","OrderActivityListCard","spacing","button","borderRadius","textTransform","lineHeight","fontSize","padding","card","marginTop","cardActions","marginLeft","label","whiteSpace","classes","data","document","handleClickOpen","tabType","orderActivities","documentList","orders","templates","fetchNoConformityList","i18n","useContext","root","history","GENERAL_CONFIRM","name","component","auth","isExecutable","Confirm","result","orderNumber","activityNumber","alert","stepNo","message","templateDataList","productLine","productFamily","productCategory","param","map","item","foe","fo","region","branch","prctr","ProjectNo","projectNumber","OrderNo","ActivityNo","Description","documentDescription","then","length","res","foundItems","nonConformities","flatMap","key","nonConformityItems","filter","subItem","questionType","itemValue","stepNumber","description","toString","GENERAL_CANCEL","Cancel","ISNTAPP_JOBLIST_DOC_DONE","ISNTAPP_JOBLIST_DOC_TODO","ISNTAPP_WITHOUT_TEMPLATES","margin","push","backgroundColor","color","info","hint","ISNTAPP_NO_PERMISSION","display","JOBLIST_ACTIVITY","ISNTAPP_JOBLIST_INST_STEPS","PROJECTLIST_PLANNED_FINISH","leadingDate","justifyContent","PROJECTLIST_CONFIRMED_FINISH","confirmedDate","overflow","index","Component","disabled","Lock","unLock","canReadDoc","flex","activityNo","dispatch","getNoConformityList"],"mappings":"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","sourcesContent":["import {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  CardActions,\r\n  CardContent,\r\n  Grid,\r\n  Typography,\r\n  withStyles,\r\n} from \"@material-ui/core\";\r\nimport {\r\n  CancelOutlined,\r\n  CheckCircleOutlineOutlined,\r\n  DescriptionOutlined,\r\n  EventAvailableOutlined,\r\n  EventNoteOutlined,\r\n  // LockOpenOutlined,\r\n  // LockOutlined,\r\n  ScheduleOutlined,\r\n} from \"@material-ui/icons\";\r\nimport { LocalizeContext } from \"i18n\";\r\nimport { isInstallationStep } from \"js/installationStep\";\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport {\r\n  toDoOrDone,\r\n  verifyWhenConfirm7020or70C0,\r\n  checkFileIsExisting,\r\n  getTemplateList\r\n} from \"../../js/util\";\r\nimport * as action from \"actions\";\r\n\r\nconst OrderActivityListCard = withStyles(({ spacing }) => {\r\n  return {\r\n    button: {\r\n      borderRadius: spacing(2.5),\r\n      textTransform: \"capitalize\",\r\n      lineHeight: \"unset\",\r\n      fontSize: \"0.5rem\",\r\n      padding: \"2px 14px\",\r\n    },\r\n    card: {\r\n      marginTop: spacing(2),\r\n      // borderTopStyle: \"solid\",\r\n      // borderTopColor: \"#ff0000\",\r\n    },\r\n    cardActions: {\r\n      marginLeft: \"0px\",\r\n    },\r\n    label: {\r\n      whiteSpace: \"nowrap\",\r\n    },\r\n  };\r\n})(\r\n  ({\r\n    classes,\r\n    data,\r\n    document,\r\n    handleClickOpen,\r\n    tabType,\r\n    orderActivities,\r\n    documentList,\r\n    orders,\r\n    templates,\r\n    fetchNoConformityList\r\n  }) => {\r\n    // console.log(data);\r\n    const i18n = React.useContext(LocalizeContext);\r\n    const root = \"listCard\";\r\n    const history = useHistory();\r\n    const action = [\r\n      // {\r\n      //   label: i18n.ORDERDETAILS_LOCK,\r\n      //   name: \"Lock\",\r\n      //   component: (auth) => (\r\n      //     <LockOutlined\r\n      //       color={auth.isExecutable.Lock ? \"action\" : \"disabled\"}\r\n      //       onClick={() =>\r\n      //         handleClickOpen(\r\n      //           \"lock\",\r\n      //           data.activityNumber,\r\n      //           (tabType ? data.activityNumber : data.stepNumber) +\r\n      //             \" \" +\r\n      //             data.descriptionShort\r\n      //         )\r\n      //       }\r\n      //     />\r\n      //   ),\r\n      // },\r\n      // {\r\n      //   label: i18n.ORDERDETAILS_UNLOCK,\r\n      //   name: \"unLock\",\r\n      //   component: (auth) => (\r\n      //     <LockOpenOutlined\r\n      //       color={auth.isExecutable.unLock ? \"action\" : \"disabled\"}\r\n      //       onClick={() =>\r\n      //         handleClickOpen(\r\n      //           \"unlock\",\r\n      //           data.activityNumber,\r\n      //           (tabType ? data.activityNumber : data.stepNumber) +\r\n      //             \" \" +\r\n      //             data.descriptionShort\r\n      //         )\r\n      //       }\r\n      //     />\r\n      //   ),\r\n      // },\r\n      {\r\n        label: i18n.GENERAL_CONFIRM,\r\n        name: \"Confirm\",\r\n        component: (auth) => (\r\n          <CheckCircleOutlineOutlined\r\n            color={auth.isExecutable.Confirm ? \"action\" : \"disabled\"}\r\n            onClick={() => {\r\n              const result = verifyWhenConfirm7020or70C0(\r\n                orderActivities,\r\n                data.orderNumber,\r\n                data.activityNumber\r\n              );\r\n              if (result) {\r\n                alert(result.stepNo + result.message);\r\n                return;\r\n              }\r\n\r\n\r\n\r\n              const templateDataList = getTemplateList(\r\n                templates[data.activityNumber] || [],\r\n                orders[data.orderNumber].productLine,\r\n                orders[data.orderNumber].productFamily,\r\n                orders[data.orderNumber].productCategory\r\n              );\r\n\r\n              const param = templateDataList.map((item) => {\r\n                return {\r\n                  foe: orders[data.orderNumber].fo,\r\n                  region: orders[data.orderNumber].region,\r\n                  branch: orders[data.orderNumber].prctr,\r\n                  ProjectNo: orders[data.orderNumber].projectNumber,\r\n                  OrderNo: data.orderNumber,\r\n                  ActivityNo: data.activityNumber,\r\n                  Description: item.documentDescription,\r\n                };\r\n              });\r\n\r\n              checkFileIsExisting(templates, data, orders).then((message) => {\r\n                if (message.length < 1) {\r\n                  param.map(item =>\r\n                    fetchNoConformityList(item).then((res) => {\r\n                      const foundItems = res.data?.[0].nonConformities?.flatMap(key =>\r\n                        key.nonConformityItems.filter(\r\n                          subItem => subItem.questionType === \"Triangle\" && subItem.itemValue === \"no\"\r\n                        )\r\n                      );\r\n\r\n                      if (foundItems.length > 0) {\r\n                        alert(`您有${foundItems.length}个三角项检查项未关闭，请关闭三角项后再确认节点`);\r\n                        return false;\r\n                      };\r\n                    })\r\n                  )\r\n                  handleClickOpen(\r\n                    \"confirm\",\r\n                    data.activityNumber,\r\n                    (tabType ? data.activityNumber : data.stepNumber) +\r\n                    \" \" +\r\n                    data.description\r\n                  );\r\n                } else {\r\n                  alert(`请上传 ${message.toString()}`);\r\n                }\r\n              });\r\n            }}\r\n          />\r\n        ),\r\n      },\r\n      {\r\n        label: i18n.GENERAL_CANCEL,\r\n        name: \"Cancel\",\r\n        component: (auth) => (\r\n          <CancelOutlined\r\n            color={auth.isExecutable.Cancel ? \"action\" : \"disabled\"}\r\n            onClick={() =>\r\n              handleClickOpen(\r\n                \"cancel\",\r\n                data.activityNumber,\r\n                (tabType ? data.activityNumber : data.stepNumber) +\r\n                \" \" +\r\n                data.description\r\n              )\r\n            }\r\n          />\r\n        ),\r\n      },\r\n      {\r\n        label:\r\n          document === \"Done\"\r\n            ? i18n.ISNTAPP_JOBLIST_DOC_DONE\r\n            : document === \"ToDo\"\r\n              ? i18n.ISNTAPP_JOBLIST_DOC_TODO\r\n              : i18n.ISNTAPP_WITHOUT_TEMPLATES,\r\n        name: \"Document\",\r\n        component: () => (\r\n          <DescriptionOutlined\r\n            style={{ margin: \"auto\" }}\r\n            color={\r\n              document === \"Done\" || document === \"ToDo\" ? \"action\" : \"disabled\"\r\n            }\r\n            onClick={() => {\r\n              history.push(\r\n                `/documents/${data.activityNumber}/${data.orderNumber}/${data.productFamily}/${root}`\r\n              );\r\n            }}\r\n          />\r\n        ),\r\n      },\r\n    ];\r\n\r\n    return (\r\n      <Card className={classes.card}>\r\n        <CardContent>\r\n          <Button\r\n            disabled\r\n            variant=\"contained\"\r\n            style={{\r\n              backgroundColor: data.isExecutable.Confirm ? \"#8bc34a\" : \"\",\r\n              color: data.isExecutable.Confirm ? \"white\" : \"black\",\r\n            }}\r\n            classes={{ root: classes.button }}\r\n          >\r\n            {data.info} {data.hint && i18n.ISNTAPP_NO_PERMISSION}\r\n          </Button>\r\n          <Box mt={2}>\r\n            <Box style={{ display: \"inline-flex\" }}>\r\n              <ScheduleOutlined color=\"action\" style={{ fontSize: \"1.4rem\" }} />\r\n              <Typography variant=\"body1\" fontWeight={500}>\r\n                {!isInstallationStep(data.activityNumber)\r\n                  ? i18n.JOBLIST_ACTIVITY\r\n                  : i18n.ISNTAPP_JOBLIST_INST_STEPS}\r\n                : {data.activityNumber + \" \" + data.description}\r\n              </Typography>\r\n            </Box>\r\n          </Box>\r\n          <Box mt={1.5}>\r\n            <Grid container>\r\n              <Grid item xs={6} style={{ display: \"inline-flex\" }}>\r\n                <EventNoteOutlined\r\n                  style={{ fontSize: \"1.05rem\" }}\r\n                  color=\"action\"\r\n                />\r\n                <Typography variant=\"caption\">\r\n                  {i18n.PROJECTLIST_PLANNED_FINISH}: {data.leadingDate}\r\n                </Typography>\r\n              </Grid>\r\n              <Grid\r\n                item\r\n                xs={6}\r\n                style={{\r\n                  display: \"inline-flex\",\r\n                  justifyContent: \"flex-start\",\r\n                }}\r\n              >\r\n                <EventAvailableOutlined\r\n                  style={{ fontSize: \"1.05rem\" }}\r\n                  color=\"action\"\r\n                />\r\n                <Typography variant=\"caption\">\r\n                  {i18n.PROJECTLIST_CONFIRMED_FINISH}: {data.confirmedDate}\r\n                </Typography>\r\n              </Grid>\r\n            </Grid>\r\n          </Box>\r\n        </CardContent>\r\n        <CardActions style={{ backgroundColor: \"#f5f5f5\", overflow: \"auto\" }}>\r\n          {action.map((item, index) => {\r\n            const Component = item.component;\r\n            let disabled = false;\r\n\r\n            if (item.name === \"Lock\") {\r\n              disabled = !data.isExecutable.Lock;\r\n            }\r\n\r\n            if (item.name === \"unLock\") {\r\n              disabled = !data.isExecutable.unLock;\r\n            }\r\n\r\n            if (item.name === \"Confirm\") {\r\n              disabled = !data.isExecutable.Confirm;\r\n            }\r\n\r\n            if (item.name === \"Cancel\") {\r\n              disabled = !data.isExecutable.Cancel;\r\n            }\r\n\r\n            if (item.name === \"Document\") {\r\n              disabled = !(\r\n                (document === \"ToDo\" || document === \"Done\") &&\r\n                data.isExecutable.canReadDoc\r\n              );\r\n            }\r\n\r\n            return (\r\n              <Button\r\n                size=\"small\"\r\n                key={index}\r\n                // disabled={disabled}\r\n                style={{\r\n                  display: \"inline-grid\",\r\n                  flex: \"auto\",\r\n                  marginLeft: \"0px\",\r\n                }}\r\n              >\r\n                <Component isExecutable={data.isExecutable} />\r\n                <Typography variant=\"caption\" className={classes.label}>\r\n                  {item.label}\r\n                </Typography>\r\n              </Button>\r\n            );\r\n          })}\r\n        </CardActions>\r\n      </Card>\r\n    );\r\n  }\r\n);\r\nexport default connect(\r\n  (\r\n    { templates = [], documentList, orders, orderActivities },\r\n    { data: { activityNumber: activityNo, orderNumber } }\r\n  ) => {\r\n    const projectNumber = orders[orderNumber]?.projectNumber;\r\n    const document = toDoOrDone(\r\n      projectNumber,\r\n      orderNumber,\r\n      activityNo,\r\n      templates,\r\n      documentList\r\n    );\r\n\r\n    return {\r\n      document,\r\n      orderActivities,\r\n      documentList,\r\n      orders,\r\n      templates,\r\n    };\r\n  }, (dispatch) => {\r\n    return {\r\n      fetchNoConformityList: (data) => {\r\n        return dispatch(action.getNoConformityList(data));\r\n      },\r\n    };\r\n  }\r\n)(OrderActivityListCard);\r\n"]},"metadata":{},"sourceType":"module"}