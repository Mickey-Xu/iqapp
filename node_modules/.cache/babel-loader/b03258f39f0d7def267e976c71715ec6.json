{"ast":null,"code":"import * as action from \"actions\";\nimport * as api from \"api\";\nimport { db } from \"js/db\";\nimport * as publicFn from \"js/publicFn/index\";\nimport store from \"js/store\";\nimport _ from \"lodash\";\nimport { isVisible } from \"./templateFormUtil/index\";\nimport * as schema from \"js/schema\";\nimport * as repo from \"js/fetch\";\nimport { normalize } from \"normalizr\";\nimport { documentAuthorizationC } from \"js/publicFn\";\nimport { Base64 } from \"js-base64\";\nimport { serialize } from \"js/sfdl\";\nexport const sleep = ms => {\n  return new Promise(resolve => {\n    setTimeout(resolve, ms);\n  });\n};\nexport const timeHorizonFilter = (date, today, timeHorizon) => {\n  const leadingDate = new Date(date);\n\n  switch (timeHorizon) {\n    case \"thisWeek\":\n      {\n        const start = today - new Date(today).getDay() * 86400000;\n        const end = start + 7 * 86400000;\n        return leadingDate.getTime() <= end;\n      }\n\n    case \"twoWeeks\":\n      {\n        const start = today - new Date(today).getDay() * 86400000;\n        const end = start + 14 * 86400000;\n        return leadingDate.getTime() <= end;\n      }\n\n    case \"fourWeeks\":\n      {\n        const start = today - new Date(today).getDay() * 86400000;\n        const end = start + 28 * 86400000;\n        return leadingDate.getTime() <= end;\n      }\n\n    case \"eightWeeks\":\n      {\n        const start = today - new Date(today).getDay() * 86400000;\n        const end = start + 56 * 86400000;\n        return leadingDate.getTime() <= end;\n      }\n\n    case \"all\":\n    default:\n      {\n        return true;\n      }\n  }\n};\nexport const orderActivitiesSort = data => {\n  return data.sort(function (a, b) {\n    if (a.sort < b.sort) {\n      return -1;\n    } else {\n      return 1;\n    }\n  });\n};\nexport const templatesConverter = data => {\n  let res = {};\n  data.forEach(elem => {\n    if (!res[elem.activityNo]) {\n      res[elem.activityNo] = [];\n    }\n\n    res[elem.activityNo].push(elem);\n  });\n  return res;\n};\nexport const groupInfoProc = data => {\n  const res = {};\n  data.forEach(value => {\n    res[value.projectNo] = JSON.parse(value.projectGroupInfo);\n  });\n  return res;\n};\nexport const groupInfoDeproc = data => {\n  const res = [];\n  Object.keys(data).forEach(key => {\n    const elem = {};\n    elem.projectNo = key;\n    elem.projectGroupInfo = JSON.stringify(data[key]);\n    res.push(elem);\n  });\n  return res;\n};\nexport const fittersAssignmentTransferProc = data => {\n  const res = {};\n  data.forEach(value => {\n    if (!res[value.projectNo]) {\n      res[value.projectNo] = [];\n    }\n\n    res[value.projectNo].push(value);\n  });\n  return res;\n};\nexport const verify = fields => {\n  const verifyType = [\"singleLine\", \"paragraph\", \"number\", \"multipleChoice\", \"dropdown\", \"dropdown\", \"signature\", \"photo\", \"naYesNo\"];\n  const defaultPhotoValue = \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\n\n  for (let i = 0; i < fields.length; i++) {\n    const result = isVisible(fields[i]);\n\n    if (result) {\n      for (let k = 0; k < verifyType.length; k++) {\n        if (fields[i].type === verifyType[k] && fields[i].settings.required) {\n          let alertInfo;\n\n          if (fields[i].settings.labelI18n.Chinese) {\n            alertInfo = fields[i].settings.labelI18n.Chinese;\n          } else if (fields[i].settings.labelI18n.English) {\n            alertInfo = fields[i].settings.labelI18n.English;\n          } else if (fields[i].settings.descriptionI18n.Chinese) {\n            alertInfo = fields[i].settings.descriptionI18n.Chinese;\n          } else {\n            alertInfo = fields[i].settings.descriptionI18n.English;\n          }\n\n          if (fields[i].settings.value === defaultPhotoValue || fields[i].settings.value === \"\" || fields[i].settings.value === \"-\") {\n            alert(alertInfo);\n            return false;\n          } else if (fields[i].settings.value === \"#\") {\n            alert(alertInfo);\n            return false;\n          } else if (fields[i].type === \"number\") {\n            if (fields[i].settings.min || fields[i].settings.max) {\n              if (fields[i].settings.value < fields[i].settings.min || fields[i].settings.value > fields[i].settings.max) {\n                const maxMin = showNumberText(fields[i].settings.min, fields[i].settings.max);\n                alert(`${alertInfo}: ${maxMin}`);\n                return false;\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return true;\n};\nexport const toDoOrDone = (projectNumber, orderNumber, activityNo, templates, documentList) => {\n  var _orders$orderNumber, _orders$orderNumber2, _orders$orderNumber3;\n\n  const orders = store.getState().orders;\n  const productLine = (_orders$orderNumber = orders[orderNumber]) === null || _orders$orderNumber === void 0 ? void 0 : _orders$orderNumber.productLine;\n  const productFamily = (_orders$orderNumber2 = orders[orderNumber]) === null || _orders$orderNumber2 === void 0 ? void 0 : _orders$orderNumber2.productFamily;\n  const productCategory = (_orders$orderNumber3 = orders[orderNumber]) === null || _orders$orderNumber3 === void 0 ? void 0 : _orders$orderNumber3.productCategory;\n  const templateParms = templates[activityNo] ? templates[activityNo] : [];\n  const templateDataList = getTemplateList(templateParms, productLine, productFamily, productCategory);\n\n  if (templateDataList.length > 0) {\n    const requiredData = templateDataList.filter(item => item.mandDoc === \"X\");\n\n    if (requiredData.length > 0) {\n      var _documentList$project, _documentList$project2;\n\n      const documents = documentList === null || documentList === void 0 ? void 0 : (_documentList$project = documentList[projectNumber]) === null || _documentList$project === void 0 ? void 0 : (_documentList$project2 = _documentList$project[orderNumber]) === null || _documentList$project2 === void 0 ? void 0 : _documentList$project2[activityNo];\n      let count = 0;\n\n      if (documents) {\n        for (let i = 0; i < requiredData.length; i++) {\n          const discription = `${requiredData[i].documentDescription}`;\n\n          for (let k = 0; k < documents.length; k++) {\n            var _documents$k;\n\n            ((_documents$k = documents[k]) === null || _documents$k === void 0 ? void 0 : _documents$k.name.includes(discription)) && count++;\n          }\n        }\n\n        if (requiredData.length <= count) {\n          return \"Done\";\n        } else {\n          return \"ToDo\";\n        }\n      } else {\n        return \"ToDo\";\n      }\n    } else {\n      return \"Done\"; //如果没有必填\n    }\n  } else {\n    return \"WithoutTemplates\";\n  }\n};\nexport const timeSort = (property, bol) => {\n  return function (a, b) {\n    var value1 = a[property];\n    var value2 = b[property];\n\n    if (bol) {\n      // 升序\n      return Date.parse(value1) - Date.parse(value2);\n    } else {\n      // 降序\n      return Date.parse(value2) - Date.parse(value1);\n    }\n  };\n};\nexport const whetherToShutDown = (orderActivities, orderNumber) => {\n  if (orderActivities[orderNumber + \"-7720\"] && !orderActivities[orderNumber + \"-7720\"].confirmedDate) {\n    return \"停工中\";\n  } else {\n    return false;\n  }\n};\nexport const getCurrentElevatorStatus = (orderActivities, orderNumber) => {\n  var _orderActivities;\n\n  if (orderActivities[orderNumber + \"-7720\"] && !orderActivities[orderNumber + \"-7720\"].confirmedDate) {\n    return \"停工中\";\n  } else if ((_orderActivities = orderActivities[orderNumber + \"-7350\"]) === null || _orderActivities === void 0 ? void 0 : _orderActivities.confirmedDate) {\n    return \"安装中\";\n  } else {\n    return \"未到货\";\n  }\n};\nexport const orderProgress = (orderActivities, orderNumber) => {\n  var _orderActivities2, _orderActivities3, _orderActivities4, _orderActivities5;\n\n  //电梯整体安装进度\n  if ((_orderActivities2 = orderActivities[orderNumber + \"-7800\"]) === null || _orderActivities2 === void 0 ? void 0 : _orderActivities2.confirmedDate) {\n    return 100;\n  }\n\n  if ((_orderActivities3 = orderActivities[orderNumber + \"-70D0\"]) === null || _orderActivities3 === void 0 ? void 0 : _orderActivities3.confirmedDate) {\n    return 60;\n  }\n\n  if (((_orderActivities4 = orderActivities[orderNumber + \"-7020\"]) === null || _orderActivities4 === void 0 ? void 0 : _orderActivities4.confirmedDate) && !orderActivities[orderNumber + \"-70D0\"]) {\n    return 60;\n  }\n\n  if ((_orderActivities5 = orderActivities[orderNumber + \"-8010\"]) === null || _orderActivities5 === void 0 ? void 0 : _orderActivities5.confirmedDate) {\n    return 30;\n  } else {\n    return 0;\n  }\n}; //电梯安装进度\n\nexport const elevatorInstallationProgress = (projectNumber, orderActivities, orderNo, documentList) => {\n  if (!orderActivities[orderNo + \"-7040\"]) {\n    // 三步\n    const threeStep = [\"7010\", \"7020\", \"7600\"];\n    const orderActivitie = Object.keys(orderActivities).filter(item => {\n      return orderActivities[item].orderNumber === orderNo && threeStep.indexOf(orderActivities[item].activityNumber) > -1;\n    });\n    const progress = orderActivitie.filter(item => {\n      return orderActivities[item].confirmedDate !== null;\n    });\n    return Math.round(progress.length * 100 / 3) + \"%\";\n  } else {\n    // 十四步\n    let elevatorInstallationProgress = 0;\n    const steps14 = [\"7010\", \"7020\", \"7030\", \"7040\", \"7050\", \"7060\", \"7070\", \"7080\", \"7090\", \"70A0\", \"70B0\", \"70C0\", \"70D0\", \"7600\"];\n    steps14.forEach(step => {\n      if (orderActivities[orderNo + \"-\" + step].editable && orderActivities[orderNo + \"-\" + step].confirmedDate) {\n        elevatorInstallationProgress += 1;\n      } else if (!orderActivities[orderNo + \"-\" + step].editable) {\n        var _documentList$project3, _documentList$project4;\n\n        const documentActivity = (_documentList$project3 = documentList[projectNumber]) === null || _documentList$project3 === void 0 ? void 0 : (_documentList$project4 = _documentList$project3[orderNo]) === null || _documentList$project4 === void 0 ? void 0 : _documentList$project4[step];\n        const activityModified = documentActivity ? documentActivity.sort(timeSort(\"modified\", false)) : null;\n        const confirmedTime = activityModified ? activityModified === null || activityModified === void 0 ? void 0 : activityModified[0].modified : null;\n        confirmedTime && (elevatorInstallationProgress += 1);\n      }\n    });\n    const result = elevatorInstallationProgress / 14 * 100;\n    return Math.round(result) + \"%\";\n  }\n};\nexport const projectProgress = (projectNumber, orders, orderActivities) => {\n  const projectOrders = [];\n  Object.keys(orders).forEach(item => {\n    orders[item].projectNumber === projectNumber && projectOrders.push(item);\n  });\n  const progressArray = [];\n  projectOrders.forEach(item => {\n    let progress = orderProgress(orderActivities, item);\n    progressArray.push(progress);\n  });\n  let sum = 0;\n  progressArray.forEach(item => {\n    sum += item === \"停工中\" ? 0 : item;\n  });\n  const projectProgress = Math.ceil(sum / projectOrders.length);\n  return projectProgress;\n};\n/**\r\n    {\r\n      \"projectNo\": \"string\",\r\n      \"orderNo\": \"string\",\r\n      \"activityNo\": \"string\",\r\n      \"type\": 0,\r\n      \"date\": \"string\",\r\n      \"combinePdf\": true\r\n    }\r\n */\n\nexport const setActivityStatusParams = (projectNo, orderNo, activityNo, date, type, orderActivities, orders) => {\n  var _orders$orderNo, _orders$orderNo2, _orders$orderNo3;\n\n  const result = {};\n  result.projectNo = projectNo;\n  result.orderNo = orderNo;\n  result.activityNo = activityNo;\n  result.date = date;\n  result.type = type;\n  result.combinePdf = false;\n  result.foe = orders === null || orders === void 0 ? void 0 : (_orders$orderNo = orders[orderNo]) === null || _orders$orderNo === void 0 ? void 0 : _orders$orderNo.fo;\n  result.region = orders === null || orders === void 0 ? void 0 : (_orders$orderNo2 = orders[orderNo]) === null || _orders$orderNo2 === void 0 ? void 0 : _orders$orderNo2.region;\n  result.branch = orders === null || orders === void 0 ? void 0 : (_orders$orderNo3 = orders[orderNo]) === null || _orders$orderNo3 === void 0 ? void 0 : _orders$orderNo3.prctr;\n\n  if (orderActivities[orderNo + \"-7030\"]) {\n    // 14 steps (or 9 steps)\n    if (activityNo === \"70C0\") {\n      result.combinePdf = true;\n    }\n\n    if (orderActivities[orderNo + \"-\" + activityNo].originalStep) {\n      result.activityNo = orderActivities[orderNo + \"-\" + activityNo].originalStep;\n    }\n  }\n\n  return result;\n};\nexport const isInstallationStepEditable = (orderNo, activityNo, orderActivities) => {\n  if (orderActivities[orderNo + \"-\" + activityNo].editable === undefined || orderActivities[orderNo + \"-\" + activityNo].editable) {\n    return true;\n  } else {\n    return false;\n  }\n};\nexport const calculationOfInstallationSteps = (orderActivities, orders) => {\n  let handedOverToMaintenance = 0; //移交维保\n\n  let debugQuantity = 0; // 调试\n\n  let guideDoorInstallation = 0; //导轨门安装\n\n  let startTheInstallation = 0; //开始安装\n\n  let installationNotStarted = 0; //未开始安装\n\n  const orderNos = Object.keys(orders);\n\n  for (let i = 0; i < orderNos.length; i++) {\n    var _orderActivities6, _orderActivities7, _orderActivities8, _orderActivities9, _orderActivities10;\n\n    if (orderActivities[orderNos[i] + \"-7800\"] && ((_orderActivities6 = orderActivities[orderNos[i] + \"-7800\"]) === null || _orderActivities6 === void 0 ? void 0 : _orderActivities6.confirmedDate)) {\n      handedOverToMaintenance++;\n    } else if (orderActivities[orderNos[i] + \"-70C0\"] && ((_orderActivities7 = orderActivities[orderNos[i] + \"-70C0\"]) === null || _orderActivities7 === void 0 ? void 0 : _orderActivities7.confirmedDate)) {\n      debugQuantity++;\n    } else if (orderActivities[orderNos[i] + \"-7020\"] && ((_orderActivities8 = orderActivities[orderNos[i] + \"-7020\"]) === null || _orderActivities8 === void 0 ? void 0 : _orderActivities8.confirmedDate)) {\n      debugQuantity++;\n    } else if (orderActivities[orderNos[i] + \"-8010\"] && ((_orderActivities9 = orderActivities[orderNos[i] + \"-8010\"]) === null || _orderActivities9 === void 0 ? void 0 : _orderActivities9.confirmedDate)) {\n      guideDoorInstallation++;\n    } else if (orderActivities[orderNos[i] + \"-7700\"] && ((_orderActivities10 = orderActivities[orderNos[i] + \"-7700\"]) === null || _orderActivities10 === void 0 ? void 0 : _orderActivities10.confirmedDate)) {\n      startTheInstallation++;\n    } else {\n      installationNotStarted++;\n    }\n  }\n\n  let theOverallProgress = 0;\n  const data = [handedOverToMaintenance, debugQuantity, guideDoorInstallation, startTheInstallation, installationNotStarted];\n  data.forEach(item => {\n    theOverallProgress += item;\n  });\n  return {\n    handedOverToMaintenance,\n    debugQuantity,\n    guideDoorInstallation,\n    startTheInstallation,\n    installationNotStarted,\n    theOverallProgress\n  };\n};\nexport const currentRefreshTime = () => {\n  return `${new Date().getMonth() + 1}/${new Date().getDate()} ${new Date().getHours()}:${new Date().getMinutes() < 10 ? \"0\" + new Date().getMinutes() : new Date().getMinutes()}`;\n};\nexport const saveTheFirstRefreshTime = dispatch => {\n  db.cache.get(\"dataRefreshTime\").then(cache => {\n    const datatime = {\n      allDataRefreshTime: currentRefreshTime(),\n      masterDataRefreshTime: currentRefreshTime(),\n      orderDataRefreshTime: currentRefreshTime(),\n      templateListDataRefreshTime: currentRefreshTime(),\n      documentListDataRefreshTime: currentRefreshTime(),\n      taskListDataRefreshTime: currentRefreshTime()\n    };\n    dispatch(action.setAllDataRefreshTime(datatime));\n    !(cache === null || cache === void 0 ? void 0 : cache.data) && db.cache.put({\n      id: \"dataRefreshTime\",\n      data: datatime\n    }).then(() => {\n      dispatch(action.setAllDataRefreshTime(datatime));\n    });\n  });\n  db.cache.get(\"settings\").then(cache => {\n    const language = \"zh-cn\";\n    !(cache === null || cache === void 0 ? void 0 : cache.data) && db.cache.put({\n      id: \"settings\",\n      data: {\n        language: \"zh-cn\"\n      }\n    }).then(() => {\n      dispatch(action.setAllDataRefreshTime(language));\n    });\n  });\n};\nexport const recordRefreshTime = (dispatch, name, projects, userInfo) => {\n  if (name) {\n    const parmas = {\n      projectNos: Object.keys(projects)\n    };\n    const auth = JSON.parse(window.localStorage.getItem(\"auth\"));\n    let roles = auth === null || auth === void 0 ? void 0 : auth.roles;\n    const isSubconTLOrPE = roles.indexOf('Subcon TL') > -1 || roles.indexOf('PE') > -1;\n    const isEISV = roles.indexOf('SL') > -1;\n    const request = getDocumentListParmas(parmas.projectNos);\n\n    switch (name) {\n      case \"all\":\n        if (isSubconTLOrPE || isEISV) {\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch));\n        } else {\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch)); // dispatch(action.fetchDocuments(request, dispatch));\n\n          dispatch(action.fetchTasksList(userInfo, dispatch));\n        }\n\n        break;\n\n      case \"orders\":\n        dispatch(action.fetchOrders(parmas, \"\", userInfo, dispatch));\n        break;\n\n      case \"documents\":\n        dispatch(action.fetchDocuments(request, userInfo, dispatch));\n        break;\n\n      case \"task\":\n        dispatch(action.fetchTasksList(request, userInfo, \"\", dispatch));\n        break;\n\n      default:\n        return dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch)), // dispatch(action.fetchDocuments(dispatch)),\n        dispatch(action.fetchTasksList(userInfo, dispatch));\n    }\n  } else {\n    db.cache.get(\"dataRefreshTime\").then(cache => {\n      (cache === null || cache === void 0 ? void 0 : cache.data) && dispatch(action.setAllDataRefreshTime(cache.data));\n    });\n  }\n};\nexport const getDocumentListParmas = (projectNos, orderNos) => {\n  const orders = orderNos ? orderNos : store.getState().orders;\n  let data = [];\n\n  for (let i = 0; i < projectNos.length; i++) {\n    Object.keys(orders).find(item => {\n      return orders[item].projectNumber === projectNos[i] && data.push({\n        foe: orders[item].fo,\n        region: orders[item].region,\n        branch: orders[item].prctr,\n        projectNo: orders[item].projectNumber,\n        orders: Object.keys(orders).filter(order => {\n          return orders[order].projectNumber === orders[item].projectNumber;\n        })\n      });\n    });\n  }\n\n  return data;\n};\nexport const isFormUpdated = (currentForm, initForm) => {\n  if (currentForm.fields.length !== initForm.fields.length) {\n    return false;\n  }\n\n  for (let i = 0; i < currentForm.fields.length; i++) {\n    if (Array.isArray(currentForm.fields[i].settings.value)) {\n      if (!_.isEqual(currentForm.fields[i].settings.value.sort(), initForm.fields[i].settings.value.sort())) {\n        return true;\n      }\n    } else {\n      if (currentForm.fields[i].settings.value !== initForm.fields[i].settings.value) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n};\nexport const localInstallationStepsConfirmDateProc = data => {\n  const res = {};\n  data.forEach(value => {\n    res[value.orderNo + \"-\" + value.stepNo] = value;\n  });\n  return res;\n};\nexport const verifyWhenConfirm7020or70C0 = (orderActivities, orderNumber, activityNumber) => {\n  // 14 steps\n  if (orderActivities[orderNumber + \"-7030\"]) {\n    if (activityNumber === \"70C0\") {\n      const checkSteps = [\"7010\", \"7020\", \"7030\", \"7040\", \"7050\", \"7060\", \"7070\", \"7080\", \"7090\", \"70A0\", \"70B0\"];\n      const result = checkSteps.find(step => !orderActivities[orderNumber + \"-\" + step].confirmedDate);\n\n      if (result) {\n        return {\n          stepNo: result,\n          message: \"未确认,请先确认\"\n        };\n      }\n    }\n  }\n};\n/**\r\n *  code: 1: 本地不存在template\r\n *        2：本地存在template,但是不一样\r\n *        3：本地存在template,但是一样\r\n */\n\nexport const checkTemplateForm = (documentNo, documentPart, value) => {\n  const key = documentNo + \"-\" + documentPart;\n  return db.cache.get(\"rawTemplateForm\").then(cache => {\n    if (cache === null || cache === void 0 ? void 0 : cache.data) {\n      const existData = cache.data;\n\n      if (!existData[key]) {\n        existData[key] = value;\n        return db.cache.put({\n          id: \"rawTemplateForm\",\n          data: existData\n        }).then(() => {\n          return Promise.resolve({\n            code: 1,\n            value\n          });\n        });\n      }\n\n      if (existData[key] !== value) {\n        existData[key] = value;\n        return db.cache.put({\n          id: \"rawTemplateForm\",\n          data: existData\n        }).then(() => {\n          return Promise.resolve({\n            code: 2,\n            value\n          });\n        });\n      }\n\n      return Promise.resolve({\n        code: 3,\n        value\n      });\n    } else {\n      const data = {};\n      data[key] = value;\n      return db.cache.put({\n        id: \"rawTemplateForm\",\n        data\n      }).then(() => {\n        return Promise.resolve({\n          code: 1,\n          value\n        });\n      });\n    }\n  });\n};\nexport const getRawTemplate = (documentNo, documentPart) => {\n  const key = documentNo + \"-\" + documentPart;\n  return db.cache.get(\"rawTemplateForm\").then(cache => {\n    // TODO: 这边正常流程下来都会有数据，可提高代码健壮性\n    if (cache === null || cache === void 0 ? void 0 : cache.data) {\n      return Promise.resolve(cache.data[key]);\n    }\n  });\n};\n/**\r\n * code: 1: 本地存在draft\r\n *      2： 本地不存在draft\r\n */\n\nexport const getDraftFromLocal = (documentNo, documentPart, activityNo, productFamily, productLine, language, draftParam) => {\n  const {\n    orderNo\n  } = draftParam;\n  const key = orderNo + \"-\" + activityNo + \"-\" + documentNo + \"-\" + documentPart + \"-\" + productFamily + \"-\" + productLine + \"-\" + language;\n  return db.cache.get(\"templateDraft\").then(cache => {\n    if (cache === null || cache === void 0 ? void 0 : cache.data) {\n      const existData = cache.data;\n\n      if (existData[key]) {\n        return Promise.resolve({\n          code: 1,\n          value: existData[key]\n        });\n      }\n\n      return Promise.resolve({\n        code: 2\n      });\n    } else {\n      return Promise.resolve({\n        code: 2\n      });\n    }\n  });\n};\n/**\r\n * code： 1：draft 存在\r\n *        2：draft 不存在\r\n */\n\nexport const getDraft = (param, draftParam, expendParam) => {\n  const {\n    documentNo,\n    documentPart\n  } = param;\n  const {\n    activityNo,\n    productFamily,\n    productLine,\n    language\n  } = expendParam;\n  return getDraftFromLocal(documentNo, documentPart, activityNo, productFamily, productLine, language, draftParam).then(data => {\n    if (data.code === 1) {\n      return Promise.resolve(data);\n    } else return getDraftFromApi(draftParam).then(data => {\n      return Promise.resolve(data);\n    });\n  });\n};\n/**\r\n * code: 1 draft 存在\r\n *       2 draft 不存在\r\n */\n\nexport const getDraftFromApi = draftParam => {\n  return api.getDraft(draftParam).then(res => {\n    if (res.data.form) {\n      return Promise.resolve({\n        code: 1,\n        value: res.data.form\n      });\n    } else {\n      return Promise.resolve({\n        code: 2\n      });\n    }\n  });\n};\nexport const saveDraftToLocal = (data, currentParam, draftParams) => {\n  const {\n    documentNo,\n    documentPart\n  } = currentParam;\n  const {\n    orderNo,\n    activityNo,\n    productFamily,\n    productLine,\n    language\n  } = draftParams;\n  const key = orderNo + \"-\" + activityNo + \"-\" + documentNo + \"-\" + documentPart + \"-\" + productFamily + \"-\" + productLine + \"-\" + language;\n  db.cache.get(\"templateDraft\").then(cache => {\n    if (cache === null || cache === void 0 ? void 0 : cache.data) {\n      const existData = cache.data;\n      existData[key] = data;\n      db.cache.put({\n        id: \"templateDraft\",\n        data: existData\n      });\n    } else {\n      const storeData = {};\n      storeData[key] = data;\n      db.cache.put({\n        id: \"templateDraft\",\n        data: storeData\n      });\n    }\n  });\n};\nexport const deleteDraftFromLocal = currentParam => {\n  const {\n    documentNo,\n    documentPart\n  } = currentParam;\n  db.cache.get(\"templateDraft\").then(cache => {\n    if (cache === null || cache === void 0 ? void 0 : cache.data) {\n      const existData = cache.data;\n      const deleteKeys = Object.keys(existData).filter(key => {\n        return key.includes(documentNo + \"-\" + documentPart);\n      });\n      deleteKeys.forEach(key => {\n        delete existData[key];\n      });\n      db.cache.put({\n        id: \"templateDraft\",\n        data: existData\n      });\n    }\n  });\n};\nexport const getTemplateList = (templatesData, productLine, productFamily, productCategory) => {\n  const condition1 = templatesData.filter(item => item.productCategory === productCategory && item.productLine === productLine && item.productFamily === productFamily);\n  const condition2 = templatesData.filter(item => item.productCategory === productCategory && item.productLine === productLine && item.productFamily === null);\n  const condition3 = templatesData.filter(item => item.productCategory === productCategory && item.productFamily === productFamily && item.productLine === null);\n  const condition4 = templatesData.filter(item => item.productCategory === productCategory && item.productLine === null && item.productFamily === null);\n  const condition5 = templatesData.filter(item => item.productLine === productLine && item.productFamily === productFamily && item.productCategory === null);\n  const condition6 = templatesData.filter(item => item.productLine === productLine && item.productCategory === null && item.productFamily === null);\n  const condition7 = templatesData.filter(item => item.productFamily === productFamily && item.productCategory === null && item.productLine === null);\n  const condition8 = templatesData.filter(item => item.productCategory === null && item.productLine === null && item.productFamily === null);\n  const result = [condition1, condition2, condition3, condition4, condition5, condition6, condition7, condition8].find(array => array.length > 0);\n  return result ? result : [];\n};\nexport const getDocumentComplateStatus = (auth, projectNumber, orderNo, orderActivities, templates, documentList) => {\n  const activityList = publicFn.orderDetailSteps(orderActivities, orderNo, auth.activityAuth, auth.roles[0]);\n  const documentCompleteStatus = [];\n\n  for (let i = 0; i < activityList.length; i++) {\n    if (orderActivities === null || orderActivities === void 0 ? void 0 : orderActivities[orderNo + '-' + activityList[i]]) {\n      const status = toDoOrDone(projectNumber, orderNo, activityList[i], templates, documentList);\n      documentCompleteStatus.push(status);\n    }\n  }\n\n  const completeSum = [];\n  const completed = [];\n\n  for (let i = 0; i < documentCompleteStatus.length; i++) {\n    if (documentCompleteStatus[i] === \"ToDo\") {\n      completeSum.push(documentCompleteStatus[i]);\n    } else if (documentCompleteStatus[i] === \"Done\") {\n      completeSum.push(documentCompleteStatus[i]);\n      completed.push(documentCompleteStatus[i]);\n    }\n  }\n\n  return `${completed.length}/${completeSum.length}`;\n}; // export const getStopsOrHoistHeight = (chars, orderNo, type) => {\n//   const condition = type === \"stops\" ? \"GRP_NUMBER_OF_STOPS\" : \"GRP_HQ\";\n//   const data = [];\n//   Object.keys(chars).filter((item) => {\n//     return (\n//       chars[item].orderNo === orderNo &&\n//       chars[item].charID === condition &&\n//       data.push(chars[item])\n//     );\n//   });\n//   console.log(data, type, orderNo);\n//   return data.length > 0 ? data[0].value : 0;\n// };\n\nexport const getStopsOrHoistHeight = (chars, orderNo, type) => {\n  const data = [];\n  Object.keys(chars).filter(item => {\n    return chars[item].orderNo === orderNo && data.push(chars[item]);\n  });\n\n  if (type === \"stops\") {\n    const stops = data.filter(item => {\n      return item.name.indexOf(\"停站数\") > -1 || item.name.indexOf(\"Number of stops\") > -1;\n    });\n    return stops.length > 0 ? stops[0].value : 0;\n  } else {\n    const hoistHeight = data.filter(item => {\n      return item.name.indexOf(\"提升高度\") > -1 || item.name.indexOf(\"Travel height\") > -1 || item.name.indexOf(\"Vertical rise\") > -1;\n    });\n    return hoistHeight.length > 0 ? hoistHeight[0].value : 0;\n  }\n};\nexport const scrollToPosition = (element, pathname) => {\n  const position = store.getState().scrollPosition[pathname];\n  element.current.scrollTop = position ? position : 0;\n};\nexport const removeNotVisibleFields = templateForm => {\n  const result = _.cloneDeep(templateForm);\n\n  _.remove(result.fields, field => {\n    return !isVisible(field);\n  });\n\n  return result;\n};\nexport const getTaskCount = () => {\n  const tasks = store.getState().tasks;\n  const orders = store.getState().orders;\n  const projects = store.getState().projects;\n  const awaitCloseNum = publicFn.taskCleaner(tasks.assigner, orders, projects) && publicFn.taskCleaner(tasks.assigner, orders, projects).filter(item => {\n    return item.Status === \"D\";\n  }).length;\n  const awaitComplateNum = publicFn.taskCleaner(tasks.assignee, orders, projects) && publicFn.taskCleaner(tasks.assignee, orders, projects).filter(item => {\n    return item.Status === \"A\";\n  }).length;\n  return {\n    awaitCloseNum,\n    awaitComplateNum\n  };\n};\nexport const getAwaitComplateAwaitCloseCount = tasks => {\n  const countTaskStatuses = tasks => {\n    const statusCount = {};\n    tasks.forEach(task => {\n      const {\n        taskType,\n        status\n      } = task;\n\n      if (!statusCount[taskType]) {\n        statusCount[taskType] = {\n          'awaitStartNum': 0,\n          \"awaitCloseNum\": 0,\n          \"awaitComplateNum\": 0\n        };\n      }\n\n      if (status === \"awaitClose\") {\n        statusCount[taskType][\"awaitCloseNum\"] += 1;\n      } else if (status === \"awaitComplate\") {\n        statusCount[taskType][\"awaitComplateNum\"] += 1;\n      } else if (status === \"awaitStart\") {\n        statusCount[taskType][\"awaitStartNum\"] += 1;\n      }\n    });\n    return statusCount;\n  };\n\n  const taskStatusCount = countTaskStatuses(tasks);\n  const updatedTasks = tasks.map(task => {\n    const {\n      taskType\n    } = task;\n    const {\n      \"awaitCloseNum\": pendingCloseCount,\n      \"awaitComplateNum\": pendingCompleteCount,\n      'awaitStartNum': pendingStartCoun\n    } = taskStatusCount[taskType] || {\n      \"awaitCloseNum\": 0,\n      \"awaitComplateNum\": 0,\n      'awaitStartNum': 0\n    };\n    return { ...task,\n      \"awaitCloseNum\": pendingCloseCount,\n      \"awaitComplateNum\": pendingCompleteCount,\n      'awaitStartNum': pendingStartCoun\n    };\n  });\n  return updatedTasks;\n};\nexport const showNumberText = (min, max) => {\n  const a = min === 0 ? min.toString() : min;\n  const b = max === 0 ? max.toString() : max;\n\n  if (a || b) {\n    if (a && !b) {\n      return `(${a}...)`;\n    } else if (!a && b) {\n      return `(...${b})`;\n    } else {\n      return `(${a}-${b})`;\n    }\n  } else {\n    return \"\";\n  }\n};\nexport const checkFileIsExisting = (template, data, orders) => {\n  const templateDataList = getTemplateList(template[data.activityNumber] || [], orders[data.orderNumber].productLine, orders[data.orderNumber].productFamily, orders[data.orderNumber].productCategory);\n  const param = templateDataList.map(item => {\n    return {\n      foe: orders[data.orderNumber].fo,\n      region: orders[data.orderNumber].region,\n      branch: orders[data.orderNumber].prctr,\n      projectNo: orders[data.orderNumber].projectNumber,\n      orderNo: data.orderNumber,\n      activityNo: data.activityNumber,\n      documentName: item.documentDescription + \".eform2\"\n    };\n  });\n  return api.checkFileIsExisting(param).then(res => {\n    let message = [];\n    res.data.forEach((item, index) => {\n      !item && message.push(templateDataList[index].documentDescription);\n    });\n    return message;\n  });\n};\nexport const getChecklistActivityNo = data => {\n  var _store$getState, _store$getState$docum, _store$getState$docum2, _store$getState$docum3;\n\n  const activtyNo = \"V001\";\n  const listData = (_store$getState = store.getState()) === null || _store$getState === void 0 ? void 0 : (_store$getState$docum = _store$getState.documentList) === null || _store$getState$docum === void 0 ? void 0 : (_store$getState$docum2 = _store$getState$docum[data.projectNumber]) === null || _store$getState$docum2 === void 0 ? void 0 : (_store$getState$docum3 = _store$getState$docum2[data.orderNumber]) === null || _store$getState$docum3 === void 0 ? void 0 : _store$getState$docum3[activtyNo];\n  return listData ? activtyNo : false;\n};\nexport const getNonConformityConfig = () => {\n  return {\n    \"7010\": {\n      activityNo: \"7010\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7020\": {\n      activityNo: \"7020\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7030\": {\n      activityNo: \"7030\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7040\": {\n      activityNo: \"7040\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7050\": {\n      activityNo: \"7050\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7060\": {\n      activityNo: \"7060\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7070\": {\n      activityNo: \"7070\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7080\": {\n      activityNo: \"7080\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"7090\": {\n      activityNo: \"7090\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"70A0\": {\n      activityNo: \"70A0\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"70B0\": {\n      activityNo: \"70B0\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"70C0\": {\n      activityNo: \"70C0\",\n      allowreupload: true,\n      closeEnabledInOILScreen: false\n    },\n    \"70D0\": {\n      activityNo: \"70D0\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7350\": {\n      activityNo: \"7350\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7360\": {\n      activityNo: \"7360\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7400\": {\n      activityNo: \"7400\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7500\": {\n      activityNo: \"7500\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7600\": {\n      activityNo: \"7600\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7620\": {\n      activityNo: \"7620\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7700\": {\n      activityNo: \"7700\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7800\": {\n      activityNo: \"7800\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"7950\": {\n      activityNo: \"7950\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"8010\": {\n      activityNo: \"8010\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    },\n    \"9200\": {\n      activityNo: \"9200\",\n      allowreupload: false,\n      closeEnabledInOILScreen: true\n    }\n  };\n};\n\nconst customizer = (objValue, srcValue) => {\n  if (Array.isArray(objValue) && Array.isArray(srcValue)) {\n    return objValue.concat(srcValue);\n  }\n};\n\nexport const updateOrdersData = (soNo, dispatch) => {\n  dispatch(action.showLoading());\n  api.fetchOrdersDataByProjects(soNo).then(response => {\n    const {\n      entities\n    } = normalize(response.data, schema.ordersData);\n    db.cache.get(\"ordersData\").then(cache => {\n      const result = _.mergeWith(cache.data, entities, customizer);\n\n      let projects = result.projects ? Object.keys(result.projects) : [];\n      db.cache.put({\n        id: \"ordersData\",\n        data: result\n      }).then(() => {\n        const param = {\n          projectNos: projects\n        };\n        repo.fetchLocalInstallationStepsConfirmDate(param);\n        const request = getDocumentListParmas(param.projectNos, result === null || result === void 0 ? void 0 : result.orders);\n        dispatch(action.fetchDocuments(request, {}, dispatch));\n      });\n    });\n  }).catch(error => {\n    dispatch(action.setError(error.message));\n  }).finally(() => {\n    dispatch(action.hideLoading());\n  });\n};\nexport const disableForm = (params = {}) => {\n  var _orders$orderNo4, _documentList$project5, _documentList$project6, _nonConformityConfig$;\n\n  if (!showUploadButton()) {\n    return false;\n  }\n\n  const {\n    orderActivities,\n    documentList,\n    templates,\n    orders,\n    auth,\n    nonConformityConfig\n  } = store.getState();\n  const {\n    activityNo,\n    orderNo,\n    productFamily,\n    productLine,\n    projectNumber,\n    root\n  } = params;\n  const productCategory = (_orders$orderNo4 = orders[orderNo]) === null || _orders$orderNo4 === void 0 ? void 0 : _orders$orderNo4.productCategory;\n  const templatesData = templates[activityNo] || [];\n  const documents = [];\n  const documentsItem = (_documentList$project5 = documentList[projectNumber]) === null || _documentList$project5 === void 0 ? void 0 : (_documentList$project6 = _documentList$project5[orderNo]) === null || _documentList$project6 === void 0 ? void 0 : _documentList$project6[activityNo];\n  const allowreupload = (_nonConformityConfig$ = nonConformityConfig[activityNo]) === null || _nonConformityConfig$ === void 0 ? void 0 : _nonConformityConfig$.allowreupload;\n  const disableTheEntranceroot = root === \"listCard\";\n  const data = getTemplateList(templatesData, productLine, productFamily, productCategory);\n  const description = data.map(item => {\n    return item.documentDescription;\n  });\n  description.forEach(item => {\n    return documentsItem && documentsItem.filter(ele => ele.name.indexOf(item) > -1 && documents.push(ele)) || [];\n  });\n  const docAuthActivityNos = documentAuthorizationC(orderActivities, orderNo, auth.activityAuth, auth.roles[0]);\n  const canUploadDoc = docAuthActivityNos.includes(activityNo);\n\n  if (root === \"installationChecklist\") {\n    var _documentList$project7, _documentList$project8;\n\n    const template = {\n      mandDoc: \"Y\",\n      documentDescription: `安装检查清单`\n    };\n    data.push(template);\n    documents.push(documentList === null || documentList === void 0 ? void 0 : (_documentList$project7 = documentList[projectNumber]) === null || _documentList$project7 === void 0 ? void 0 : (_documentList$project8 = _documentList$project7[orderNo]) === null || _documentList$project8 === void 0 ? void 0 : _documentList$project8[activityNo][0]);\n  }\n\n  if (disableTheEntranceroot && canUploadDoc) {\n    return false;\n  }\n\n  if (documents.length > 0) {\n    if (!allowreupload) {\n      return true;\n    } else {\n      if (getChecklistActivityNo({\n        projectNumber: projectNumber,\n        orderNumber: orderNo\n      })) {\n        return true;\n      } else {\n        return false;\n      }\n    }\n  } else {\n    return false;\n  }\n};\nexport const showUploadButton = () => {\n  const {\n    auth\n  } = store.getState();\n  return auth === null || auth === void 0 ? void 0 : auth.isEnableCorrectImage;\n};\n\nconst getTime = () => {\n  const now = new Date();\n  const year = now.getFullYear();\n  const month = String(now.getMonth() + 1).padStart(2, '0');\n  const day = String(now.getDate()).padStart(2, '0');\n  const hours = String(now.getHours()).padStart(2, '0');\n  const minutes = String(now.getMinutes()).padStart(2, '0');\n  const seconds = String(now.getSeconds()).padStart(2, '0');\n  return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\n};\n\nconst getCurrentPosition = () => {\n  return new Promise(resolve => {\n    if (navigator.geolocation) {\n      navigator.geolocation.getCurrentPosition(position => {\n        const latitude = position.coords.latitude;\n        const longitude = position.coords.longitude;\n        resolve({\n          status: 'success',\n          data: {\n            latitude,\n            longitude\n          }\n        });\n      }, error => {\n        resolve({\n          status: 'error',\n          message: error.message\n        });\n      });\n    } else {\n      resolve({\n        status: 'error',\n        message: 'Geolocation is not supported by this browser.'\n      });\n    }\n  });\n}; // 根据经纬度获取详细地址\n\n\nconst getLocationFromCoordinates = (latitude, longitude) => {\n  return new Promise((resolve, reject) => {\n    if (window.BMap) {\n      const geocoder = new window.BMap.Geocoder(); // 创建 Geocoder 实例\n\n      const point = new window.BMap.Point(longitude, latitude); // 创建坐标对象\n\n      geocoder.getLocation(point, result => {\n        if (result) {\n          resolve(result.address);\n        } else {\n          resolve('无法获取地址信息');\n        }\n      });\n    } else {\n      reject('百度地图 API 未加载');\n    }\n  });\n};\n\nexport const fillTextToImg = async (base64, projectParams, isOnline) => {\n  var _data$projects$projec;\n\n  let data = store.getState(); // let location = { longitude: \"121.197237\", latitude: \"31.449172\" }\n\n  var address = \"\";\n\n  if (isOnline) {\n    var _location$data, _location$data2;\n\n    const location = await getCurrentPosition();\n    address = await getLocationFromCoordinates(location === null || location === void 0 ? void 0 : (_location$data = location.data) === null || _location$data === void 0 ? void 0 : _location$data.latitude, location === null || location === void 0 ? void 0 : (_location$data2 = location.data) === null || _location$data2 === void 0 ? void 0 : _location$data2.longitude);\n  }\n\n  ;\n  let projectName = (_data$projects$projec = data.projects[projectParams.projectNumber]) === null || _data$projects$projec === void 0 ? void 0 : _data$projects$projec.description;\n  let time = getTime();\n  let watermarkText = [`拍摄地点：${address}`, `拍摄时间：${time}`, `订单编号：${projectParams.orderNo}`, `项目名称：${projectName}`];\n  const img = new Image();\n  img.src = base64;\n  img.setAttribute(\"crossOrigin\", \"Anonymous\");\n  return new Promise(resolve => {\n    img.onload = () => {\n      const canvas = document.createElement(\"canvas\");\n      const ctx = canvas.getContext(\"2d\");\n      canvas.width = img.width;\n      canvas.height = img.height;\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\n      ctx.font = '15px Arial';\n      ctx.textAlign = \"left\";\n      ctx.fillStyle = \"#ffffff\";\n      let lineHeight = 0;\n      watermarkText.forEach(item => {\n        lineHeight += 30;\n        ctx.fillText(item, 20, canvas.height - lineHeight + 20);\n      });\n      resolve(canvas.toDataURL(\"image/jpg\"));\n    };\n  });\n};\nexport const formatDateToYMD = dateString => {\n  console.log(dateString);\n  const date = new Date(dateString); // 将字符串转换为 Date 对象\n\n  const year = date.getFullYear(); // 获取年份\n\n  const month = String(date.getMonth() + 1).padStart(2, '0'); // 获取月份（注意月份是从0开始的，需加1）\n\n  const day = String(date.getDate()).padStart(2, '0'); // 获取日期\n\n  return dateString ? `${year}-${month}-${day}` : null; // 拼接成“YYYY年MM月DD日”格式\n};\nexport const taskDataConversion = item => {\n  let status;\n\n  switch (item.status) {\n    case 1:\n      status = \"awaitStart\";\n      break;\n\n    case 2:\n      status = \"awaitComplate\";\n      break;\n\n    case 3:\n      status = \"awaitClose\";\n      break;\n\n    case 4:\n      status = 'closed';\n      break;\n\n    case 5:\n      status = 'closed';\n      break;\n\n    default:\n      status = 'closed';\n      break;\n  }\n\n  ;\n  return {\n    taskId: item.id,\n    taskType: item.type,\n    projectNo: item.projectNo,\n    orderNo: item.salesOrderNo,\n    activityNo: item.activityNo,\n    projectName: item.projectName,\n    planStartDate: formatDateToYMD(item.planStartDate),\n    planEndDate: formatDateToYMD(item.planEndDate),\n    actualStartDate: formatDateToYMD(item.actualStartDate),\n    actualEndDate: formatDateToYMD(item.actualEndDate),\n    actualCloseDate: formatDateToYMD(item.closedDate),\n    statusDesc: item.statusDesc,\n    status: status\n  };\n};\nexport const finishOrCloseCheck = (type, orderActivities, data, templates, orders, submit, activityParams) => {\n  if (type === \"close\") {\n    const result = verifyWhenConfirm7020or70C0(orderActivities, data.orderNo, data.activityNo);\n\n    if (result) {\n      alert(result.stepNo + result.message);\n      return false;\n    }\n  }\n\n  ;\n  checkFileIsExisting(templates, {\n    orderNumber: data.orderNo,\n    activityNumber: data.activityNo\n  }, orders).then(message => {\n    if (message.length < 1) {\n      if (type === \"close\") {\n        const templateDataList = getTemplateList(templates[data.activityNo] || [], orders[data.orderNo].productLine, orders[data.orderNo].productFamily, orders[data.orderNo].productCategory);\n        const param = templateDataList.map(item => {\n          return {\n            foe: orders[data.orderNo].fo,\n            region: orders[data.orderNo].region,\n            branch: orders[data.orderNo].prctr,\n            ProjectNo: orders[data.orderNo].projectNumber,\n            OrderNo: data.orderNo,\n            ActivityNo: data.activityNo,\n            Description: item.documentDescription\n          };\n        });\n        param.map(item => store.dispatch(action.getNoConformityList(item)).then(res => {\n          var _res$data, _res$data$0$nonConfor;\n\n          const foundItems = (_res$data = res.data) === null || _res$data === void 0 ? void 0 : (_res$data$0$nonConfor = _res$data[0].nonConformities) === null || _res$data$0$nonConfor === void 0 ? void 0 : _res$data$0$nonConfor.flatMap(key => key.nonConformityItems.filter(subItem => subItem.itemValue === \"no\"));\n\n          if (foundItems.length > 0) {\n            alert(`您有${foundItems.length}个不符合项未关闭，请点击已上传按钮进入查看&关闭不符合项界面关闭所有不符合项后，才能关闭任务`);\n            return false;\n          } else {\n            submit(type, data, activityParams);\n          }\n        }));\n      }\n\n      ;\n      type === 'finish' && submit(type, data, activityParams);\n    } else {\n      alert(`请点击待处理 上传 ${message.toString()}`);\n      return false;\n    }\n  });\n};\nexport const offlineSaving = (templateFormData, key) => {\n  const data = {\n    [key]: Base64.encode(serialize(templateFormData))\n  };\n  db.cache.get(\"offlineForm\").then(res => {\n    const formData = (res === null || res === void 0 ? void 0 : res.data) ? res.data : [];\n    let index = formData.findIndex(item => Object.keys(item)[0] === Object.keys(data)[0]);\n    index >= 0 ? formData[index] = data : formData.push(data);\n    db.cache.put({\n      id: \"offlineForm\",\n      data: formData\n    });\n    alert('当前网络不佳，已为您离线存储');\n  });\n};\nexport const getOfflineForm = (templateForm, key) => {\n  return db.cache.get(\"offlineForm\").then(res => {\n    if (res === null || res === void 0 ? void 0 : res.data) {\n      let index = res === null || res === void 0 ? void 0 : res.data.findIndex(item => Object.keys(item)[0] === key);\n      let form = index >= 0 ? res.data[index][key] : templateForm;\n      return form;\n    } else {\n      return templateForm;\n    }\n  });\n};\nexport const deleteOfflineFromLocal = key => {\n  db.cache.get(\"offlineForm\").then(res => {\n    const formData = (res === null || res === void 0 ? void 0 : res.data) ? res.data : [];\n    let index = formData.findIndex(item => Object.keys(item)[0] === key);\n    formData.splice(index, 1);\n    db.cache.put({\n      id: \"offlineForm\",\n      data: formData\n    });\n  });\n};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/js/util.js"],"names":["action","api","db","publicFn","store","_","isVisible","schema","repo","normalize","documentAuthorizationC","Base64","serialize","sleep","ms","Promise","resolve","setTimeout","timeHorizonFilter","date","today","timeHorizon","leadingDate","Date","start","getDay","end","getTime","orderActivitiesSort","data","sort","a","b","templatesConverter","res","forEach","elem","activityNo","push","groupInfoProc","value","projectNo","JSON","parse","projectGroupInfo","groupInfoDeproc","Object","keys","key","stringify","fittersAssignmentTransferProc","verify","fields","verifyType","defaultPhotoValue","i","length","result","k","type","settings","required","alertInfo","labelI18n","Chinese","English","descriptionI18n","alert","min","max","maxMin","showNumberText","toDoOrDone","projectNumber","orderNumber","templates","documentList","orders","getState","productLine","productFamily","productCategory","templateParms","templateDataList","getTemplateList","requiredData","filter","item","mandDoc","documents","count","discription","documentDescription","name","includes","timeSort","property","bol","value1","value2","whetherToShutDown","orderActivities","confirmedDate","getCurrentElevatorStatus","orderProgress","elevatorInstallationProgress","orderNo","threeStep","orderActivitie","indexOf","activityNumber","progress","Math","round","steps14","step","editable","documentActivity","activityModified","confirmedTime","modified","projectProgress","projectOrders","progressArray","sum","ceil","setActivityStatusParams","combinePdf","foe","fo","region","branch","prctr","originalStep","isInstallationStepEditable","undefined","calculationOfInstallationSteps","handedOverToMaintenance","debugQuantity","guideDoorInstallation","startTheInstallation","installationNotStarted","orderNos","theOverallProgress","currentRefreshTime","getMonth","getDate","getHours","getMinutes","saveTheFirstRefreshTime","dispatch","cache","get","then","datatime","allDataRefreshTime","masterDataRefreshTime","orderDataRefreshTime","templateListDataRefreshTime","documentListDataRefreshTime","taskListDataRefreshTime","setAllDataRefreshTime","put","id","language","recordRefreshTime","projects","userInfo","parmas","projectNos","auth","window","localStorage","getItem","roles","isSubconTLOrPE","isEISV","request","getDocumentListParmas","fetchOrders","fetchTasksList","fetchDocuments","find","order","isFormUpdated","currentForm","initForm","Array","isArray","isEqual","localInstallationStepsConfirmDateProc","stepNo","verifyWhenConfirm7020or70C0","checkSteps","message","checkTemplateForm","documentNo","documentPart","existData","code","getRawTemplate","getDraftFromLocal","draftParam","getDraft","param","expendParam","getDraftFromApi","form","saveDraftToLocal","currentParam","draftParams","storeData","deleteDraftFromLocal","deleteKeys","templatesData","condition1","condition2","condition3","condition4","condition5","condition6","condition7","condition8","array","getDocumentComplateStatus","activityList","orderDetailSteps","activityAuth","documentCompleteStatus","status","completeSum","completed","getStopsOrHoistHeight","chars","stops","hoistHeight","scrollToPosition","element","pathname","position","scrollPosition","current","scrollTop","removeNotVisibleFields","templateForm","cloneDeep","remove","field","getTaskCount","tasks","awaitCloseNum","taskCleaner","assigner","Status","awaitComplateNum","assignee","getAwaitComplateAwaitCloseCount","countTaskStatuses","statusCount","task","taskType","taskStatusCount","updatedTasks","map","pendingCloseCount","pendingCompleteCount","pendingStartCoun","toString","checkFileIsExisting","template","documentName","index","getChecklistActivityNo","activtyNo","listData","getNonConformityConfig","allowreupload","closeEnabledInOILScreen","customizer","objValue","srcValue","concat","updateOrdersData","soNo","showLoading","fetchOrdersDataByProjects","response","entities","ordersData","mergeWith","fetchLocalInstallationStepsConfirmDate","catch","error","setError","finally","hideLoading","disableForm","params","showUploadButton","nonConformityConfig","root","documentsItem","disableTheEntranceroot","description","ele","docAuthActivityNos","canUploadDoc","isEnableCorrectImage","now","year","getFullYear","month","String","padStart","day","hours","minutes","seconds","getSeconds","getCurrentPosition","navigator","geolocation","latitude","coords","longitude","getLocationFromCoordinates","reject","BMap","geocoder","Geocoder","point","Point","getLocation","address","fillTextToImg","base64","projectParams","isOnline","location","projectName","time","watermarkText","img","Image","src","setAttribute","onload","canvas","document","createElement","ctx","getContext","width","height","fillRect","drawImage","font","textAlign","fillStyle","lineHeight","fillText","toDataURL","formatDateToYMD","dateString","console","log","taskDataConversion","taskId","salesOrderNo","planStartDate","planEndDate","actualStartDate","actualEndDate","actualCloseDate","closedDate","statusDesc","finishOrCloseCheck","submit","activityParams","ProjectNo","OrderNo","ActivityNo","Description","getNoConformityList","foundItems","nonConformities","flatMap","nonConformityItems","subItem","itemValue","offlineSaving","templateFormData","encode","formData","findIndex","getOfflineForm","deleteOfflineFromLocal","splice"],"mappings":"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","sourcesContent":["import * as action from \"actions\";\r\nimport * as api from \"api\";\r\nimport { db } from \"js/db\";\r\nimport * as publicFn from \"js/publicFn/index\";\r\nimport store from \"js/store\";\r\nimport _ from \"lodash\";\r\nimport { isVisible } from \"./templateFormUtil/index\";\r\nimport * as schema from \"js/schema\";\r\nimport * as repo from \"js/fetch\";\r\nimport { normalize } from \"normalizr\";\r\nimport { documentAuthorizationC } from \"js/publicFn\";\r\nimport { Base64 } from \"js-base64\";\r\nimport { serialize } from \"js/sfdl\";\r\n\r\nexport const sleep = (ms) => {\r\n  return new Promise((resolve) => {\r\n    setTimeout(resolve, ms);\r\n  });\r\n};\r\n\r\nexport const timeHorizonFilter = (date, today, timeHorizon) => {\r\n  const leadingDate = new Date(date);\r\n  switch (timeHorizon) {\r\n    case \"thisWeek\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 7 * 86400000;\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"twoWeeks\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 14 * 86400000;\r\n\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"fourWeeks\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 28 * 86400000;\r\n\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"eightWeeks\": {\r\n      const start = today - new Date(today).getDay() * 86400000;\r\n      const end = start + 56 * 86400000;\r\n\r\n      return leadingDate.getTime() <= end;\r\n    }\r\n    case \"all\":\r\n    default: {\r\n      return true;\r\n    }\r\n  }\r\n};\r\n\r\nexport const orderActivitiesSort = (data) => {\r\n  return data.sort(function (a, b) {\r\n    if (a.sort < b.sort) {\r\n      return -1;\r\n    } else {\r\n      return 1;\r\n    }\r\n  });\r\n};\r\n\r\nexport const templatesConverter = (data) => {\r\n  let res = {};\r\n\r\n  data.forEach((elem) => {\r\n    if (!res[elem.activityNo]) {\r\n      res[elem.activityNo] = [];\r\n    }\r\n\r\n    res[elem.activityNo].push(elem);\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const groupInfoProc = (data) => {\r\n  const res = {};\r\n\r\n  data.forEach((value) => {\r\n    res[value.projectNo] = JSON.parse(value.projectGroupInfo);\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const groupInfoDeproc = (data) => {\r\n  const res = [];\r\n\r\n  Object.keys(data).forEach((key) => {\r\n    const elem = {};\r\n\r\n    elem.projectNo = key;\r\n    elem.projectGroupInfo = JSON.stringify(data[key]);\r\n\r\n    res.push(elem);\r\n  });\r\n  return res;\r\n};\r\n\r\nexport const fittersAssignmentTransferProc = (data) => {\r\n  const res = {};\r\n\r\n  data.forEach((value) => {\r\n    if (!res[value.projectNo]) {\r\n      res[value.projectNo] = [];\r\n    }\r\n    res[value.projectNo].push(value);\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const verify = (fields) => {\r\n  const verifyType = [\r\n    \"singleLine\",\r\n    \"paragraph\",\r\n    \"number\",\r\n    \"multipleChoice\",\r\n    \"dropdown\",\r\n    \"dropdown\",\r\n    \"signature\",\r\n    \"photo\",\r\n    \"naYesNo\",\r\n  ];\r\n\r\n  const defaultPhotoValue =\r\n    \"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7\";\r\n\r\n  for (let i = 0; i < fields.length; i++) {\r\n    const result = isVisible(fields[i]);\r\n    if (result) {\r\n      for (let k = 0; k < verifyType.length; k++) {\r\n        if (fields[i].type === verifyType[k] && fields[i].settings.required) {\r\n          let alertInfo;\r\n          if (fields[i].settings.labelI18n.Chinese) {\r\n            alertInfo = fields[i].settings.labelI18n.Chinese;\r\n          } else if (fields[i].settings.labelI18n.English) {\r\n            alertInfo = fields[i].settings.labelI18n.English;\r\n          } else if (fields[i].settings.descriptionI18n.Chinese) {\r\n            alertInfo = fields[i].settings.descriptionI18n.Chinese;\r\n          } else {\r\n            alertInfo = fields[i].settings.descriptionI18n.English;\r\n          }\r\n\r\n          if (\r\n            fields[i].settings.value === defaultPhotoValue ||\r\n            fields[i].settings.value === \"\" ||\r\n            fields[i].settings.value === \"-\"\r\n          ) {\r\n            alert(alertInfo);\r\n\r\n            return false;\r\n          } else if (fields[i].settings.value === \"#\") {\r\n            alert(alertInfo);\r\n            return false;\r\n          } else if (fields[i].type === \"number\") {\r\n            if (fields[i].settings.min || fields[i].settings.max) {\r\n              if (fields[i].settings.value < fields[i].settings.min || fields[i].settings.value > fields[i].settings.max) {\r\n                const maxMin = showNumberText(fields[i].settings.min, fields[i].settings.max);\r\n                alert(`${alertInfo}: ${maxMin}`)\r\n                return false;\r\n              }\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return true;\r\n};\r\n\r\nexport const toDoOrDone = (\r\n  projectNumber,\r\n  orderNumber,\r\n  activityNo,\r\n  templates,\r\n  documentList\r\n) => {\r\n  const orders = store.getState().orders;\r\n  const productLine = orders[orderNumber]?.productLine;\r\n  const productFamily = orders[orderNumber]?.productFamily;\r\n  const productCategory = orders[orderNumber]?.productCategory;\r\n  const templateParms = templates[activityNo] ? templates[activityNo] : [];\r\n  const templateDataList = getTemplateList(\r\n    templateParms,\r\n    productLine,\r\n    productFamily,\r\n    productCategory\r\n  );\r\n\r\n  if (templateDataList.length > 0) {\r\n    const requiredData = templateDataList.filter(\r\n      (item) => item.mandDoc === \"X\"\r\n    );\r\n    if (requiredData.length > 0) {\r\n      const documents =\r\n        documentList?.[projectNumber]?.[orderNumber]?.[activityNo];\r\n\r\n      let count = 0;\r\n      if (documents) {\r\n        for (let i = 0; i < requiredData.length; i++) {\r\n          const discription = `${requiredData[i].documentDescription}`;\r\n          for (let k = 0; k < documents.length; k++) {\r\n            documents[k]?.name.includes(discription) && count++;\r\n          }\r\n        }\r\n\r\n        if (requiredData.length <= count) {\r\n          return \"Done\";\r\n        } else {\r\n          return \"ToDo\";\r\n        }\r\n      } else {\r\n        return \"ToDo\";\r\n      }\r\n    } else {\r\n      return \"Done\"; //如果没有必填\r\n    }\r\n  } else {\r\n    return \"WithoutTemplates\";\r\n  }\r\n};\r\n\r\nexport const timeSort = (property, bol) => {\r\n  return function (a, b) {\r\n    var value1 = a[property];\r\n    var value2 = b[property];\r\n\r\n    if (bol) {\r\n      // 升序\r\n      return Date.parse(value1) - Date.parse(value2);\r\n    } else {\r\n      // 降序\r\n      return Date.parse(value2) - Date.parse(value1);\r\n    }\r\n  };\r\n};\r\n\r\nexport const whetherToShutDown = (orderActivities, orderNumber) => {\r\n  if (\r\n    orderActivities[orderNumber + \"-7720\"] &&\r\n    !orderActivities[orderNumber + \"-7720\"].confirmedDate\r\n  ) {\r\n    return \"停工中\";\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport const getCurrentElevatorStatus = (orderActivities, orderNumber) => {\r\n  if (\r\n    orderActivities[orderNumber + \"-7720\"] &&\r\n    !orderActivities[orderNumber + \"-7720\"].confirmedDate\r\n  ) {\r\n    return \"停工中\";\r\n  } else if (orderActivities[orderNumber + \"-7350\"]?.confirmedDate) {\r\n    return \"安装中\";\r\n  } else {\r\n    return \"未到货\";\r\n  }\r\n};\r\n\r\nexport const orderProgress = (orderActivities, orderNumber) => {\r\n  //电梯整体安装进度\r\n\r\n  if (orderActivities[orderNumber + \"-7800\"]?.confirmedDate) {\r\n    return 100;\r\n  }\r\n  if (orderActivities[orderNumber + \"-70D0\"]?.confirmedDate) {\r\n    return 60;\r\n  }\r\n  if (\r\n    orderActivities[orderNumber + \"-7020\"]?.confirmedDate &&\r\n    !orderActivities[orderNumber + \"-70D0\"]\r\n  ) {\r\n    return 60;\r\n  }\r\n  if (orderActivities[orderNumber + \"-8010\"]?.confirmedDate) {\r\n    return 30;\r\n  } else {\r\n    return 0;\r\n  }\r\n};\r\n\r\n//电梯安装进度\r\nexport const elevatorInstallationProgress = (\r\n  projectNumber,\r\n  orderActivities,\r\n  orderNo,\r\n  documentList\r\n) => {\r\n  if (!orderActivities[orderNo + \"-7040\"]) {\r\n    // 三步\r\n    const threeStep = [\"7010\", \"7020\", \"7600\"];\r\n    const orderActivitie = Object.keys(orderActivities).filter((item) => {\r\n      return (\r\n        orderActivities[item].orderNumber === orderNo &&\r\n        threeStep.indexOf(orderActivities[item].activityNumber) > -1\r\n      );\r\n    });\r\n\r\n    const progress = orderActivitie.filter((item) => {\r\n      return orderActivities[item].confirmedDate !== null;\r\n    });\r\n\r\n    return Math.round((progress.length * 100) / 3) + \"%\";\r\n  } else {\r\n    // 十四步\r\n    let elevatorInstallationProgress = 0;\r\n    const steps14 = [\r\n      \"7010\",\r\n      \"7020\",\r\n      \"7030\",\r\n      \"7040\",\r\n      \"7050\",\r\n      \"7060\",\r\n      \"7070\",\r\n      \"7080\",\r\n      \"7090\",\r\n      \"70A0\",\r\n      \"70B0\",\r\n      \"70C0\",\r\n      \"70D0\",\r\n      \"7600\",\r\n    ];\r\n\r\n    steps14.forEach((step) => {\r\n      if (\r\n        orderActivities[orderNo + \"-\" + step].editable &&\r\n        orderActivities[orderNo + \"-\" + step].confirmedDate\r\n      ) {\r\n        elevatorInstallationProgress += 1;\r\n      } else if (!orderActivities[orderNo + \"-\" + step].editable) {\r\n        const documentActivity = documentList[projectNumber]?.[orderNo]?.[step];\r\n        const activityModified = documentActivity\r\n          ? documentActivity.sort(timeSort(\"modified\", false))\r\n          : null;\r\n        const confirmedTime = activityModified\r\n          ? activityModified?.[0].modified\r\n          : null;\r\n        confirmedTime && (elevatorInstallationProgress += 1);\r\n      }\r\n    });\r\n\r\n    const result = (elevatorInstallationProgress / 14) * 100;\r\n    return Math.round(result) + \"%\";\r\n  }\r\n};\r\n\r\nexport const projectProgress = (projectNumber, orders, orderActivities) => {\r\n  const projectOrders = [];\r\n  Object.keys(orders).forEach((item) => {\r\n    orders[item].projectNumber === projectNumber && projectOrders.push(item);\r\n  });\r\n  const progressArray = [];\r\n  projectOrders.forEach((item) => {\r\n    let progress = orderProgress(orderActivities, item);\r\n\r\n    progressArray.push(progress);\r\n  });\r\n\r\n  let sum = 0;\r\n\r\n  progressArray.forEach((item) => {\r\n    sum += item === \"停工中\" ? 0 : item;\r\n  });\r\n  const projectProgress = Math.ceil(sum / projectOrders.length);\r\n  return projectProgress;\r\n};\r\n\r\n/**\r\n    {\r\n      \"projectNo\": \"string\",\r\n      \"orderNo\": \"string\",\r\n      \"activityNo\": \"string\",\r\n      \"type\": 0,\r\n      \"date\": \"string\",\r\n      \"combinePdf\": true\r\n    }\r\n */\r\nexport const setActivityStatusParams = (\r\n  projectNo,\r\n  orderNo,\r\n  activityNo,\r\n  date,\r\n  type,\r\n  orderActivities,\r\n  orders\r\n) => {\r\n  const result = {};\r\n  result.projectNo = projectNo;\r\n  result.orderNo = orderNo;\r\n  result.activityNo = activityNo;\r\n  result.date = date;\r\n  result.type = type;\r\n  result.combinePdf = false;\r\n  result.foe = orders?.[orderNo]?.fo;\r\n  result.region = orders?.[orderNo]?.region;\r\n  result.branch = orders?.[orderNo]?.prctr;\r\n\r\n  if (orderActivities[orderNo + \"-7030\"]) {\r\n    // 14 steps (or 9 steps)\r\n    if (activityNo === \"70C0\") {\r\n      result.combinePdf = true;\r\n    }\r\n\r\n    if (orderActivities[orderNo + \"-\" + activityNo].originalStep) {\r\n      result.activityNo =\r\n        orderActivities[orderNo + \"-\" + activityNo].originalStep;\r\n    }\r\n  }\r\n  return result;\r\n};\r\n\r\nexport const isInstallationStepEditable = (\r\n  orderNo,\r\n  activityNo,\r\n  orderActivities\r\n) => {\r\n  if (\r\n    orderActivities[orderNo + \"-\" + activityNo].editable === undefined ||\r\n    orderActivities[orderNo + \"-\" + activityNo].editable\r\n  ) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport const calculationOfInstallationSteps = (orderActivities, orders) => {\r\n  let handedOverToMaintenance = 0; //移交维保\r\n  let debugQuantity = 0; // 调试\r\n  let guideDoorInstallation = 0; //导轨门安装\r\n  let startTheInstallation = 0; //开始安装\r\n  let installationNotStarted = 0; //未开始安装\r\n  const orderNos = Object.keys(orders);\r\n  for (let i = 0; i < orderNos.length; i++) {\r\n    if (\r\n      orderActivities[orderNos[i] + \"-7800\"] &&\r\n      orderActivities[orderNos[i] + \"-7800\"]?.confirmedDate\r\n    ) {\r\n      handedOverToMaintenance++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-70C0\"] &&\r\n      orderActivities[orderNos[i] + \"-70C0\"]?.confirmedDate\r\n    ) {\r\n      debugQuantity++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-7020\"] &&\r\n      orderActivities[orderNos[i] + \"-7020\"]?.confirmedDate\r\n    ) {\r\n      debugQuantity++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-8010\"] &&\r\n      orderActivities[orderNos[i] + \"-8010\"]?.confirmedDate\r\n    ) {\r\n      guideDoorInstallation++;\r\n    } else if (\r\n      orderActivities[orderNos[i] + \"-7700\"] &&\r\n      orderActivities[orderNos[i] + \"-7700\"]?.confirmedDate\r\n    ) {\r\n      startTheInstallation++;\r\n    } else {\r\n      installationNotStarted++;\r\n    }\r\n  }\r\n\r\n  let theOverallProgress = 0;\r\n  const data = [\r\n    handedOverToMaintenance,\r\n    debugQuantity,\r\n    guideDoorInstallation,\r\n    startTheInstallation,\r\n    installationNotStarted,\r\n  ];\r\n  data.forEach((item) => {\r\n    theOverallProgress += item;\r\n  });\r\n\r\n  return {\r\n    handedOverToMaintenance,\r\n    debugQuantity,\r\n    guideDoorInstallation,\r\n    startTheInstallation,\r\n    installationNotStarted,\r\n    theOverallProgress,\r\n  };\r\n};\r\n\r\nexport const currentRefreshTime = () => {\r\n  return `${new Date().getMonth() + 1\r\n    }/${new Date().getDate()} ${new Date().getHours()}:${new Date().getMinutes() < 10\r\n      ? \"0\" + new Date().getMinutes()\r\n      : new Date().getMinutes()\r\n    }`;\r\n};\r\n\r\nexport const saveTheFirstRefreshTime = (dispatch) => {\r\n  db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n    const datatime = {\r\n      allDataRefreshTime: currentRefreshTime(),\r\n      masterDataRefreshTime: currentRefreshTime(),\r\n      orderDataRefreshTime: currentRefreshTime(),\r\n      templateListDataRefreshTime: currentRefreshTime(),\r\n      documentListDataRefreshTime: currentRefreshTime(),\r\n      taskListDataRefreshTime: currentRefreshTime(),\r\n    };\r\n    dispatch(action.setAllDataRefreshTime(datatime));\r\n\r\n    !cache?.data &&\r\n      db.cache\r\n        .put({\r\n          id: \"dataRefreshTime\",\r\n          data: datatime,\r\n        })\r\n        .then(() => {\r\n          dispatch(action.setAllDataRefreshTime(datatime));\r\n        });\r\n  });\r\n\r\n  db.cache.get(\"settings\").then((cache) => {\r\n    const language = \"zh-cn\";\r\n    !cache?.data &&\r\n      db.cache\r\n        .put({\r\n          id: \"settings\",\r\n          data: { language: \"zh-cn\" },\r\n        })\r\n        .then(() => {\r\n          dispatch(action.setAllDataRefreshTime(language));\r\n        });\r\n  });\r\n};\r\n\r\nexport const recordRefreshTime = (dispatch, name, projects, userInfo) => {\r\n  if (name) {\r\n    const parmas = {\r\n      projectNos: Object.keys(projects),\r\n    };\r\n\r\n    const auth = JSON.parse(window.localStorage.getItem(\"auth\"));\r\n    let roles = auth?.roles;\r\n    const isSubconTLOrPE = roles.indexOf('Subcon TL') > -1 || roles.indexOf('PE') > -1;\r\n    const isEISV = roles.indexOf('SL') > -1;\r\n\r\n    const request = getDocumentListParmas(parmas.projectNos);\r\n    switch (name) {\r\n      case \"all\":\r\n        if (isSubconTLOrPE || isEISV) {\r\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch));\r\n        } else {\r\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch));\r\n          // dispatch(action.fetchDocuments(request, dispatch));\r\n          dispatch(action.fetchTasksList(userInfo, dispatch));\r\n        }\r\n        break;\r\n      case \"orders\":\r\n        dispatch(action.fetchOrders(parmas, \"\", userInfo, dispatch));\r\n        break;\r\n      case \"documents\":\r\n        dispatch(action.fetchDocuments(request, userInfo, dispatch));\r\n        break;\r\n      case \"task\":\r\n        dispatch(action.fetchTasksList(request,userInfo,\"\", dispatch));\r\n        break;\r\n      default:\r\n        return (\r\n          dispatch(action.fetchOrders(request, \"all\", userInfo, dispatch)),\r\n          // dispatch(action.fetchDocuments(dispatch)),\r\n          dispatch(action.fetchTasksList(userInfo, dispatch))\r\n        );\r\n    }\r\n  } else {\r\n    db.cache.get(\"dataRefreshTime\").then((cache) => {\r\n      cache?.data && dispatch(action.setAllDataRefreshTime(cache.data));\r\n    });\r\n  }\r\n};\r\n\r\nexport const getDocumentListParmas = (projectNos, orderNos) => {\r\n  const orders = orderNos ? orderNos:  store.getState().orders;\r\n  let data = [];\r\n  for (let i = 0; i < projectNos.length; i++) {\r\n    Object.keys(orders).find((item) => {\r\n      return (\r\n        orders[item].projectNumber === projectNos[i] &&\r\n        data.push({\r\n          foe: orders[item].fo,\r\n          region: orders[item].region,\r\n          branch: orders[item].prctr,\r\n          projectNo: orders[item].projectNumber,\r\n          orders: Object.keys(orders).filter((order) => {\r\n            return orders[order].projectNumber === orders[item].projectNumber;\r\n          }),\r\n        })\r\n      );\r\n    });\r\n  }\r\n\r\n  return data;\r\n};\r\n\r\nexport const isFormUpdated = (currentForm, initForm) => {\r\n  if (currentForm.fields.length !== initForm.fields.length) {\r\n    return false;\r\n  }\r\n\r\n  for (let i = 0; i < currentForm.fields.length; i++) {\r\n    if (Array.isArray(currentForm.fields[i].settings.value)) {\r\n      if (\r\n        !_.isEqual(\r\n          currentForm.fields[i].settings.value.sort(),\r\n          initForm.fields[i].settings.value.sort()\r\n        )\r\n      ) {\r\n        return true;\r\n      }\r\n    } else {\r\n      if (\r\n        currentForm.fields[i].settings.value !==\r\n        initForm.fields[i].settings.value\r\n      ) {\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  return false;\r\n};\r\n\r\nexport const localInstallationStepsConfirmDateProc = (data) => {\r\n  const res = {};\r\n\r\n  data.forEach((value) => {\r\n    res[value.orderNo + \"-\" + value.stepNo] = value;\r\n  });\r\n\r\n  return res;\r\n};\r\n\r\nexport const verifyWhenConfirm7020or70C0 = (\r\n  orderActivities,\r\n  orderNumber,\r\n  activityNumber\r\n) => {\r\n  // 14 steps\r\n  if (orderActivities[orderNumber + \"-7030\"]) {\r\n    if (activityNumber === \"70C0\") {\r\n      const checkSteps = [\r\n        \"7010\",\r\n        \"7020\",\r\n        \"7030\",\r\n        \"7040\",\r\n        \"7050\",\r\n        \"7060\",\r\n        \"7070\",\r\n        \"7080\",\r\n        \"7090\",\r\n        \"70A0\",\r\n        \"70B0\",\r\n      ];\r\n\r\n      const result = checkSteps.find(\r\n        (step) => !orderActivities[orderNumber + \"-\" + step].confirmedDate\r\n      );\r\n\r\n      if (result) {\r\n        return {\r\n          stepNo: result,\r\n          message: \"未确认,请先确认\",\r\n        };\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n *  code: 1: 本地不存在template\r\n *        2：本地存在template,但是不一样\r\n *        3：本地存在template,但是一样\r\n */\r\nexport const checkTemplateForm = (documentNo, documentPart, value) => {\r\n  const key = documentNo + \"-\" + documentPart;\r\n  return db.cache.get(\"rawTemplateForm\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      if (!existData[key]) {\r\n        existData[key] = value;\r\n\r\n        return db.cache\r\n          .put({ id: \"rawTemplateForm\", data: existData })\r\n          .then(() => {\r\n            return Promise.resolve({ code: 1, value });\r\n          });\r\n      }\r\n\r\n      if (existData[key] !== value) {\r\n        existData[key] = value;\r\n\r\n        return db.cache\r\n          .put({ id: \"rawTemplateForm\", data: existData })\r\n          .then(() => {\r\n            return Promise.resolve({ code: 2, value });\r\n          });\r\n      }\r\n\r\n      return Promise.resolve({ code: 3, value });\r\n    } else {\r\n      const data = {};\r\n      data[key] = value;\r\n\r\n      return db.cache.put({ id: \"rawTemplateForm\", data }).then(() => {\r\n        return Promise.resolve({ code: 1, value });\r\n      });\r\n    }\r\n  });\r\n};\r\n\r\nexport const getRawTemplate = (documentNo, documentPart) => {\r\n  const key = documentNo + \"-\" + documentPart;\r\n  return db.cache.get(\"rawTemplateForm\").then((cache) => {\r\n    // TODO: 这边正常流程下来都会有数据，可提高代码健壮性\r\n    if (cache?.data) {\r\n      return Promise.resolve(cache.data[key]);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * code: 1: 本地存在draft\r\n *      2： 本地不存在draft\r\n */\r\nexport const getDraftFromLocal = (\r\n  documentNo,\r\n  documentPart,\r\n  activityNo,\r\n  productFamily,\r\n  productLine,\r\n  language,\r\n  draftParam\r\n) => {\r\n  const { orderNo } = draftParam;\r\n  const key =\r\n    orderNo +\r\n    \"-\" +\r\n    activityNo +\r\n    \"-\" +\r\n    documentNo +\r\n    \"-\" +\r\n    documentPart +\r\n    \"-\" +\r\n    productFamily +\r\n    \"-\" +\r\n    productLine +\r\n    \"-\" +\r\n    language;\r\n  return db.cache.get(\"templateDraft\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      if (existData[key]) {\r\n        return Promise.resolve({ code: 1, value: existData[key] });\r\n      }\r\n\r\n      return Promise.resolve({ code: 2 });\r\n    } else {\r\n      return Promise.resolve({ code: 2 });\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * code： 1：draft 存在\r\n *        2：draft 不存在\r\n */\r\nexport const getDraft = (param, draftParam, expendParam) => {\r\n  const { documentNo, documentPart } = param;\r\n  const { activityNo, productFamily, productLine, language } = expendParam;\r\n  return getDraftFromLocal(\r\n    documentNo,\r\n    documentPart,\r\n    activityNo,\r\n    productFamily,\r\n    productLine,\r\n    language,\r\n    draftParam\r\n  ).then((data) => {\r\n    if (data.code === 1) {\r\n      return Promise.resolve(data);\r\n    } else\r\n      return getDraftFromApi(draftParam).then((data) => {\r\n        return Promise.resolve(data);\r\n      });\r\n  });\r\n};\r\n\r\n/**\r\n * code: 1 draft 存在\r\n *       2 draft 不存在\r\n */\r\nexport const getDraftFromApi = (draftParam) => {\r\n  return api.getDraft(draftParam).then((res) => {\r\n    if (res.data.form) {\r\n      return Promise.resolve({ code: 1, value: res.data.form });\r\n    } else {\r\n      return Promise.resolve({ code: 2 });\r\n    }\r\n  });\r\n};\r\n\r\nexport const saveDraftToLocal = (data, currentParam, draftParams) => {\r\n  const { documentNo, documentPart } = currentParam;\r\n  const { orderNo, activityNo, productFamily, productLine, language } =\r\n    draftParams;\r\n  const key =\r\n    orderNo +\r\n    \"-\" +\r\n    activityNo +\r\n    \"-\" +\r\n    documentNo +\r\n    \"-\" +\r\n    documentPart +\r\n    \"-\" +\r\n    productFamily +\r\n    \"-\" +\r\n    productLine +\r\n    \"-\" +\r\n    language;\r\n  db.cache.get(\"templateDraft\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      existData[key] = data;\r\n      db.cache.put({ id: \"templateDraft\", data: existData });\r\n    } else {\r\n      const storeData = {};\r\n      storeData[key] = data;\r\n      db.cache.put({ id: \"templateDraft\", data: storeData });\r\n    }\r\n  });\r\n};\r\n\r\nexport const deleteDraftFromLocal = (currentParam) => {\r\n  const { documentNo, documentPart } = currentParam;\r\n  db.cache.get(\"templateDraft\").then((cache) => {\r\n    if (cache?.data) {\r\n      const existData = cache.data;\r\n      const deleteKeys = Object.keys(existData).filter((key) => {\r\n        return key.includes(documentNo + \"-\" + documentPart);\r\n      });\r\n\r\n      deleteKeys.forEach((key) => {\r\n        delete existData[key];\r\n      });\r\n\r\n      db.cache.put({ id: \"templateDraft\", data: existData });\r\n    }\r\n  });\r\n};\r\n\r\nexport const getTemplateList = (templatesData, productLine, productFamily, productCategory) => {\r\n  const condition1 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productLine === productLine && item.productFamily === productFamily\r\n  );\r\n\r\n  const condition2 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productLine === productLine && item.productFamily === null\r\n  );\r\n\r\n  const condition3 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productFamily === productFamily && item.productLine === null\r\n  );\r\n\r\n  const condition4 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === productCategory && item.productLine === null && item.productFamily === null\r\n  );\r\n\r\n  const condition5 = templatesData.filter(\r\n    (item) =>\r\n      item.productLine === productLine && item.productFamily === productFamily && item.productCategory === null\r\n  );\r\n\r\n  const condition6 = templatesData.filter(\r\n    (item) =>\r\n      item.productLine === productLine && item.productCategory === null && item.productFamily === null\r\n  );\r\n\r\n  const condition7 = templatesData.filter(\r\n    (item) =>\r\n      item.productFamily === productFamily && item.productCategory === null && item.productLine === null\r\n  );\r\n\r\n  const condition8 = templatesData.filter(\r\n    (item) =>\r\n      item.productCategory === null && item.productLine === null && item.productFamily === null\r\n  );\r\n\r\n  const result = [\r\n    condition1,\r\n    condition2,\r\n    condition3,\r\n    condition4,\r\n    condition5,\r\n    condition6,\r\n    condition7,\r\n    condition8\r\n  ].find(array => array.length > 0)\r\n\r\n  return result ? result : [];\r\n};\r\n\r\nexport const getDocumentComplateStatus = (\r\n  auth,\r\n  projectNumber,\r\n  orderNo,\r\n  orderActivities,\r\n  templates,\r\n  documentList\r\n) => {\r\n  const activityList = publicFn.orderDetailSteps(\r\n    orderActivities,\r\n    orderNo,\r\n    auth.activityAuth,\r\n    auth.roles[0]\r\n  );\r\n\r\n  const documentCompleteStatus = [];\r\n  for (let i = 0; i < activityList.length; i++) {\r\n    if (orderActivities?.[orderNo + '-' + activityList[i]]) {\r\n      const status = toDoOrDone(\r\n        projectNumber,\r\n        orderNo,\r\n        activityList[i],\r\n        templates,\r\n        documentList\r\n      );\r\n      documentCompleteStatus.push(status);\r\n    }\r\n\r\n  }\r\n\r\n  const completeSum = [];\r\n  const completed = [];\r\n  for (let i = 0; i < documentCompleteStatus.length; i++) {\r\n    if (documentCompleteStatus[i] === \"ToDo\") {\r\n      completeSum.push(documentCompleteStatus[i]);\r\n    } else if (documentCompleteStatus[i] === \"Done\") {\r\n      completeSum.push(documentCompleteStatus[i]);\r\n      completed.push(documentCompleteStatus[i]);\r\n    }\r\n  }\r\n\r\n  return `${completed.length}/${completeSum.length}`;\r\n};\r\n\r\n// export const getStopsOrHoistHeight = (chars, orderNo, type) => {\r\n//   const condition = type === \"stops\" ? \"GRP_NUMBER_OF_STOPS\" : \"GRP_HQ\";\r\n\r\n//   const data = [];\r\n//   Object.keys(chars).filter((item) => {\r\n//     return (\r\n//       chars[item].orderNo === orderNo &&\r\n//       chars[item].charID === condition &&\r\n//       data.push(chars[item])\r\n//     );\r\n//   });\r\n//   console.log(data, type, orderNo);\r\n\r\n//   return data.length > 0 ? data[0].value : 0;\r\n// };\r\n\r\nexport const getStopsOrHoistHeight = (chars, orderNo, type) => {\r\n  const data = [];\r\n  Object.keys(chars).filter((item) => {\r\n    return chars[item].orderNo === orderNo && data.push(chars[item]);\r\n  });\r\n\r\n  if (type === \"stops\") {\r\n    const stops = data.filter((item) => {\r\n      return (\r\n        item.name.indexOf(\"停站数\") > -1 ||\r\n        item.name.indexOf(\"Number of stops\") > -1\r\n      );\r\n    });\r\n    return stops.length > 0 ? stops[0].value : 0;\r\n  } else {\r\n    const hoistHeight = data.filter((item) => {\r\n      return (\r\n        item.name.indexOf(\"提升高度\") > -1 ||\r\n        item.name.indexOf(\"Travel height\") > -1 ||\r\n        item.name.indexOf(\"Vertical rise\") > -1\r\n      );\r\n    });\r\n\r\n    return hoistHeight.length > 0 ? hoistHeight[0].value : 0;\r\n  }\r\n};\r\n\r\nexport const scrollToPosition = (element, pathname) => {\r\n  const position = store.getState().scrollPosition[pathname];\r\n  element.current.scrollTop = position ? position : 0;\r\n};\r\n\r\nexport const removeNotVisibleFields = (templateForm) => {\r\n  const result = _.cloneDeep(templateForm);\r\n  _.remove(result.fields, (field) => {\r\n    return !isVisible(field);\r\n  });\r\n  return result;\r\n};\r\n\r\nexport const getTaskCount = () => {\r\n  const tasks = store.getState().tasks;\r\n  const orders = store.getState().orders;\r\n  const projects = store.getState().projects;\r\n\r\n  const awaitCloseNum =\r\n    publicFn.taskCleaner(tasks.assigner, orders, projects) &&\r\n    publicFn.taskCleaner(tasks.assigner, orders, projects).filter((item) => {\r\n      return item.Status === \"D\";\r\n    }).length;\r\n\r\n  const awaitComplateNum =\r\n    publicFn.taskCleaner(tasks.assignee, orders, projects) &&\r\n    publicFn.taskCleaner(tasks.assignee, orders, projects).filter((item) => {\r\n      return item.Status === \"A\";\r\n    }).length;\r\n\r\n  return {\r\n    awaitCloseNum,\r\n    awaitComplateNum,\r\n  };\r\n};\r\n\r\nexport const getAwaitComplateAwaitCloseCount = (tasks) => {\r\n  const countTaskStatuses = (tasks) => {\r\n    const statusCount = {};\r\n    tasks.forEach(task => {\r\n      const { taskType, status } = task;\r\n      if (!statusCount[taskType]) {\r\n        statusCount[taskType] = { 'awaitStartNum': 0, \"awaitCloseNum\": 0, \"awaitComplateNum\": 0 };\r\n      }\r\n      if (status === \"awaitClose\") {\r\n        statusCount[taskType][\"awaitCloseNum\"] += 1;\r\n      } else if (status === \"awaitComplate\") {\r\n        statusCount[taskType][\"awaitComplateNum\"] += 1;\r\n      } else if (status === \"awaitStart\") {\r\n        statusCount[taskType][\"awaitStartNum\"] += 1;\r\n      }\r\n    });\r\n\r\n    return statusCount;\r\n  };\r\n\r\n  const taskStatusCount = countTaskStatuses(tasks);\r\n\r\n  const updatedTasks = tasks.map(task => {\r\n    const { taskType } = task;\r\n    const { \"awaitCloseNum\": pendingCloseCount, \"awaitComplateNum\": pendingCompleteCount, 'awaitStartNum': pendingStartCoun } = taskStatusCount[taskType] || { \"awaitCloseNum\": 0, \"awaitComplateNum\": 0, 'awaitStartNum': 0 };\r\n\r\n    return {\r\n      ...task,\r\n      \"awaitCloseNum\": pendingCloseCount,\r\n      \"awaitComplateNum\": pendingCompleteCount,\r\n      'awaitStartNum': pendingStartCoun\r\n    };\r\n  });\r\n  return updatedTasks;\r\n}\r\n\r\nexport const showNumberText = (min, max) => {\r\n  const a = min === 0 ? min.toString() : min;\r\n  const b = max === 0 ? max.toString() : max;\r\n\r\n  if (a || b) {\r\n    if (a && !b) {\r\n      return `(${a}...)`;\r\n    } else if (!a && b) {\r\n      return `(...${b})`;\r\n    } else {\r\n      return `(${a}-${b})`;\r\n    }\r\n  } else {\r\n    return \"\";\r\n  }\r\n};\r\n\r\nexport const checkFileIsExisting = (template, data, orders) => {\r\n  const templateDataList = getTemplateList(\r\n    template[data.activityNumber] || [],\r\n    orders[data.orderNumber].productLine,\r\n    orders[data.orderNumber].productFamily,\r\n    orders[data.orderNumber].productCategory\r\n  );\r\n\r\n  const param = templateDataList.map((item) => {\r\n    return {\r\n      foe: orders[data.orderNumber].fo,\r\n      region: orders[data.orderNumber].region,\r\n      branch: orders[data.orderNumber].prctr,\r\n      projectNo: orders[data.orderNumber].projectNumber,\r\n      orderNo: data.orderNumber,\r\n      activityNo: data.activityNumber,\r\n      documentName: item.documentDescription + \".eform2\",\r\n    };\r\n  });\r\n\r\n  return api.checkFileIsExisting(param).then((res) => {\r\n    let message = [];\r\n    res.data.forEach((item, index) => {\r\n      !item && message.push(templateDataList[index].documentDescription);\r\n    });\r\n\r\n    return message;\r\n  });\r\n};\r\n\r\nexport const getChecklistActivityNo = (data) => {\r\n  const activtyNo = \"V001\";\r\n\r\n  const listData =\r\n    store.getState()?.documentList?.[data.projectNumber]?.[data.orderNumber]?.[\r\n    activtyNo\r\n    ];\r\n\r\n  return listData ? activtyNo : false;\r\n};\r\n\r\n\r\nexport const getNonConformityConfig = () => {\r\n  return {\r\n    \"7010\": {\r\n      activityNo: \"7010\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7020\": {\r\n      activityNo: \"7020\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7030\": {\r\n      activityNo: \"7030\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7040\": {\r\n      activityNo: \"7040\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7050\": {\r\n      activityNo: \"7050\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7060\": {\r\n      activityNo: \"7060\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7070\": {\r\n      activityNo: \"7070\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7080\": {\r\n      activityNo: \"7080\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"7090\": {\r\n      activityNo: \"7090\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70A0\": {\r\n      activityNo: \"70A0\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70B0\": {\r\n      activityNo: \"70B0\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70C0\": {\r\n      activityNo: \"70C0\",\r\n      allowreupload: true,\r\n      closeEnabledInOILScreen: false\r\n    },\r\n    \"70D0\": {\r\n      activityNo: \"70D0\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7350\": {\r\n      activityNo: \"7350\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7360\": {\r\n      activityNo: \"7360\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7400\": {\r\n      activityNo: \"7400\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7500\": {\r\n      activityNo: \"7500\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7600\": {\r\n      activityNo: \"7600\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7620\": {\r\n      activityNo: \"7620\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7700\": {\r\n      activityNo: \"7700\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7800\": {\r\n      activityNo: \"7800\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"7950\": {\r\n      activityNo: \"7950\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"8010\": {\r\n      activityNo: \"8010\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    },\r\n    \"9200\": {\r\n      activityNo: \"9200\",\r\n      allowreupload: false,\r\n      closeEnabledInOILScreen: true\r\n    }\r\n  }\r\n}\r\n\r\nconst customizer = (objValue, srcValue) => {\r\n  if (Array.isArray(objValue) && Array.isArray(srcValue)) {\r\n    return objValue.concat(srcValue);\r\n  }\r\n};\r\n\r\nexport const updateOrdersData = (soNo, dispatch) => {\r\n  dispatch(action.showLoading());\r\n  api.fetchOrdersDataByProjects(soNo).then((response) => {\r\n    const { entities } = normalize(response.data, schema.ordersData);\r\n    db.cache.get(\"ordersData\").then((cache) => {\r\n      const result = _.mergeWith(cache.data, entities, customizer);\r\n      let projects = result.projects\r\n        ? Object.keys(result.projects)\r\n        : [];\r\n      db.cache.put({ id: \"ordersData\", data: result }).then(() => {\r\n        const param = { projectNos: projects }\r\n        repo\r\n          .fetchLocalInstallationStepsConfirmDate(param)\r\n\r\n        const request= getDocumentListParmas(param.projectNos, result?.orders)\r\n        dispatch(action.fetchDocuments(request, {}, dispatch));\r\n      });\r\n    });\r\n\r\n\r\n  }).catch((error) => {\r\n    dispatch(action.setError(error.message));\r\n  }).finally(() => {\r\n    dispatch(action.hideLoading());\r\n  });\r\n}\r\n\r\nexport const disableForm = (params = {}) => {\r\n  if (!showUploadButton()) {\r\n    return false\r\n  }\r\n\r\n  const { orderActivities, documentList, templates, orders, auth, nonConformityConfig } = store.getState();\r\n  const { activityNo, orderNo, productFamily, productLine, projectNumber, root } = params;\r\n  const productCategory = orders[orderNo]?.productCategory;\r\n  const templatesData = templates[activityNo] || [];\r\n  const documents = [];\r\n  const documentsItem = documentList[projectNumber]?.[orderNo]?.[activityNo];\r\n  const allowreupload = nonConformityConfig[activityNo]?.allowreupload;\r\n  const disableTheEntranceroot = root === \"listCard\";\r\n\r\n\r\n  const data = getTemplateList(templatesData, productLine, productFamily, productCategory);\r\n  const description = data.map((item) => {\r\n    return item.documentDescription;\r\n  });\r\n\r\n\r\n  description.forEach((item) => {\r\n    return (\r\n      (documentsItem &&\r\n        documentsItem.filter(\r\n          (ele) => ele.name.indexOf(item) > -1 && documents.push(ele)\r\n        )) ||\r\n      []\r\n    );\r\n  });\r\n\r\n  const docAuthActivityNos = documentAuthorizationC(\r\n    orderActivities,\r\n    orderNo,\r\n    auth.activityAuth,\r\n    auth.roles[0]\r\n  );\r\n\r\n  const canUploadDoc = docAuthActivityNos.includes(activityNo);\r\n\r\n  if (root === \"installationChecklist\") {\r\n    const template = {\r\n      mandDoc: \"Y\",\r\n      documentDescription: `安装检查清单`,\r\n    };\r\n\r\n    data.push(template);\r\n\r\n    documents.push(documentList?.[projectNumber]?.[orderNo]?.[activityNo][0]);\r\n  }\r\n\r\n  if (disableTheEntranceroot && canUploadDoc) {\r\n    return false\r\n  }\r\n\r\n  if (documents.length > 0) {\r\n    if (!allowreupload) {\r\n      return true\r\n    } else {\r\n      if (getChecklistActivityNo({ projectNumber: projectNumber, orderNumber: orderNo })) {\r\n        return true\r\n      } else {\r\n        return false;\r\n      }\r\n    }\r\n  } else {\r\n    return false\r\n  }\r\n}\r\n\r\nexport const showUploadButton = () => {\r\n  const {  auth } = store.getState();\r\n\r\n  return auth?.isEnableCorrectImage\r\n}\r\n\r\nconst getTime = () => {\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  const month = String(now.getMonth() + 1).padStart(2, '0');\r\n  const day = String(now.getDate()).padStart(2, '0');\r\n  const hours = String(now.getHours()).padStart(2, '0');\r\n  const minutes = String(now.getMinutes()).padStart(2, '0');\r\n  const seconds = String(now.getSeconds()).padStart(2, '0');\r\n\r\n  return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;\r\n}\r\n\r\nconst getCurrentPosition =  () => {\r\n  return new Promise((resolve) => {\r\n    if (navigator.geolocation) {\r\n      navigator.geolocation.getCurrentPosition(\r\n        (position) => {\r\n          const latitude = position.coords.latitude;\r\n          const longitude = position.coords.longitude;\r\n          resolve({ status: 'success', data: { latitude, longitude } });\r\n        },\r\n        (error) => {\r\n          resolve({ status: 'error', message: error.message });\r\n        }\r\n      );\r\n    } else {\r\n      resolve({ status: 'error', message: 'Geolocation is not supported by this browser.' });\r\n    }\r\n  });\r\n\r\n};\r\n\r\n// 根据经纬度获取详细地址\r\nconst getLocationFromCoordinates = (latitude, longitude) => {\r\n  return new Promise((resolve, reject) => {\r\n    if (window.BMap) {\r\n      const geocoder = new window.BMap.Geocoder(); // 创建 Geocoder 实例\r\n      const point = new window.BMap.Point(longitude, latitude); // 创建坐标对象\r\n\r\n      geocoder.getLocation(point, (result) => {\r\n        if (result) {\r\n          resolve(result.address);\r\n        } else {\r\n          resolve('无法获取地址信息');\r\n        }\r\n      });\r\n    } else {\r\n      reject('百度地图 API 未加载');\r\n    }\r\n  });\r\n};\r\n\r\nexport const fillTextToImg = async (base64, projectParams, isOnline) => {\r\n  let data = store.getState();\r\n  // let location = { longitude: \"121.197237\", latitude: \"31.449172\" }\r\n  var address = \"\";\r\n  if (isOnline) {\r\n    const location = await getCurrentPosition();\r\n    address = await getLocationFromCoordinates(location?.data?.latitude, location?.data?.longitude);\r\n  };\r\n  let projectName = data.projects[projectParams.projectNumber]?.description;\r\n  let time = getTime();\r\n\r\n  let watermarkText = [`拍摄地点：${address}`, `拍摄时间：${time}`, `订单编号：${projectParams.orderNo}`, `项目名称：${projectName}`];\r\n\r\n  const img = new Image();\r\n  img.src = base64;\r\n  img.setAttribute(\"crossOrigin\", \"Anonymous\");\r\n\r\n  return new Promise((resolve) => {\r\n\r\n    img.onload = () => {\r\n\r\n      const canvas = document.createElement(\"canvas\");\r\n      const ctx = canvas.getContext(\"2d\");\r\n\r\n      canvas.width = img.width;\r\n      canvas.height = img.height;\r\n\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);\r\n\r\n      ctx.font = '15px Arial';\r\n      ctx.textAlign = \"left\";\r\n      ctx.fillStyle = \"#ffffff\";\r\n\r\n      let lineHeight = 0;\r\n\r\n      watermarkText.forEach(item => {\r\n        lineHeight += 30\r\n        ctx.fillText(item, 20, canvas.height - lineHeight + 20);\r\n      })\r\n\r\n      resolve(canvas.toDataURL(\"image/jpg\"));\r\n    };\r\n  });\r\n}\r\n\r\nexport const formatDateToYMD = (dateString) => {\r\n  console.log(dateString)\r\n  const date = new Date(dateString);  // 将字符串转换为 Date 对象\r\n\r\n  const year = date.getFullYear();  // 获取年份\r\n  const month = String(date.getMonth() + 1).padStart(2, '0');  // 获取月份（注意月份是从0开始的，需加1）\r\n  const day = String(date.getDate()).padStart(2, '0');  // 获取日期\r\n\r\n  return dateString? `${year}-${month}-${day}`: null;  // 拼接成“YYYY年MM月DD日”格式\r\n}\r\n\r\nexport const taskDataConversion = (item) => {\r\n  let status;\r\n  switch (item.status) {\r\n    case 1:\r\n      status = \"awaitStart\"\r\n      break;\r\n    case 2:\r\n      status = \"awaitComplate\";\r\n      break;\r\n    case 3:\r\n      status = \"awaitClose\";\r\n      break;\r\n    case 4:\r\n      status = 'closed';\r\n      break;\r\n    case 5:\r\n      status = 'closed';\r\n      break;\r\n    default:\r\n      status = 'closed';\r\n      break;\r\n  };\r\n\r\n  return {\r\n    taskId: item.id,\r\n    taskType: item.type,\r\n    projectNo: item.projectNo,\r\n    orderNo: item.salesOrderNo,\r\n    activityNo: item.activityNo,\r\n    projectName: item.projectName,\r\n    planStartDate: formatDateToYMD(item.planStartDate),\r\n    planEndDate: formatDateToYMD(item.planEndDate),\r\n    actualStartDate: formatDateToYMD(item.actualStartDate),\r\n    actualEndDate: formatDateToYMD(item.actualEndDate),\r\n    actualCloseDate: formatDateToYMD(item.closedDate),\r\n    statusDesc: item.statusDesc,\r\n    status: status\r\n  };\r\n\r\n}\r\n\r\nexport const finishOrCloseCheck = (type, orderActivities, data, templates, orders, submit, activityParams) => {\r\n  if (type === \"close\") {\r\n    const result = verifyWhenConfirm7020or70C0(\r\n      orderActivities,\r\n      data.orderNo,\r\n      data.activityNo\r\n    );\r\n    if (result) {\r\n      alert(result.stepNo + result.message);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  checkFileIsExisting(templates, {\r\n    orderNumber: data.orderNo,\r\n    activityNumber: data.activityNo\r\n  }, orders).then((message) => {\r\n    if (message.length < 1) {\r\n      if (type === \"close\") {\r\n        const templateDataList = getTemplateList(\r\n          templates[data.activityNo] || [],\r\n          orders[data.orderNo].productLine,\r\n          orders[data.orderNo].productFamily,\r\n          orders[data.orderNo].productCategory\r\n        );\r\n\r\n        const param = templateDataList.map((item) => {\r\n          return {\r\n            foe: orders[data.orderNo].fo,\r\n            region: orders[data.orderNo].region,\r\n            branch: orders[data.orderNo].prctr,\r\n            ProjectNo: orders[data.orderNo].projectNumber,\r\n            OrderNo: data.orderNo,\r\n            ActivityNo: data.activityNo,\r\n            Description: item.documentDescription,\r\n          };\r\n        });\r\n\r\n       param.map(item =>\r\n            store.dispatch(action.getNoConformityList(item)).then((res) => {\r\n            const foundItems = res.data?.[0].nonConformities?.flatMap(key =>\r\n              key.nonConformityItems.filter(\r\n                subItem => subItem.itemValue === \"no\"\r\n              )\r\n              );\r\n              if (foundItems.length > 0) {\r\n                alert(`您有${foundItems.length}个不符合项未关闭，请点击已上传按钮进入查看&关闭不符合项界面关闭所有不符合项后，才能关闭任务`);\r\n              return false;\r\n            } else {\r\n              submit(type, data, activityParams)\r\n              }\r\n          })\r\n       )\r\n      \r\n      };\r\n      type === 'finish' && submit(type, data, activityParams);\r\n    } else {\r\n      alert(`请点击待处理 上传 ${message.toString()}`);\r\n      return false;\r\n    }\r\n  });\r\n}\r\n\r\nexport const offlineSaving = (templateFormData, key) => {\r\n  const data = {\r\n    [key]: Base64.encode(serialize(templateFormData))\r\n  }\r\n  db.cache.get(\"offlineForm\").then((res) => {\r\n    const formData = res?.data ? res.data : [];\r\n    let index = formData.findIndex((item) => Object.keys(item)[0] === Object.keys(data)[0]);\r\n    index >= 0 ? formData[index] = data : formData.push(data);\r\n    db.cache.put({ id: \"offlineForm\", data: formData })\r\n    alert('当前网络不佳，已为您离线存储')\r\n  })\r\n}\r\n\r\n\r\nexport const getOfflineForm = (templateForm, key) => {\r\n  return db.cache.get(\"offlineForm\").then((res) => {\r\n    if (res?.data) {\r\n      let index = res?.data.findIndex((item) => Object.keys(item)[0] === key);\r\n      let form = index >= 0 ? res.data[index][key] : templateForm;\r\n      return form\r\n    } else {\r\n      return templateForm\r\n    }\r\n  });\r\n};\r\n\r\nexport const deleteOfflineFromLocal = (key) => {\r\n  db.cache.get(\"offlineForm\").then((res) => {\r\n          const formData = res?.data ? res.data : [];\r\n          let index = formData.findIndex((item) => Object.keys(item)[0] === key);\r\n          formData.splice(index, 1)\r\n          db.cache.put({ id: \"offlineForm\", data: formData })\r\n        })\r\n}"]},"metadata":{},"sourceType":"module"}