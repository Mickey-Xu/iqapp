{"ast":null,"code":"import _slicedToArray from\"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import{Box,Button,MenuItem,TextField,Typography}from\"@material-ui/core\";import{withStyles}from\"@material-ui/core/styles\";import{DatePicker}from\"@material-ui/pickers\";import*as action from\"actions\";import{LocalizeContext}from\"i18n\";import*as repo from\"js/fetch\";import PrimaryLayout from\"layouts/PrimaryLayout\";import lodash from\"lodash\";import moment from\"moment\";import React,{useState}from\"react\";import{connect}from\"react-redux\";var TaskCreatePage=withStyles(function(_ref){var spacing=_ref.spacing;return{root:{width:\"calc(100% - 16px)\",height:\"calc(100% - 16px)\",display:\"flex\",flexDirection:\"column\",margin:\"8px\",color:\"rgb(220,0,0)\"},itemBox:{width:\"100%\",padding:\"4px\",margin:\"4px\",display:\"flex\",alignItems:\"center\"// backgroundColor: \"white\",\n},projectNo:{// marginLeft: spacing(6),\ndisplay:\"flex\",justifyContent:\"space-between\"}};})(function(_ref2){var classes=_ref2.classes,assignerList=_ref2.assignerList,orderList=_ref2.orderList,projectList=_ref2.projectList,partnerNo=_ref2.partnerNo,fetchCreateTask=_ref2.fetchCreateTask,orders=_ref2.orders;var i18n=React.useContext(LocalizeContext);var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),description=_useState2[0],setDescription=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),details=_useState4[0],setDetails=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),projectNo=_useState6[0],setProjectNo=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),orderNo=_useState8[0],setOrderNo=_useState8[1];var _useState9=useState(moment(new Date()).format(\"YYYY-MM-DD\")),_useState10=_slicedToArray(_useState9,2),dueDate=_useState10[0],setDueDate=_useState10[1];var _useState11=useState(\"\"),_useState12=_slicedToArray(_useState11,2),assigneeID=_useState12[0],setAssigneeID=_useState12[1];var createTaskFn=function createTaskFn(){if(description.length===0){alert(\"任务简介是必填字段\");return;}else if(details.length===0){alert(\"任务明细是必填字段\");return;}else if(projectNo.length===0&&(orderNo===null||orderNo===void 0?void 0:orderNo.length)===0){alert(\"订单号是必填字段\");return;}else if((orderNo===null||orderNo===void 0?void 0:orderNo.length)===0&&projectNo.length===0){alert(\"项目编号是必填字段\");return;}else if(dueDate.length===0){alert(\"到期日是必填字段\");return;}else if(assigneeID.length===0){alert(\"被分配人是必填字段\");return;}var data=[{partnerNo:partnerNo,projectNo:projectNo,orderNo:orderNo,dueDate:dueDate,status:\"A\",description:description,details:details,assigneeID:assigneeID,cplDate:\"\",assigneeCMNT:\"\"}];fetchCreateTask(data);repo.fetchTasks();window.history.back(-1);};return/*#__PURE__*/React.createElement(PrimaryLayout,{name:\"task\",title:i18n.ISNTAPP_TASK_CREATED},/*#__PURE__*/React.createElement(\"form\",{className:classes.root,autoComplete:\"off\"},/*#__PURE__*/React.createElement(Box,{className:classes.itemBox},/*#__PURE__*/React.createElement(TextField,{fullWidth:true,required:true,color:\"secondary\",label:i18n.ISNTAPP_TASK,value:description,onChange:function onChange(e){setDescription(e.target.value);},InputLabelProps:{shrink:true}})),/*#__PURE__*/React.createElement(Box,{className:classes.itemBox},/*#__PURE__*/React.createElement(TextField,{fullWidth:true,multiline:true,required:true,color:\"secondary\",label:i18n.ISNTAPP_TASK_DESCRIPTION,value:details,onChange:function onChange(e){setDetails(e.target.value);},InputLabelProps:{shrink:true}})),!orderNo&&/*#__PURE__*/React.createElement(Box,{className:classes.itemBox},/*#__PURE__*/React.createElement(TextField,{fullWidth:true,select:true,required:orderNo?false:true,color:\"secondary\",label:i18n.PROJECTLIST_PROJECT_NO,value:projectNo,onChange:function onChange(e){setProjectNo(e.target.value);},InputLabelProps:{shrink:true}},projectList.map(function(option,index){return/*#__PURE__*/React.createElement(MenuItem,{key:index,value:option.label,className:classes.projectNo},/*#__PURE__*/React.createElement(Typography,{variant:\"body2\"},option.projectName),/*#__PURE__*/React.createElement(Typography,{variant:\"body2\"},option.value));}))),!projectNo&&/*#__PURE__*/React.createElement(Box,{className:classes.itemBox},/*#__PURE__*/React.createElement(TextField,{fullWidth:true,select:true,required:projectNo?false:true,color:\"secondary\",label:i18n.JOBLIST_ORDER_NUMBER,value:orderNo,onChange:function onChange(e){setOrderNo(e.target.value);setAssigneeID(\"\");},InputLabelProps:{shrink:true}},orderList.map(function(option,index){return/*#__PURE__*/React.createElement(MenuItem,{key:index,value:option.value,className:classes.projectNo},/*#__PURE__*/React.createElement(Typography,{variant:\"body2\"},option.unitDesignation),/*#__PURE__*/React.createElement(Typography,{variant:\"body2\"},option.label));}))),/*#__PURE__*/React.createElement(Box,{className:classes.itemBox},/*#__PURE__*/React.createElement(DatePicker,{autoOk:true,fullWidth:true,required:true,label:i18n.ISNTAPP_DUE_DATE,disableToolbar:true,variant:\"inline\",value:dueDate?new Date(dueDate):null,minDate:new Date(),format:\"YYYY/MM/DD\",onChange:function onChange(d){setDueDate(moment(d).format(\"YYYY-MM-DD\"));}})),/*#__PURE__*/React.createElement(Box,{className:classes.itemBox},/*#__PURE__*/React.createElement(TextField,{required:true,fullWidth:true,select:true,color:\"secondary\",label:i18n.ISNTAPP_ASSIGNEE,value:assigneeID,onChange:function onChange(e){setAssigneeID(e.target.value);},InputLabelProps:{shrink:true}},projectNo?lodash.unionBy(assignerList.filter(function(item){return Object.keys(orders).filter(function(item){return orders[item].projectNumber===projectNo;}).indexOf(item.orderNum)>-1;}),\"label\").map(function(option,index){return/*#__PURE__*/React.createElement(MenuItem,{key:index,value:option.value},option.label);}):assignerList.filter(function(item){return item.orderNum===orderNo;}).map(function(option,index){return/*#__PURE__*/React.createElement(MenuItem,{key:index,value:option.value},option.label);}))),/*#__PURE__*/React.createElement(Button,{style:{backgroundColor:\"rgb(220,0,0)\",color:\"white\",marginTop:\"20px\"},onClick:function onClick(){createTaskFn();}},i18n.ISNTAPP_SUBMIT)));});var mapStateToProps=function mapStateToProps(_ref3){var partners=_ref3.partners,orders=_ref3.orders,projects=_ref3.projects,auth=_ref3.auth;// const filterList = new Set();\nvar orderList=Object.keys(orders).map(function(order){return{label:order,value:order,unitDesignation:orders[order].unitDesignation};}).sort(function(a,b){return a.label?a.label>b.label?1:-1:1;});orderList.unshift({label:\"\",value:\"\",unitDesignation:\"\"});var projectList=Object.keys(projects).map(function(project){return{label:project,value:project,projectName:projects[project].description};}).sort(function(a,b){return a.label?a.label>b.label?1:-1:1;});projectList.unshift({label:\"\",value:\"\",projectName:\"\"});return{assignerList:Array.from(new Set(Object.keys(partners).filter(function(partner){return partners[partner].functionNumber===\"Z(\"||partners[partner].functionNumber===\"VW\"||partners[partner].functionNumber===\"YI\";}).map(function(item){var lable;if(partners[item].functionNumber===\"Z(\"){lable=\"PE-\".concat(partners[item].name1);}else if(partners[item].functionNumber===\"VW\"){lable=\"TL-\".concat(partners[item].name1);}else{lable=\"PM-\".concat(partners[item].name1);}return{label:lable,value:partners[item].number,orderNum:partners[item].orderNumber};}))).sort(function(a,b){return a.label?a.label>b.label?1:-1:1;}).filter(function(items){return items;}),orderList:orderList,projectList:projectList,partnerNo:auth.personalNumber,orders:orders};};var mapDispatchToProps=function mapDispatchToProps(dispatch){return{fetchCreateTask:function fetchCreateTask(data){dispatch(action.fetchCreateTask(data)).then(function(response){repo.fetchTasks().then(function(data){dispatch(action.setTasks(data));});});}};};export default connect(mapStateToProps,mapDispatchToProps)(TaskCreatePage);","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/pages/TaskCreatePage/index.js"],"names":["Box","Button","MenuItem","TextField","Typography","withStyles","DatePicker","action","LocalizeContext","repo","PrimaryLayout","lodash","moment","React","useState","connect","TaskCreatePage","spacing","root","width","height","display","flexDirection","margin","color","itemBox","padding","alignItems","projectNo","justifyContent","classes","assignerList","orderList","projectList","partnerNo","fetchCreateTask","orders","i18n","useContext","description","setDescription","details","setDetails","setProjectNo","orderNo","setOrderNo","Date","format","dueDate","setDueDate","assigneeID","setAssigneeID","createTaskFn","length","alert","data","status","cplDate","assigneeCMNT","fetchTasks","window","history","back","ISNTAPP_TASK_CREATED","ISNTAPP_TASK","e","target","value","shrink","ISNTAPP_TASK_DESCRIPTION","PROJECTLIST_PROJECT_NO","map","option","index","label","projectName","JOBLIST_ORDER_NUMBER","unitDesignation","ISNTAPP_DUE_DATE","d","ISNTAPP_ASSIGNEE","unionBy","filter","item","Object","keys","projectNumber","indexOf","orderNum","backgroundColor","marginTop","ISNTAPP_SUBMIT","mapStateToProps","partners","projects","auth","order","sort","a","b","unshift","project","Array","from","Set","partner","functionNumber","lable","name1","number","orderNumber","items","personalNumber","mapDispatchToProps","dispatch","then","response","setTasks"],"mappings":"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","sourcesContent":["import {\r\n  Box,\r\n  Button,\r\n  MenuItem,\r\n  TextField,\r\n  Typography,\r\n} from \"@material-ui/core\";\r\nimport { withStyles } from \"@material-ui/core/styles\";\r\nimport { DatePicker } from \"@material-ui/pickers\";\r\nimport * as action from \"actions\";\r\nimport { LocalizeContext } from \"i18n\";\r\nimport * as repo from \"js/fetch\";\r\nimport PrimaryLayout from \"layouts/PrimaryLayout\";\r\nimport lodash from \"lodash\";\r\nimport moment from \"moment\";\r\nimport React, { useState } from \"react\";\r\nimport { connect } from \"react-redux\";\r\n\r\nconst TaskCreatePage = withStyles(({ spacing }) => {\r\n  return {\r\n    root: {\r\n      width: `calc(100% - 16px)`,\r\n      height: `calc(100% - 16px)`,\r\n      display: \"flex\",\r\n      flexDirection: \"column\",\r\n      margin: \"8px\",\r\n      color: \"rgb(220,0,0)\",\r\n    },\r\n    itemBox: {\r\n      width: \"100%\",\r\n      padding: \"4px\",\r\n      margin: \"4px\",\r\n      display: \"flex\",\r\n      alignItems: \"center\",\r\n      // backgroundColor: \"white\",\r\n    },\r\n    projectNo: {\r\n      // marginLeft: spacing(6),\r\n      display: \"flex\",\r\n      justifyContent: \"space-between\",\r\n    },\r\n  };\r\n})(\r\n  ({\r\n    classes,\r\n    assignerList,\r\n    orderList,\r\n    projectList,\r\n    partnerNo,\r\n    fetchCreateTask,\r\n    orders,\r\n  }) => {\r\n    const i18n = React.useContext(LocalizeContext);\r\n\r\n    const [description, setDescription] = useState(\"\");\r\n    const [details, setDetails] = useState(\"\");\r\n    const [projectNo, setProjectNo] = useState(\"\");\r\n    const [orderNo, setOrderNo] = useState(\"\");\r\n    const [dueDate, setDueDate] = useState(\r\n      moment(new Date()).format(\"YYYY-MM-DD\")\r\n    );\r\n    const [assigneeID, setAssigneeID] = useState(\"\");\r\n\r\n    const createTaskFn = () => {\r\n      if (description.length === 0) {\r\n        alert(\"任务简介是必填字段\");\r\n        return;\r\n      } else if (details.length === 0) {\r\n        alert(\"任务明细是必填字段\");\r\n        return;\r\n      } else if (projectNo.length === 0 && orderNo?.length === 0) {\r\n        alert(\"订单号是必填字段\");\r\n        return;\r\n      } else if (orderNo?.length === 0 && projectNo.length === 0) {\r\n        alert(\"项目编号是必填字段\");\r\n        return;\r\n      } else if (dueDate.length === 0) {\r\n        alert(\"到期日是必填字段\");\r\n        return;\r\n      } else if (assigneeID.length === 0) {\r\n        alert(\"被分配人是必填字段\");\r\n        return;\r\n      }\r\n      const data = [\r\n        {\r\n          partnerNo: partnerNo,\r\n          projectNo: projectNo,\r\n          orderNo: orderNo,\r\n          dueDate: dueDate,\r\n          status: \"A\",\r\n          description: description,\r\n          details: details,\r\n          assigneeID: assigneeID,\r\n          cplDate: \"\",\r\n          assigneeCMNT: \"\",\r\n        },\r\n      ];\r\n      fetchCreateTask(data);\r\n      repo.fetchTasks();\r\n      window.history.back(-1);\r\n    };\r\n    return (\r\n      <PrimaryLayout name=\"task\" title={i18n.ISNTAPP_TASK_CREATED}>\r\n        <form className={classes.root} autoComplete=\"off\">\r\n          <Box className={classes.itemBox}>\r\n            <TextField\r\n              fullWidth\r\n              required={true}\r\n              color={\"secondary\"}\r\n              label={i18n.ISNTAPP_TASK}\r\n              value={description}\r\n              onChange={(e) => {\r\n                setDescription(e.target.value);\r\n              }}\r\n              InputLabelProps={{\r\n                shrink: true,\r\n              }}\r\n            />\r\n          </Box>\r\n          <Box className={classes.itemBox}>\r\n            <TextField\r\n              fullWidth\r\n              multiline\r\n              required={true}\r\n              color={\"secondary\"}\r\n              label={i18n.ISNTAPP_TASK_DESCRIPTION}\r\n              value={details}\r\n              onChange={(e) => {\r\n                setDetails(e.target.value);\r\n              }}\r\n              InputLabelProps={{\r\n                shrink: true,\r\n              }}\r\n            />\r\n          </Box>\r\n          {!orderNo && (\r\n            <Box className={classes.itemBox}>\r\n              <TextField\r\n                fullWidth\r\n                select\r\n                required={orderNo ? false : true}\r\n                color={\"secondary\"}\r\n                label={i18n.PROJECTLIST_PROJECT_NO}\r\n                value={projectNo}\r\n                onChange={(e) => {\r\n                  setProjectNo(e.target.value);\r\n                }}\r\n                InputLabelProps={{\r\n                  shrink: true,\r\n                }}\r\n              >\r\n                {projectList.map((option, index) => (\r\n                  <MenuItem\r\n                    key={index}\r\n                    value={option.label}\r\n                    className={classes.projectNo}\r\n                  >\r\n                    <Typography variant=\"body2\">\r\n                      {option.projectName}\r\n                    </Typography>\r\n                    <Typography variant=\"body2\">{option.value}</Typography>\r\n                  </MenuItem>\r\n                ))}\r\n              </TextField>\r\n            </Box>\r\n          )}\r\n          {!projectNo && (\r\n            <Box className={classes.itemBox}>\r\n              <TextField\r\n                fullWidth\r\n                select\r\n                required={projectNo ? false : true}\r\n                color={\"secondary\"}\r\n                label={i18n.JOBLIST_ORDER_NUMBER}\r\n                value={orderNo}\r\n                onChange={(e) => {\r\n                  setOrderNo(e.target.value);\r\n                  setAssigneeID(\"\");\r\n                }}\r\n                InputLabelProps={{\r\n                  shrink: true,\r\n                }}\r\n              >\r\n                {orderList.map((option, index) => (\r\n                  <MenuItem\r\n                    key={index}\r\n                    value={option.value}\r\n                    className={classes.projectNo}\r\n                  >\r\n                    <Typography variant=\"body2\">\r\n                      {option.unitDesignation}\r\n                    </Typography>\r\n                    <Typography variant=\"body2\">{option.label}</Typography>\r\n                  </MenuItem>\r\n                ))}\r\n              </TextField>\r\n            </Box>\r\n          )}\r\n          <Box className={classes.itemBox}>\r\n            {/* <TextField\r\n              required\r\n              fullWidth\r\n              color={\"secondary\"}\r\n              label={i18n.ISNTAPP_DUE_DATE}\r\n              type={\"date\"}\r\n              value={dueDate}\r\n              onChange={(e) => {\r\n                setDueDate(e.target.value);\r\n              }}\r\n              InputLabelProps={{\r\n                shrink: true,\r\n              }}\r\n              InputProps={{\r\n                inputProps: { min: moment().format(\"YYYY-MM-DD\") },\r\n              }}\r\n            /> */}\r\n            <DatePicker\r\n              autoOk\r\n              fullWidth\r\n              required\r\n              label={i18n.ISNTAPP_DUE_DATE}\r\n              disableToolbar={true}\r\n              variant=\"inline\"\r\n              value={dueDate ? new Date(dueDate) : null}\r\n              minDate={new Date()}\r\n              format=\"YYYY/MM/DD\"\r\n              onChange={(d) => {\r\n                setDueDate(moment(d).format(\"YYYY-MM-DD\"));\r\n              }}\r\n            />\r\n          </Box>\r\n          <Box className={classes.itemBox}>\r\n            <TextField\r\n              required\r\n              fullWidth\r\n              select\r\n              color={\"secondary\"}\r\n              label={i18n.ISNTAPP_ASSIGNEE}\r\n              value={assigneeID}\r\n              onChange={(e) => {\r\n                setAssigneeID(e.target.value);\r\n              }}\r\n              InputLabelProps={{\r\n                shrink: true,\r\n              }}\r\n            >\r\n              {projectNo\r\n                ? lodash\r\n                    .unionBy(\r\n                      assignerList.filter((item) => {\r\n                        return (\r\n                          Object.keys(orders)\r\n                            .filter((item) => {\r\n                              return orders[item].projectNumber === projectNo;\r\n                            })\r\n                            .indexOf(item.orderNum) > -1\r\n                        );\r\n                      }),\r\n                      \"label\"\r\n                    )\r\n                    .map((option, index) => (\r\n                      <MenuItem key={index} value={option.value}>\r\n                        {option.label}\r\n                      </MenuItem>\r\n                    ))\r\n                : assignerList\r\n                    .filter((item) => {\r\n                      return item.orderNum === orderNo;\r\n                    })\r\n                    .map((option, index) => (\r\n                      <MenuItem key={index} value={option.value}>\r\n                        {option.label}\r\n                      </MenuItem>\r\n                    ))}\r\n            </TextField>\r\n          </Box>\r\n          <Button\r\n            style={{\r\n              backgroundColor: \"rgb(220,0,0)\",\r\n              color: \"white\",\r\n              marginTop: \"20px\",\r\n            }}\r\n            onClick={() => {\r\n              createTaskFn();\r\n            }}\r\n          >\r\n            {i18n.ISNTAPP_SUBMIT}\r\n          </Button>\r\n        </form>\r\n      </PrimaryLayout>\r\n    );\r\n  }\r\n);\r\n\r\nconst mapStateToProps = ({ partners, orders, projects, auth }) => {\r\n  // const filterList = new Set();\r\n  const orderList = Object.keys(orders)\r\n    .map((order) => {\r\n      return {\r\n        label: order,\r\n        value: order,\r\n        unitDesignation: orders[order].unitDesignation,\r\n      };\r\n    })\r\n    .sort((a, b) => (a.label ? (a.label > b.label ? 1 : -1) : 1));\r\n  orderList.unshift({ label: \"\", value: \"\", unitDesignation: \"\" });\r\n  const projectList = Object.keys(projects)\r\n    .map((project) => {\r\n      return {\r\n        label: project,\r\n        value: project,\r\n        projectName: projects[project].description,\r\n      };\r\n    })\r\n    .sort((a, b) => (a.label ? (a.label > b.label ? 1 : -1) : 1));\r\n  projectList.unshift({ label: \"\", value: \"\", projectName: \"\" });\r\n\r\n  return {\r\n    assignerList: Array.from(\r\n      new Set(\r\n        Object.keys(partners)\r\n          .filter((partner) => {\r\n            return (\r\n              partners[partner].functionNumber === \"Z(\" ||\r\n              partners[partner].functionNumber === \"VW\" ||\r\n              partners[partner].functionNumber === \"YI\"\r\n            );\r\n          })\r\n          .map((item) => {\r\n            let lable;\r\n            if (partners[item].functionNumber === \"Z(\") {\r\n              lable = `PE-${partners[item].name1}`;\r\n            } else if (partners[item].functionNumber === \"VW\") {\r\n              lable = `TL-${partners[item].name1}`;\r\n            } else {\r\n              lable = `PM-${partners[item].name1}`;\r\n            }\r\n\r\n            return {\r\n              label: lable,\r\n              value: partners[item].number,\r\n              orderNum: partners[item].orderNumber,\r\n            };\r\n          })\r\n      )\r\n    )\r\n      .sort((a, b) => (a.label ? (a.label > b.label ? 1 : -1) : 1))\r\n      .filter((items) => {\r\n        return items;\r\n      }),\r\n    orderList: orderList,\r\n    projectList: projectList,\r\n    partnerNo: auth.personalNumber,\r\n    orders,\r\n  };\r\n};\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n  return {\r\n    fetchCreateTask: (data) => {\r\n      dispatch(action.fetchCreateTask(data)).then((response) => {\r\n        repo.fetchTasks().then((data) => {\r\n          dispatch(action.setTasks(data));\r\n        });\r\n      });\r\n    },\r\n  };\r\n};\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(TaskCreatePage);\r\n"]},"metadata":{},"sourceType":"module"}