{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\src\\\\components\\\\Camera\\\\index.js\";\nimport { Box, Button, IconButton } from '@material-ui/core';\nimport AppBar from '@material-ui/core/AppBar';\nimport Dialog from '@material-ui/core/Dialog';\nimport List from '@material-ui/core/List';\nimport Slide from '@material-ui/core/Slide';\nimport Toolbar from '@material-ui/core/Toolbar';\nimport Typography from '@material-ui/core/Typography';\nimport CloseIcon from '@material-ui/icons/Close';\nimport { LocalizeContext } from \"i18n\";\nimport React, { useRef, useState } from 'react';\nconst Transition = React.forwardRef(function Transition(props, ref) {\n  return /*#__PURE__*/React.createElement(Slide, Object.assign({\n    direction: \"up\",\n    ref: ref\n  }, props, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 12\n    }\n  }));\n});\nexport default function FullScreenDialog(props) {\n  const i18n = React.useContext(LocalizeContext);\n  const [open, setOpen] = React.useState(false);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const [isCameraOn, setIsCameraOn] = useState(false);\n  const [photo, setPhoto] = useState(null);\n  const pageHeight = document.documentElement.clientHeight;\n  const [videoSize, setVideoSize] = useState({\n    width: 0,\n    height: 0,\n    top: 0,\n    bottom: 0\n  });\n\n  const handleClickOpen = () => {\n    setOpen(true);\n    toggleCamera();\n  };\n\n  const handleClose = async () => {\n    setOpen(false);\n    setPhoto(null);\n    const stream = videoRef.current.srcObject;\n\n    if (stream) {\n      stream.getTracks().forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n    }\n\n    setIsCameraOn(false);\n  };\n\n  const toggleCamera = async () => {\n    if (isCameraOn) {\n      // 停止相机\n      const stream = videoRef.current.srcObject;\n\n      if (stream) {\n        stream.getTracks().forEach(track => track.stop());\n        videoRef.current.srcObject = null;\n      }\n\n      setIsCameraOn(false);\n    } else {\n      // 开启相机\n      try {\n        const stream = await navigator.mediaDevices.getUserMedia({\n          video: {\n            facingMode: {\n              exact: 'environment'\n            }\n          }\n        }); // const stream = await navigator.mediaDevices.getUserMedia({\n        //     video: true\n        // });\n\n        videoRef.current.srcObject = stream;\n        console.log(videoRef.current);\n        setIsCameraOn(true);\n      } catch (error) {\n        console.error(\"Error accessing the camera:\", error);\n      }\n    }\n  };\n\n  const takePhoto = () => {\n    const canvas = canvasRef.current;\n    const video = videoRef.current;\n\n    if (video && canvas) {\n      const context = canvas.getContext('2d');\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      context.drawImage(video, 0, 0, canvas.width, canvas.height); // 获取图像的 base64 编码\n\n      const base64Image = canvas.toDataURL('image/png');\n      setPhoto(base64Image);\n      console.log(base64Image); // 或者根据需要处理\n\n      setIsCameraOn(false);\n      toggleCamera();\n    }\n  };\n\n  var viewportHeight = window.innerHeight;\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    onClick: handleClickOpen,\n    color: \"secondary\",\n    variant: \"body2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 13\n    }\n  }, i18n.ISNTAPP_TAKE_PICTURE), /*#__PURE__*/React.createElement(Dialog, {\n    fullScreen: true,\n    open: open,\n    onClose: handleClose,\n    TransitionComponent: Transition,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(AppBar, {\n    style: {\n      backgroundColor: \"black\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Toolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IconButton, {\n    edge: \"start\",\n    color: \"inherit\",\n    onClick: handleClose,\n    \"aria-label\": \"close\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(CloseIcon, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 29\n    }\n  })))), /*#__PURE__*/React.createElement(List, {\n    style: {\n      backgroundColor: \"black\",\n      padding: 0,\n      margin: 0,\n      height: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      display: 'flex',\n      flexDirection: 'column',\n      alignItems: 'center',\n      justifyContent: 'center',\n      height: \"100%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      width: '100%',\n      height: '100%',\n      position: 'relative',\n      top: 0,\n      left: 0\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    ref: videoRef,\n    playsInline: true,\n    autoPlay: true,\n    style: {\n      display: isCameraOn ? 'block' : 'none',\n      width: '100%',\n      height: '100%',\n      zIndex: 1,\n      marginTop: \"-5%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"img\", {\n    src: photo,\n    alt: \"\",\n    style: {\n      maxWidth: '100%',\n      height: 'auto',\n      display: photo ? 'block' : 'none',\n      position: 'absolute',\n      top: 56\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 29\n    }\n  }), /*#__PURE__*/React.createElement(\"canvas\", {\n    ref: canvasRef,\n    style: {\n      display: 'none'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 29\n    }\n  }), isCameraOn && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      position: \"absolute\",\n      width: \"35%\",\n      height: \"5%\",\n      border: \"1px dashed red\",\n      top: \"40%\",\n      left: \"5%\",\n      borderRadius: \"10%\",\n      pointerEvents: 'none',\n      zIndex: 100\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 33\n    }\n  }), isCameraOn && /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      position: \"absolute\",\n      width: \"30%\",\n      height: viewportHeight / 1.5,\n      border: \"1px dashed red\",\n      top: viewportHeight / 7,\n      right: \"15%\",\n      borderRadius: \"5%\",\n      pointerEvents: 'none',\n      zIndex: 100\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 33\n    }\n  }), /*#__PURE__*/React.createElement(Box, {\n    style: {\n      position: \"fixed\",\n      bottom: 0,\n      left: 0,\n      right: 0,\n      fontWeight: 600,\n      display: \"flex\",\n      justifyContent: \"space-around\",\n      zIndex: 100\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      toggleCamera();\n      setIsCameraOn(true);\n      setPhoto(null);\n    },\n    disabled: isCameraOn,\n    style: {\n      color: 'white'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 33\n    }\n  }, i18n.ISNTAPP_RESHOOT), /*#__PURE__*/React.createElement(Box, {\n    style: {\n      border: \" 5px solid white\",\n      borderRadius: \"50%\",\n      padding: \"2px\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    onClick: () => takePhoto(),\n    disabled: !isCameraOn,\n    style: {\n      color: 'black',\n      width: \"60px\",\n      height: \"60px\",\n      backgroundColor: \"white\",\n      borderRadius: \" 50%\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 180,\n      columnNumber: 37\n    }\n  }, i18n.ISNTAPP_TAKE_PICTURE)), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => {\n      props.onChange(photo);\n      setOpen(false);\n      setPhoto(null);\n    },\n    disabled: isCameraOn,\n    style: {\n      color: 'white'\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 194,\n      columnNumber: 33\n    }\n  }, i18n.ISNTAPP_USE_PHOTOS)))))));\n}","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/components/Camera/index.js"],"names":["Box","Button","IconButton","AppBar","Dialog","List","Slide","Toolbar","Typography","CloseIcon","LocalizeContext","React","useRef","useState","Transition","forwardRef","props","ref","FullScreenDialog","i18n","useContext","open","setOpen","videoRef","canvasRef","isCameraOn","setIsCameraOn","photo","setPhoto","pageHeight","document","documentElement","clientHeight","videoSize","setVideoSize","width","height","top","bottom","handleClickOpen","toggleCamera","handleClose","stream","current","srcObject","getTracks","forEach","track","stop","navigator","mediaDevices","getUserMedia","video","facingMode","exact","console","log","error","takePhoto","canvas","context","getContext","videoWidth","videoHeight","drawImage","base64Image","toDataURL","viewportHeight","window","innerHeight","ISNTAPP_TAKE_PICTURE","backgroundColor","padding","margin","display","flexDirection","alignItems","justifyContent","position","left","zIndex","marginTop","maxWidth","border","borderRadius","pointerEvents","right","fontWeight","color","ISNTAPP_RESHOOT","onChange","ISNTAPP_USE_PHOTOS"],"mappings":"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","sourcesContent":["import { Box, Button, IconButton } from '@material-ui/core';\r\nimport AppBar from '@material-ui/core/AppBar';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport List from '@material-ui/core/List';\r\nimport Slide from '@material-ui/core/Slide';\r\nimport Toolbar from '@material-ui/core/Toolbar';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport CloseIcon from '@material-ui/icons/Close';\r\nimport { LocalizeContext } from \"i18n\";\r\nimport React, { useRef, useState } from 'react';\r\n\r\nconst Transition = React.forwardRef(function Transition(props, ref) {\r\n    return <Slide direction=\"up\" ref={ref} {...props} />;\r\n});\r\n\r\nexport default function FullScreenDialog(props) {\r\n    const i18n = React.useContext(LocalizeContext);\r\n    const [open, setOpen] = React.useState(false);\r\n    const videoRef = useRef(null);\r\n    const canvasRef = useRef(null);\r\n    const [isCameraOn, setIsCameraOn] = useState(false);\r\n    const [photo, setPhoto] = useState(null);\r\n    const pageHeight = document.documentElement.clientHeight;\r\n    const [videoSize, setVideoSize] = useState({\r\n        width: 0,\r\n        height: 0,\r\n        top: 0,\r\n        bottom: 0,\r\n    }); \r\n\r\n\r\n    const handleClickOpen = () => {\r\n        setOpen(true);\r\n        toggleCamera();\r\n    };\r\n\r\n    const handleClose = async () => {\r\n        setOpen(false);\r\n        setPhoto(null);\r\n        const stream = videoRef.current.srcObject;\r\n        if (stream) {\r\n            stream.getTracks().forEach(track => track.stop());\r\n            videoRef.current.srcObject = null;\r\n        }\r\n        setIsCameraOn(false);\r\n    };\r\n\r\n    const toggleCamera = async () => {\r\n        if (isCameraOn) {\r\n            // 停止相机\r\n            const stream = videoRef.current.srcObject;\r\n            if (stream) {\r\n                stream.getTracks().forEach(track => track.stop());\r\n                videoRef.current.srcObject = null;\r\n            }\r\n            setIsCameraOn(false);\r\n        } else {\r\n            // 开启相机\r\n            try {\r\n                const stream = await navigator.mediaDevices.getUserMedia({\r\n                    video: { facingMode: { exact: 'environment' } }\r\n                });\r\n                // const stream = await navigator.mediaDevices.getUserMedia({\r\n                //     video: true\r\n                // });\r\n                videoRef.current.srcObject = stream;\r\n                console.log(videoRef.current)\r\n                setIsCameraOn(true);\r\n            } catch (error) {\r\n                console.error(\"Error accessing the camera:\", error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const takePhoto = () => {\r\n        const canvas = canvasRef.current;\r\n        const video = videoRef.current;\r\n\r\n        if (video && canvas) {\r\n            const context = canvas.getContext('2d');\r\n            canvas.width = video.videoWidth;\r\n            canvas.height = video.videoHeight;\r\n            context.drawImage(video, 0, 0, canvas.width, canvas.height);\r\n\r\n            // 获取图像的 base64 编码\r\n            const base64Image = canvas.toDataURL('image/png');\r\n            setPhoto(base64Image);\r\n            console.log(base64Image); // 或者根据需要处理\r\n            setIsCameraOn(false)\r\n            toggleCamera()\r\n        }\r\n    };\r\n    var viewportHeight = window.innerHeight;\r\n\r\n    return (\r\n        <div>\r\n            <Typography onClick={handleClickOpen} color=\"secondary\" variant=\"body2\">\r\n                {i18n.ISNTAPP_TAKE_PICTURE}\r\n            </Typography>\r\n            <Dialog fullScreen open={open} onClose={handleClose} TransitionComponent={Transition}>\r\n                <AppBar style={{ backgroundColor: \"black\" }}>\r\n                    <Toolbar>\r\n                        <IconButton edge=\"start\" color=\"inherit\" onClick={handleClose} aria-label=\"close\">\r\n                            <CloseIcon />\r\n                        </IconButton>\r\n                    </Toolbar>\r\n                </AppBar>\r\n                <List style={{ backgroundColor: \"black\", padding: 0, margin: 0, height: \"100%\" }}>\r\n                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', height: \"100%\" }}>\r\n                        <div style={{ width: '100%', height: '100%', position: 'relative', top: 0, left: 0 }}>\r\n                            <video\r\n                                ref={videoRef}\r\n                                playsInline\r\n                                autoPlay\r\n                                style={{\r\n                                    display: isCameraOn ? 'block' : 'none', width: '100%', height: '100%', zIndex: 1,\r\n                                    marginTop: \"-5%\"\r\n                                }}\r\n                            />\r\n                            <img src={photo} alt=\"\" style={{\r\n                                maxWidth: '100%', height: 'auto', display: photo ? 'block' : 'none', position: 'absolute',\r\n                                top: 56\r\n                            }} />\r\n                            <canvas ref={canvasRef} style={{ display: 'none' }} />\r\n\r\n                            {isCameraOn && (\r\n                                <div style={{\r\n                                    position: \"absolute\",\r\n                                    width: \"35%\",\r\n                                    height: \"5%\",\r\n                                    border: \"1px dashed red\",\r\n                                    top: \"40%\",\r\n                                    left: \"5%\",\r\n                                    borderRadius: \"10%\",\r\n                                    pointerEvents: 'none',\r\n                                    zIndex: 100\r\n                                }}></div>\r\n                            )}\r\n                            {isCameraOn && (\r\n                                <div style={{\r\n                                    position: \"absolute\",\r\n                                    width: \"30%\",\r\n                                    height: viewportHeight / 1.5,\r\n                                    border: \"1px dashed red\",\r\n                                    top: viewportHeight / 7,\r\n                                    right: \"15%\",\r\n                                    borderRadius: \"5%\",\r\n                                    pointerEvents: 'none',\r\n                                    zIndex: 100\r\n                                }}></div>\r\n                            )}\r\n                            <Box style={{\r\n                                position: \"fixed\",\r\n                                bottom: 0,\r\n                                left: 0,\r\n                                right: 0,\r\n                                fontWeight: 600,\r\n                                display: \"flex\",\r\n                                justifyContent: \"space-around\",\r\n                                zIndex: 100\r\n\r\n                            }}>\r\n                                <Button\r\n                                    onClick={() => {\r\n                                        toggleCamera();\r\n                                        setIsCameraOn(true)\r\n                                        setPhoto(null)\r\n                                    }}\r\n                                    disabled={isCameraOn}\r\n                                    style={{\r\n                                        color: 'white',\r\n                                    }}>\r\n                                    {i18n.ISNTAPP_RESHOOT}\r\n                                </Button>\r\n                                <Box style={{\r\n                                    border: \" 5px solid white\",\r\n                                    borderRadius: \"50%\",\r\n                                    padding: \"2px\"\r\n                                }}>\r\n                                    <Button\r\n                                        onClick={() => takePhoto()}\r\n                                        disabled={!isCameraOn}\r\n                                        style={{\r\n                                            color: 'black',\r\n                                            width: \"60px\",\r\n                                            height: \"60px\",\r\n                                            backgroundColor: \"white\",\r\n                                            borderRadius: \" 50%\",\r\n\r\n                                        }}>\r\n                                        {i18n.ISNTAPP_TAKE_PICTURE}\r\n                                    </Button>\r\n                                </Box>\r\n                                <Button\r\n                                    onClick={() => {\r\n                                        props.onChange(photo);\r\n                                        setOpen(false);\r\n                                        setPhoto(null);\r\n                                    }}\r\n                                    disabled={isCameraOn}\r\n                                    style={{\r\n                                        color: 'white',\r\n                                    }}>\r\n                                    {i18n.ISNTAPP_USE_PHOTOS}\r\n                                </Button>\r\n                            </Box>\r\n                        </div>\r\n                    </div>\r\n                </List>\r\n            </Dialog>\r\n        </div>\r\n    );\r\n}\r\n\r\n\r\n"]},"metadata":{},"sourceType":"module"}