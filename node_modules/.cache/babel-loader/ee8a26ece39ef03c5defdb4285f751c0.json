{"ast":null,"code":"var _jsxFileName = \"C:\\\\project\\\\SCF-NI_PM_App\\\\SCF.InstallationQuality\\\\react-client\\\\src\\\\components\\\\TemplateForm\\\\Photo\\\\index.js\";\nimport { Box, FormLabel, makeStyles, Typography } from \"@material-ui/core\";\nimport Compressor from \"compressorjs\";\nimport { LocalizeContext } from \"i18n\";\nimport { fillTextToImg } from \"js/util\";\nimport React, { useRef, useState } from \"react\";\nimport { useParams } from 'react-router-dom';\nimport Camera from \"../../Camera\";\nconst useStyles = makeStyles(({\n  spacing\n}) => ({\n  btm: {\n    display: \"flex\",\n    justifyContent: \"space-between\",\n    margin: spacing(1, 1, 0, 1)\n  },\n  root: {\n    display: \"grid\",\n    padding: spacing(1, 0),\n    borderBottom: \" 1px solid #e0e0e0\",\n    backgroundColor: \"#FFF\"\n  },\n  lable: {\n    margin: spacing(0, 0, 1, 0),\n    color: \"rgba(0, 0, 0, 0.87)\"\n  },\n  inputFile: {\n    width: \"0.1px\",\n    height: \"0.1px\",\n    opacity: 0,\n    overflow: \"hidden\",\n    position: \"absolute\",\n    top: \"0\",\n    zIndex: -1\n  },\n  file: {\n    height: \"160px\",\n    position: \"relative\",\n    overflow: \"hidden\",\n    textAlign: \"center\"\n  }\n}));\nexport const Photo = props => {\n  const i18n = React.useContext(LocalizeContext);\n  const classes = useStyles();\n  const [photoStyle, setPhotoStyle] = useState({\n    width: \"auto\",\n    height: \"100%\"\n  });\n  const photoEl = useRef(null);\n  const iptRef = useRef(null);\n  const projectData = useParams();\n\n  const onPhotoChange = e => {\n    const fileReader = new FileReader();\n    const file = e.target.files[0];\n    const isCamera = e.target.value.includes('camera');\n    console.log(isCamera ? '用户选择了拍照' : '用户选择了本地图片');\n\n    fileReader.onloadend = e => {\n      const photo = e.target.result;\n\n      if ((projectData === null || projectData === void 0 ? void 0 : projectData.activityNo) === \"7030\" && ((props === null || props === void 0 ? void 0 : props.identifier) === \"photoJ\" || (props === null || props === void 0 ? void 0 : props.identifier) === \"photoP\")) {\n        fillTextToImg(photo, projectData).then(res => {\n          props.onChange(res);\n        });\n      } else {\n        props.onChange(photo);\n      }\n\n      const i = new Image();\n\n      i.onload = () => {\n        setPhotoStyle({\n          // width: photoEl.current.clientWidth,\n          // height: (photoEl.current.clientWidth / i.width) * i.height,\n          width: \"auto\",\n          height: \"100%\"\n        });\n      };\n\n      i.src = photo;\n    };\n\n    if (file) {\n      new Compressor(file, {\n        quality: 0.2,\n        convertSize: 400000,\n\n        success(result) {\n          fileReader.readAsDataURL(result);\n        },\n\n        error(err) {\n          console.log(err.message);\n        }\n\n      });\n    } else {\n      props.onChange(\"#\");\n    }\n  };\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: classes.root,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    variant: \"subtitle2\",\n    className: classes.lable,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }\n  }, props.label), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"input\", {\n    className: classes.inputFile,\n    type: \"file\",\n    accept: \"image/x-png,image/jpeg,image/gif\",\n    id: props.id,\n    ref: iptRef,\n    onChange: onPhotoChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(FormLabel, {\n    required: props.required,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    component: \"span\",\n    variant: \"subtitle2\",\n    className: classes.lable,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 11\n    }\n  }, props.description))), /*#__PURE__*/React.createElement(Box, {\n    border: 1,\n    className: classes.file,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    src: props.value,\n    style: photoStyle,\n    ref: photoEl,\n    alt: \"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 9\n    }\n  })), /*#__PURE__*/React.createElement(Box, {\n    className: classes.btm,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    color: \"secondary\",\n    variant: \"body2\",\n    onClick: () => {\n      props.onChange(\"#\");\n      iptRef.current.value = \"\";\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }\n  }, i18n.ISNTAPP_DELETE), /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: props.id,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 136,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Typography, {\n    color: \"secondary\",\n    variant: \"body2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 11\n    }\n  }, i18n.ISNTAPP_IMPORT_PICTURES)), /*#__PURE__*/React.createElement(Camera, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 9\n    }\n  })));\n};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/components/TemplateForm/Photo/index.js"],"names":["Box","FormLabel","makeStyles","Typography","Compressor","LocalizeContext","fillTextToImg","React","useRef","useState","useParams","Camera","useStyles","spacing","btm","display","justifyContent","margin","root","padding","borderBottom","backgroundColor","lable","color","inputFile","width","height","opacity","overflow","position","top","zIndex","file","textAlign","Photo","props","i18n","useContext","classes","photoStyle","setPhotoStyle","photoEl","iptRef","projectData","onPhotoChange","e","fileReader","FileReader","target","files","isCamera","value","includes","console","log","onloadend","photo","result","activityNo","identifier","then","res","onChange","i","Image","onload","src","quality","convertSize","success","readAsDataURL","error","err","message","label","id","required","description","current","ISNTAPP_DELETE","ISNTAPP_IMPORT_PICTURES"],"mappings":"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","sourcesContent":["import { Box, FormLabel, makeStyles, Typography } from \"@material-ui/core\";\r\nimport Compressor from \"compressorjs\";\r\nimport { LocalizeContext } from \"i18n\";\r\nimport { fillTextToImg } from \"js/util\";\r\nimport React, { useRef, useState } from \"react\";\r\nimport { useParams } from 'react-router-dom';\r\nimport Camera from \"../../Camera\"\r\n\r\nconst useStyles = makeStyles(({ spacing }) => ({\r\n  btm: {\r\n    display: \"flex\",\r\n    justifyContent: \"space-between\",\r\n    margin: spacing(1, 1, 0, 1),\r\n  },\r\n  root: {\r\n    display: \"grid\",\r\n    padding: spacing(1, 0),\r\n    borderBottom: \" 1px solid #e0e0e0\",\r\n    backgroundColor: \"#FFF\",\r\n  },\r\n  lable: {\r\n    margin: spacing(0, 0, 1, 0),\r\n    color: \"rgba(0, 0, 0, 0.87)\",\r\n  },\r\n  inputFile: {\r\n    width: \"0.1px\",\r\n    height: \"0.1px\",\r\n    opacity: 0,\r\n    overflow: \"hidden\",\r\n    position: \"absolute\",\r\n    top: \"0\",\r\n    zIndex: -1,\r\n  },\r\n  file: {\r\n    height: \"160px\",\r\n    position: \"relative\",\r\n    overflow: \"hidden\",\r\n    textAlign: \"center\",\r\n  },\r\n}));\r\n\r\nexport const Photo = (props) => {\r\n  const i18n = React.useContext(LocalizeContext);\r\n  const classes = useStyles();\r\n  const [photoStyle, setPhotoStyle] = useState({\r\n    width: \"auto\",\r\n    height: \"100%\",\r\n  });\r\n  const photoEl = useRef(null);\r\n  const iptRef = useRef(null);\r\n  const projectData = useParams();\r\n  const onPhotoChange = (e) => {\r\n    const fileReader = new FileReader();\r\n    const file = e.target.files[0];\r\n    const isCamera = e.target.value.includes('camera');\r\n    console.log(isCamera ? '用户选择了拍照' : '用户选择了本地图片');\r\n\r\n    fileReader.onloadend = (e) => {\r\n      const photo = e.target.result; \r\n      if (projectData?.activityNo === \"7030\" && (props?.identifier === \"photoJ\" || props?.identifier === \"photoP\")) {\r\n        fillTextToImg(photo, projectData).then((res) => {\r\n          props.onChange(res);\r\n        })\r\n      } else {\r\n        props.onChange(photo);\r\n      }\r\n\r\n      const i = new Image();\r\n      i.onload = () => {\r\n        setPhotoStyle({\r\n          // width: photoEl.current.clientWidth,\r\n          // height: (photoEl.current.clientWidth / i.width) * i.height,\r\n          width: \"auto\",\r\n          height: \"100%\",\r\n        });\r\n      };\r\n      i.src = photo;\r\n    };\r\n    if (file) {\r\n      new Compressor(file, {\r\n        quality: 0.2,\r\n        convertSize: 400000,\r\n        success(result) {\r\n          fileReader.readAsDataURL(result);\r\n        },\r\n        error(err) {\r\n          console.log(err.message);\r\n        },\r\n      });\r\n    } else {\r\n      props.onChange(\"#\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className={classes.root}>\r\n      <Typography variant=\"subtitle2\" className={classes.lable}>\r\n        {props.label}\r\n      </Typography>\r\n      <div>\r\n        <input\r\n          className={classes.inputFile}\r\n          type=\"file\"\r\n          accept=\"image/x-png,image/jpeg,image/gif\"\r\n          id={props.id}\r\n          ref={iptRef}\r\n          onChange={onPhotoChange}\r\n        />\r\n      </div>\r\n      <div>\r\n        {/* <Typography variant=\"body2\">{props.description}</Typography> */}\r\n        <FormLabel required={props.required}>\r\n          <Typography\r\n            component=\"span\"\r\n            variant=\"subtitle2\"\r\n            className={classes.lable}\r\n          >\r\n            {props.description}\r\n          </Typography>\r\n        </FormLabel>\r\n      </div>\r\n      <Box border={1} className={classes.file}>\r\n        <img src={props.value} style={photoStyle} ref={photoEl} alt=\"\" />\r\n      </Box>\r\n      <Box className={classes.btm}>\r\n        <Typography\r\n          color=\"secondary\"\r\n          variant=\"body2\"\r\n          onClick={() => {\r\n            props.onChange(\"#\");\r\n            iptRef.current.value = \"\";\r\n          }}\r\n        >\r\n          {i18n.ISNTAPP_DELETE}\r\n        </Typography>\r\n        <label htmlFor={props.id}>\r\n          <Typography color=\"secondary\" variant=\"body2\">\r\n            {i18n.ISNTAPP_IMPORT_PICTURES}\r\n          </Typography>\r\n        </label>\r\n        <Camera />\r\n      </Box>\r\n    </div>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}