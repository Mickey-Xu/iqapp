{"ast":null,"code":"import{Box,Button,Card,CardActions,CardContent,Grid,Typography,withStyles}from\"@material-ui/core\";import{CancelOutlined,CheckCircleOutlineOutlined,DescriptionOutlined,EventAvailableOutlined,EventNoteOutlined// LockOpenOutlined,\n// LockOutlined,\n,ScheduleOutlined}from\"@material-ui/icons\";import{LocalizeContext}from\"i18n\";import{isInstallationStep}from\"js/installationStep\";import React from\"react\";import{connect}from\"react-redux\";import{useHistory}from\"react-router-dom\";import{toDoOrDone,verifyWhenConfirm7020or70C0,checkFileIsExisting,getTemplateList}from\"../../js/util\";import*as action from\"actions\";var OrderActivityListCard=withStyles(function(_ref){var spacing=_ref.spacing;return{button:{borderRadius:spacing(2.5),textTransform:\"capitalize\",lineHeight:\"unset\",fontSize:\"0.5rem\",padding:\"2px 14px\"},card:{marginTop:spacing(2)// borderTopStyle: \"solid\",\n// borderTopColor: \"#ff0000\",\n},cardActions:{marginLeft:\"0px\"},label:{whiteSpace:\"nowrap\"}};})(function(_ref2){var classes=_ref2.classes,data=_ref2.data,document=_ref2.document,handleClickOpen=_ref2.handleClickOpen,tabType=_ref2.tabType,orderActivities=_ref2.orderActivities,documentList=_ref2.documentList,orders=_ref2.orders,templates=_ref2.templates,fetchNoConformityList=_ref2.fetchNoConformityList;// console.log(data);\nvar i18n=React.useContext(LocalizeContext);var root=\"listCard\";var history=useHistory();var action=[// {\n//   label: i18n.ORDERDETAILS_LOCK,\n//   name: \"Lock\",\n//   component: (auth) => (\n//     <LockOutlined\n//       color={auth.isExecutable.Lock ? \"action\" : \"disabled\"}\n//       onClick={() =>\n//         handleClickOpen(\n//           \"lock\",\n//           data.activityNumber,\n//           (tabType ? data.activityNumber : data.stepNumber) +\n//             \" \" +\n//             data.descriptionShort\n//         )\n//       }\n//     />\n//   ),\n// },\n// {\n//   label: i18n.ORDERDETAILS_UNLOCK,\n//   name: \"unLock\",\n//   component: (auth) => (\n//     <LockOpenOutlined\n//       color={auth.isExecutable.unLock ? \"action\" : \"disabled\"}\n//       onClick={() =>\n//         handleClickOpen(\n//           \"unlock\",\n//           data.activityNumber,\n//           (tabType ? data.activityNumber : data.stepNumber) +\n//             \" \" +\n//             data.descriptionShort\n//         )\n//       }\n//     />\n//   ),\n// },\n{label:i18n.GENERAL_CONFIRM,name:\"Confirm\",component:function component(auth){return/*#__PURE__*/React.createElement(CheckCircleOutlineOutlined,{color:auth.isExecutable.Confirm?\"action\":\"disabled\",onClick:function onClick(){var result=verifyWhenConfirm7020or70C0(orderActivities,data.orderNumber,data.activityNumber);if(result){alert(result.stepNo+result.message);return;}var templateDataList=getTemplateList(templates[data.activityNumber]||[],orders[data.orderNumber].productLine,orders[data.orderNumber].productFamily,orders[data.orderNumber].productCategory);var param=templateDataList.map(function(item){return{foe:orders[data.orderNumber].fo,region:orders[data.orderNumber].region,branch:orders[data.orderNumber].prctr,ProjectNo:orders[data.orderNumber].projectNumber,OrderNo:data.orderNumber,ActivityNo:data.activityNumber,Description:item.documentDescription};});checkFileIsExisting(templates,data,orders).then(function(message){if(message.length<1){param.map(function(item){return fetchNoConformityList(item).then(function(res){var _res$data,_res$data$0$nonConfor;var foundItems=(_res$data=res.data)===null||_res$data===void 0?void 0:(_res$data$0$nonConfor=_res$data[0].nonConformities)===null||_res$data$0$nonConfor===void 0?void 0:_res$data$0$nonConfor.flatMap(function(key){return key.nonConformityItems.filter(function(subItem){return subItem.questionType===\"Triangle\"&&subItem.itemValue===\"no\";});});if(foundItems.length>0){alert(\"\\u60A8\\u6709\".concat(foundItems.length,\"\\u4E2A\\u4E09\\u89D2\\u9879\\u68C0\\u67E5\\u9879\\u672A\\u5173\\u95ED\\uFF0C\\u8BF7\\u5173\\u95ED\\u4E09\\u89D2\\u9879\\u540E\\u518D\\u786E\\u8BA4\\u8282\\u70B9\"));return false;};});});handleClickOpen(\"confirm\",data.activityNumber,(tabType?data.activityNumber:data.stepNumber)+\" \"+data.description);}else{alert(\"\\u8BF7\\u4E0A\\u4F20 \".concat(message.toString()));}});}});}},{label:i18n.GENERAL_CANCEL,name:\"Cancel\",component:function component(auth){return/*#__PURE__*/React.createElement(CancelOutlined,{color:auth.isExecutable.Cancel?\"action\":\"disabled\",onClick:function onClick(){return handleClickOpen(\"cancel\",data.activityNumber,(tabType?data.activityNumber:data.stepNumber)+\" \"+data.description);}});}},{label:document===\"Done\"?i18n.ISNTAPP_JOBLIST_DOC_DONE:document===\"ToDo\"?i18n.ISNTAPP_JOBLIST_DOC_TODO:i18n.ISNTAPP_WITHOUT_TEMPLATES,name:\"Document\",component:function component(){return/*#__PURE__*/React.createElement(DescriptionOutlined,{style:{margin:\"auto\"},color:document===\"Done\"||document===\"ToDo\"?\"action\":\"disabled\",onClick:function onClick(){history.push(\"/documents/\".concat(data.activityNumber,\"/\").concat(data.orderNumber,\"/\").concat(data.productFamily,\"/\").concat(root));}});}}];return/*#__PURE__*/React.createElement(Card,{className:classes.card},/*#__PURE__*/React.createElement(CardContent,null,/*#__PURE__*/React.createElement(Button,{disabled:true,variant:\"contained\",style:{backgroundColor:data.isExecutable.Confirm?\"#8bc34a\":\"\",color:data.isExecutable.Confirm?\"white\":\"black\"},classes:{root:classes.button}},data.info,\" \",data.hint&&i18n.ISNTAPP_NO_PERMISSION),/*#__PURE__*/React.createElement(Box,{mt:2},/*#__PURE__*/React.createElement(Box,{style:{display:\"inline-flex\"}},/*#__PURE__*/React.createElement(ScheduleOutlined,{color:\"action\",style:{fontSize:\"1.4rem\"}}),/*#__PURE__*/React.createElement(Typography,{variant:\"body1\",fontWeight:500},!isInstallationStep(data.activityNumber)?i18n.JOBLIST_ACTIVITY:i18n.ISNTAPP_JOBLIST_INST_STEPS,\": \",data.activityNumber+\" \"+data.description))),/*#__PURE__*/React.createElement(Box,{mt:1.5},/*#__PURE__*/React.createElement(Grid,{container:true},/*#__PURE__*/React.createElement(Grid,{item:true,xs:6,style:{display:\"inline-flex\"}},/*#__PURE__*/React.createElement(EventNoteOutlined,{style:{fontSize:\"1.05rem\"},color:\"action\"}),/*#__PURE__*/React.createElement(Typography,{variant:\"caption\"},i18n.PROJECTLIST_PLANNED_FINISH,\": \",data.leadingDate)),/*#__PURE__*/React.createElement(Grid,{item:true,xs:6,style:{display:\"inline-flex\",justifyContent:\"flex-start\"}},/*#__PURE__*/React.createElement(EventAvailableOutlined,{style:{fontSize:\"1.05rem\"},color:\"action\"}),/*#__PURE__*/React.createElement(Typography,{variant:\"caption\"},i18n.PROJECTLIST_CONFIRMED_FINISH,\": \",data.confirmedDate))))),/*#__PURE__*/React.createElement(CardActions,{style:{backgroundColor:\"#f5f5f5\",overflow:\"auto\"}},action.map(function(item,index){var Component=item.component;var disabled=false;if(item.name===\"Lock\"){disabled=!data.isExecutable.Lock;}if(item.name===\"unLock\"){disabled=!data.isExecutable.unLock;}if(item.name===\"Confirm\"){disabled=!data.isExecutable.Confirm;}if(item.name===\"Cancel\"){disabled=!data.isExecutable.Cancel;}if(item.name===\"Document\"){disabled=!((document===\"ToDo\"||document===\"Done\")&&data.isExecutable.canReadDoc);}return/*#__PURE__*/React.createElement(Button,{size:\"small\",key:index,disabled:disabled,style:{display:\"inline-grid\",flex:\"auto\",marginLeft:\"0px\"}},/*#__PURE__*/React.createElement(Component,{isExecutable:data.isExecutable}),/*#__PURE__*/React.createElement(Typography,{variant:\"caption\",className:classes.label},item.label));})));});export default connect(function(_ref3,_ref4){var _orders$orderNumber;var _ref3$templates=_ref3.templates,templates=_ref3$templates===void 0?[]:_ref3$templates,documentList=_ref3.documentList,orders=_ref3.orders,orderActivities=_ref3.orderActivities;var _ref4$data=_ref4.data,activityNo=_ref4$data.activityNumber,orderNumber=_ref4$data.orderNumber;var projectNumber=(_orders$orderNumber=orders[orderNumber])===null||_orders$orderNumber===void 0?void 0:_orders$orderNumber.projectNumber;var document=toDoOrDone(projectNumber,orderNumber,activityNo,templates,documentList);return{document:document,orderActivities:orderActivities,documentList:documentList,orders:orders,templates:templates};},function(dispatch){return{fetchNoConformityList:function fetchNoConformityList(data){return dispatch(action.getNoConformityList(data));}};})(OrderActivityListCard);","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/components/OrderActivityListCard/index.js"],"names":["Box","Button","Card","CardActions","CardContent","Grid","Typography","withStyles","CancelOutlined","CheckCircleOutlineOutlined","DescriptionOutlined","EventAvailableOutlined","EventNoteOutlined","ScheduleOutlined","LocalizeContext","isInstallationStep","React","connect","useHistory","toDoOrDone","verifyWhenConfirm7020or70C0","checkFileIsExisting","getTemplateList","action","OrderActivityListCard","spacing","button","borderRadius","textTransform","lineHeight","fontSize","padding","card","marginTop","cardActions","marginLeft","label","whiteSpace","classes","data","document","handleClickOpen","tabType","orderActivities","documentList","orders","templates","fetchNoConformityList","i18n","useContext","root","history","GENERAL_CONFIRM","name","component","auth","isExecutable","Confirm","result","orderNumber","activityNumber","alert","stepNo","message","templateDataList","productLine","productFamily","productCategory","param","map","item","foe","fo","region","branch","prctr","ProjectNo","projectNumber","OrderNo","ActivityNo","Description","documentDescription","then","length","res","foundItems","nonConformities","flatMap","key","nonConformityItems","filter","subItem","questionType","itemValue","stepNumber","description","toString","GENERAL_CANCEL","Cancel","ISNTAPP_JOBLIST_DOC_DONE","ISNTAPP_JOBLIST_DOC_TODO","ISNTAPP_WITHOUT_TEMPLATES","margin","push","backgroundColor","color","info","hint","ISNTAPP_NO_PERMISSION","display","JOBLIST_ACTIVITY","ISNTAPP_JOBLIST_INST_STEPS","PROJECTLIST_PLANNED_FINISH","leadingDate","justifyContent","PROJECTLIST_CONFIRMED_FINISH","confirmedDate","overflow","index","Component","disabled","Lock","unLock","canReadDoc","flex","activityNo","dispatch","getNoConformityList"],"mappings":"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","sourcesContent":["import {\r\n  Box,\r\n  Button,\r\n  Card,\r\n  CardActions,\r\n  CardContent,\r\n  Grid,\r\n  Typography,\r\n  withStyles,\r\n} from \"@material-ui/core\";\r\nimport {\r\n  CancelOutlined,\r\n  CheckCircleOutlineOutlined,\r\n  DescriptionOutlined,\r\n  EventAvailableOutlined,\r\n  EventNoteOutlined,\r\n  // LockOpenOutlined,\r\n  // LockOutlined,\r\n  ScheduleOutlined,\r\n} from \"@material-ui/icons\";\r\nimport { LocalizeContext } from \"i18n\";\r\nimport { isInstallationStep } from \"js/installationStep\";\r\nimport React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { useHistory } from \"react-router-dom\";\r\nimport {\r\n  toDoOrDone,\r\n  verifyWhenConfirm7020or70C0,\r\n  checkFileIsExisting,\r\n  getTemplateList\r\n} from \"../../js/util\";\r\nimport * as action from \"actions\";\r\n\r\nconst OrderActivityListCard = withStyles(({ spacing }) => {\r\n  return {\r\n    button: {\r\n      borderRadius: spacing(2.5),\r\n      textTransform: \"capitalize\",\r\n      lineHeight: \"unset\",\r\n      fontSize: \"0.5rem\",\r\n      padding: \"2px 14px\",\r\n    },\r\n    card: {\r\n      marginTop: spacing(2),\r\n      // borderTopStyle: \"solid\",\r\n      // borderTopColor: \"#ff0000\",\r\n    },\r\n    cardActions: {\r\n      marginLeft: \"0px\",\r\n    },\r\n    label: {\r\n      whiteSpace: \"nowrap\",\r\n    },\r\n  };\r\n})(\r\n  ({\r\n    classes,\r\n    data,\r\n    document,\r\n    handleClickOpen,\r\n    tabType,\r\n    orderActivities,\r\n    documentList,\r\n    orders,\r\n    templates,\r\n    fetchNoConformityList\r\n  }) => {\r\n    // console.log(data);\r\n    const i18n = React.useContext(LocalizeContext);\r\n    const root = \"listCard\";\r\n    const history = useHistory();\r\n    const action = [\r\n      // {\r\n      //   label: i18n.ORDERDETAILS_LOCK,\r\n      //   name: \"Lock\",\r\n      //   component: (auth) => (\r\n      //     <LockOutlined\r\n      //       color={auth.isExecutable.Lock ? \"action\" : \"disabled\"}\r\n      //       onClick={() =>\r\n      //         handleClickOpen(\r\n      //           \"lock\",\r\n      //           data.activityNumber,\r\n      //           (tabType ? data.activityNumber : data.stepNumber) +\r\n      //             \" \" +\r\n      //             data.descriptionShort\r\n      //         )\r\n      //       }\r\n      //     />\r\n      //   ),\r\n      // },\r\n      // {\r\n      //   label: i18n.ORDERDETAILS_UNLOCK,\r\n      //   name: \"unLock\",\r\n      //   component: (auth) => (\r\n      //     <LockOpenOutlined\r\n      //       color={auth.isExecutable.unLock ? \"action\" : \"disabled\"}\r\n      //       onClick={() =>\r\n      //         handleClickOpen(\r\n      //           \"unlock\",\r\n      //           data.activityNumber,\r\n      //           (tabType ? data.activityNumber : data.stepNumber) +\r\n      //             \" \" +\r\n      //             data.descriptionShort\r\n      //         )\r\n      //       }\r\n      //     />\r\n      //   ),\r\n      // },\r\n      {\r\n        label: i18n.GENERAL_CONFIRM,\r\n        name: \"Confirm\",\r\n        component: (auth) => (\r\n          <CheckCircleOutlineOutlined\r\n            color={auth.isExecutable.Confirm ? \"action\" : \"disabled\"}\r\n            onClick={() => {\r\n              const result = verifyWhenConfirm7020or70C0(\r\n                orderActivities,\r\n                data.orderNumber,\r\n                data.activityNumber\r\n              );\r\n              if (result) {\r\n                alert(result.stepNo + result.message);\r\n                return;\r\n              }\r\n\r\n\r\n\r\n              const templateDataList = getTemplateList(\r\n                templates[data.activityNumber] || [],\r\n                orders[data.orderNumber].productLine,\r\n                orders[data.orderNumber].productFamily,\r\n                orders[data.orderNumber].productCategory\r\n              );\r\n\r\n              const param = templateDataList.map((item) => {\r\n                return {\r\n                  foe: orders[data.orderNumber].fo,\r\n                  region: orders[data.orderNumber].region,\r\n                  branch: orders[data.orderNumber].prctr,\r\n                  ProjectNo: orders[data.orderNumber].projectNumber,\r\n                  OrderNo: data.orderNumber,\r\n                  ActivityNo: data.activityNumber,\r\n                  Description: item.documentDescription,\r\n                };\r\n              });\r\n\r\n              checkFileIsExisting(templates, data, orders).then((message) => {\r\n                if (message.length < 1) {\r\n                  param.map(item =>\r\n                    fetchNoConformityList(item).then((res) => {\r\n                      const foundItems = res.data?.[0].nonConformities?.flatMap(key =>\r\n                        key.nonConformityItems.filter(\r\n                          subItem => subItem.questionType === \"Triangle\" && subItem.itemValue === \"no\"\r\n                        )\r\n                      );\r\n\r\n                      if (foundItems.length > 0) {\r\n                        alert(`您有${foundItems.length}个三角项检查项未关闭，请关闭三角项后再确认节点`);\r\n                        return false;\r\n                      };\r\n                    })\r\n                  )\r\n                  handleClickOpen(\r\n                    \"confirm\",\r\n                    data.activityNumber,\r\n                    (tabType ? data.activityNumber : data.stepNumber) +\r\n                    \" \" +\r\n                    data.description\r\n                  );\r\n                } else {\r\n                  alert(`请上传 ${message.toString()}`);\r\n                }\r\n              });\r\n            }}\r\n          />\r\n        ),\r\n      },\r\n      {\r\n        label: i18n.GENERAL_CANCEL,\r\n        name: \"Cancel\",\r\n        component: (auth) => (\r\n          <CancelOutlined\r\n            color={auth.isExecutable.Cancel ? \"action\" : \"disabled\"}\r\n            onClick={() =>\r\n              handleClickOpen(\r\n                \"cancel\",\r\n                data.activityNumber,\r\n                (tabType ? data.activityNumber : data.stepNumber) +\r\n                \" \" +\r\n                data.description\r\n              )\r\n            }\r\n          />\r\n        ),\r\n      },\r\n      {\r\n        label:\r\n          document === \"Done\"\r\n            ? i18n.ISNTAPP_JOBLIST_DOC_DONE\r\n            : document === \"ToDo\"\r\n              ? i18n.ISNTAPP_JOBLIST_DOC_TODO\r\n              : i18n.ISNTAPP_WITHOUT_TEMPLATES,\r\n        name: \"Document\",\r\n        component: () => (\r\n          <DescriptionOutlined\r\n            style={{ margin: \"auto\" }}\r\n            color={\r\n              document === \"Done\" || document === \"ToDo\" ? \"action\" : \"disabled\"\r\n            }\r\n            onClick={() => {\r\n              history.push(\r\n                `/documents/${data.activityNumber}/${data.orderNumber}/${data.productFamily}/${root}`\r\n              );\r\n            }}\r\n          />\r\n        ),\r\n      },\r\n    ];\r\n\r\n    return (\r\n      <Card className={classes.card}>\r\n        <CardContent>\r\n          <Button\r\n            disabled\r\n            variant=\"contained\"\r\n            style={{\r\n              backgroundColor: data.isExecutable.Confirm ? \"#8bc34a\" : \"\",\r\n              color: data.isExecutable.Confirm ? \"white\" : \"black\",\r\n            }}\r\n            classes={{ root: classes.button }}\r\n          >\r\n            {data.info} {data.hint && i18n.ISNTAPP_NO_PERMISSION}\r\n          </Button>\r\n          <Box mt={2}>\r\n            <Box style={{ display: \"inline-flex\" }}>\r\n              <ScheduleOutlined color=\"action\" style={{ fontSize: \"1.4rem\" }} />\r\n              <Typography variant=\"body1\" fontWeight={500}>\r\n                {!isInstallationStep(data.activityNumber)\r\n                  ? i18n.JOBLIST_ACTIVITY\r\n                  : i18n.ISNTAPP_JOBLIST_INST_STEPS}\r\n                : {data.activityNumber + \" \" + data.description}\r\n              </Typography>\r\n            </Box>\r\n          </Box>\r\n          <Box mt={1.5}>\r\n            <Grid container>\r\n              <Grid item xs={6} style={{ display: \"inline-flex\" }}>\r\n                <EventNoteOutlined\r\n                  style={{ fontSize: \"1.05rem\" }}\r\n                  color=\"action\"\r\n                />\r\n                <Typography variant=\"caption\">\r\n                  {i18n.PROJECTLIST_PLANNED_FINISH}: {data.leadingDate}\r\n                </Typography>\r\n              </Grid>\r\n              <Grid\r\n                item\r\n                xs={6}\r\n                style={{\r\n                  display: \"inline-flex\",\r\n                  justifyContent: \"flex-start\",\r\n                }}\r\n              >\r\n                <EventAvailableOutlined\r\n                  style={{ fontSize: \"1.05rem\" }}\r\n                  color=\"action\"\r\n                />\r\n                <Typography variant=\"caption\">\r\n                  {i18n.PROJECTLIST_CONFIRMED_FINISH}: {data.confirmedDate}\r\n                </Typography>\r\n              </Grid>\r\n            </Grid>\r\n          </Box>\r\n        </CardContent>\r\n        <CardActions style={{ backgroundColor: \"#f5f5f5\", overflow: \"auto\" }}>\r\n          {action.map((item, index) => {\r\n            const Component = item.component;\r\n            let disabled = false;\r\n\r\n            if (item.name === \"Lock\") {\r\n              disabled = !data.isExecutable.Lock;\r\n            }\r\n\r\n            if (item.name === \"unLock\") {\r\n              disabled = !data.isExecutable.unLock;\r\n            }\r\n\r\n            if (item.name === \"Confirm\") {\r\n              disabled = !data.isExecutable.Confirm;\r\n            }\r\n\r\n            if (item.name === \"Cancel\") {\r\n              disabled = !data.isExecutable.Cancel;\r\n            }\r\n\r\n            if (item.name === \"Document\") {\r\n              disabled = !(\r\n                (document === \"ToDo\" || document === \"Done\") &&\r\n                data.isExecutable.canReadDoc\r\n              );\r\n            }\r\n\r\n            return (\r\n              <Button\r\n                size=\"small\"\r\n                key={index}\r\n                disabled={disabled}\r\n                style={{\r\n                  display: \"inline-grid\",\r\n                  flex: \"auto\",\r\n                  marginLeft: \"0px\",\r\n                }}\r\n              >\r\n                <Component isExecutable={data.isExecutable} />\r\n                <Typography variant=\"caption\" className={classes.label}>\r\n                  {item.label}\r\n                </Typography>\r\n              </Button>\r\n            );\r\n          })}\r\n        </CardActions>\r\n      </Card>\r\n    );\r\n  }\r\n);\r\nexport default connect(\r\n  (\r\n    { templates = [], documentList, orders, orderActivities },\r\n    { data: { activityNumber: activityNo, orderNumber } }\r\n  ) => {\r\n    const projectNumber = orders[orderNumber]?.projectNumber;\r\n    const document = toDoOrDone(\r\n      projectNumber,\r\n      orderNumber,\r\n      activityNo,\r\n      templates,\r\n      documentList\r\n    );\r\n\r\n    return {\r\n      document,\r\n      orderActivities,\r\n      documentList,\r\n      orders,\r\n      templates,\r\n    };\r\n  }, (dispatch) => {\r\n    return {\r\n      fetchNoConformityList: (data) => {\r\n        return dispatch(action.getNoConformityList(data));\r\n      },\r\n    };\r\n  }\r\n)(OrderActivityListCard);\r\n"]},"metadata":{},"sourceType":"module"}