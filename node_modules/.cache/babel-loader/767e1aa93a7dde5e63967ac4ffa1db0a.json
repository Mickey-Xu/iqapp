{"ast":null,"code":"import * as action from \"actions\";\nimport * as api from \"api\";\nimport * as repo from \"js/fetch\";\nimport { saveTheFirstRefreshTime } from \"js/util\";\nexport const setAuth = auth => {\n  return {\n    type: \"SET_AUTH\",\n    payload: auth\n  };\n};\nexport const clearState = () => {\n  return {\n    type: \"USER_LOGOUT\"\n  };\n};\n\nconst getIDPToken = () => {\n  const data = {\n    \"AppId\": \"SCF.IQAPP\",\n    \"UserName\": \"IQAPP\",\n    \"Password\": \"YtLPPMGa9YUkGsJZNYJA8\"\n  };\n  axios.post(\"/user/login\", data, {\n    headers: {\n      \"Content-Type\": \"application/json\"\n    }\n  }).then(response => {\n    var _response$data;\n\n    window.localStorage.setItem(\"idptAuth\", JSON.stringify((_response$data = response.data) === null || _response$data === void 0 ? void 0 : _response$data.data));\n  }).catch(error => {\n    console.error('Error:', error);\n  });\n};\n\nexport const login = data => dispatch => {\n  dispatch(action.showLoading());\n  return api.login(data).then(response => {\n    const {\n      result\n    } = response.data;\n\n    if (result === 2) {\n      return Promise.reject({\n        message: \"用户名或密码错误\"\n      });\n    }\n\n    return repo.fetchProfile();\n  }).then(data => {\n    if (data.isPwdInit) {\n      return data;\n    } else {\n      dispatch(action.setAuth(data));\n      window.localStorage.setItem(\"auth\", JSON.stringify(data));\n      saveTheFirstRefreshTime(dispatch);\n      dispatch(action.setHistoryPage(\"loginPage\"));\n      return repo.fetchInstMethods();\n    }\n  }).catch(error => {\n    window.localStorage.removeItem(\"auth\");\n    dispatch(action.setAuth(null));\n    dispatch(action.setError(error.message));\n  }).finally(() => {\n    dispatch(action.hideLoading());\n  });\n};\nexport const logout = () => dispatch => {\n  dispatch(action.showLoading());\n  return api.logout().then(() => {\n    window.localStorage.removeItem(\"auth\");\n    dispatch(setAuth(null));\n    dispatch(clearState());\n  }).catch(error => {\n    dispatch(action.setError(error));\n  }).finally(() => {\n    dispatch(action.hideLoading());\n  });\n};","map":{"version":3,"sources":["C:/project/SCF-NI_PM_App/SCF.InstallationQuality/react-client/src/actions/auth.js"],"names":["action","api","repo","saveTheFirstRefreshTime","setAuth","auth","type","payload","clearState","getIDPToken","data","axios","post","headers","then","response","window","localStorage","setItem","JSON","stringify","catch","error","console","login","dispatch","showLoading","result","Promise","reject","message","fetchProfile","isPwdInit","setHistoryPage","fetchInstMethods","removeItem","setError","finally","hideLoading","logout"],"mappings":"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","sourcesContent":["import * as action from \"actions\";\r\nimport * as api from \"api\";\r\nimport * as repo from \"js/fetch\";\r\nimport { saveTheFirstRefreshTime } from \"js/util\";\r\n\r\nexport const setAuth = (auth) => {\r\n  return { type: \"SET_AUTH\", payload: auth };\r\n};\r\n\r\nexport const clearState = () => {\r\n  return { type: \"USER_LOGOUT\" };\r\n};\r\n\r\nconst getIDPToken = () => {\r\n  const data = {\r\n    \"AppId\": \"SCF.IQAPP\",\r\n    \"UserName\": \"IQAPP\",\r\n    \"Password\": \"YtLPPMGa9YUkGsJZNYJA8\"\r\n  }\r\n\r\n  axios.post(\"/user/login\", data, {\r\n    headers: { \"Content-Type\": \"application/json\" }\r\n  })\r\n    .then(response => {\r\n      window.localStorage.setItem(\"idptAuth\", JSON.stringify(response.data?.data));\r\n    })\r\n    .catch(error => {\r\n      console.error('Error:', error);\r\n    });\r\n\r\n}\r\n\r\nexport const login = (data) => (dispatch) => {\r\n  dispatch(action.showLoading());\r\n  return api\r\n    .login(data)\r\n    .then((response) => {\r\n      const { result } = response.data;\r\n      if (result === 2) {\r\n        return Promise.reject({ message: \"用户名或密码错误\" });\r\n      }\r\n      return repo.fetchProfile();\r\n    })\r\n    .then((data) => {\r\n      if (data.isPwdInit) {\r\n        return data;\r\n      } else {\r\n        dispatch(action.setAuth(data));\r\n        window.localStorage.setItem(\"auth\", JSON.stringify(data));\r\n        saveTheFirstRefreshTime(dispatch);\r\n        dispatch(action.setHistoryPage(\"loginPage\"));\r\n        return repo.fetchInstMethods();\r\n      }\r\n    })\r\n    .catch((error) => {\r\n      window.localStorage.removeItem(\"auth\");\r\n      dispatch(action.setAuth(null));\r\n      dispatch(action.setError(error.message));\r\n    })\r\n    .finally(() => {\r\n      dispatch(action.hideLoading());\r\n    });\r\n};\r\n\r\nexport const logout = () => (dispatch) => {\r\n  dispatch(action.showLoading());\r\n  return api\r\n    .logout()\r\n    .then(() => {\r\n      window.localStorage.removeItem(\"auth\");\r\n      dispatch(setAuth(null));\r\n      dispatch(clearState());\r\n    })\r\n    .catch((error) => {\r\n      dispatch(action.setError(error));\r\n    })\r\n    .finally(() => {\r\n      dispatch(action.hideLoading());\r\n    });\r\n};\r\n"]},"metadata":{},"sourceType":"module"}