"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core"),n=function(n){var i=n.page,a=n.pageHeight,r=n.pageWidth,u=n.rotation,o=n.thumbnailHeight,c=n.thumbnailWidth,g=e.useRef(),s=e.useState(""),h=s[0],p=s[1];return e.useEffect((function(){var e=g.current;e&&e.cancel();var t=document.createElement("canvas"),n=t.getContext("2d",{alpha:!1}),o=c,s=o/(r/a),h=o/r;t.height=s,t.width=o,t.style.height=s+"px",t.style.width=o+"px";var l=i.getViewport({rotation:u,scale:h});g.current=i.render({canvasContext:n,viewport:l}),g.current.promise.then((function(){return p(t.toDataURL())}),(function(){}))}),[u]),h?e.createElement("img",{src:h,height:o+"px",width:c+"px"}):e.createElement(t.Spinner,null)},i=function(i){var a=i.doc,r=i.pageHeight,u=i.pageIndex,o=i.pageWidth,c=i.rotation,g=e.useState({height:r,isCalculated:!1,page:null,viewportRotation:0,width:o}),s=g[0],h=g[1],p=s.isCalculated,l=s.page,d=s.height,m=s.width,f=m/d,b=Math.abs(c)%180==0,v=b?100:100/f,E=b?100/f:100,w=(c+s.viewportRotation)%360,P=t.useIntersectionObserver({onVisibilityChanged:function(e){e.isVisible&&!p&&a.getPage(u+1).then((function(e){var t=e.getViewport({scale:1});h({height:t.height,isCalculated:!0,page:e,viewportRotation:t.rotation,width:t.width})}))}});return e.createElement("div",{className:"rpv-thumbnail-container",ref:P,style:{height:E+"px",width:v+"px"}},l?e.createElement(n,{page:l,pageHeight:b?d:m,pageWidth:b?m:d,rotation:w,thumbnailHeight:E,thumbnailWidth:v}):e.createElement(t.Spinner,null))},a=function(t){var n=t.currentPage,a=t.doc,r=t.pageHeight,u=t.pageWidth,o=t.rotation,c=t.onJumpToPage,g=a.numPages;return e.createElement("div",{className:"rpv-thumbnail-list"},Array(g).fill(0).map((function(t,g){var s,h,p;return e.createElement("div",{key:"thumbnail-"+g,onClick:function(){return c(g)}},e.createElement("div",{className:(s={},s["rpv-thumbnail-item"]=!0,s["rpv-thumbnail-item-selected"]=n===g,h=s,p=[],Object.keys(h).forEach((function(e){e&&h[e]&&p.push(e)})),p.join(" "))},e.createElement(i,{doc:a,pageHeight:r,pageIndex:g,pageWidth:u,rotation:o})))})))},r=function(n){var i=n.store,r=e.useState(i.get("doc")),u=r[0],o=r[1],c=e.useState(i.get("currentPage")||0),g=c[0],s=c[1],h=e.useState(i.get("pageHeight")||0),p=h[0],l=h[1],d=e.useState(i.get("pageWidth")||0),m=d[0],f=d[1],b=e.useState(i.get("rotation")||0),v=b[0],E=b[1],w=function(e){s(e)},P=function(e){o(e)},x=function(e){l(e)},H=function(e){f(e)},W=function(e){E(e)};return e.useEffect((function(){return i.subscribe("doc",P),i.subscribe("pageHeight",x),i.subscribe("pageWidth",H),i.subscribe("rotation",W),function(){i.unsubscribe("doc",P),i.unsubscribe("pageHeight",x),i.unsubscribe("pageWidth",H),i.unsubscribe("rotation",W)}}),[]),t.useIsomorphicLayoutEffect((function(){return i.subscribe("currentPage",w),function(){i.unsubscribe("currentPage",w)}}),[]),u?e.createElement(a,{currentPage:g,doc:u,pageHeight:p,pageWidth:m,rotation:v,onJumpToPage:function(e){var t=i.get("jumpToPage");t&&t(e)}}):e.createElement("div",{className:"rpv-thumbnail-list-loader"},e.createElement(t.Spinner,null))};exports.thumbnailPlugin=function(){var n=e.useMemo((function(){return t.createStore({})}),[]);return{install:function(e){n.update("jumpToPage",e.jumpToPage)},onDocumentLoad:function(e){n.update("doc",e.doc)},onViewerStateChange:function(e){return n.update("currentPage",e.pageIndex),n.update("pageHeight",e.pageHeight),n.update("pageWidth",e.pageWidth),e},Thumbnails:function(){return e.createElement(r,{store:n})}}};
