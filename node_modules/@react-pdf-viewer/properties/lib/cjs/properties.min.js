"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("react"),t=require("@react-pdf-viewer/core"),r=function(){return e.createElement(t.Icon,{size:16},e.createElement("path",{d:"M12,1.001c6.075,0,11,4.925,11,11s-4.925,11-11,11s-11-4.925-11-11S5.925,1.001,12,1.001z\n                M14.5,17.005H13\n                c-0.552,0-1-0.448-1-1v-6.5c0-0.276-0.224-0.5-0.5-0.5H10\n                M11.745,6.504L11.745,6.504\n                M11.745,6.5c-0.138,0-0.25,0.112-0.25,0.25\n                S11.607,7,11.745,7s0.25-0.112,0.25-0.25S11.883,6.5,11.745,6.5"}))},n=function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)},o=function(r){var n=r.doc,o=r.render,a=e.useState(),i=a[0],l=a[1];return e.useEffect((function(){n.getMetadata().then((function(e){return Promise.resolve(e)})).then((function(e){return n.getDownloadInfo().then((function(t){return Promise.resolve({fileName:e.contentDispositionFilename||"",info:e.info,length:t.length})}))})).then((function(e){l(e)}))}),[]),i?o(i):e.createElement("div",{className:"rpv-properties-loader"},e.createElement(t.Spinner,null))},a=function(t){var r=t.label,n=t.value;return e.createElement("dl",{className:"rpv-property-item"},e.createElement("dt",{className:"rpv-property-item-label"},r,":"),e.createElement("dd",{className:"rpv-property-item-value"},n||"-"))},i=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"),l=function(e,t,r,n){var o=parseInt(e,10);return o>=t&&o<=r?o:n},c=function(r){var n=r.doc,c=r.fileName,p=r.onToggle,u=e.useContext(t.LocalizationContext),s=function(e){var t=function(e){var t=i.exec(e);if(!t)return null;var r=parseInt(t[1],10),n=l(t[2],1,12,1)-1,o=l(t[3],1,31,1),a=l(t[4],0,23,0),c=l(t[5],0,59,0),p=l(t[6],0,59,0),u=t[7]||"Z",s=l(t[8],0,23,0),m=l(t[9],0,59,0);switch(u){case"-":a+=s,c+=m;break;case"+":a-=s,c-=m}return new Date(Date.UTC(r,n,o,a,c,p))}(e);return t?t.toLocaleDateString()+", "+t.toLocaleTimeString():""};return e.createElement("div",{className:"rpv-properties-modal"},e.createElement(o,{doc:n,render:function(r){return e.createElement(e.Fragment,null,e.createElement("div",{className:"rpv-properties-modal-group"},e.createElement(a,{label:u&&u.properties?u.properties.fileName:"File name",value:r.fileName||(l=c,p=l.split("/").pop(),p?p.split("#")[0].split("?")[0]:l)}),e.createElement(a,{label:u&&u.properties?u.properties.fileSize:"File size",value:(o=r.length,i=Math.floor(Math.log(o)/Math.log(1024)),(o/Math.pow(1024,i)).toFixed(2)+" "+["B","kB","MB","GB","TB"][i])})),e.createElement(t.Separator,null),e.createElement("div",{className:"rpv-properties-modal-group"},e.createElement(a,{label:u&&u.properties?u.properties.title:"Title",value:r.info.Title}),e.createElement(a,{label:u&&u.properties?u.properties.author:"Author",value:r.info.Author}),e.createElement(a,{label:u&&u.properties?u.properties.subject:"Subject",value:r.info.Subject}),e.createElement(a,{label:u&&u.properties?u.properties.keywords:"Keywords",value:r.info.Keywords}),e.createElement(a,{label:u&&u.properties?u.properties.creator:"Creator",value:r.info.Creator}),e.createElement(a,{label:u&&u.properties?u.properties.creationDate:"Creation date",value:s(r.info.CreationDate)}),e.createElement(a,{label:u&&u.properties?u.properties.modificationDate:"Modification date",value:s(r.info.ModDate)})),e.createElement(t.Separator,null),e.createElement("div",{className:"rpv-properties-modal-group"},e.createElement(a,{label:u&&u.properties?u.properties.pdfProducer:"PDF producer",value:r.info.Producer}),e.createElement(a,{label:u&&u.properties?u.properties.pdfVersion:"PDF version",value:r.info.PDFFormatVersion}),e.createElement(a,{label:u&&u.properties?u.properties.pageCount:"Page count",value:""+n.numPages})));var o,i,l,p}}),e.createElement("div",{className:"rpv-properties-modal-footer"},e.createElement(t.PrimaryButton,{onClick:p},u&&u.properties?u.properties.close:"Close")))},p={left:0,top:8},u=function(n){var o=n.onClick,a=e.useContext(t.LocalizationContext),i=a&&a.properties?a.properties.showProperties:"Show properties";return e.createElement(t.Tooltip,{position:t.Position.BottomCenter,target:e.createElement(t.Button,{onClick:o},e.createElement(r,null)),content:function(){return i},offset:p})},s=function(r){var o=r.children,a=r.store,i=function(t){var r=e.useState(t.get("doc")),n=r[0],o=r[1],a=function(e){o(e)};return e.useEffect((function(){return t.subscribe("doc",a),function(){t.unsubscribe("doc",a)}}),[]),{currentDoc:n}}(a).currentDoc,l=a.get("fileName")||"",p=o||function(t){return e.createElement(u,n({},t))};return i?e.createElement(t.Modal,{target:function(e){return p({onClick:e})},content:function(t){return e.createElement(c,{doc:i,fileName:l,onToggle:t})},closeOnClickOutside:!0,closeOnEscape:!0}):e.createElement(e.Fragment,null)},m=function(n){var o=n.onClick,a=e.useContext(t.LocalizationContext),i=a&&a.properties?a.properties.showProperties:"Show properties";return e.createElement(t.MenuItem,{icon:e.createElement(r,null),onClick:o},i)};exports.InfoIcon=r,exports.propertiesPlugin=function(){var r=e.useMemo((function(){return t.createStore({fileName:""})}),[]),o=function(t){return e.createElement(s,n({},t,{store:r}))};return{onDocumentLoad:function(e){r.update("doc",e.doc)},onViewerStateChange:function(e){return r.update("fileName",e.file.name),e},ShowProperties:o,ShowPropertiesButton:function(){return e.createElement(s,{store:r})},ShowPropertiesMenuItem:function(t){return e.createElement(o,null,(function(t){return e.createElement(m,n({},t))}))}}};
